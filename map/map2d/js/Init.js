function PROXY_ControlManager(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(null!==NPMap.Managers.ControlManager&&"function"==typeof NPMap.Managers.ControlManager[t])return NPMap.Managers.ControlManager[t].apply(NPMap.Managers.ControlManager,e)}function PROXY_LayerManager(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(null!==NPMap.Managers.LayerManager&&"function"==typeof NPMap.Managers.LayerManager[t])return NPMap.Managers.LayerManager[t].apply(NPMap.Managers.LayerManager,e)}function PROXY_MapManager(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(null!==NPMap.Managers.MapManager&&"function"==typeof NPMap.Managers.MapManager[t])return NPMap.Managers.MapManager[t].apply(NPMap.Managers.MapManager,e)}function PROXY_OtherManager(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(null!==NPMap.Managers.OtherManager&&"function"==typeof NPMap.Managers.OtherManager[t])return NPMap.Managers.OtherManager[t].apply(NPMap.Managers.OtherManager,e)}function PROXY_OverlayManager(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(null!==NPMap.Managers.OverlayManager&&"function"==typeof NPMap.Managers.OverlayManager[t])return NPMap.Managers.OverlayManager[t].apply(NPMap.Managers.OverlayManager,e)}function overlayContextMenuCallBack(e,t){try{NPMapLib.callMethod("OnOverlayContextMenuCallBack",t,e)}catch(i){window.alert(e+","+t)}}function MessageLog(e){if(EzServerClient.GlobeParams.IsDebug)try{JavaScriptLog(JSON.stringify(e))}catch(t){console.log(JSON.stringify(e))}}!function(){var NPNamespace=window.NPNamespace=NPNamespace||{};window.NPNamespace.register=function(fullNS){for(var nsArray=fullNS.split("."),sEval="",sNS="",i=0;i<nsArray.length;i++)0!=i&&(sNS+="."),sNS+=nsArray[i],sEval+="if (typeof("+sNS+") == 'undefined') "+sNS+" = new Object();";""!=sEval&&eval(sEval)},window.NPMapLib=window.NPMap=window.NPMapLib||{},window.NPMapLib.VERSION_NUMBER="1.0.5.0",window.NPMapLib.IsDebug=!1,NPMap.ISWGS84=!0,window.NPMapLib.ISPOINTCONVERT=!0,window.NPMapLib.CULTURE="CN",NPMapLib.ADAPTER_TYPE_OPENLAYERS="OpenLayers",window.NPMapLib.Adapter=window.NPMapLib.Adapter||{},window.NPMapLib.Controls=window.NPMapLib.Controls||{},window.NPMapLib.Geometry=window.NPMapLib.Geometry||{},window.NPMapLib.Layers=window.NPMapLib.Layers||{},window.NPMapLib.Managers=window.NPMapLib.Managers||{},window.NPMapLib.Symbols=window.NPMapLib.Symbols||{},window.NPMapLib.Tools=window.NPMapLib.Tools||{},window.NPMapLib.Utils=window.NPMapLib.Utils||{},window.NPMapLib.Services=window.NPMapLib.Services||{},window.EzServerClient=window.EzServerClient||{},window.EzServerClient.GlobeParams=window.EzServerClient.GlobeParams||{},window.EzServerClient.GlobeParams.MyMapType=NPMapLib.MAP_LAYER_TYPE_EZMAP_TILE,NPMapLib.MAP_LAYER_TYPE_EZMAP_OFFLINE=0,NPMapLib.MAP_LAYER_TYPE_EZMAP_TILE=1,NPMapLib.MAP_LAYER_TYPE_GOOGLE_OFFLINE=2,NPMapLib.MAP_LAYER_TYPE_GOOGLE_TILE=3,NPMapLib.MAP_LAYER_TYPE_ARCGIS_OFFLINE=4,NPMapLib.MAP_LAYER_TYPE_ARCGIS_TILE=5,NPMapLib.MAP_LAYER_TYPE_WMS=6,NPMapLib.MAP_LAYER_TYPE_VECTORGML=7,NPMapLib.MAP_LAYER_TYPE_VECTORWFS=8,NPMapLib.MAP_LAYER_TYPE_OVERLAY=9,NPMapLib.MAP_LAYER_TYPE_TDMAP=10,NPMapLib.MAP_LAYER_TYPE_QQMAP=11,NPMapLib.MAP_LAYER_TYPE_GAODEMAP=12,NPMapLib.GEOMETRY_TYPE_UNKNOWN=0,NPMapLib.GEOMETRY_TYPE_POINT=1,NPMapLib.GEOMETRY_TYPE_POLYLINE=2,NPMapLib.GEOMETRY_TYPE_POLYGON=3,NPMapLib.GEOMETRY_TYPE_CIRCLE=4,NPMapLib.GEOMETRY_TYPE_RECTANGLE=5,NPMapLib.GEOMETRY_TYPE_CIRCLESECTOR=6,window.NPMapLib.LINE_TYPE_SOLID=0,window.NPMapLib.LINE_TYPE_DASH=1,window.NPMapLib.LINE_TYPE_DOT=2,window.NPMapLib.LINE_TYPE_DASHDOTDOT=3,window.NPMapLib.LINE_TYPE_DASHDOT=4,window.NPMapLib.LINE_TYPE_SHORTDASH=5,window.NPMapLib.LINE_TYPE_SHORTDOT=6,window.NPMapLib.LINE_TYPE_SHORTDASHDOTDOT=7,window.NPMapLib.LINE_TYPE_SHORTDASHDOT=8,window.NPMapLib.LINE_TYPE_LONGDASH=9,window.NPMapLib.LINE_TYPE_LONGDASHDOT=10,window.NPMapLib.LINE_ARROW_TYPE_REVERSE=-1,window.NPMapLib.LINE_ARROW_TYPE_NULL=0,window.NPMapLib.LINE_ARROW_TYPE_FORWORD=1,window.NPMapLib.LINE_ARROW_TYPE_BOTH=2,window.NPMapLib.MEASURE_MODE_DISTANCE=0,window.NPMapLib.MEASURE_MODE_AREA=1,window.NPMapLib.MEASURE_MODE_LOCATION=2,window.NPMapLib.DRAW_MODE_NONE=0,window.NPMapLib.DRAW_MODE_RECT=1,window.NPMapLib.DRAW_MODE_CIRCLE=2,window.NPMapLib.DRAW_MODE_POLYLINE=3,window.NPMapLib.DRAW_MODE_POLYLGON=4,window.NPMapLib.DRAW_MODE_CIRCLE_DIAMETER=5,window.NPMapLib.DRAW_MODE_FREEHAND=6,NPMapLib.OVERLAY_TYPE_UNKNOWN=0,NPMapLib.OVERLAY_TYPE_POLYLINE=1,NPMapLib.OVERLAY_TYPE_POLYGON=2,NPMapLib.OVERLAY_TYPE_CIRCLE=3,NPMapLib.OVERLAY_TYPE_LABEL=4,NPMapLib.OVERLAY_TYPE_MARKER=5,NPMapLib.OVERLAY_TYPE_INFOWIN=6,NPMapLib.OVERLAY_TYPE_POINT=7,NPMapLib.OVERLAY_TYPE_CIRCLESECTOR=8,NPMapLib.OVERLAY_TYPE_ClusterPoints=9,NPMapLib.OVERLAY_TYPE_DIALOG=10,NPMap.OVERLAY_TYPE_BUBBLE=11,NPMapLib.CONTROL_TYPE_UNKNOWN=0,NPMapLib.CONTROL_TYPE_COPYRIGHT=1,NPMapLib.CONTROL_TYPE_NAVIGATION=2,NPMapLib.CONTROL_TYPE_OVERVIEW=3,NPMapLib.CONTROL_TYPE_SCALE=4,NPMapLib.CONTROL_TYPE_NORTH=5,NPMapLib.CONTROL_TYPE_MOUSEPOSITION=6,NPMapLib.CONTROL_TYPE_JWMOUSEPOSITION=7,NPMapLib.CONTROL_TYPE_ZOOMANIMATION=8,NPMapLib.MAP_UNITS_UNKNOWN="UnknownUnits",NPMapLib.MAP_UNITS_CENTIMETERS="Centimeters",NPMapLib.MAP_UNITS_DECIMAL_DEGREES="DecimalDegrees",NPMapLib.MAP_UNITS_DEGREE_MINUTE_SECONDS="DegreeMinuteSeconds",NPMapLib.MAP_UNITS_DECIMETERS="Decimeters",NPMapLib.MAP_UNITS_FEET="Feet",NPMapLib.MAP_UNITS_INCHES="Inches",NPMapLib.MAP_UNITS_KILOMETERS="Kilometers",NPMapLib.MAP_UNITS_METERS="Meters",NPMapLib.MAP_UNITS_MILES="Miles",NPMapLib.MAP_UNITS_MILLIMETERS="Millimeters",NPMapLib.MAP_UNITS_NAUTICAL_MILES="NauticalMiles",NPMapLib.MAP_UNITS_POINTS="Points",NPMapLib.MAP_UNITS_YARDS="Yards",NPMapLib.MAP_UNITS_ACRES="Acres",NPMapLib.MAP_UNITS_ARES="Ares",NPMapLib.MAP_UNITS_SQUARE_KILOMETERS="SquareKilometers",NPMapLib.MAP_UNITS_SQUARE_MILES="SquareMiles",NPMapLib.MAP_UNITS_SQUARE_FEET="SquareFeet",NPMapLib.MAP_UNITS_SQUARE_METERS="SquareMeters",NPMapLib.MAP_UNITS_HECTARES="Hectares",NPMapLib.MAP_UNITS_SQUARE_YARDS="SquareYards",NPMapLib.MAP_UNITS_SQUARE_INCHES="SquareInches",NPMapLib.MAP_UNITS_SQUARE_MILLIMETERS="SquareMillimeters",NPMapLib.MAP_UNITS_SQUARE_CENTIMETERS="SquareCentimeters",NPMapLib.MAP_UNITS_SQUARE_DECIMETERS="SquareDecimeters",NPMapLib.CONTROL_ANCHOR_TOP_LEFT=0,NPMapLib.CONTROL_ANCHOR_TOP_RIGHT=1,NPMapLib.CONTROL_ANCHOR_BOTTOM_LEFT=2,NPMapLib.CONTROL_ANCHOR_BOTTOM_RIGHT=3,NPMapLib.MAPTYPE_ARCGISTILE=8,NPMapLib.MAPTYPE_PGIS=1,NPMapLib.MAPTYPE_WMS=2,NPMapLib.MAPTYPE_GOOGLE=3,NPMapLib.MAPTYPE_BAIDU=4,NPMapLib.MAPTYPE_BING=5,NPMapLib.MAPTYPE_IMAGE=6,NPMapLib.MAPTYPE_GEOSERVER=7,NPMapLib.MAPTYPE_NPGIS=9,NPMapLib.ModifyFeature_DRAG=8,NPMapLib.ModifyFeature_ROTATE=4,NPMapLib.ModifyFeature_RESIZE=2,NPMapLib.ModifyFeature_RESHAPE=1,NPMapLib.MapMeasure_CloseMarkDispaly=!0,NPMapLib.USING_ADAPTER=NPMapLib.ADAPTER_TYPE_OPENLAYERS}(),NPMap.Utils.BaseUtils=function(){function _getScriptLocation(){for(var e,t,i=new RegExp("(^|(.*?\\/))("+scriptName+")(\\?|$)"),r=document.getElementsByTagName("script"),n="",s=0,o=r.length;s<o;s++)if(e=r[s].getAttribute("src","i"),e&&(t=e.match(i))){n=t[1];break}return n}var scriptName="Init.js",host=_getScriptLocation(),e={};return e.getScriptLocation=function(){var e=document.getElementsByTagName("script");return e[e.length-1].getAttribute("src")},e.getHostPath=function(){return host},e.getScriptDictoryLocation=function(){var e=this.getScriptLocation();if(e||!(e.length<0))return e.substring(0,e.lastIndexOf("/")+1)},e.createError=function(e,t){return t?new Error(e+"\r\nBecause :"+t.message):new Error(e)},e.addtrusturl=function(e){},e.popupwindow=function(e){},e.addtrustmyself=function(){this.addtrusturl(window.location.href)},e.addpopwinmyself=function(){this.popupwindow(window.location.href)},e.addCSSFiles=function(e){if(e&&!(e.length<=0)){for(var t=new Array(e.length),i=0,r=e.length;i<r;i++)t[i]="<link type='text/css' rel='stylesheet' href = '"+host+"/"+e[i]+"'/> ";t.length>0&&document.write(t.join(""))}},e.addJSFiles=function(e){if(e&&!(e.length<=0)){for(var t=new Array(e.length),i=0,r=e.length;i<r;i++)t[i]="<script type='text/javascript' src='"+(""==host?"":host+"/")+e[i]+"'></script>";t.length>0&&document.write(t.join(""))}},e.toJson=function(e){switch(e.constructor){case Object:var t="{";for(var i in e)t+="'"+i+"':"+NPMap.Utils.BaseUtils.toJson(e[i])+",";return","==t.substr(t.length-1)&&(t=t.substr(0,t.length-1)),t+"}";case Array:for(var t="[",r=0;r<e.length;r++)e[r]&&(t+=NPMap.Utils.BaseUtils.toJson(e[r])+",");return","==t.substr(t.length-1)&&(t=t.substr(0,t.length-1)),t+"]";case Boolean:return'"'+e.toString()+'"';case Date:return'"'+e.toString()+'"';case Function:break;case Number:return e.toString();case String:return'"'+e.toString()+'"'}},e.JsonToStr=function(e){var t,i=[],r=function(e){if("function"!=typeof e)return"object"==typeof e&&null!=e?NPMap.Utils.BaseUtils.JsonToStr(e):/^(string|number)$/.test(typeof e)?"'"+e+"'":e};for(var n in e)t=r(e[n]),t&&i.push("'"+n+"':"+t);return"{"+i.join(",")+"}"},e.isTypeRight=function(param,type){switch(type){case"string":return"string"==typeof param;case"int":return"number"==typeof param&&param.toString().indexOf(".")==-1;case"float":return"number"==typeof param;case"number":return"number"==typeof param;case"boolean":return"boolean"==typeof param;case"Array":return param instanceof Array==1;case"function":return"function"==typeof param;case"object":return"object"==typeof param;case"undefined":return"undefined"==typeof param;default:return param instanceof eval(type)}},e}(),Function.prototype.bind=function(){var e=this,t=Array.prototype.slice.call(arguments),i=t.shift();return function(){return e.apply(i,t.concat(Array.prototype.slice.call(arguments)))}},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t,i=0;t=this[i];i++)if(t==e)return i;return-1}),String.prototype.padLeft=function(e,t){for(var i=this;i.length<t;)i=i.length+e.length<t?e+i:e.substring(0,t-i.length)+i;return i},function(){"undefined"!=typeof OpenLayersClient&&OpenLayersClient||(OpenLayersClient=new Object),"undefined"!=typeof OpenLayersClient.GlobeParams&&OpenLayersClient.GlobeParams||(OpenLayersClient.GlobeParams=new Object),OpenLayersClient.GlobeParams.MyMapType=NPMap.MAP_LAYER_TYPE_ARCGIS_TILE,OpenLayersClient.GlobeParams.IsLocal=!1;var e=("object"==typeof OpenLayers&&OpenLayers.singleFile,"Init.js");window.OpenLayers;window.OpenLayers={_getScriptLocation:function(){for(var t,i,r=new RegExp("(^|(.*?\\/))("+e+")(\\?|$)"),n=document.getElementsByTagName("script"),s="",o=0,a=n.length;o<a;o++)if(t=n[o].getAttribute("src"),t&&(i=t.match(r))){s=i[1];break}return function(){return s+"Netposa/"}}(),ImgPath:""},OpenLayers.VERSION_NUMBER="Release 2.13"}(),OpenLayers.Class=function(){var e=arguments.length,t=arguments[0],i=arguments[e-1],r="function"==typeof i.initialize?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(e>1){var n=[r,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i);OpenLayers.inherit.apply(null,n)}else r.prototype=i;return r},OpenLayers.inherit=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i;var r,n,s;for(r=2,n=arguments.length;r<n;r++)s=arguments[r],"function"==typeof s&&(s=s.prototype),OpenLayers.Util.extend(e.prototype,s)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(e,t){if(e=e||{},t){for(var i in t){var r=t[i];void 0!==r&&(e[i]=r)}var n="function"==typeof window.Event&&t instanceof window.Event;!n&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var e=[],t=0,i=arguments.length;t<i;t++){var r=arguments[t];if("string"==typeof r&&(r=document.getElementById(r)),1==arguments.length)return r;e.push(r)}return e},OpenLayers.Util.isElement=function(e){return!(!e||1!==e.nodeType)},OpenLayers.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},OpenLayers.Util.removeItem=function(e,t){for(var i=e.length-1;i>=0;i--)e[i]==t&&e.splice(i,1);return e},OpenLayers.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var i=0,r=e.length;i<r;i++)if(e[i]==t)return i;return-1},OpenLayers.Util.dotless=/\./g,OpenLayers.Util.modifyDOMElement=function(e,t,i,r,n,s,o,a){t&&(e.id=t.replace(OpenLayers.Util.dotless,"_")),i&&(e.style.left=i.x+"px",e.style.top=i.y+"px"),r&&(e.style.width=r.w+"px",e.style.height=r.h+"px"),n&&(e.style.position=n),s&&(e.style.border=s),o&&(e.style.overflow=o),parseFloat(a)>=0&&parseFloat(a)<1?(e.style.filter="alpha(opacity="+100*a+")",e.style.opacity=a):1==parseFloat(a)&&(e.style.filter="",e.style.opacity="")},OpenLayers.Util.createDiv=function(e,t,i,r,n,s,o,a){var l=document.createElement("div");return r&&(l.style.backgroundImage="url("+r+")"),e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),n||(n="absolute"),OpenLayers.Util.modifyDOMElement(l,e,t,i,n,s,o,a),l},OpenLayers.Util.createImage=function(e,t,i,r,n,s,o,a){function l(){p.style.display="",OpenLayers.Event.stopObservingElement(p)}var p=document.createElement("img");return e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),n||(n="relative"),OpenLayers.Util.modifyDOMElement(p,e,t,i,n,s,null,o),a&&(p.style.display="none",OpenLayers.Event.observe(p,"load",l),OpenLayers.Event.observe(p,"error",l)),p.style.alt=e,p.galleryImg="no",r&&(p.src=r),p},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),t=parseFloat(e[1]),i=!1;try{i=!!document.body.filters}catch(r){}OpenLayers.Util.alphaHackNeeded=i&&t>=5.5&&t<7}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(e,t,i,r,n,s,o,a,l){OpenLayers.Util.modifyDOMElement(e,t,i,r,s,null,null,l);var p=e.childNodes[0];n&&(p.src=n),OpenLayers.Util.modifyDOMElement(p,e.id+"_innerImage",null,r,"relative",o),OpenLayers.Util.alphaHack()&&("none"!=e.style.display&&(e.style.display="inline-block"),null==a&&(a="scale"),e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+p.src+"', sizingMethod='"+a+"')",parseFloat(e.style.opacity)>=0&&parseFloat(e.style.opacity)<1&&(e.style.filter+=" alpha(opacity="+100*e.style.opacity+")"),p.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(e,t,i,r,n,s,o,a,l){var p=OpenLayers.Util.createDiv(),h=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l);return h.className="olAlphaImg",p.appendChild(h),OpenLayers.Util.modifyAlphaImageDiv(p,e,t,i,r,n,s,o,a),p},OpenLayers.Util.upperCaseObject=function(e){var t={};for(var i in e)t[i.toUpperCase()]=e[i];return t},OpenLayers.Util.applyDefaults=function(e,t){e=e||{};var i="function"==typeof window.Event&&t instanceof window.Event;for(var r in t)(void 0===e[r]||!i&&t.hasOwnProperty&&t.hasOwnProperty(r)&&!e.hasOwnProperty(r))&&(e[r]=t[r]);return!i&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e},OpenLayers.Util.getParameterString=function(e){var t=[];for(var i in e){var r=e[i];if(null!=r&&"function"!=typeof r){var n;if("object"==typeof r&&r.constructor==Array){for(var s,o=[],a=0,l=r.length;a<l;a++)s=r[a],o.push(encodeURIComponent(null===s||void 0===s?"":s));n=o.join(",")}else n=encodeURIComponent(r);t.push(encodeURIComponent(i)+"="+n)}}return t.join("&")},OpenLayers.Util.urlAppend=function(e,t){var i=e;if(t){var r=(e+" ").split(/[?&]/);i+=" "===r.pop()?t:r.length?"&"+t:"?"+t}return i},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(e){return OpenLayers.Util.getImagesLocation()+e},OpenLayers.Util.Try=function(){for(var e=null,t=0,i=arguments.length;t<i;t++){var r=arguments[t];try{e=r();break}catch(n){}}return e},OpenLayers.Util.getXmlNodeValue=function(e){var t=null;return OpenLayers.Util.Try(function(){t=e.text,t||(t=e.textContent),t||(t=e.firstChild.nodeValue)},function(){t=e.textContent}),t},OpenLayers.Util.mouseLeft=function(e,t){for(var i=e.relatedTarget?e.relatedTarget:e.toElement;i!=t&&null!=i;)i=i.parentNode;return i!=t},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(e,t){return null==t&&(t=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof e&&(e=parseFloat(e)),0===t?e:parseFloat(e.toPrecision(t))},OpenLayers.Util.rad=function(e){return e*Math.PI/180},OpenLayers.Util.deg=function(e){return 180*e/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(e,t){for(var i=OpenLayers.Util.VincentyConstants,r=i.a,n=i.b,s=i.f,o=OpenLayers.Util.rad(t.lon-e.lon),a=Math.atan((1-s)*Math.tan(OpenLayers.Util.rad(e.lat))),l=Math.atan((1-s)*Math.tan(OpenLayers.Util.rad(t.lat))),p=Math.sin(a),h=Math.cos(a),u=Math.sin(l),y=Math.cos(l),c=o,d=2*Math.PI,m=20;Math.abs(c-d)>1e-12&&--m>0;){var f=Math.sin(c),g=Math.cos(c),L=Math.sqrt(y*f*(y*f)+(h*u-p*y*g)*(h*u-p*y*g));if(0===L)return 0;var v=p*u+h*y*g,O=Math.atan2(L,v),P=Math.asin(h*y*f/L),b=Math.cos(P)*Math.cos(P),w=v-2*p*u/b,M=s/16*b*(4+s*(4-3*b));d=c,c=o+(1-M)*s*Math.sin(P)*(O+M*L*(w+M*v*(-1+2*w*w)))}if(0===m)return NaN;var _=b*(r*r-n*n)/(n*n),x=1+_/16384*(4096+_*(-768+_*(320-175*_))),C=_/1024*(256+_*(-128+_*(74-47*_))),S=C*L*(w+C/4*(v*(-1+2*w*w)-C/6*w*(-3+4*L*L)*(-3+4*w*w))),N=n*x*(O-S),E=N.toFixed(3)/1e3;return E},OpenLayers.Util.destinationVincenty=function(e,t,i){for(var r=OpenLayers.Util,n=r.VincentyConstants,s=n.a,o=n.b,a=n.f,l=e.lon,p=e.lat,h=i,u=r.rad(t),y=Math.sin(u),c=Math.cos(u),d=(1-a)*Math.tan(r.rad(p)),m=1/Math.sqrt(1+d*d),f=d*m,g=Math.atan2(d,c),L=m*y,v=1-L*L,O=v*(s*s-o*o)/(o*o),P=1+O/16384*(4096+O*(-768+O*(320-175*O))),b=O/1024*(256+O*(-128+O*(74-47*O))),w=h/(o*P),M=2*Math.PI;Math.abs(w-M)>1e-12;){var _=Math.cos(2*g+w),x=Math.sin(w),C=Math.cos(w),S=b*x*(_+b/4*(C*(-1+2*_*_)-b/6*_*(-3+4*x*x)*(-3+4*_*_)));M=w,w=h/(o*P)+S}var N=f*x-m*C*c,E=Math.atan2(f*C+m*x*c,(1-a)*Math.sqrt(L*L+N*N)),T=Math.atan2(x*y,m*C-f*x*c),A=a/16*v*(4+a*(4-3*v)),I=T-(1-A)*a*L*(w+A*x*(_+A*C*(-1+2*_*_)));Math.atan2(L,-N);return new OpenLayers.LonLat(l+r.deg(I),r.deg(E))},OpenLayers.Util.getParameters=function(e,t){t=t||{},e=null===e||void 0===e?window.location.href:e;var i="";if(OpenLayers.String.contains(e,"?")){var r=e.indexOf("?")+1,n=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length;i=e.substring(r,n)}for(var s={},o=i.split(/[&;]/),a=0,l=o.length;a<l;++a){var p=o[a].split("=");if(p[0]){var h=p[0];try{h=decodeURIComponent(h)}catch(u){h=unescape(h)}var y=(p[1]||"").replace(/\+/g," ");try{y=decodeURIComponent(y)}catch(u){y=unescape(y)}t.splitArgs!==!1&&(y=y.split(",")),1==y.length&&(y=y[0]),s[h]=y}}return s},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(e){return e=null==e?"id_":e.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,e+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(e){var t=e>1?1/e:e;return t},OpenLayers.Util.getResolutionFromScale=function(e,t){var i;if(e){null==t&&(t="degrees");var r=OpenLayers.Util.normalizeScale(e);i=1/(r*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)}return i},OpenLayers.Util.getScaleFromResolution=function(e,t){null==t&&(t="degrees");var i=e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH;return i},OpenLayers.Util.pagePosition=function(e){var t=[0,0],i=OpenLayers.Util.getViewportElement();if(!e||e==window||e==i)return t;var r,n=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left),s=null;if(e.getBoundingClientRect){r=e.getBoundingClientRect();var o=window.pageYOffset||i.scrollTop,a=window.pageXOffset||i.scrollLeft;t[0]=r.left+a,t[1]=r.top+o}else if(document.getBoxObjectFor&&!n){r=document.getBoxObjectFor(e);var l=document.getBoxObjectFor(i);t[0]=r.screenX-l.screenX,t[1]=r.screenY-l.screenY}else{if(t[0]=e.offsetLeft,t[1]=e.offsetTop,s=e.offsetParent,s!=e)for(;s;)t[0]+=s.offsetLeft,t[1]+=s.offsetTop,s=s.offsetParent;var p=OpenLayers.BROWSER_NAME;for(("opera"==p||"safari"==p&&"absolute"==OpenLayers.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop),s=e.offsetParent;s&&s!=document.body;)t[0]-=s.scrollLeft,"opera"==p&&"TR"==s.tagName||(t[1]-=s.scrollTop),s=s.offsetParent}return t},OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;return void 0==e&&(e="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=e),e},OpenLayers.Util.isEquivalentUrl=function(e,t,i){i=i||{},OpenLayers.Util.applyDefaults(i,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var r=OpenLayers.Util.createUrlObject(e,i),n=OpenLayers.Util.createUrlObject(t,i);for(var s in r)if("args"!==s&&r[s]!=n[s])return!1;for(var s in r.args){if(r.args[s]!=n.args[s])return!1;delete n.args[s]}for(var s in n.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(e,t){if(t=t||{},!/^\w+:\/\//.test(e)){var i=window.location,r=i.port?":"+i.port:"",n=i.protocol+"//"+i.host.split(":").shift()+r;if(0===e.indexOf("/"))e=n+e;else{var s=i.pathname.split("/");s.pop(),e=n+s.join("/")+"/"+e}}t.ignoreCase&&(e=e.toLowerCase());var o=document.createElement("a");o.href=e;var a={};a.host=o.host.split(":").shift(),a.protocol=o.protocol,t.ignorePort80?a.port="80"==o.port||"0"==o.port?"":o.port:a.port=""==o.port||"0"==o.port?"80":o.port,a.hash=t.ignoreHash||"#"===o.hash?"":o.hash;var l=o.search;if(!l){var p=e.indexOf("?");l=p!=-1?e.substr(p):""}return a.args=OpenLayers.Util.getParameters(l,{splitArgs:t.splitArgs}),a.pathname="/"==o.pathname.charAt(0)?o.pathname:"/"+o.pathname,a},OpenLayers.Util.removeTail=function(e){var t=null,i=e.indexOf("?"),r=e.indexOf("#");return t=i==-1?r!=-1?e.substr(0,r):e:r!=-1?e.substr(0,Math.min(i,r)):e.substr(0,i)},OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("webkit")==-1&&e.indexOf("gecko")!=-1}(),OpenLayers.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();return t.indexOf("opera")!=-1?e="opera":t.indexOf("msie")!=-1?e="msie":t.indexOf("safari")!=-1?e="safari":t.indexOf("mozilla")!=-1&&(e=t.indexOf("firefox")!=-1?"firefox":"mozilla"),e}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(e,t,i){var r,n,s=document.createElement("div");s.style.visibility="hidden";for(var o=i&&i.containerElement?i.containerElement:document.body,a=!1,l=null,p=o;p&&"body"!=p.tagName.toLowerCase();){var h=OpenLayers.Element.getStyle(p,"position");if("absolute"==h){a=!0;break}if(h&&"static"!=h)break;p=p.parentNode}!a||0!==o.clientHeight&&0!==o.clientWidth||(l=document.createElement("div"),l.style.visibility="hidden",l.style.position="absolute",l.style.overflow="visible",l.style.width=document.body.clientWidth+"px",l.style.height=document.body.clientHeight+"px",l.appendChild(s)),s.style.position="absolute",t&&(t.w?(r=t.w,s.style.width=r+"px"):t.h&&(n=t.h,s.style.height=n+"px")),i&&i.displayClass&&(s.className=i.displayClass);var u=document.createElement("div");if(u.innerHTML=e,u.style.overflow="visible",u.childNodes)for(var y=0,c=u.childNodes.length;y<c;y++)u.childNodes[y].style&&(u.childNodes[y].style.overflow="visible");return s.appendChild(u),l?o.appendChild(l):o.appendChild(s),r||(r=parseInt(u.scrollWidth),s.style.width=r+"px"),n||(n=parseInt(u.scrollHeight)),s.removeChild(u),u=null,l?(l.removeChild(s),s=null,o.removeChild(l),l=null):(o.removeChild(s),s=null),new OpenLayers.Size(r,n)},OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(null==e){var t=null,i=null,r=0,n=0;t=document.createElement("div"),t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.width="100px",t.style.height="50px",t.style.overflow="hidden",i=document.createElement("div"),i.style.width="100%",i.style.height="200px",t.appendChild(i),document.body.appendChild(t),r=i.offsetWidth,t.style.overflow="scroll",n=i.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=r-n,e=OpenLayers.Util._scrollbarWidth}return e},OpenLayers.Util.getFormattedLonLat=function(e,t,i){i||(i="dms"),e=(e+540)%360-180;var r=Math.abs(e),n=Math.floor(r),s=(r-n)/(1/60),o=s;s=Math.floor(s);var a=(o-s)/(1/60);a=Math.round(10*a),a/=10,a>=60&&(a-=60,s+=1,s>=60&&(s-=60,n+=1)),n<10&&(n="0"+n);var l=n+"°";return i.indexOf("dm")>=0&&(s<10&&(s="0"+s),l+=s+"'",i.indexOf("dms")>=0&&(a<10&&(a="0"+a),l+=a+'"')),l+="lon"==t?e<0?OpenLayers.i18n("W"):OpenLayers.i18n("E"):e<0?OpenLayers.i18n("S"):OpenLayers.i18n("N")},OpenLayers.Util.getConstructor=function(e){var t,i=e.split(".");t="OpenLayers"===i[0]?OpenLayers:window[i[0]];for(var r=1,n=i.length;r<n;++r)t=t[i[r]];return t},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.vendorPrefix=function(){"use strict";function e(e){return e?e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function t(t){if(void 0===o[t]){var i=t.replace(/(-[\s\S])/g,function(e){return e.charAt(1).toUpperCase()}),n=r(i);o[t]=e(n)}return o[t]}function i(e,t){if(void 0===a[t]){var i,r,s=0,o=n.length,l="undefined"!=typeof e.cssText;for(a[t]=null;s<o;s++)if(r=n[s],r?(l||(r=r.toLowerCase()),i=r+t.charAt(0).toUpperCase()+t.slice(1)):i=t,void 0!==e[i]){a[t]=i;break}}return a[t]}function r(e){return i(s,e)}var n=["","O","ms","Moz","Webkit"],s=document.createElement("div").style,o={},a={};return{css:t,js:i,style:r,cssCache:o,jsCache:a}}(),OpenLayers.Animation=function(e){function t(e,t,i){t=t>0?t:Number.POSITIVE_INFINITY;var r=++o,n=+new Date;return a[r]=function(){a[r]&&+new Date-n<=t?(e(),a[r]&&s(a[r],i)):delete a[r]},s(a[r],i),r}function i(e){delete a[e]}var r=OpenLayers.Util.vendorPrefix.js(e,"requestAnimationFrame"),n=!!r,s=function(){var t=e[r]||function(t,i){e.setTimeout(t,16)};return function(i,r){t.apply(e,[i,r])}}(),o=0,a={};return{isNative:n,requestFrame:s,start:t,stop:i}}(window),OpenLayers.String={startsWith:function(e,t){return 0===e.indexOf(t)},contains:function(e,t){return e.indexOf(t)!==-1},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var t=e.split("-"),i=t[0],r=1,n=t.length;r<n;r++){var s=t[r];i+=s.charAt(0).toUpperCase()+s.substring(1)}return i},format:function(e,t,i){t||(t=window);var r=function(e,r){for(var n,s=r.split(/\.+/),o=0;o<s.length&&(0===o&&(n=t),void 0!==n);o++)n=n[s[o]];return"function"==typeof n&&(n=i?n.apply(null,i):n()),"undefined"==typeof n?"undefined":n};return e.replace(OpenLayers.String.tokenRegEx,r)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e,t){var i=e;return t===!0&&null!==e&&e.replace&&(e=e.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(e)?parseFloat(e):i}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var i=0;return t>0&&(i=parseFloat(e.toPrecision(t))),i},format:function(e,t,i,r){t="undefined"!=typeof t?t:0,i="undefined"!=typeof i?i:OpenLayers.Number.thousandsSeparator,r="undefined"!=typeof r?r:OpenLayers.Number.decimalSeparator,null!=t&&(e=parseFloat(e.toFixed(t)));var n=e.toString().split(".");1===n.length&&null===t&&(t=0);var s=n[0];if(i)for(var o=/(-?[0-9]+)([0-9]{3})/;o.test(s);)s=s.replace(o,"$1"+i+"$2");var a;if(0===t)a=s;else{var l=n.length>1?n[1]:"0";null!==t&&(l+=new Array(t-l.length+1).join("0")),a=s+r+l}return a},zeroPad:function(e,t,i){for(var r=e.toString(i||10);r.length<t;)r="0"+r;return r}},OpenLayers.Function={bind:function(e,t){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var r=i.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,r)}},bindAsEventListener:function(e,t){return function(i){return e.call(t,i||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}
},OpenLayers.Array={filter:function(e,t,i){var r=[];if(!e)return r;if(Array.prototype.filter)r=e.filter(t,i);else{var n=e.length;if("function"!=typeof t)throw new TypeError;for(var s=0;s<n;s++)if(s in e){var o=e[s];t.call(i,o,s,e)&&r.push(o)}}return r}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,i,r){OpenLayers.Util.isArray(e)&&(r=e[3],i=e[2],t=e[1],e=e[0]),null!=e&&(this.left=OpenLayers.Util.toFloat(e)),null!=t&&(this.bottom=OpenLayers.Util.toFloat(t)),null!=i&&(this.right=OpenLayers.Util.toFloat(i)),null!=r&&(this.top=OpenLayers.Util.toFloat(r))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=!1;return null!=e&&(t=this.left===e.left&&this.right===e.right&&this.top===e.top&&this.bottom===e.bottom),t},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(e){return e===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(e,t){null==e&&(e=6);var i=Math.pow(10,e),r=Math.round(this.left*i)/i,n=Math.round(this.bottom*i)/i,s=Math.round(this.right*i)/i,o=Math.round(this.top*i)/i;return t===!0?n+","+r+","+o+","+s:r+","+n+","+s+","+o},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(e,t){null==t&&(t=this.getCenterLonLat());var i,r;"OpenLayers.LonLat"===t.CLASS_NAME?(i=t.lon,r=t.lat):(i=t.x,r=t.y);var n=(this.left-i)*e+i,s=(this.bottom-r)*e+r,o=(this.right-i)*e+i,a=(this.top-r)*e+r;return new OpenLayers.Bounds(n,s,o,a)},add:function(e,t){if(null==e||null==t)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){if(e)switch(e.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(e.lon,e.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(e.x,e.y);break;case"OpenLayers.Bounds":this.centerLonLat=null,(null==this.left||e.left<this.left)&&(this.left=e.left),(null==this.bottom||e.bottom<this.bottom)&&(this.bottom=e.bottom),(null==this.right||e.right>this.right)&&(this.right=e.right),(null==this.top||e.top>this.top)&&(this.top=e.top)}},extendXY:function(e,t){this.centerLonLat=null,(null==this.left||e<this.left)&&(this.left=e),(null==this.bottom||t<this.bottom)&&(this.bottom=t),(null==this.right||e>this.right)&&(this.right=e),(null==this.top||t>this.top)&&(this.top=t)},containsLonLat:function(e,t){"boolean"==typeof t&&(t={inclusive:t}),t=t||{};var i=this.contains(e.lon,e.lat,t.inclusive),r=t.worldBounds;if(r&&!i){var n=r.getWidth(),s=(r.left+r.right)/2,o=Math.round((e.lon-s)/n);i=this.containsLonLat({lon:e.lon-o*n,lat:e.lat},{inclusive:t.inclusive})}return i},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,i){if(null==i&&(i=!0),null==e||null==t)return!1;e=OpenLayers.Util.toFloat(e),t=OpenLayers.Util.toFloat(t);var r;return r=i?e>=this.left&&e<=this.right&&t>=this.bottom&&t<=this.top:e>this.left&&e<this.right&&t>this.bottom&&t<this.top},intersectsBounds:function(e,t){if("boolean"==typeof t&&(t={inclusive:t}),t=t||{},t.worldBounds){var i=this.wrapDateLine(t.worldBounds);e=e.wrapDateLine(t.worldBounds)}else i=this;null==t.inclusive&&(t.inclusive=!0);var r=!1,n=i.left===e.right||i.right===e.left||i.top===e.bottom||i.bottom===e.top;if(t.inclusive||!n){var s=e.bottom>=i.bottom&&e.bottom<=i.top||i.bottom>=e.bottom&&i.bottom<=e.top,o=e.top>=i.bottom&&e.top<=i.top||i.top>e.bottom&&i.top<e.top,a=e.left>=i.left&&e.left<=i.right||i.left>=e.left&&i.left<=e.right,l=e.right>=i.left&&e.right<=i.right||i.right>=e.left&&i.right<=e.right;r=(s||o)&&(a||l)}if(t.worldBounds&&!r){var p=t.worldBounds,h=p.getWidth(),u=!p.containsBounds(i),y=!p.containsBounds(e);u&&!y?(e=e.add(-h,0),r=i.intersectsBounds(e,{inclusive:t.inclusive})):y&&!u&&(i=i.add(-h,0),r=e.intersectsBounds(i,{inclusive:t.inclusive}))}return r},containsBounds:function(e,t,i){null==t&&(t=!1),null==i&&(i=!0);var r=this.contains(e.left,e.bottom,i),n=this.contains(e.right,e.bottom,i),s=this.contains(e.left,e.top,i),o=this.contains(e.right,e.top,i);return t?r||n||s||o:r&&n&&s&&o},determineQuadrant:function(e){var t="",i=this.getCenterLonLat();return t+=e.lat<i.lat?"b":"t",t+=e.lon<i.lon?"l":"r"},transform:function(e,t){this.centerLonLat=null;var i=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t),r=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t),n=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t),s=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);return this.left=Math.min(i.x,n.x),this.bottom=Math.min(i.y,r.y),this.right=Math.max(r.x,s.x),this.top=Math.max(n.y,s.y),this},wrapDateLine:function(e,t){t=t||{};var i=t.leftTolerance||0,r=t.rightTolerance||0,n=this.clone();if(e){for(var s=e.getWidth();n.left<e.left&&n.right-r<=e.left;)n=n.add(s,0);for(;n.left+i>=e.right&&n.right>e.right;)n=n.add(-s,0);var o=n.left+i;o<e.right&&o>e.left&&n.right-r>e.right&&(n=n.add(-s,0))}return n},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(e,t){var i=e.split(",");return OpenLayers.Bounds.fromArray(i,t)},OpenLayers.Bounds.fromArray=function(e,t){return t===!0?new OpenLayers.Bounds(e[1],e[0],e[3],e[2]):new OpenLayers.Bounds(e[0],e[1],e[2],e[3])},OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(e){var t="";return t+="t"===e.charAt(0)?"b":"t",t+="l"===e.charAt(1)?"r":"l"},OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){return"toISOString"in Date.prototype?function(e){return e.toISOString()}:function(e){var t;return t=isNaN(e.getTime())?"Invalid Date":e.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(e.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(e.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(e.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(e.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(e.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(e.getUTCMilliseconds(),3)+"Z"}}(),parse:function(e){var t,i=e.match(this.dateRegEx);if(i&&(i[1]||i[7])){var r=parseInt(i[1],10)||0,n=parseInt(i[2],10)-1||0,s=parseInt(i[3],10)||1;t=new Date(Date.UTC(r,n,s));var o=i[7];if(o){var a=parseInt(i[4],10),l=parseInt(i[5],10),p=parseFloat(i[6]),h=0|p,u=Math.round(1e3*(p-h));if(t.setUTCHours(a,l,h,u),"Z"!==o){var y=parseInt(o,10),c=parseInt(i[8],10)||0,d=-1e3*(60*(60*y)+60*c);t=new Date(t.getTime()+d)}}}else t=new Date("invalid");return t}},OpenLayers.Element={visible:function(e){return"none"!==OpenLayers.Util.getElement(e).style.display},toggle:function(){for(var e=0,t=arguments.length;e<t;e++){var i=OpenLayers.Util.getElement(arguments[e]),r=OpenLayers.Element.visible(i)?"none":"";i.style.display=r}},remove:function(e){e=OpenLayers.Util.getElement(e),e.parentNode.removeChild(e)},getHeight:function(e){return e=OpenLayers.Util.getElement(e),e.offsetHeight},hasClass:function(e,t){var i=e.className;return!!i&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)},addClass:function(e,t){return OpenLayers.Element.hasClass(e,t)||(e.className+=(e.className?" ":"")+t),e},removeClass:function(e,t){var i=e.className;return i&&(e.className=OpenLayers.String.trim(i.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))),e},toggleClass:function(e,t){return OpenLayers.Element.hasClass(e,t)?OpenLayers.Element.removeClass(e,t):OpenLayers.Element.addClass(e,t),e},getStyle:function(e,t){e=OpenLayers.Util.getElement(e);var i=null;if(e&&e.style){if(i=e.style[OpenLayers.String.camelize(t)],!i)if(document.defaultView&&document.defaultView.getComputedStyle){var r=document.defaultView.getComputedStyle(e,null);i=r?r.getPropertyValue(t):null}else e.currentStyle&&(i=e.currentStyle[OpenLayers.String.camelize(t)]);var n=["left","top","right","bottom"];window.opera&&OpenLayers.Util.indexOf(n,t)!==-1&&"static"===OpenLayers.Element.getStyle(e,"position")&&(i="auto")}return"auto"===i?null:i}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){OpenLayers.Util.isArray(e)&&(t=e[1],e=e[0]),this.lon=OpenLayers.Util.toFloat(e),this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(null==e||null==t)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=!1;return null!=e&&(t=this.lon===e.lon&&this.lat===e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat)),t},transform:function(e,t){var i=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);return this.lon=i.x,this.lat=i.y,this},wrapDateLine:function(e){var t=this.clone();if(e){for(;t.lon<e.left;)t.lon+=e.getWidth();for(;t.lon>e.right;)t.lon-=e.getWidth()}return t},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(e){var t=e.split(",");return new OpenLayers.LonLat(t[0],t[1])},OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e),i=t&&e[0],r=t&&e[1];return new OpenLayers.LonLat(i,r)},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e),this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=!1;return null!=e&&(t=this.x===e.x&&this.y===e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(null==e||null==t)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();return e&&(t=this.add(e.x,e.y)),t},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e),this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=!1;return null!=e&&(t=this.w===e.w&&this.h===e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h)),t},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var e=document.getElementsByTagName("script"),t=0,i=e.length;t<i;++t)if(e[t].src.indexOf("firebug.js")!==-1&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(e){this.easing=e?e:OpenLayers.Easing.Expo.easeOut},start:function(e,t,i,r){this.playing=!0,this.begin=e,this.finish=t,this.duration=i,this.callbacks=r.callbacks,this.minFrameRate=r.minFrameRate||30,this.time=0,this.startTime=(new Date).getTime(),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var e={};for(var t in this.begin){var i=this.begin[t],r=this.finish[t];if(null==i||null==r||isNaN(i)||isNaN(r))throw new TypeError("invalid value for Tween");var n=r-i;e[t]=this.easing.apply(this,[this.time,i,n,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,e),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(e,t,i,r){return i*e/r+t},easeOut:function(e,t,i,r){return i*e/r+t},easeInOut:function(e,t,i,r){return i*e/r+t},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(e,t,i,r){return 0==e?t:i*Math.pow(2,10*(e/r-1))+t},easeOut:function(e,t,i,r){return e==r?t+i:i*(-Math.pow(2,-10*e/r)+1)+t},easeInOut:function(e,t,i,r){return 0==e?t:e==r?t+i:(e/=r/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(-Math.pow(2,-10*--e)+2)+t},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(e,t,i,r){return i*(e/=r)*e+t},easeOut:function(e,t,i,r){return-i*(e/=r)*(e-2)+t},easeInOut:function(e,t,i,r){return(e/=r/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(e){OpenLayers.Util.extend(this,e)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(e){this.points.unshift({xy:e,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(e){for(var t,i,r=(new Date).getTime(),n=0,s=this.points.length;n<s&&(i=this.points[n],!(r-i.tick>this.delay));n++)t=i;if(t){var o=(new Date).getTime()-t.tick,a=Math.sqrt(Math.pow(e.x-t.xy.x,2)+Math.pow(e.y-t.xy.y,2)),l=a/o;if(!(0==l||l<this.threshold)){var p=Math.asin((e.y-t.xy.y)/a);return t.xy.x<=e.x&&(p=Math.PI-p),{speed:l,theta:p}}}},move:function(e,t){var i=e.speed,r=Math.cos(e.theta),n=-Math.sin(e.theta),s=(new Date).getTime(),o=0,a=0,l=function(){if(null!=this.timerId){var e=(new Date).getTime()-s,l=-this.deceleration*Math.pow(e,2)/2+i*e,p=l*r,h=l*n,u={};u.end=!1;var y=-this.deceleration*e+i;y<=0&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,u.end=!0),u.x=p-o,u.y=h-a,o=p,a=h,t(u.x,u.y,u.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(l,this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&1===e.touches.length},isMultiTouch:function(e){return e.touches&&e.touches.length>1},isLeftClick:function(e){return"undefined"!=typeof e.which&&1===e.which||"undefined"!=typeof e.button&&2!==e.button},isRightClick:function(e){return e.which&&3===e.which||e.button&&2===e.button},stop:function(e,t){t||OpenLayers.Event.preventDefault(e),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},findElement:function(e,t){for(var i=OpenLayers.Event.element(e);i.parentNode&&(!i.tagName||i.tagName.toUpperCase()!==t.toUpperCase());)i=i.parentNode;return i},observe:function(e,t,i,r){var n=OpenLayers.Util.getElement(e);if(r=r||!1,"keypress"===t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||n.attachEvent)&&(t="keydown"),this.observers||(this.observers={}),!n._eventCacheID){var s="eventCacheID_";n.id&&(s=n.id+"_"+s),n._eventCacheID=OpenLayers.Util.createUniqueID(s)}var o=n._eventCacheID;this.observers[o]||(this.observers[o]=[]),this.observers[o].push({element:n,name:t,observer:i,useCapture:r}),n.addEventListener?n.addEventListener(t,i,r):n.attachEvent&&n.attachEvent("on"+t,i)},stopObservingElement:function(e){var t=OpenLayers.Util.getElement(e),i=t._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[i])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;t>=0;t--){var i=e[t];OpenLayers.Event.stopObserving.apply(this,[i.element,i.name,i.observer,i.useCapture])}},stopObserving:function(e,t,i,r){r=r||!1;var n=OpenLayers.Util.getElement(e),s=n._eventCacheID;"keypress"===t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||n.detachEvent)&&(t="keydown");var o=!1,a=OpenLayers.Event.observers[s];if(a)for(var l=0;!o&&l<a.length;){var p=a[l];if(p.name===t&&p.observer===i&&p.useCapture===r){a.splice(l,1),0===a.length&&delete OpenLayers.Event.observers[s],o=!0;break}l++}return o&&(n.removeEventListener?n.removeEventListener(t,i,r):n&&n.detachEvent&&n.detachEvent("on"+t,i)),o},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers)if(OpenLayers.Event.observers.hasOwnProperty(e)){var t=OpenLayers.Event.observers[e];OpenLayers.Event._removeElementObservers.apply(this,[t])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","contextmenu","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,i,r,n){OpenLayers.Util.extend(this,n),this.object=e,this.fallThrough=r,this.listeners={},this.extensions={},this.extensionCount={},this._msTouches=[],null!=t&&this.attachToElement(t)},destroy:function(){for(var e in this.extensions)"boolean"!=typeof this.extensions[e]&&this.extensions[e].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(e){},attachToElement:function(e){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=e;for(var t,i=!!window.navigator.msMaxTouchPoints,r=0,n=this.BROWSER_EVENTS.length;r<n;r++)t=this.BROWSER_EVENTS[r],OpenLayers.Event.observe(e,t,this.eventHandler),i&&0===t.indexOf("touch")&&this.addMsTouchListener(e,t,this.eventHandler);OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)"scope"!==t&&e.hasOwnProperty(t)&&this.register(t,e.scope,e[t])},register:function(e,t,i,r){if(e in OpenLayers.Events&&!this.extensions[e]&&(this.extensions[e]=new OpenLayers.Events[e](this)),null!=i){null==t&&(t=this.object);var n=this.listeners[e];n||(n=[],this.listeners[e]=n,this.extensionCount[e]=0);var s={obj:t,func:i};r?(n.splice(this.extensionCount[e],0,s),"object"==typeof r&&r.extension&&this.extensionCount[e]++):n.push(s)}},registerPriority:function(e,t,i){this.register(e,t,i,!0)},un:function(e){for(var t in e)"scope"!==t&&e.hasOwnProperty(t)&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,i){null==t&&(t=this.object);var r=this.listeners[e];if(null!=r)for(var n=0,s=r.length;n<s;n++)if(r[n].obj===t&&r[n].func===i){r.splice(n,1);break}},remove:function(e){null!=this.listeners[e]&&(this.listeners[e]=[])},triggerEvent:function(e,t){var i=this.listeners[e];if(i&&0!==i.length){null==t&&(t={}),t.object=this.object,t.element=this.element,t.type||(t.type=e),i=i.slice();for(var r,n=0,s=i.length;n<s;n++){var o=i[n];if(r=o.func.apply(o.obj,[t]),void 0!==r&&r===!1)break}return this.fallThrough||OpenLayers.Event.stop(t,!0),r}},handleBrowserEvent:function(e){var t=e.type,i=this.listeners[t];if(i&&0!==i.length){var r=e.touches;if(r&&r[0]){for(var n,s=0,o=0,a=r.length,l=0;l<a;++l)n=this.getTouchClientXY(r[l]),s+=n.clientX,o+=n.clientY;e.clientX=s/a,e.clientY=o/a}this.includeXY&&(e.xy=this.getMousePosition(e)),this.triggerEvent(t,e)}},getTouchClientXY:function(e){var t=window.olMockWin||window,i=t.pageXOffset,r=t.pageYOffset,n=e.clientX,s=e.clientY;return 0===e.pageY&&Math.floor(s)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(n)>Math.floor(e.pageX)?(n-=i,s-=r):(s<e.pageY-r||n<e.pageX-i)&&(n=e.pageX-i,s=e.pageY-r),e.olClientX=n,e.olClientY=s,{clientX:n,clientY:s}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(e){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||t.scrollLeft,window.pageYOffset||t.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(e,t,i){function r(e){i(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var e=n.length-1;e>=0;--e)n[e].stopPropagation()},preventDefault:function(){for(var e=n.length-1;e>=0;--e)n[e].preventDefault()},type:t},e))}var n=this._msTouches;switch(t){case"touchstart":return this.addMsTouchListenerStart(e,t,r);case"touchend":return this.addMsTouchListenerEnd(e,t,r);case"touchmove":return this.addMsTouchListenerMove(e,t,r);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(e,t,i){var r=this._msTouches,n=function(e){for(var t=!1,n=0,s=r.length;n<s;++n)if(r[n].pointerId===e.pointerId){t=!0;break}t||r.push(e),e.touches=r.slice(),i(e)};OpenLayers.Event.observe(e,"MSPointerDown",n);var s=function(e){for(var t=0,i=r.length;t<i;++t)if(r[t].pointerId===e.pointerId){r.splice(t,1);break}};OpenLayers.Event.observe(e,"MSPointerUp",s)},addMsTouchListenerMove:function(e,t,i){var r=this._msTouches,n=function(e){if(!(e.pointerType===e.MSPOINTER_TYPE_MOUSE&&0===e.buttons||1===r.length&&r[0].pageX===e.pageX&&r[0].pageY===e.pageY)){for(var t=0,n=r.length;t<n;++t)if(r[t].pointerId===e.pointerId){r[t]=e;break}e.touches=r.slice(),i(e)}};OpenLayers.Event.observe(e,"MSPointerMove",n)},addMsTouchListenerEnd:function(e,t,i){var r=this._msTouches,n=function(e){for(var t=0,n=r.length;t<n;++t)if(r[t].pointerId===e.pointerId){r.splice(t,1);break}e.touches=r.slice(),i(e)};OpenLayers.Event.observe(e,"MSPointerUp",n)},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(e){this.target=e;for(var t=this.events.length-1;t>=0;--t)this.target.register(this.events[t],this,this.buttonClick,{extension:!0})},destroy:function(){for(var e=this.events.length-1;e>=0;--e)this.target.unregister(this.events[e],this,this.buttonClick);delete this.target},getPressedButton:function(e){var t,i=3;do{if(OpenLayers.Element.hasClass(e,"olButton")){t=e;break}e=e.parentNode}while(--i>0&&e);return t},ignore:function(e){var t=3,i=!1;do{if("a"===e.nodeName.toLowerCase()){i=!0;break}e=e.parentNode}while(--t>0&&e);return i},buttonClick:function(e){var t=!0,i=OpenLayers.Event.element(e);if(i&&(OpenLayers.Event.isLeftClick(e)||!~e.type.indexOf("mouse"))){var r=this.getPressedButton(i);if(r){if("keydown"===e.type)switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:r}),OpenLayers.Event.stop(e),t=!1}else if(this.startEvt){if(this.completeRegEx.test(e.type)){var n=OpenLayers.Util.pagePosition(r),s=OpenLayers.Util.getViewportElement(),o=window.pageYOffset||s.scrollTop,a=window.pageXOffset||s.scrollLeft;n[0]=n[0]-a,n[1]=n[1]-o,this.target.triggerEvent("buttonclick",{buttonElement:r,buttonXY:{x:this.startEvt.clientX-n[0],y:this.startEvt.clientY-n[1]}})}this.cancelRegEx.test(e.type)&&delete this.startEvt,OpenLayers.Event.stop(e),t=!1}this.startRegEx.test(e.type)&&(this.startEvt=e,OpenLayers.Event.stop(e),t=!1)}else t=!this.ignore(OpenLayers.Event.element(e)),delete this.startEvt}return t}}),OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,curretFeature:null,activeFeature:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(e){if(this.target=e,e.object instanceof OpenLayers.Map)this.setMap(e.object);else{if(!(e.object instanceof OpenLayers.Layer.Vector))throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances";e.object.map?this.setMap(e.object.map):e.object.events.register("added",this,function(t){this.setMap(e.object.map)})}for(var t=this.provides.length-1;t>=0;--t)e.extensions[this.provides[t]]=!0},setMap:function(e){this.map=e,this.cache={},e.events.register("mousedown",this,this.start,{extension:!0}),e.events.register("mouseup",this,this.onClick,{extension:!0}),e.events.register("touchstart",this,this.start,{extension:!0}),e.events.register("touchmove",this,this.cancel,{extension:!0}),e.events.register("touchend",this,this.onClick,{extension:!0})},start:function(e){this.startEvt=e;for(var t in this.cache)if(feature=this.cache[t],feature){var i=this.triggerEvent("featuremousedown",{feature:feature});if(this.curretFeature=feature,i===!1)break}},cancel:function(e){delete this.startEvt},onClick:function(e){if(this.startEvt&&("touchend"===e.type||OpenLayers.Event.isLeftClick(e))){this.curretFeature&&this.triggerEvent("featuremouseup",{feature:this.curretFeature});var t=this.getFeatures(this.startEvt);delete this.startEvt;for(var i,r,n,s={},o=0,a=t.length;o<a&&(i=t[o],r=i.layer,s[r.id]=!0,n=this.triggerEvent("featureclick",{feature:i,xy:e.xy}),n!==!1);++o);for(o=0,a=this.map.layers.length;o<a;++o)r=this.map.layers[o],r instanceof OpenLayers.Layer.Vector&&!s[r.id]&&this.triggerEvent("nofeatureclick",{layer:r})}},onMousemove:function(e){for(var t,i=this.getFeatures(e,!0),r={},n=[],s=0,o=i.length;s<o;++s)t=i[s],r[t.id]=t,n.push(t);var a;n.length>0&&(a=n[0]);for(var s=0;s<n.length;s++)a.style.graphicZIndex<n[s].style.graphicZIndex&&(a=n[s]);0===n.length&&(this.activeFeature&&(this.triggerEvent("featureout",{feature:this.activeFeature,xy:{x:e.offsetX,y:e.offsetY}}),delete this.cache[this.activeFeature.id]),this.activeFeature=null),this.activeFeature!==a&&(this.activeFeature&&(this.triggerEvent("featureout",{feature:this.activeFeature,xy:{x:e.offsetX,y:e.offsetY}}),delete this.cache[this.activeFeature.id],this.activeFeature=null),this.triggerEvent("featureover",{feature:a,xy:{x:e.offsetX,y:e.offsetY}}),this.activeFeature=a,this.cache[i.id]=a)},triggerEvent:function(e,t){var i=t.feature?t.feature.layer:t.layer,r=this.target.object;if(r instanceof OpenLayers.Map||r===i)return this.target.triggerEvent(e,t)},getFeatures:function(e){return this.map.getFeatures(e,!0)},destroy:function(){for(var e=this.provides.length-1;e>=0;--e)delete this.target.extensions[this.provides[e]];this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this}),delete this.cache,delete this.map,delete this.target}}),OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick,OpenLayers.Events.featureover=OpenLayers.Events.featureclick,OpenLayers.Events.featureout=OpenLayers.Events.featureclick,OpenLayers.ProxyHost="",OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(e,t){var i=0!==e.indexOf("http"),r=!i&&e.match(this.URL_SPLIT_REGEX);if(r){var n=window.location;i=r[1]==n.protocol&&r[3]==n.hostname;var s=r[4],o=n.port;(80!=s&&""!=s||"80"!=o&&""!=o)&&(i=i&&s==o)}return i||t&&(e="function"==typeof t?t(e):t+encodeURIComponent(e)),e},issue:function(e){var t=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});e=e||{},e.headers=e.headers||{},e=OpenLayers.Util.applyDefaults(e,t),e.headers=OpenLayers.Util.applyDefaults(e.headers,t.headers);var i,r=!1;for(i in e.headers)e.headers.hasOwnProperty(i)&&"x-requested-with"===i.toLowerCase()&&(r=!0);r===!1&&(e.headers["X-Requested-With"]="XMLHttpRequest");var n=new OpenLayers.Request.XMLHttpRequest,s=OpenLayers.Util.urlAppend(e.url,OpenLayers.Util.getParameterString(e.params||{}));if(s=OpenLayers.Request.makeSameOrigin(s,e.proxy),n.open(e.method,s,e.async,e.user,e.password),e.data&&"object"==typeof e.data){var a=new FormData;for(o in e.data)a.append(o,e.data[o]);e.data=a}else for(var l in e.headers)n.setRequestHeader(l,e.headers[l]);var p=this.events,h=this;return n.onreadystatechange=function(){if(n.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var t=p.triggerEvent("complete",{request:n,config:e,requestUrl:s});t!==!1&&h.runCallbacks({request:n,config:e,requestUrl:s})}},e.async===!1?n.send(e.data):window.setTimeout(function(){0!==n.readyState&&n.send(e.data)},0),n},runCallbacks:function(e){var t,i=e.request,r=e.config,n=r.scope?OpenLayers.Function.bind(r.callback,r.scope):r.callback;r.success&&(t=r.scope?OpenLayers.Function.bind(r.success,r.scope):r.success);var s;r.failure&&(s=r.scope?OpenLayers.Function.bind(r.failure,r.scope):r.failure),"file:"==OpenLayers.Util.createUrlObject(r.url).protocol&&i.responseText&&(i.status=200),n(i),(!i.status||i.status>=200&&i.status<300)&&(this.events.triggerEvent("success",e),t&&t(i)),i.status&&(i.status<200||i.status>=300)&&(this.events.triggerEvent("failure",e),s&&s(i))},GET:function(e){return e=OpenLayers.Util.extend(e,{method:"GET"}),OpenLayers.Request.issue(e)},POST:function(e){return e=OpenLayers.Util.extend(e,{method:"POST"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},PUT:function(e){return e=OpenLayers.Util.extend(e,{method:"PUT"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},DELETE:function(e){return e=OpenLayers.Util.extend(e,{method:"DELETE"}),OpenLayers.Request.issue(e)},HEAD:function(e){return e=OpenLayers.Util.extend(e,{method:"HEAD"}),OpenLayers.Request.issue(e)},OPTIONS:function(e){return e=OpenLayers.Util.extend(e,{method:"OPTIONS"}),OpenLayers.Request.issue(e)}}),function(){function e(){this._object=a&&!h?new a:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function t(){return new e}function i(e){if(e._object.send(e._data),l&&!e._async)for(e.readyState=t.OPENED,
s(e);e.readyState<t.DONE;)if(e.readyState++,r(e),e._aborted)return}function r(e){t.onreadystatechange&&t.onreadystatechange.apply(e),e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function n(e){var t=e.responseXML,i=e.responseText;return p&&i&&t&&!t.documentElement&&e.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(i)),t&&(p&&0!=t.parseError||!t.documentElement||t.documentElement&&"parsererror"==t.documentElement.tagName)?null:t}function s(e){try{e.responseText=e._object.responseText}catch(t){}try{e.responseXML=n(e._object)}catch(t){}try{e.status=e._object.status}catch(t){}try{e.statusText=e._object.statusText}catch(t){}}function o(e){e._object.onreadystatechange=new window.Function}var a=window.XMLHttpRequest,l=!!window.controllers,p=window.document.all&&!window.opera,h=p&&window.navigator.userAgent.match(/MSIE 7.0/);t.prototype=e.prototype,l&&a.wrapped&&(t.wrapped=a.wrapped),t.UNSENT=0,t.OPENED=1,t.HEADERS_RECEIVED=2,t.LOADING=3,t.DONE=4,t.prototype.readyState=t.UNSENT,t.prototype.responseText="",t.prototype.responseXML=null,t.prototype.status=0,t.prototype.statusText="",t.prototype.priority="NORMAL",t.prototype.onreadystatechange=null,t.onreadystatechange=null,t.onopen=null,t.onsend=null,t.onabort=null,t.prototype.open=function(e,i,n,a,h){delete this._headers,arguments.length<3&&(n=!0),this._async=n;var u,y=this,c=this.readyState;p&&n&&(u=function(){c!=t.DONE&&(o(y),y.abort())},window.attachEvent("onunload",u)),t.onopen&&t.onopen.apply(this,arguments),arguments.length>4?this._object.open(e,i,n,a,h):arguments.length>3?this._object.open(e,i,n,a):this._object.open(e,i,n),this.readyState=t.OPENED,r(this),this._object.onreadystatechange=function(){if(!l||n){if(y.readyState=y._object.readyState,s(y),y._aborted)return void(y.readyState=t.UNSENT);y.readyState==t.DONE&&(delete y._data,o(y),p&&n&&window.detachEvent("onunload",u)),c!=y.readyState&&r(y),c=y.readyState}}},t.prototype.send=function(e){t.onsend&&t.onsend.apply(this,arguments),arguments.length||(e=null),e&&e.nodeType&&(e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=e,i(this)},t.prototype.abort=function(){t.onabort&&t.onabort.apply(this,arguments),this.readyState>t.UNSENT&&(this._aborted=!0),this._object.abort(),o(this),this.readyState=t.UNSENT,delete this._data},t.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},t.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)},t.prototype.setRequestHeader=function(e,t){return this._headers||(this._headers={}),this._headers[e]=t,this._object.setRequestHeader(e,t)},t.prototype.addEventListener=function(e,t,i){for(var r,n=0;r=this._listeners[n];n++)if(r[0]==e&&r[1]==t&&r[2]==i)return;this._listeners.push([e,t,i])},t.prototype.removeEventListener=function(e,t,i){for(var r,n=0;(r=this._listeners[n])&&(r[0]!=e||r[1]!=t||r[2]!=i);n++);r&&this._listeners.splice(n,1)},t.prototype.dispatchEvent=function(e){var t={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==t.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[t]);for(var i,r=0;i=this._listeners[r];r++)i[0]!=t.type||i[2]||(i[1].handleEvent||i[1]).apply(this,[t])},t.prototype.toString=function(){return"[object XMLHttpRequest]"},t.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t||(t=[]),e.__func=this,e.__func(t[0],t[1],t[2],t[3],t[4]),delete e.__func}),OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Request.XMLHttpRequest=t}(),OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.projCode=e,"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=e,i=!1;if(t)if(t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t)),"object"==typeof Proj4js&&this.proj.defData&&t.proj.defData)i=this.proj.defData.replace(this.titleRegEx,"")==t.proj.defData.replace(this.titleRegEx,"");else if(t.getCode){var r=this.getCode(),n=t.getCode();i=r==n||!!OpenLayers.Projection.transforms[r]&&OpenLayers.Projection.transforms[r][n]===OpenLayers.Projection.nullTransform}return i},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],worldExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90],worldExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],worldExtent:[-180,-89,180,89]}},OpenLayers.Projection.addTransform=function(e,t,i){if(i===OpenLayers.Projection.nullTransform){var r=OpenLayers.Projection.defaults[e];r&&!OpenLayers.Projection.defaults[t]&&(OpenLayers.Projection.defaults[t]=r)}OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={}),OpenLayers.Projection.transforms[e][t]=i},OpenLayers.Projection.transform=function(e,t,i){if(t&&i)if(t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t)),i instanceof OpenLayers.Projection||(i=new OpenLayers.Projection(i)),t.proj&&i.proj)e=Proj4js.transform(t.proj,i.proj,e);else{var r=t.getCode(),n=i.getCode(),s=OpenLayers.Projection.transforms;s[r]&&s[r][n]&&s[r][n](e)}return e},OpenLayers.Projection.nullTransform=function(e){return e},function(){function e(e){return e.x=180*e.x/n,e.y=180/Math.PI*(2*Math.atan(Math.exp(e.y/n*Math.PI))-Math.PI/2),e}function t(e){e.x=e.x*n/180;var t=Math.log(Math.tan((90+e.y)*Math.PI/360))/Math.PI*n;return e.y=Math.max(-20037508.34,Math.min(t,20037508.34)),e}function i(i,r){var n,s,o,a,l,p=OpenLayers.Projection.addTransform,h=OpenLayers.Projection.nullTransform;for(n=0,s=r.length;n<s;++n)for(o=r[n],p(i,o,t),p(o,i,e),l=n+1;l<s;++l)a=r[l],p(o,a,h),p(a,o,h)}var r,n=20037508.34,s=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],o=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(r=s.length-1;r>=0;--r)i(s[r],o);for(r=o.length-1;r>=0;--r)i(o[r],s)}(),OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,DefaultLayer:500,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:22,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,maxZoom:null,minZoom:null,mousePosition:null,originCenter:null,isZooming:!1,initialize:function(e,t){1===arguments.length&&"object"==typeof e&&(t=e,e=t&&t.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(70,15,190,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",this.options=OpenLayers.Util.extend({},t),OpenLayers.Util.extend(this,t);var i=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[i]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds?this.restrictedExtent=this.maxExtent:this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(e),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");var r=this.id+"_OpenLayers_ViewPort";if(this.viewPortDiv=OpenLayers.Util.createDiv(r,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this)),r=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(r),this.layerContainerOriginPx={x:0,y:0},this.applyTransform(),this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),this.autoUpdateSize===!0&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var n=!0,s=document.getElementsByTagName("link"),o=0,a=s.length;o<a;++o)if(OpenLayers.Util.isEquivalentUrl(s.item(o).href,this.theme)){n=!1;break}if(n){var l=document.createElement("link");l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(l)}}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));for(var o=0,a=this.controls.length;o<a;o++)this.addControlToMap(this.controls[o]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),t&&t.layers&&(delete this.center,delete this.zoom,this.addLayers(t.layers),t.center&&!this.getCenter()&&this.setCenter(t.center,t.zoom)),this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod)),this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(e){this.div=OpenLayers.Util.getElement(e),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),this.zoomTween&&(this.zoomTween.stop(),this.zoomTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,null!=this.controls){for(var e=this.controls.length-1;e>=0;--e)this.controls[e].destroy();this.controls=null}if(null!=this.layers){for(var e=this.layers.length-1;e>=0;--e)this.layers[e].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null),this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.events=null,this.options=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e),t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},registerMousePosition:function(){this.events.register("mousemove",this,function(e){this.mousePosition=this.getLonLatFromPixel(e.xy)})},getMousePosition:function(){return this.mousePosition},getBy:function(e,t,i){var r="function"==typeof i.test,n=OpenLayers.Array.filter(this[e],function(e){return e[t]==i||r&&i.test(e[t])});return n},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){var t=OpenLayers.Array.filter(this.layers,function(t){return t.name==e});return t},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},getLayer:function(e){for(var t=null,i=0,r=this.layers.length;i<r;i++){var n=this.layers[i];if(n.id==e){t=n;break}}return t},setLayerZIndex:function(e,t){e.isDefaultLayer?e.setZIndex(this.Z_INDEX_BASE.DefaultLayer):e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+5*t)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;e<t;e++){var i=this.layers[e];!i.isBaseLayer&&(i instanceof OpenLayers.Layer.TDTLayer||i instanceof OpenLayers.Layer.Baidu)?i.setZIndex(parseInt(this.baseLayer.getZIndex())+1):this.setLayerZIndex(i,e)}},addLayer:function(e){for(var t=0,i=this.layers.length;t<i;t++)if(this.layers[t]==e)return!1;return this.events.triggerEvent("preaddlayer",{layer:e})!==!1&&(this.allOverlays&&(e.isBaseLayer=!1),e.div.className="olLayerDiv",e.div.style.overflow="",this.setLayerZIndex(e,this.layers.length),e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div),this.layers.push(e),e.setMap(this),e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw(),this.events.triggerEvent("addlayer",{layer:e}),e.events.triggerEvent("added",{map:this,layer:e}),e.afterAdd(),!0)},addLayers:function(e){for(var t=0,i=e.length;t<i;t++)this.addLayer(e[t])},removeLayer:function(e,t){if(this.events.triggerEvent("preremovelayer",{layer:e})!==!1){if(null==t&&(t=!0),e.isFixed?this.viewPortDiv.removeChild(e.div):this.layerContainerDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.layers,e),e.removeMap(this),e.map=null,this.baseLayer==e&&(this.baseLayer=null,t))for(var i=0,r=this.layers.length;i<r;i++){var n=this.layers[i];if(n.isBaseLayer||this.allOverlays){this.setBaseLayer(n);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:e}),e.events.triggerEvent("removed",{map:this,layer:e})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var i=this.getLayerIndex(e);if(t<0?t=0:t>this.layers.length&&(t=this.layers.length),i!=t){this.layers.splice(i,1),this.layers.splice(t,0,e);for(var r=0,n=this.layers.length;r<n;r++)this.setLayerZIndex(this.layers[r],r);this.events.triggerEvent("changelayer",{layer:e,property:"order"}),this.allOverlays&&(0===t?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,t){var i=this.getLayerIndex(e)+t;this.setLayerIndex(e,i)},setBaseLayer:function(e){if(e!=this.baseLayer&&OpenLayers.Util.indexOf(this.layers,e)!=-1){var t=this.getCachedCenter(),i=this.getResolution(),r=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);if(null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=e,this.allOverlays&&!this.baseLayer.visibility||(this.baseLayer.setVisibility(!0),this.baseLayer.inRange===!1&&this.baseLayer.redraw()),null!=t){var n=this.getZoomForResolution(r||this.resolution,!0);this.setCenter(t,n,!1,i!=r)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(e,t){this.controls.push(e),this.addControlToMap(e,t),this.events.triggerEvent("addcontrol")},addControls:function(e,t){for(var i=1===arguments.length?[]:t,r=0,n=e.length;r<n;r++){var s=e[r],o=i[r]?i[r]:null;this.addControl(s,o)}},addControlToMap:function(e,t){e.outsideViewport=null!=e.div,this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection),e.setMap(this);var i=e.draw(t);i&&(e.outsideViewport||(i.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(i))),e.autoActivate&&e.activate()},getControl:function(e){for(var t=null,i=0,r=this.controls.length;i<r;i++){var n=this.controls[i];if(n.id==e){t=n;break}}return t},removeControl:function(e){e&&e==this.getControl(e.id)&&(e.div&&e.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.controls,e),this.events.triggerEvent("removecontrol"))},addPopup:function(e,t){if(t)for(var i=this.popups.length-1;i>=0;--i)this.removePopup(this.popups[i]);e.map=this,this.popups.push(e);var r=e.draw();r&&(r.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(r))},removePopup:function(e){if(OpenLayers.Util.removeItem(this.popups,e),e.div)try{this.layerContainerDiv.removeChild(e.div)}catch(t){}e.map=null},destroyPopup:function(e){OpenLayers.Util.removeItem(this.popups,e),e.destroy(),e=null},getSize:function(){var e=null;return null!=this.size&&(e=this.size.clone()),e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();if(null==t&&(this.size=t=e),!e.equals(t)){this.size=e;for(var i=0,r=this.layers.length;i<r;i++)this.layers[i].onMapResize();var n=this.getCachedCenter();if(null!=this.baseLayer&&null!=n){var s=this.getZoom();this.zoom=null,this.setCenter(n,s)}}}if(this.popups)for(var i=0;i<this.popups.length;i++)this.popups[i].visible()&&this.popups[i].updatePosition();this.events.triggerEvent("updatesize")},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=this.div.offsetWidth,e.h=this.div.offsetHeight),(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=parseInt(this.div.style.width),e.h=parseInt(this.div.style.height)),e},calculateBounds:function(e,t){var i=null;if(null==e&&(e=this.getCachedCenter()),null==t&&(t=this.getResolution()),null!=e&&null!=t){var r=this.size.w*t/2,n=this.size.h*t/2;i=new OpenLayers.Bounds(e.lon-r,e.lat-n,e.lon+r,e.lat+n)}return i},getCenter:function(){var e=null,t=this.getCachedCenter();return t&&(e=t.clone()),e},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(e,t,i){if(i=OpenLayers.Util.applyDefaults(i,{animate:!0,dragging:!1}),this.panTween&&this.panTween.stop(),i.dragging)0==e&&0==t||this.moveByPx(e,t);else{var r=this.getViewPortPxFromLonLat(this.getCachedCenter()),n=r.add(e,t);if(this.dragging||!n.equals(r)){var s=this.getLonLatFromViewPortPx(n);i.isPan||(s=this.getCachedCenter()),i.animate?this.panTo(s):(this.moveTo(s),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(e,t){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(e)){var i=this.getCachedCenter();if(e.equals(i))return;var r=this.getPixelFromLonLat(i),n=this.getPixelFromLonLat(e),s={x:n.x-r.x,y:n.y-r.y},o={x:0,y:0};this.panTween.start({x:0,y:0},s,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){var t=e.x-o.x,i=e.y-o.y;this.moveByPx(t,i),o.x=Math.round(e.x),o.y=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(i){this.moveTo(e),this.dragging=!1,this.events.triggerEvent("moveend"),t&&t()},this)}})}else this.setCenter(e),t&&t()},setCenter:function(e,t,i,r){this.panTween&&this.panTween.stop(),this.zoomTween&&t!=this.zoom&&this.zoomTween.stop(),this.moveTo(e,t,{dragging:i,forceZoomChange:r})},moveByPx:function(e,t){var i=this.size.w/2,r=this.size.h/2,n=i+e,s=r+t,o=this.baseLayer.wrapDateLine,a=0,l=0;if(this.restrictedExtent&&(a=i,l=r,o=!1),e=o||n<=this.maxPx.x-a&&n>=this.minPx.x+a?Math.round(e):0,t=s<=this.maxPx.y-l&&s>=this.minPx.y+l?Math.round(t):0,e||t){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,e&&(this.layerContainerOriginPx.x-=e,this.minPx.x-=e,this.maxPx.x-=e),t&&(this.layerContainerOriginPx.y-=t,this.minPx.y-=t,this.maxPx.y-=t),this.applyTransform();var p,h,u;for(h=0,u=this.layers.length;h<u;++h)p=this.layers[h],p.visibility&&(p===this.baseLayer||p.inRange)&&(p.moveByPx(e,t),p.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(e){if(this.baseLayer&&this.baseLayer.wrapDateLine){var t=this.baseLayer.resolutions,i=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(e)>i)if(this.fractionalZoom)e=this.getZoomForResolution(i);else for(var r=0|e,n=t.length;r<n;++r)if(t[r]<=i){e=r;break}}return e},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(e,t,i){var r=this.getZoom(),n=!0;n=!t&&0!=t||t==r,null==e||e instanceof OpenLayers.LonLat||(e=new OpenLayers.LonLat(e)),i||(i={}),null!=t&&(t=parseFloat(t),this.fractionalZoom||(t=Math.round(t)));var s=t;t=this.adjustZoom(t),t!==s&&(e=this.getCenter());var o=i.dragging||this.dragging,a=i.forceZoomChange||this.isZooming;if(this.getCachedCenter()||this.isValidLonLat(e)||(e=this.maxExtent.getCenterLonLat(),this.center=e.clone()),null==t&&(t=this.getZoom()),null!=this.restrictedExtent){null==e&&(e=this.center);var l=this.getResolutionForZoom(t),p=this.calculateBounds(e,l);if(!this.restrictedExtent.containsBounds(p)){var h=this.restrictedExtent.getCenterLonLat();p.getWidth()>this.restrictedExtent.getWidth()?e=new OpenLayers.LonLat(h.lon,e.lat):p.left<this.restrictedExtent.left?e=e.add(this.restrictedExtent.left-p.left,0):p.right>this.restrictedExtent.right&&(e=e.add(this.restrictedExtent.right-p.right,0)),p.getHeight()>this.restrictedExtent.getHeight()?e=new OpenLayers.LonLat(e.lon,h.lat):p.bottom<this.restrictedExtent.bottom?e=e.add(0,this.restrictedExtent.bottom-p.bottom):p.top>this.restrictedExtent.top&&(e=e.add(0,this.restrictedExtent.top-p.top))}}var u=a||this.isValidZoomLevel(t)&&t!=this.getZoom(),y=this.isValidLonLat(e)&&!e.equals(this.center);if(u||y||o){y&&(!u&&this.center&&this.centerLayerContainer(e),this.center=e.clone());var c=u?this.getResolutionForZoom(t):this.getResolution();if(u||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerOriginPx.x=0,this.layerContainerOriginPx.y=0,this.applyTransform();var d=this.getMaxExtent({restricted:!0}),m=d.getCenterLonLat(),f=this.center.lon-m.lon,g=m.lat-this.center.lat,L=Math.round(d.getWidth()/c),v=Math.round(d.getHeight()/c);this.minPx={x:(this.size.w-L)/2-f/c,y:(this.size.h-v)/2-g/c},this.maxPx={x:this.minPx.x+Math.round(d.getWidth()/c),y:this.minPx.y+Math.round(d.getHeight()/c)}}u&&(this.zoom=t,this.resolution=c),o||this.events.triggerEvent("movestart",{zoomChanged:u});var O=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(O,u,i.dragging),i.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:u})),O=this.baseLayer.getExtent();for(var P=this.layers.length-1;P>=0;--P){var b=this.layers[P];if(b!==this.baseLayer&&!b.isBaseLayer){var w=b.calculateInRange();b.inRange!=w&&(b.inRange=w,w||b.display(!1),this.events.triggerEvent("changelayer",{layer:b,property:"visibility"})),w&&b.visibility&&(b.moveTo(O,u,i.dragging),i.dragging||b.events.triggerEvent("moveend",{zoomChanged:u}))}}this.events.triggerEvent("move"),o||this.events.triggerEvent("moveend"),u&&(n&&!i.zoomChanged||window.setTimeout(this._showpopups.bind(this),10),this.isZooming=!1,this.events.triggerEvent("zoomend"))}},_showpopups:function(){for(var e=0,t=this.popups.length;e<t;e++)this.popups[e].hideStates===!1&&this.popups[e].updatePosition(),this.popups[e].mapHide&&this.popups[e].show()},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin),i=this.getViewPortPxFromLonLat(e);if(null!=t&&null!=i){var r=this.layerContainerOriginPx.x,n=this.layerContainerOriginPx.y,s=Math.round(t.x-i.x),o=Math.round(t.y-i.y);this.applyTransform(this.layerContainerOriginPx.x=s,this.layerContainerOriginPx.y=o);var a=r-s,l=n-o;this.minPx.x-=a,this.maxPx.x-=a,this.minPx.y-=l,this.maxPx.y-=l}},isValidZoomLevel:function(e){var t=null!=e&&e>=0&&e<this.getNumZoomLevels();return t&&this.minZoom&&this.maxZoom?e>=this.minZoom&&this.maxZoom>=e:t},isValidLonLat:function(e){var t=!1;try{if(null!=e){var i=this.getMaxExtent(),r=this.baseLayer.wrapDateLine&&i;t=i.containsLonLat(e,{worldBounds:r})}}catch(n){}return t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.projection),e},getMaxResolution:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.maxResolution),e},getMaxExtent:function(e){var t=null;return e&&e.restricted&&this.restrictedExtent?t=this.restrictedExtent:null!=this.baseLayer&&(t=this.baseLayer.maxExtent),t},getNumZoomLevels:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.numZoomLevels),e},getExtent:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.getExtent()),e},getResolution:function(){var e=null;return null!=this.baseLayer?e=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(e=this.layers[0].getResolution()),e},getUnits:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.units),e},getScale:function(){var e=null;if(null!=this.baseLayer){var t=this.getResolution(),i=this.baseLayer.units;e=OpenLayers.Util.getScaleFromResolution(t,i)}return e},getZoomForExtent:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForExtent(e,t)),parseInt(i)},getResolutionForZoom:function(e){var t=null;return this.baseLayer&&(t=this.baseLayer.getResolutionForZoom(e)),t},getZoomForResolution:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForResolution(e,t)),Math.round(i)},zoomTo:function(e,t,i,r){e=Math.round(e);var n=this;if(n.isValidZoomLevel(e)){this.isZooming=!0,n.baseLayer.wrapDateLine&&(e=n.adjustZoom(e));var s=t?n.getZoomTargetCenter(t,n.getResolutionForZoom(e)):n.getCenter();if(s=r||s,s&&e!=this.getZoom()){for(var o=0,a=this.popups.length;o<a;o++)this.popups[o].visible()&&this.popups[o].hide(!0);n.events.triggerEvent("zoomstart",{center:s,zoom:e,xy:t,zoomType:i})}if(n.zoomTween){var l=n.getResolution(),p=n.getResolutionForZoom(e),h={scale:1},u={scale:l/p},y=-1;if(e>n.getZoom()&&(y=1),n.zoomTween.playing&&n.zoomTween.isZoomIn==y&&n.zoomTween.duration<3*n.zoomDuration)n.zoomTween.finish={scale:n.zoomTween.finish.scale*u.scale};else{if(n.zoomTween.isZoomIn=y,!t){var c=n.getSize();t={x:c.w/2,y:c.h/2}}e==n.minZoom||e==n.maxZoom?4==Math.abs(n.getZoom()-e)?n.zoomDuration=6:3==Math.abs(n.getZoom()-e)?n.zoomDuration=5:2==Math.abs(n.getZoom()-e)?n.zoomDuration=4:1==Math.abs(n.getZoom()-e)&&(n.zoomDuration=2):n.zoomDuration=20,n.zoomTween.start(h,u,n.zoomDuration,{minFrameRate:45,callbacks:{eachStep:function(e){var i=n.layerContainerOriginPx,r=e.scale,s=(r-1)*(i.x-t.x)|0,o=(r-1)*(i.y-t.y)|0;n.applyTransform(i.x+s,i.y+o,r)},done:function(e){n.applyTransform();var i=n.getResolution()/e.scale,r=n.getZoomForResolution(i,!0);r>n.maxZoom&&(r=n.maxZoom),r<n.minZoom&&(r=n.minZoom),i=n.getResolutionForZoom(r),n.moveTo(n.getZoomTargetCenter(t,i),r,{zoomChanged:!0})}}})}}else{var s=t?n.getZoomTargetCenter(t,n.getResolutionForZoom(e)):null;n.setCenter(s,e)}}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t,i){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var r=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){var n=this.getMaxExtent();for(e=e.clone();e.right<e.left;)e.right+=n.getWidth();r=e.getCenterLonLat().wrapDateLine(n)}i&&(r=this.originCenter),this.setCenter(r,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){var t=new OpenLayers.LonLat(this.originCenter[0],this.originCenter[1]);this.setCenter(t,this.minZoom)},zoomToScale:function(e,t){var i=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units),r=this.size.w*i/2,n=this.size.h*i/2,s=this.getCachedCenter(),o=new OpenLayers.Bounds(s.lon-r,s.lat-n,s.lon+r,s.lat+n);this.zoomToExtent(o,t)},getLonLatFromViewPortPx:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getLonLatFromViewPortPx(e)),t},getViewPortPxFromLonLat:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getViewPortPxFromLonLat(e)),t},getZoomTargetCenter:function(e,t){var i=null,r=this.getSize(),n=r.w/2-e.x,s=e.y-r.h/2,o=this.getLonLatFromPixel(e);return o&&(i=new OpenLayers.LonLat(o.lon+n*t,o.lat+s*t)),i},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){var t=this.getViewPortPxFromLonLat(e);return t.x=Math.round(t.x),t.y=Math.round(t.y),t},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0),i=this.getResolution(),r=t.add(-i/2,0),n=t.add(i/2,0),s=t.add(0,-i/2),o=t.add(0,i/2),a=new OpenLayers.Projection("EPSG:4326"),l=this.getProjectionObject()||a;return l.equals(a)||(r.transform(l,a),n.transform(l,a),s.transform(l,a),o.transform(l,a)),new OpenLayers.Size(OpenLayers.Util.distVincenty(r,n),OpenLayers.Util.distVincenty(s,o))},getViewPortPxFromLayerPx:function(e){var t=null;if(null!=e){var i=this.layerContainerOriginPx.x,r=this.layerContainerOriginPx.y;t=e.add(i,r)}return t},getLayerPxFromViewPortPx:function(e){var t=null;if(null!=e){var i=-this.layerContainerOriginPx.x,r=-this.layerContainerOriginPx.y;t=e.add(i,r),(isNaN(t.x)||isNaN(t.y))&&(t=null)}return t},getLonLatFromLayerPx:function(e){return e=this.getViewPortPxFromLayerPx(e),this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){var t=this.getPixelFromLonLat(e);return this.getLayerPxFromViewPortPx(t)},applyTransform:function(e,t,i){i=i||1;var r=this.layerContainerOriginPx,n=1!==i;e=e||r.x,t=t||r.y;var s=this.layerContainerDiv.style,o=this.applyTransform.transform,a=this.applyTransform.template;if(void 0===o&&(o=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=o,o)){var l=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));l&&"none"===l||(a=["translate3d(",",0) ","scale3d(",",1)"],s[o]=[a[0],"0,0",a[1]].join("")),a&&~s[o].indexOf(a[0])||(a=["translate(",") ","scale(",")"]),this.applyTransform.template=a}null===o||"translate3d("!==a[0]&&n!==!0?(s.left=e+"px",s.top=t+"px",null!==o&&(s[o]="")):(n===!0&&"translate("===a[0]&&(e-=r.x,t-=r.y,s.left=r.x+"px",s.top=r.y+"px"),s[o]=[a[0],e,"px,",t,"px",a[1],a[2],i,",",i,a[3]].join(""))},getSortLayers:function(){var e=this.layers.slice();return e.sort(function(e,t){return parseInt(e.getZIndex())-parseInt(t.getZIndex())})},getFeatures:function(e,t){var i,r,n,s=(e.offsetX,e.offsetY,[]),o=[],a=this.getSortLayers();if(!this.useMultiMarkers)for(var l=this.viewPortDiv.getElementsByTagName("canvas"),p=[],n=0;n<l.length;n++)l[n].parentElement==this.viewPortDiv&&"none"!==l[n].style.display?(p.push(l[n]),
l[n].style.display="none"):"olScrollable"===l[n].parentElement.className&&"none"!==l[n].parentElement.style.display&&(p.push(l[n]),l[n].parentElement.style.display="none");for(n=a.length-1;n>=0;--n)if(i=a[n],"none"!==i.div.style.display)if(i.renderer instanceof OpenLayers.Renderer.Elements){if(i instanceof OpenLayers.Layer.Vector){if(r=i.getFeatureFromEvent(e)){s.push(r);break}o.push(i),i.div.style.display="none"}}else i.renderer&&i.renderer instanceof OpenLayers.Renderer.Canvas&&(r=i.getFeatureFromEvent(e),r&&(s.push(r),o.push(i)));for(n=o.length-1;n>=0;--n)o[n].div.style.display="block";if(!this.useMultiMarkers)for(var n=0;n<p.length;n++)p[n].parentElement==this.viewPortDiv?p[n].style.display="block":"olScrollable"===p[n].parentElement.className&&(p[n].parentElement.style.display="block");return s},setMapStyle:function(e){switch(e){case"灰色":this.mapStyle="grayscale";break;case"经典黑":this.mapStyle="classicblack";break;case"浅绿":this.mapStyle="green";break;case"天蓝":this.mapStyle="blue";break;case"粉色":this.mapStyle="pinkcolour";break;default:this.mapStyle=null}},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,preZindex:null,initialize:function(e,t){this.metadata={},t=OpenLayers.Util.extend({},t),null!=this.alwaysInRange&&(t.alwaysInRange=this.alwaysInRange),this.addOptions(t),this.name=e,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object&&this.events.on(this.eventListeners))},destroy:function(e){null==e&&(e=!0),null!=this.map&&this.map.removeLayer(this,e),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(e){return null==e&&(e=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(e,this),e.map=null,e},getOptions:function(){var e={};for(var t in this.options)e[t]=this[t];return e},setName:function(e){e!=this.name&&(this.name=e,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(e,t){if(null==this.options&&(this.options={}),e&&("string"==typeof e.projection&&(e.projection=new OpenLayers.Projection(e.projection)),e.projection&&OpenLayers.Util.applyDefaults(e,OpenLayers.Projection.defaults[e.projection.getCode()]),!e.maxExtent||e.maxExtent instanceof OpenLayers.Bounds||(e.maxExtent=new OpenLayers.Bounds(e.maxExtent)),!e.minExtent||e.minExtent instanceof OpenLayers.Bounds||(e.minExtent=new OpenLayers.Bounds(e.minExtent))),OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var i=this.map.getResolution(),r=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var n in e)if(e.hasOwnProperty(n)&&OpenLayers.Util.indexOf(r,n)>=0){this.initResolutions(),t&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(i),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();if(t&&this.inRange&&this.visibility){var i=!0;this.moveTo(t,i,!1),this.events.triggerEvent("moveend",{zoomChanged:i}),e=!0}}return e},moveTo:function(e,t,i){var r=this.visibility;this.isBaseLayer||(r=r&&this.inRange),this.display(r)},moveByPx:function(e,t){},setMap:function(e){if(null==this.map){if(this.map=e,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.projection&&this.projection.getUnits()?this.units=this.projection.getUnits():this.units=this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var t=this.visibility&&this.inRange;this.div.style.display=t?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(e){},getImageSize:function(e){return this.imageSize||this.tileSize},setTileSize:function(e){var t=e?e:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=t,this.gutter&&(this.imageSize=new OpenLayers.Size(t.w+2*this.gutter,t.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(e){e!=this.visibility&&(this.visibility=e,this.display(e),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(e){e!=("none"!=this.div.style.display)&&(this.div.style.display=e&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var e=!1;if(this.alwaysInRange)e=!0;else if(this.map){var t=this.map.getResolution();e=t>=this.minResolution&&t<=this.maxResolution}return e},setIsBaseLayer:function(e){e!=this.isBaseLayer&&(this.isBaseLayer=e,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var e,t,i,r={},n=!0;for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++)i=this.RESOLUTION_PROPERTIES[e],r[i]=this.options[i],n&&this.options[i]&&(n=!1);if(null==this.options.alwaysInRange&&(this.alwaysInRange=n),null==r.resolutions&&(r.resolutions=this.resolutionsFromScales(r.scales)),null==r.resolutions&&(r.resolutions=this.calculateResolutions(r)),null==r.resolutions){for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++)i=this.RESOLUTION_PROPERTIES[e],r[i]=null!=this.options[i]?this.options[i]:this.map[i];null==r.resolutions&&(r.resolutions=this.resolutionsFromScales(r.scales)),null==r.resolutions&&(r.resolutions=this.calculateResolutions(r))}var s;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(s=this.options.maxResolution),this.options.minScale&&(s=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var o;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(o=this.options.minResolution),this.options.maxScale&&(o=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),r.resolutions&&(r.resolutions.sort(function(e,t){return t-e}),s||(s=r.resolutions[0]),!o)){var a=r.resolutions.length-1;o=r.resolutions[a]}if(this.resolutions=r.resolutions,this.resolutions){for(t=this.resolutions.length,this.scales=new Array(t),e=0;e<t;e++)this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units);this.numZoomLevels=t}this.minResolution=o,o&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(o,this.units)),this.maxResolution=s,s&&(this.minScale=OpenLayers.Util.getScaleFromResolution(s,this.units))},resolutionsFromScales:function(e){if(null!=e){var t,i,r;for(r=e.length,t=new Array(r),i=0;i<r;i++)t[i]=OpenLayers.Util.getResolutionFromScale(e[i],this.units);return t}},calculateResolutions:function(e){var t,i,r,n=e.maxResolution;null!=e.minScale?n=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units):"auto"==n&&null!=this.maxExtent&&(t=this.map.getSize(),i=this.maxExtent.getWidth()/t.w,r=this.maxExtent.getHeight()/t.h,n=Math.max(i,r));var s=e.minResolution;if(null!=e.maxScale?s=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units):"auto"==e.minResolution&&null!=this.minExtent&&(t=this.map.getSize(),i=this.minExtent.getWidth()/t.w,r=this.minExtent.getHeight()/t.h,s=Math.max(i,r)),"number"!=typeof n&&"number"!=typeof s&&null!=this.maxExtent){var o=this.map.getTileSize();n=Math.max(this.maxExtent.getWidth()/o.w,this.maxExtent.getHeight()/o.h)}var a=e.maxZoomLevel,l=e.numZoomLevels;if("number"==typeof s&&"number"==typeof n&&void 0===l){var p=n/s;l=Math.floor(Math.log(p)/Math.log(2))+1}else void 0===l&&null!=a&&(l=a+1);if(!("number"!=typeof l||l<=0||"number"!=typeof n&&"number"!=typeof s)){var h=new Array(l),u=2;"number"==typeof s&&"number"==typeof n&&(u=Math.pow(n/s,1/(l-1)));var y;if("number"==typeof n)for(y=0;y<l;y++)h[y]=n/Math.pow(u,y);else for(y=0;y<l;y++)h[l-1-y]=s*Math.pow(u,y);return h}},getResolution:function(){var e=this.map.getZoom();return this.getResolutionForZoom(e)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var i=this.map.getSize(),r=Math.max(e.getWidth()/i.w,e.getHeight()/i.h);return this.getZoomForResolution(r,t)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));var t;if(this.map.fractionalZoom){var i=Math.floor(e),r=Math.ceil(e);t=this.resolutions[i]-(e-i)*(this.resolutions[i]-this.resolutions[r])}else t=this.resolutions[Math.round(e)];return t},getZoomForResolution:function(e,t){var i,r,n;if(this.map.fractionalZoom){var s,o=0,a=this.resolutions.length-1,l=this.resolutions[o],p=this.resolutions[a];for(r=0,n=this.resolutions.length;r<n;++r)if(s=this.resolutions[r],s>=e&&(l=s,o=r),s<=e){p=s,a=r;break}var h=l-p;i=h>0?o+(l-e)/h:o}else{var u,y=Number.POSITIVE_INFINITY;for(r=0,n=this.resolutions.length;r<n;r++)if(t){if(u=Math.abs(this.resolutions[r]-e),u>y)break;y=u}else if(this.resolutions[r]<e)break;i=Math.max(0,r-1)}return t&&(i=Math.round(i)),i},getLonLatFromViewPortPx:function(e){var t=null,i=this.map;if(null!=e&&i.minPx){var r=i.getResolution(),n=i.getMaxExtent({restricted:!0}),s=(e.x-i.minPx.x)*r+n.left,o=(i.minPx.y-e.y)*r+n.top;t=new OpenLayers.LonLat(s,o),this.wrapDateLine&&(t=t.wrapDateLine(this.maxExtent))}return t},getViewPortPxFromLonLat:function(e,t){var i=null;if(null!=e){t=t||this.map.getResolution();var r=this.map.calculateBounds(null,t);i=new OpenLayers.Pixel(1/t*(e.lon-r.left),1/t*(r.top-e.lat))}return i},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=this.div.childNodes,i=0,r=t.length;i<r;++i){var n=t[i].firstChild||t[i],s=t[i].lastChild;s&&"iframe"===s.nodeName.toLowerCase()&&(n=s.parentNode),OpenLayers.Util.modifyDOMElement(n,null,null,null,null,null,null,e)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter){var t=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t)}if(this.wrapDateLine){var i={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};e=e.wrapDateLine(this.maxExtent,i)}return e},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,t,i,r){this.url=e,this.size=t||{w:20,h:20},this.offset=i||{x:-(this.size.w/2),y:-(this.size.h/2)},this.calculateOffset=r;var n=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(n)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(e){null!=e&&(this.size=e),this.draw()},setUrl:function(e){null!=e&&(this.url=e),this.draw()},draw:function(e){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(e),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,e)},moveTo:function(e){null!=e&&(this.px=e),null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(e){this.imageDiv.style.display=e?"":"none"},isDrawn:function(){var e=this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType;return e},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,isAdaptation:!1,prevPositon:null,mapHide:!0,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(e,t,i,r,n,s,o){null==e&&(e=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=e,this.lonlat=t,this.contentSize=null!=i?i:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=r&&(this.contentHTML=r),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.style.overflow="visible",this.div.style.cursor="default",this.div.className=this.displayClass;var a=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(a,null,null,null,"relative",null,"hidden");var e=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(e,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),o&&(this.titleDiv=OpenLayers.Util.createDiv(e+"_dialog",null,new OpenLayers.Size(this.contentSize.w,20),null,"relative"),this.titleDiv.innerHTML='<span id="ui-id-1" class="ui-dialog-title">Basic dialog</span>'),this.div.appendChild(this.groupDiv),n&&this.addCloseBox(s),this.registerEvents()},destroy:function(){this.id=null,this.lonlat=null,this.size=null,this.contentHTML=null,this.backgroundColor=null,this.opacity=null,this.border=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),delete this.closeDiv,this.closeDiv=null,this.contentDiv&&(this.groupDiv.removeChild(this.contentDiv),delete this.contentDiv,this.contentDiv=null),this.div.removeChild(this.groupDiv),delete this.groupDiv,this.groupDiv=null,this.map.layerContainerDiv.removeChild(this.div),delete this.map,this.map=null,delete this.div,this.div=null,this.autoSize=null,this.contentSize=null,this.minSize=null,this.maxSize=null,this.padding=null,this.panMapIfOutOfView=null},draw:function(e){return null==e&&null!=this.lonlat&&null!=this.map&&(e=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var e=document.defaultView.getComputedStyle(this.contentDiv,null),t=e.getPropertyValue("overflow");"hidden"!=t&&(this.contentDiv._oldOverflow=t,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var e=this.contentDiv._oldOverflow;e&&(this.contentDiv.style.overflow=e,this.contentDiv._oldOverflow=null)})),this.moveTo(e),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.isAdaptation&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);e&&this.moveTo(e)}},moveTo:function(e){if(null!=e&&null!=this.div){var t=0;this.positionBlocks&&this.positionBlocks.tr.blocks.length>0&&(t=this.positionBlocks.tr.blocks[0].size.h),e.y=e.y-t,this.div.style.left=e.x+"px",this.div.style.top=e.y+"px",this.prevPositon={left:this.div.style.left,top:this.div.style.top}}},visible:function(){return"-1000000px"!=this.div.style.left&&"-1e+06px"!=this.div.style.left&&"-1000000px"!=this.div.style.top&&"-1e+06px"!=this.div.style.top},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="",this.prevPositon&&(this.div.style.left=this.prevPositon.left,this.div.style.top=this.prevPositon.top),this.panMapIfOutOfView&&this.isAdaptation&&this.panIntoView(),this.hideStates=!1,this.mapHide=!1},hide:function(e){this.prevPositon={left:this.div.style.left,top:this.div.style.top},this.div.style.left="-1000000px",this.div.style.top="-1000000px",this.hideStates=!0,this.mapHide=e},setSize:function(e){if(this.size=e.clone(),"OpenLayers.Popup.Anchored"!=this.CLASS_NAME){var t=this.getContentDivPadding(),i=t.left+t.right,r=t.top+t.bottom;if(this.fixPadding(),i+=this.padding.left+this.padding.right,r+=this.padding.top+this.padding.bottom,this.closeDiv){var n=parseInt(this.closeDiv.style.width);i+=n+t.right}this.size.w+=i,this.size.h+=r,this.imageSize&&(this.size.h-=this.imageSize.h),"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=t.left+t.right,this.contentSize.h+=t.bottom+t.top)}null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=e.w+"px",this.contentDiv.style.height=e.h+"px")},getContentDivStyle:function(){if(this.contentDiv)return this.contentDiv.style},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",t=this.map?this.map.div:document.body,i=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass,containerElement:t}),r=this.getSafeContentSize(i),n=null;if(r.equals(i))n=i;else{var s={w:r.w<i.w?r.w:null,h:r.h<i.h?r.h:null};if(s.w&&s.h)n=r;else{var o=OpenLayers.Util.getRenderedDimensions(e,s,{displayClass:this.contentDisplayClass,containerElement:t}),a=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if("hidden"!=a&&o.equals(r)){var l=OpenLayers.Util.getScrollbarWidth();s.w?o.h+=l:o.w+=l}n=this.getSafeContentSize(o)}}this.setSize(n)},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(e){void 0!=e&&(this.opacity=e),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(e){void 0!=e&&(this.border=e),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(e){null!=e&&(this.contentHTML=e),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize())),this.prevPositon={left:this.div.style.left,top:this.div.style.top}},registerImageListeners:function(){for(var e=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},t=this.contentDiv.getElementsByTagName("img"),i=0,r=t.length;i<r;i++){var n=t[i];if(0==n.width||0==n.height){var s={popup:this,img:n};n._onImgLoad=OpenLayers.Function.bind(e,s),OpenLayers.Event.observe(n,"load",n._onImgLoad)}}},getSafeContentSize:function(e){return e},getContentDivPadding:function(){var e=this._contentDivPadding;return e||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),e=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=e,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),e},addCloseBox:function(e){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var t=this.getContentDivPadding();this.closeDiv.style.right=t.right+"px",this.closeDiv.style.top=t.top+"px",this.groupDiv.appendChild(this.closeDiv);var i=e||function(e){this.hide(),OpenLayers.Event.stop(e)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(i,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(i,this))},panIntoView:function(){if(null!=this.map){var e=this.map.getSize(),t=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),i=t.clone();t.x<this.map.paddingForPopups.left?i.x=this.map.paddingForPopups.left:t.x+this.size.w>e.w-this.map.paddingForPopups.right&&(i.x=e.w-this.map.paddingForPopups.right-this.size.w),t.y<this.map.paddingForPopups.top?i.y=this.map.paddingForPopups.top:t.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(i.y=e.h-this.map.paddingForPopups.bottom-this.size.h);var r=t.x-i.x,n=t.y-i.y;this.map.pan(r,n)}},registerEvents:function(){function e(e){OpenLayers.Event.stop(e,!0)}this.events=new OpenLayers.Events(this,this.div,null,(!0)),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:e,scope:this})},onmousedown:function(e){this.mousedown=!0,OpenLayers.Event.stop(e,!0)},onmousemove:function(e){this.mousedown&&OpenLayers.Event.stop(e,!0)},onmouseup:function(e){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(e,!0))},onclick:function(e){OpenLayers.Event.stop(e,!0)},onmouseout:function(e){this.mousedown=!1},ondblclick:function(e){OpenLayers.Event.stop(e,!0)},setContentDom:function(e){if(this.contentHTML=e.innerHTML,null!=this.contentDiv){for(;this.contentDiv.childNodes.length>0;)this.contentDiv.removeChild(this.contentDiv.firstChild);this.contentDiv.appendChild(e),this.autoSize&&(this.registerImageListeners(),this.updateSize())}this.hideStates||(this.prevPositon={left:this.div.style.left,top:this.div.style.top})},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px",OpenLayers.Menu=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"contextmenu",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,menuList:[],initialize:function(e,t){null==e&&(e=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=e,this.menuList=t,this.backgroundColor=OpenLayers.Menu.COLOR,this.opacity=OpenLayers.Menu.OPACITY,this.border=OpenLayers.Menu.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,""),this.div.className=this.displayClass,this.registerEvents()},destroy:function(){this.id=null,this.lonlat=null,this.size=null,this.contentHTML=null,this.backgroundColor=null,this.opacity=null,this.border=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.div&&this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.map=null,this.div=null,this.autoSize=null,this.minSize=null,this.maxSize=null,this.padding=null,this.panMapIfOutOfView=null},draw:function(e){return null==e&&(this.lonlat=this.map.getMousePosition(),null!=this.lonlat&&null!=this.map&&(e=this.map.getLayerPxFromLonLat(this.lonlat))),this.closeOnMove,this.moveTo(e),!this.autoSize&&!this.size,this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);e&&this.moveTo(e)}},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(pixel,f){this.div.style.display="",this.div.innerHTML="",f&&(this.div.style.left=pixel.x+"px",this.div.style.top=pixel.y+"px");for(var mHeight=20,mWidth=100,g_menu=this.menuList,i=0;i<g_menu.length;i++){var pDiv=document.createElement("div");this.div.appendChild(pDiv);var pObj=g_menu[i];if(null!=pObj){pDiv.style.width=mWidth+"px",pDiv.innerHTML=pObj.name,pDiv.className="menuitem",pDiv.func=pObj.func,pDiv.onmouseover=function(){this.className="menuitem selectedmenuitem"},pDiv.onmouseout=function(){this.className="menuitem"};var that=this;pDiv.onclick=function(){f?this.func(NPMapLib.T.getPoint(that.map,that.map.mousePosition)):eval(this.func)}}else pDiv.className="divider"}var e=window.event?window.event:f;e&&(e.returnValue=!1),this.div.style.display="",this.div.style.backgroundColor="rgb(240, 240, 240)"},hide:function(){this.div&&(this.div.style.display="none",this.destroy())},setSize:function(e){this.size=e.clone();var t=this.getContentDivPadding(),i=t.left+t.right,r=t.top+t.bottom;if(this.fixPadding(),i+=this.padding.left+this.padding.right,r+=this.padding.top+this.padding.bottom,this.closeDiv){var n=parseInt(this.closeDiv.style.width);i+=n+t.right}this.size.w+=i,this.size.h+=r,"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=t.left+t.right,this.contentSize.h+=t.bottom+t.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=e.w+"px",this.contentDiv.style.height=e.h+"px")},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",t=this.map?this.map.div:document.body,i=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass,containerElement:t}),r=this.getSafeContentSize(i),n=null;if(r.equals(i))n=i;else{var s={w:r.w<i.w?r.w:null,h:r.h<i.h?r.h:null};if(s.w&&s.h)n=r;else{var o=OpenLayers.Util.getRenderedDimensions(e,s,{displayClass:this.contentDisplayClass,containerElement:t}),a=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if("hidden"!=a&&o.equals(r)){var l=OpenLayers.Util.getScrollbarWidth();s.w?o.h+=l:o.w+=l}n=this.getSafeContentSize(o)}}this.setSize(n)},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(e){void 0!=e&&(this.opacity=e),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(e){void 0!=e&&(this.border=e),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(e){null!=e&&(this.contentHTML=e),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var e=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},t=this.contentDiv.getElementsByTagName("img"),i=0,r=t.length;i<r;i++){var n=t[i];if(0==n.width||0==n.height){var s={popup:this,img:n};n._onImgLoad=OpenLayers.Function.bind(e,s),OpenLayers.Event.observe(n,"load",n._onImgLoad)}}},getSafeContentSize:function(e){var t=e.clone(),i=this.getContentDivPadding(),r=i.left+i.right,n=i.top+i.bottom;if(this.fixPadding(),r+=this.padding.left+this.padding.right,n+=this.padding.top+this.padding.bottom,this.closeDiv){var s=parseInt(this.closeDiv.style.width);r+=s+i.right}if(this.minSize&&(t.w=Math.max(t.w,this.minSize.w-r),t.h=Math.max(t.h,this.minSize.h-n)),this.maxSize&&(t.w=Math.min(t.w,this.maxSize.w-r),t.h=Math.min(t.h,this.maxSize.h-n)),this.map&&this.map.size){var o=0,a=0;if(this.keepInMap&&!this.panMapIfOutOfView){var l=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":o=l.x,a=this.map.size.h-l.y;break;case"tl":o=this.map.size.w-l.x,a=this.map.size.h-l.y;break;case"bl":o=this.map.size.w-l.x,a=l.y;break;case"br":o=l.x,a=l.y;break;default:o=l.x,a=this.map.size.h-l.y}}var p=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-n-a,h=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-r-o;t.w=Math.min(t.w,h),t.h=Math.min(t.h,p)}return t},getContentDivPadding:function(){var e=this._contentDivPadding;return e||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),e=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=e,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),e},addCloseBox:function(e){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var t=this.getContentDivPadding();this.closeDiv.style.right=t.right+"px",this.closeDiv.style.top=t.top+"px",this.groupDiv.appendChild(this.closeDiv);var i=e||function(e){this.hide(),OpenLayers.Event.stop(e)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(i,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(i,this))},panIntoView:function(){var e=this.map.getSize(),t=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),i=t.clone();t.x<this.map.paddingForPopups.left?i.x=this.map.paddingForPopups.left:t.x+this.size.w>e.w-this.map.paddingForPopups.right&&(i.x=e.w-this.map.paddingForPopups.right-this.size.w),t.y<this.map.paddingForPopups.top?i.y=this.map.paddingForPopups.top:t.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(i.y=e.h-this.map.paddingForPopups.bottom-this.size.h);var r=t.x-i.x,n=t.y-i.y;this.map.pan(r,n)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,(!0)),this.events.on({scope:this})},onmousedown:function(e){this.mousedown=!0,this.div.style.display="none",OpenLayers.Event.stop(e,!0)},onmousemove:function(e){this.mousedown&&OpenLayers.Event.stop(e,!0)},onmouseup:function(e){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(e,!0))},onclick:function(e){OpenLayers.Event.stop(e,!0)},onmouseout:function(e){this.mousedown=!1},ondblclick:function(e){OpenLayers.Event.stop(e,!0)},setContentDom:function(e){if(this.contentHTML=e.innerHTML,null!=this.contentDiv){for(;this.contentDiv.childNodes.length>0;)this.contentDiv.removeChild(this.contentDiv.firstChild);
this.contentDiv.appendChild(e),this.autoSize&&(this.registerImageListeners(),this.updateSize())}},CLASS_NAME:"OpenLayers.Menu"}),OpenLayers.Menu.WIDTH=200,OpenLayers.Menu.HEIGHT=200,OpenLayers.Menu.COLOR="white",OpenLayers.Menu.OPACITY=1,OpenLayers.Menu.BORDER="0px",OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(e,t,i,r,n,s){this.layer=e,this.position=t.clone(),this.setBounds(i),this.url=r,n&&(this.size=n.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,s),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null,this.bounds=null,this.size=null,this.position=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.eventListeners=null,this.events=null},draw:function(e){e||this.clear();var t=this.shouldDraw();return t&&!e&&this.events.triggerEvent("beforedraw")===!1&&(t=null),t},shouldDraw:function(){var e=!1,t=this.layer.maxExtent;if(t){var i=this.layer.map,r=i.baseLayer.wrapDateLine&&i.getMaxExtent();this.bounds.intersectsBounds(t,{inclusive:!1,worldBounds:r})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){if(e=e.clone(),this.layer.map.baseLayer.wrapDateLine){var t=this.layer.map.getMaxExtent(),i=this.layer.map.getResolution();e=e.wrapDateLine(t,{leftTolerance:i,rightTolerance:i})}this.bounds=e},moveTo:function(e,t,i){null==i&&(i=!0),this.setBounds(e),this.position=t.clone(),i&&this.draw()},clear:function(e){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(e,t,i,r,n,s){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=r,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.imgDiv=null,this.frame=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);return e?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):e===!1&&this.unload(),e},renderTile:function(){if(this.layer.async){var e=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(t){e==this.asyncRequestId&&(this.url=t,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var e=this.getTile().style,t=this.frame?this.size:this.layer.getImageSize(this.bounds),i=1;this.layer instanceof OpenLayers.Layer.Grid&&(i=this.layer.getServerResolution()/this.layer.map.getResolution()),e.left=this.position.x+"px",e.top=this.position.y+"px",e.width=Math.round(i*t.w)+"px",e.height=Math.round(i*t.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var e=this.imgDiv;if(e){var t=this.getTile();t.parentNode===this.layer.div&&this.layer.div.removeChild(t),this.setImgSrc(),this.layerAlphaHack===!0&&(e.style.filter=""),OpenLayers.Element.removeClass(e,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var e=this.imgDiv.style;if(this.frame){var t=0,i=0;this.layer.gutter&&(t=this.layer.gutter/this.layer.tileSize.w*100,i=this.layer.gutter/this.layer.tileSize.h*100),e.left=-t+"%",e.top=-i+"%",e.width=2*t+100+"%",e.height=2*i+100+"%"}e.visibility="hidden",e.opacity=0,this.layer.opacity<1&&(e.filter="alpha(opacity="+100*this.layer.opacity+")"),e.position="absolute",this.layerAlphaHack&&(e.paddingTop=e.height,e.height="0",e.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(e){this.imgDiv=e},initImage:function(){if(!this.url&&!this.imgDiv)return void(this.isLoading=!1);this.events.triggerEvent("beforeload"),this.layer.div.appendChild(this.getTile()),this.events.triggerEvent(this._loadEvent);var e=this.getImage(),t=e.getAttribute("src")||"";this.url&&OpenLayers.Util.isEquivalentUrl(t,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&&e.removeAttribute("crossorigin"),OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(e,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))},setImgSrc:function(e){var t=this.imgDiv;e?(t.style.visibility="hidden",t.style.opacity=0,this.crossOriginKeyword&&("data:"!==e.substr(0,5)?t.setAttribute("crossorigin",this.crossOriginKeyword):t.removeAttribute("crossorigin")),t.src=e):(this.stopLoading(),this.imgDiv=null,t.parentNode&&t.parentNode.removeChild(t))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var e;return this.frame?(e=this.frame.cloneNode(!1),e.appendChild(this.imgDiv)):e=this.imgDiv,this.imgDiv=null,e}},onImageLoad:function(){var e=this.imgDiv;this.stopLoading(),e.style.visibility="inherit",e.style.opacity=this.layer.opacity,e.style.webkitFilter=this.getImageStyleFilter(),this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),e.style.filter=e.style.webkitFilter,this.layerAlphaHack===!0&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},getImageStyleFilter:function(){var e="";switch(this.layer.map.mapStyle){case"grayscale":e="grayscale(1)";break;case"classicblack":e="invert()";break;case"green":e="hue-rotate(60deg)";break;case"blue":e="hue-rotate(120deg)";break;case"pinkcolour":e="hue-rotate(300deg)"}return e},onImageError:function(){var e=this.imgDiv;null!=e.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(e,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),window.clearTimeout(this._loadTimeout),delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var e=document.createElement("canvas");e.width=this.size.w,e.height=this.size.h,this.canvasContext=e.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.IMAGE=function(){var e=new Image;return e.className="olTileImage",e.galleryImg="no",e}(),OpenLayers.Tile.Image.IFrame={useIFrame:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",draw:function(){var e=OpenLayers.Tile.Image.prototype.shouldDraw.call(this);if(e){var t=this.layer.getURL(this.bounds),i=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&t.length>this.maxGetUrlLength;var r=i&&!this.useIFrame,n=!i&&this.useIFrame;(r||n)&&(this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,r&&this.frame.removeChild(this.frame.firstChild))}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(this.useIFrame===!0){if(!this.frame.childNodes.length){var e=document.createElement("div"),t=e.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex=1,t.backgroundImage="url("+this.blankImageUrl+")",this.frame.appendChild(e)}var i,r=this.id+"_iFrame";return parseFloat(navigator.appVersion.split("MSIE")[1])<9?(i=document.createElement('<iframe name="'+r+'">'),i.style.backgroundColor="#FFFFFF",i.style.filter="chroma(color=#FFFFFF)"):(i=document.createElement("iframe"),i.style.backgroundColor="transparent",i.name=r),i.scrolling="no",i.marginWidth="0px",i.marginHeight="0px",i.frameBorder="0",i.style.position="absolute",i.style.width="100%",i.style.height="100%",this.layer.opacity<1&&OpenLayers.Util.modifyDOMElement(i,null,null,null,null,null,null,this.layer.opacity),this.frame.appendChild(i),this.imgDiv=i,i}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var e=document.createElement("form");e.method="POST";var t=this.layer.params._OLSALT;t=(t?t+"_":"")+this.bounds.toBBOX(),e.action=OpenLayers.Util.urlAppend(this.layer.url,t),e.target=this.id+"_iFrame";var i,r=(this.layer.getImageSize(),OpenLayers.Util.getParameters(this.url));for(var n in r)i=document.createElement("input"),i.type="hidden",i.name=n,i.value=r[n],e.appendChild(i);return e},setImgSrc:function(e){if(this.useIFrame===!0)if(e){var t=this.createRequestForm();this.frame.appendChild(t),t.submit(),this.frame.removeChild(t)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments),this.useIFrame===!0&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var e;return this.useIFrame===!1&&(e=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this)),e}},OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear(),OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(e)if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var t=new OpenLayers.Protocol.Script({url:this.url,callback:function(e){this.isLoading=!1,this.events.triggerEvent("loadend"),this.json=e.data},scope:this});t.read(),this.request=t}else this.request=OpenLayers.Request.GET({url:this.url,callback:function(e){this.isLoading=!1,this.events.triggerEvent("loadend"),200===e.status&&this.parseData(e.responseText)},scope:this});else this.unload();return e},abortLoading:function(){this.request&&(this.request.abort(),delete this.request),this.isLoading=!1},getFeatureInfo:function(e,t){var i=null;if(this.json){var r=this.getFeatureId(e,t);null!==r&&(i={id:r,data:this.json.data[r]})}return i},getFeatureId:function(e,t){var i=null;if(this.json){var r=this.utfgridResolution,n=Math.floor(t/r),s=Math.floor(e/r),o=this.json.grid[n].charCodeAt(s),a=this.indexFromCharCode(o),l=this.json.keys;!isNaN(a)&&a in l&&(i=l[a])}return i},indexFromCharCode:function(e){return e>=93&&e--,e>=35&&e--,e-32},parseData:function(e){this.format||(this.format=new OpenLayers.Format.JSON),this.json=this.format.read(e)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"}),OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(e,t,i,r,n){this.url=t,this.extent=i,this.maxExtent=i,this.size=r,OpenLayers.Layer.prototype.initialize.apply(this,[e,n]),this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null),OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setMap:function(e){null==this.options.maxResolution&&(this.aspectRatio<1?this.options.maxResolution=this.extent.getWidth()/this.size.w:this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w),OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(e,t,i){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var r=null==this.tile;if(t||r){this.setTileSize();var n=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});r?(this.tile=new OpenLayers.Tile.Image(this,n,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=n.clone()),this.tile.draw()}},setTileSize:function(){var e=this.extent.getWidth()/this.map.getResolution(),t=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(e,t)},addTileMonitoringHooks:function(e){e.onLoadStart=function(){this.events.triggerEvent("loadstart")},e.events.register("loadstart",this,e.onLoadStart),e.onLoadEnd=function(){this.events.triggerEvent("loadend")},e.events.register("loadend",this,e.onLoadEnd),e.events.register("unload",this,e.onLoadEnd)},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,scope:this})},setUrl:function(e){this.url=e,this.tile.draw()},getURL:function(e){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,t,i,r){OpenLayers.Layer.prototype.initialize.apply(this,[e,r]),this.url=t,this.params||(this.params=OpenLayers.Util.extend({},i))},destroy:function(){this.url=null,this.params=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setUrl:function(e){this.url=e},mergeNewParams:function(e){this.params=OpenLayers.Util.extend(this.params,e);var t=this.redraw();return null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),t},redraw:function(e){return e?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(e,t){for(var i=1,r=0,n=e.length;r<n;r++)i*=e.charCodeAt(r)*this.URL_HASH_FACTOR,i-=Math.floor(i);return t[Math.floor(i*t.length)]},getFullRequestString:function(e,t){var i=t||this.url,r=OpenLayers.Util.extend({},this.params);r=OpenLayers.Util.extend(r,e);var n=OpenLayers.Util.getParameterString(r);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(n,i));var s=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var o in r)o.toUpperCase()in s&&delete r[o];return n=OpenLayers.Util.getParameterString(r),OpenLayers.Util.urlAppend(i,n)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,isChina:!0,images:{},transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],isVectorLayer:!1,initialize:function(e,t,i,r){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this),this.initProperties(),this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(e){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,e),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(e){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;e<t;e++)for(var i=this.grid[e],r=0,n=i.length;r<n;r++){var s=i[r];this.destroyTile(s)}this.grid=[],this.gridResolution=null,this.gridLayout=null}},addOptions:function(e,t){var i=void 0!==e.singleTile&&e.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments),this.map&&i&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.visibility&&this.moveTo(null,!0))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e.gridResolution=null,e.backBuffer=null,e.backBufferTimerId=null,e.loading=!1,e.numLoadingTiles=0,e},moveTo:function(e,t,i){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),e=e||this.map.getExtent(),null!=e){var r=!this.grid.length||t,n=this.getTilesBounds(),s=this.map.getResolution();this.getServerResolution(s);this.singleTile?(r||!i&&!n.containsBounds(e))&&(t&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),t&&"resize"!==this.transitionEffect||this.applyBackBuffer(s),this.initSingleTile(e)):(r=r||!n.intersectsBounds(e,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),r?(!t||"resize"!==this.transitionEffect&&this.gridResolution!==s||this.applyBackBuffer(s),this.isVectorLayer&&!this.isVectorTile?(this.clearImages&&this.clearImages(),this.moveGriddedTiles(!0)):this.initGriddedTiles(e)):this.moveGriddedTiles())}},getTileData:function(e){var t=null,i=e.lon,r=e.lat,n=this.grid.length;if(this.map&&n){var s=this.map.getResolution(),o=this.tileSize.w,a=this.tileSize.h,l=this.grid[0][0].bounds,p=l.left,h=l.top;if(i<p&&this.map.baseLayer.wrapDateLine){var u=this.map.getMaxExtent().getWidth(),y=Math.ceil((p-i)/u);i+=u*y}var c=(i-p)/(s*o),d=(h-r)/(s*a),m=Math.floor(c),f=Math.floor(d);if(f>=0&&f<n){var g=this.grid[f][m];g&&(t={tile:g,i:Math.floor((c-m)*o),j:Math.floor((d-f)*a)})}}return t},destroyTile:function(e){this.removeTileMonitoringHooks(e),e.destroy()},getServerResolution:function(e){var t=Number.POSITIVE_INFINITY;if(e=e||this.map.getResolution(),this.serverResolutions&&OpenLayers.Util.indexOf(this.serverResolutions,e)===-1){var i,r,n,s;for(i=this.serverResolutions.length-1;i>=0&&(n=this.serverResolutions[i],r=Math.abs(n-e),!(r>t));i--)t=r,s=n;e=s}return e},getServerZoom:function(){var e=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,e):this.map.getZoomForResolution(e)+(this.zoomOffset||0)},applyBackBuffer:function(e){null!==this.backBufferTimerId&&this.removeBackBuffer();var t=this.backBuffer;if(!t){if(t=this.createBackBuffer(),!t)return;e===this.gridResolution?this.div.insertBefore(t,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(t,this.map.baseLayer.div),this.backBuffer=t;var i=this.grid[0][0].bounds;this.backBufferLonLat={lon:i.left,lat:i.top},this.backBufferResolution=this.gridResolution}for(var r,n=this.backBufferResolution/e,s=t.childNodes,o=s.length-1;o>=0;--o)r=s[o],r.style.top=(n*r._i*t._th|0)+"px",r.style.left=(n*r._j*t._tw|0)+"px",r.style.width=Math.round(n*r._w)+"px",r.style.height=Math.round(n*r._h)+"px";var a=this.getViewPortPxFromLonLat(this.backBufferLonLat,e),l=this.map.layerContainerOriginPx.x,p=this.map.layerContainerOriginPx.y,h=Math.round(a.x-l)+"px";t.style.left="NaNpx"==h?"":h;var u=Math.round(a.y-p)+"px";t.style.top="NaNpx"==u?"":u},createBackBuffer:function(){var e;if(this.grid.length>0){e=document.createElement("div"),e.id=this.div.id+"_bb",e.className="olBackBuffer",e.style.position="absolute";var t=this.map;e.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:t.Z_INDEX_BASE.BaseLayer-(t.getNumLayers()-t.getLayerIndex(this));for(var i=0,r=this.grid.length;i<r;i++)for(var n=0,s=this.grid[i].length;n<s;n++){var o=this.grid[i][n],a=this.grid[i][n].createBackBuffer();a&&(a._i=i,a._j=n,a._w=this.singleTile?this.getImageSize(o.bounds).w:o.size.w,a._h=o.size.h,a.id=o.id+"_bb",e.appendChild(a))}e._tw=this.tileSize.w,e._th=this.tileSize.h}return e},removeBackBuffer:function(){if(this._transitionElement){for(var e=this.transitionendEvents.length-1;e>=0;--e)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[e],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBuffer=null,this.backBufferResolution=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(e,t){this.singleTile||this.moveGriddedTiles()},setTileSize:function(e){this.singleTile&&(e=this.map.getSize(),e.h=parseInt(e.h*this.ratio,10),e.w=parseInt(e.w*this.ratio,10)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getTilesBounds:function(){var e=null,t=this.grid.length;if(t){var i=this.grid[t-1][0].bounds,r=this.grid[0].length*i.getWidth(),n=this.grid.length*i.getHeight();e=new OpenLayers.Bounds(i.left,i.bottom,i.left+r,i.bottom+n)}return e},initSingleTile:function(e){this.events.triggerEvent("retile");var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio,r=e.getHeight()*this.ratio,n=new OpenLayers.Bounds(t.lon-i/2,t.lat-r/2,t.lon+i/2,t.lat+r/2);this.gridResolution=this.getServerResolution();var s=this.maxExtent;s&&(!this.displayOutsideMaxExtent||this.map.baseLayer.wrapDateLine&&this.maxExtent.equals(this.map.getMaxExtent()))&&(n.left=Math.max(n.left,s.left),n.right=Math.min(n.right,s.right));var o=this.map.getLayerPxFromLonLat({lon:n.left,lat:n.top});this.grid.length||(this.grid[0]=[]);var a=this.grid[0][0];a?a.moveTo(n,o):(a=this.addTile(n,o),this.addTileMonitoringHooks(a),a.draw(),this.grid[0][0]=a),this.removeExcessTiles(1,1)},calculateGridLayout:function(e,t,i){var r=i*this.tileSize.w,n=i*this.tileSize.h,s=e.left-t.lon,o=Math.floor(s/r)-this.buffer,a=this.rowSign,l=a*(t.lat-e.top+n),p=Math[~a?"floor":"ceil"](l/n)-this.buffer*a;return{tilelon:r,tilelat:n,startcol:o,startrow:p}},getImageSize:function(e){var t=OpenLayers.Layer.HTTPRequest.prototype.getImageSize.apply(this,arguments);return this.singleTile&&(t=new OpenLayers.Size(Math.round(e.getWidth()/this.gridResolution),t.h)),t},getTileOrigin:function(){var e=this.tileOrigin;if(!e){var t=this.getMaxExtent(),i={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];e=new OpenLayers.LonLat(t[i[0]],t[i[1]])}return e},getTileBoundsForGridIndex:function(e,t){var i=this.getTileOrigin(),r=this.gridLayout,n=r.tilelon,s=r.tilelat,o=r.startcol,a=r.startrow,l=this.rowSign;return new OpenLayers.Bounds(i.lon+(o+t)*n,i.lat-(a+e*l)*s*l,i.lon+(o+t+1)*n,i.lat-(a+(e-1)*l)*s*l)},initGriddedTiles:function(e){this.events.triggerEvent("retile");var t=this.map.getSize(),i=this.getTileOrigin(),r=this.map.getResolution(),n=this.getServerResolution(),s=r/n,o={w:this.tileSize.w/s,h:this.tileSize.h/s},a=Math.ceil(t.h/o.h)+2*this.buffer+1,l=Math.ceil(t.w/o.w)+2*this.buffer+1,p=this.calculateGridLayout(e,i,n);this.gridLayout=p;var h=p.tilelon,u=p.tilelat,y=this.map.layerContainerOriginPx.x,c=this.map.layerContainerOriginPx.y,d=this.getTileBoundsForGridIndex(0,0),m=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(d.left,d.top));m.x=Math.round(m.x)-y,m.y=Math.round(m.y)-c;var f=[],g=this.map.getCenter(),L=0;do{var v=this.grid[L];v||(v=[],this.grid.push(v));var O=0;do{d=this.getTileBoundsForGridIndex(L,O);var P=m.clone();P.x=P.x+O*Math.round(o.w),P.y=P.y+L*Math.round(o.h);var b=v[O];b?b.moveTo(d,P,!1):(b=this.addTile(d,P),this.addTileMonitoringHooks(b),v.push(b));var w=d.getCenterLonLat();f.push({tile:b,distance:Math.pow(w.lon-g.lon,2)+Math.pow(w.lat-g.lat,2)}),O+=1}while(d.right<=e.right+h*this.buffer||O<l);L+=1}while(d.bottom>=e.bottom-u*this.buffer||L<a);this.removeExcessTiles(L,O);var r=this.getServerResolution();this.gridResolution=r,f.sort(function(e,t){return e.distance-t.distance});for(var M=0,_=f.length;M<_;++M)f[M].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(e,t){var i=new this.tileClass(this,t,e,null,this.tileSize,this.tileOptions);return this.events.triggerEvent("addtile",{tile:i}),i},addTileMonitoringHooks:function(e){var t="olTileReplacing";e.onLoadStart=function(){this.loading===!1&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:e}),this.numLoadingTiles++,!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(e.getTile(),t)},e.onLoadEnd=function(i){this.numLoadingTiles--;var r="unload"===i.type;if(this.events.triggerEvent("tileloaded",{tile:e,aborted:r}),!this.singleTile&&!r&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var n=e.getTile();if("none"===OpenLayers.Element.getStyle(n,"display")){var s=document.getElementById(e.id+"_bb");s&&s.parentNode.removeChild(s)}OpenLayers.Element.removeClass(n,t)}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=r?this.div.lastChild:e.imgDiv;for(var o=this.transitionendEvents,a=o.length-1;a>=0;--a)OpenLayers.Event.observe(this._transitionElement,o[a],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1,this.events.triggerEvent("loadend")}},e.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:e})},e.events.on({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},moveGriddedTiles:function(){for(var e=this.buffer+1;;){var t=this.grid[0][0],i={x:t.position.x+this.map.layerContainerOriginPx.x,y:t.position.y+this.map.layerContainerOriginPx.y},r=this.getServerResolution()/this.map.getResolution(),n={w:Math.round(this.tileSize.w*r),h:Math.round(this.tileSize.h*r)};if(i.x>-n.w*(e-1))this.shiftColumn(!0,n);else if(i.x<-n.w*e)this.shiftColumn(!1,n);else if(i.y>-n.h*(e-1))this.shiftRow(!0,n);else{if(!(i.y<-n.h*e))break;this.shiftRow(!1,n)}}},shiftRow:function(e,t){var i=this.grid,r=e?0:i.length-1,n=e?-1:1,s=this.rowSign,o=this.gridLayout;o.startrow+=n*s;for(var a=i[r],l=i[e?"pop":"shift"](),p=0,h=l.length;p<h;p++){var u=l[p],y=a[p].position.clone();y.y+=t.h*n,u.moveTo(this.getTileBoundsForGridIndex(r,p),y)}i[e?"unshift":"push"](l)},shiftColumn:function(e,t){var i=this.grid,r=e?0:i[0].length-1,n=e?-1:1,s=this.gridLayout;s.startcol+=n;for(var o=0,a=i.length;o<a;o++){var l=i[o],p=l[r].position.clone(),h=l[e?"pop":"shift"]();p.x+=t.w*n,h.moveTo(this.getTileBoundsForGridIndex(o,r),p),l[e?"unshift":"push"](h)}},removeExcessTiles:function(e,t){for(var i,r;this.grid.length>e;){var n=this.grid.pop();for(i=0,r=n.length;i<r;i++){var s=n[i];this.destroyTile(s)}}for(i=0,r=this.grid.length;i<r;i++)for(;this.grid[i].length>t;){var n=this.grid[i],s=n.pop();this.destroyTile(s)}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(e){var t=this.maxExtent,i=this.getResolution(),r=i*this.tileSize.w,n=i*this.tileSize.h,s=this.getLonLatFromViewPortPx(e),o=t.left+r*Math.floor((s.lon-t.left)/r),a=t.bottom+n*Math.floor((s.lat-t.bottom)/n);return new OpenLayers.Bounds(o,a,o+r,a+n)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Layer.TMS_PGIS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"0.3",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,yOffset:!0,initialize:function(e,t,i){var r=[];r.push(e,t,{},i),OpenLayers.Layer.Grid.prototype.initialize.apply(this,r)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.TMS_PGIS(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t=this.map.getZoom(),i=this.getResolution(),r=this.tileOrigin.lon+i*this.tileSize.w/2,n=this.tileOrigin.lat-i*this.tileSize.h/2,s=e.getCenterLonLat(),o=({x:s.lon,y:s.lat},Math.round(Math.abs((s.lon-r)/(i*this.tileSize.w)))),a=Math.round(Math.abs((n-s.lat)/(i*this.tileSize.h)));return 0==o||0==a?null:(this.yOffset&&(a-=1),NPMapLib.IsDebug?OpenLayers.Util.getImageLocation("256.png"):this.url.indexOf("$")!=-1?OpenLayers.String.format(this.url,{x:o,y:a,z:t}):this.url+"/EzMap?Service=getImage&Type=RGB&ZoomOffset="+this.zoomOffset+"&V="+this.serviceVersion+"&Col="+o+"&Row="+a+"&Zoom="+(t-this.zoomOffset))},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS_PGIS"}),OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(e,t,i,r){var n=[];i=OpenLayers.Util.upperCaseObject(i),parseFloat(i.VERSION)>=1.3&&!i.EXCEPTIONS&&(i.EXCEPTIONS="INIMAGE"),n.push(e,t,i,r),OpenLayers.Layer.Grid.prototype.initialize.apply(this,n),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=r&&r.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},reverseAxisOrder:function(){var e=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[e]||OpenLayers.Projection.defaults[e]&&OpenLayers.Projection.defaults[e].yx)},getURL:function(e){e=this.adjustBounds(e);var t=this.getImageSize(),i={},r=this.reverseAxisOrder();i.BBOX=this.encodeBBOX?e.toBBOX(null,r):e.toArray(r),i.WIDTH=t.w,i.HEIGHT=t.h;var n=this.getFullRequestString(i);return NPMapLib.IsDebug?OpenLayers.Util.getImageLocation("256.png"):n},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),i=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,i)},getFullRequestString:function(e,t){var i=this.map.getProjectionObject(),r=this.projection&&this.projection.equals(i)?this.projection.getCode():i.getCode(),n="none"==r?null:r;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=n:this.params.SRS=n,"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"}),OpenLayers.Layer.Heatmap=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,heatmap:null,mapLayer:null,tmpData:{},initialize:function(e,t,i,r,n){var s,o=document.createElement("div");OpenLayers.Layer.prototype.initialize.apply(this,[e,n]),o.style.cssText="position:absolute;width:"+t.size.w+"px;height:"+t.size.h+"px;",this.div.appendChild(o),r.element=o,this.mapLayer=i,this.map=t,this.mapLayer||(this.mapLayer=this.map.baseLayer),
this.heatmap=h337.create(r),s=function(){this.tmpData.max&&this.updateLayer()},t.events.register("zoomend",this,s),t.events.register("moveend",this,s)},updateLayer:function(){var e=this.getPixelOffset(),t=this.heatmap.get("element");t.style.top=(e.y>0?"-"+e.y:Math.abs(e.y))+"px",t.style.left=(e.x>0?"-"+e.x:Math.abs(e.x))+"px",this.setDataSet(this.tmpData)},getPixelOffset:function(){var e=this.mapLayer.map.layerContainerOrigin,t=new OpenLayers.LonLat(e.lon,e.lat),i=this.mapLayer.getViewPortPxFromLonLat(t),r=this.mapLayer.map.center,n=new OpenLayers.LonLat(r.lon,r.lat),s=this.mapLayer.getViewPortPxFromLonLat(n);return{x:i.x-s.x,y:i.y-s.y}},setDataSet:function(e){var t,i,r,n={},s=e.data,o=s.length;for(n.max=e.max,n.data=[];o--;)t=s[o],i=NPMap.T.setPoint(this.map,t.lonlat),r=this.roundPixels(this.getViewPortPxFromLonLat(i)),r&&n.data.push({x:r.x,y:r.y,count:t.count});this.tmpData=e,this.heatmap.store.setDataSet(n)},roundPixels:function(e){return!(e.x<0||e.y<0)&&(e.x=e.x>>0,e.y=e.y>>0,e)},addDataPoint:function(e){e=NPMap.T.setPoint(this.map,e);var t,i=this.roundPixels(this.mapLayer.getViewPortPxFromLonLat(e)),r={lonlat:e};2==arguments.length&&(r.count=arguments[1]),this.tmpData.data.push(r),i&&(t=[i.x,i.y],2==arguments.length&&t.push(arguments[1]),this.heatmap.store.addDataPoint.apply(this.heatmap.store,t))},toggle:function(){this.heatmap.toggleDisplay()},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},setVisibility:function(e){e!=this.visibility&&(this.visibility=e,e!=("none"!=this.div.style.display)&&(this.div.style.display=e?"block":"none"),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},CLASS_NAME:"OpenLayers.Layer.Heatmap"}),OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(e){var t={url:!0,layer:!0,style:!0,matrixSet:!0};for(var i in t)if(!(i in e))throw new Error("Missing property '"+i+"' in layer configuration.");e.params=OpenLayers.Util.upperCaseObject(e.params);var r=[e.name,e.url,e.params,e];if(OpenLayers.Layer.Grid.prototype.initialize.apply(this,r),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()),this.matrixIds){var n=this.matrixIds.length;if(n&&"string"==typeof this.matrixIds[0]){var s=this.matrixIds;this.matrixIds=new Array(n);for(var o=0;o<n;++o)this.matrixIds[o]={identifier:s[o]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){this.matrix=this.getMatrix(),this.matrix&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))},moveTo:function(e,t,i){return!t&&this.matrix||this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMTS(this.options)),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var e;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var t,i=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/28e-5,r=Number.POSITIVE_INFINITY,n=0,s=this.matrixIds.length;n<s;++n)t=Math.abs(1-this.matrixIds[n].scaleDenominator/i),t<r&&(r=t,e=this.matrixIds[n]);else e=this.matrixIds[this.getIdentifier()];else e={identifier:this.getIdentifier()};return e},getTileInfo:function(e){var t=this.getServerResolution(),i=(e.lon-this.tileOrigin.lon)/(t*this.tileSize.w),r=(this.tileOrigin.lat-e.lat)/(t*this.tileSize.h),n=Math.floor(i),s=Math.floor(r);return{col:n,row:s,i:Math.floor((i-n)*this.tileSize.w),j:Math.floor((r-s)*this.tileSize.h)}},getURL:function(e){e=this.adjustBounds(e);var t="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(e)){var i,r=e.getCenterLonLat(),n=this.getTileInfo(r),s=(this.matrix.identifier,this.dimensions);if(t=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,n.row,n.col].join(","),this.url):this.url,"REST"===this.requestEncoding.toUpperCase())if(i=this.params,t.indexOf("{")!==-1){var o=t.replace(/\{/g,"${"),a={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:n.row,TileCol:n.col};if(s){var l,p;for(p=s.length-1;p>=0;--p)l=s[p],a[l]=i[l.toUpperCase()]}t=OpenLayers.String.format(o,a)}else{var h=this.version+"/"+this.layer+"/"+this.style+"/";if(s)for(var p=0;p<s.length;p++)i[s[p]]&&(h=h+i[s[p]]+"/");h=h+this.matrixSet+"/"+this.matrix.identifier+"/"+n.row+"/"+n.col+"."+this.formatSuffix,t.match(/\/$/)||(t+="/"),t+=h}else"KVP"===this.requestEncoding.toUpperCase()&&(i={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:n.row,TILECOL:n.col,FORMAT:this.format},t=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[i]))}return t},mergeNewParams:function(e){if("KVP"===this.requestEncoding.toUpperCase())return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(e)])},CLASS_NAME:"OpenLayers.Layer.WMTS"}),OpenLayers.Layer.TDTLayer=OpenLayers.Class(OpenLayers.Layer.Grid,{mapType:null,mirrorUrls:null,topLevel:null,bottomLevel:null,topLevelIndex:0,bottomLevelIndex:20,topTileFromX:-180,topTileFromY:90,topTileToX:180,topTileToY:-270,isLocalMap:!1,type:"png",initialize:function(e,t,i){i.topLevel=i.topLevel?i.topLevel:this.topLevelIndex,i.bottomLevel=i.bottomLevel?i.bottomLevel:this.bottomLevelIndex,i.maxResolution=this.getResolutionForLevel(i.topLevel),i.minResolution=this.getResolutionForLevel(i.bottomLevel);var r=[e,t,{},i];OpenLayers.Layer.Grid.prototype.initialize.apply(this,r)},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.isBaseLayer||this.setZIndex(parseInt(this.map.baseLayer.getZIndex())+1)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.TDTLayer(this.name,this.url,this.options)),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getXYZ:function(e){var t=this.getServerResolution(),i=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),r=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h)),n=this.getServerZoom();if(this.wrapDateLine){var s=Math.pow(2,n);i=(i%s+s)%s}return{x:i,y:r,z:n}},getURL:function(e){var t=this.getLevelForResolution(this.map.getResolution()),i=360/Math.pow(2,t),r=this.topTileFromX<this.topTileToX?Math.round((e.left-this.topTileFromX)/i):Math.round((this.topTileFromX-e.right)/i),n=this.topTileFromY<this.topTileToY?Math.round((e.bottom-this.topTileFromY)/i):Math.round((this.topTileFromY-e.top)/i),s=this.mapType;"EMap"==s&&(t>=1&&t<=10?s="vec_c":11==t||12==t?s="vec_c":t>=13&&t<=18&&(s="vec_c")),"ESatellite"==s&&(t>=1&&t<=10?s="cva_c":11==t||12==t||13==t?s="cva_c":14==t?s="cva_c":t>=15&&t<=18&&(s="cva_c")),"EDEM"==s&&(s="J07098"),"EAddress"==s&&(s="wfs"),"ciac"===s&&(s="cia_c"),"imgc"===s&&(s="img_c");var o=this.url;if(OpenLayers.Util.isArray(this.url)&&(o=this.selectUrl(r,this.url)),null!=this.mirrorUrls&&(o=this.selectUrl(r,this.mirrorUrls)),o.indexOf("EzMap")>0){var a=OpenLayers.String.format(o,{x:r,y:n,z:t});return a}if(this.isLocalMap){if(o.indexOf(s)<0)return o+"/"+s+"/"+t+"/"+n+"/"+r+this.type;if(""===s)return o+"/"+t+"/"+n+"/"+r;var a=""+t+"/"+n+"/"+r+"."+this.type;return o+a}return this.getFullRequestString({T:s,X:r,Y:n,L:t},o)},selectUrl:function(e,t){return t[e%t.length]},getLevelForResolution:function(e){var t=this.getMaxResolution()/e;if(t<1)return 0;for(var i=0;t/2>=1;)i++,t/=2;return i},getResolutionForLevel:function(e){return 1.40625/Math.pow(2,e)},getMaxResolution:function(){return this.getResolutionForLevel(this.topLevelIndex)},getMinResolution:function(){return this.getResolutionForLevel(this.bottomLevelIndex)},addTile:function(e,t){var i=this.getURL(e);return new OpenLayers.Tile.Image(this,t,e,i,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.TDTLayer"}),OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(e,t,i){(i&&i.sphericalMercator||this.sphericalMercator)&&(i=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},i)),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e||this.name,t||this.url,{},i])},clone:function(e){return null==e&&(e=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t=this.getXYZ(e),i=this.url;if(OpenLayers.Util.isArray(i)){var r=""+t.x+t.y+t.z;i=this.selectUrl(r,i)}return OpenLayers.String.format(i,t)},getXYZ:function(e){var t=this.getServerResolution(),i=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),r=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h)),n=this.getServerZoom();if(this.wrapDateLine){var s=Math.pow(2,n);i=(i%s+s)%s}return{x:i,y:r,z:n}},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(e,t,i){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.tileOptions=OpenLayers.Util.extend({},this.options&&this.options.tileOptions)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(e,t,i){var r=[];r.push(e,t,{},i),OpenLayers.Layer.Grid.prototype.initialize.apply(this,r)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=this.getServerResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),r=Math.round((e.bottom-this.tileOrigin.lat)/(t*this.tileSize.h)),n=this.getServerZoom(),s=this.serviceVersion+"/"+this.layername+"/"+n+"/"+i+"/"+r+"."+this.type,o=this.url;return OpenLayers.Util.isArray(o)&&(o=this.selectUrl(s,o)),o+s},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"}),OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(e,t,i,r){this.layername=i,OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e,t,{},r]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(e){return null==e&&(e=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t=this.getServerResolution(),i=this.maxExtent,r=this.tileSize,n=Math.round((e.left-i.left)/(t*r.w)),s=Math.round((e.bottom-i.bottom)/(t*r.h)),o=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,t):this.map.getZoom(),a=[this.layername,OpenLayers.Number.zeroPad(o,2),OpenLayers.Number.zeroPad(parseInt(n/1e6),3),OpenLayers.Number.zeroPad(parseInt(n/1e3)%1e3,3),OpenLayers.Number.zeroPad(parseInt(n)%1e3,3),OpenLayers.Number.zeroPad(parseInt(s/1e6),3),OpenLayers.Number.zeroPad(parseInt(s/1e3)%1e3,3),OpenLayers.Number.zeroPad(parseInt(s)%1e3,3)+"."+this.extension],l=a.join("/"),p=this.url;return OpenLayers.Util.isArray(p)&&(p=this.selectUrl(l,p)),p="/"==p.charAt(p.length-1)?p:p+"/",p+l},CLASS_NAME:"OpenLayers.Layer.TileCache"}),OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(e,t,i){if(OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent||(this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0]))),this.layerInfo){var r=this.layerInfo,n=new OpenLayers.Bounds(r.fullExtent.xmin,r.fullExtent.ymin,r.fullExtent.xmax,r.fullExtent.ymax);if(this.projection="EPSG:"+r.spatialReference.wkid,this.sphericalMercator=102100===r.spatialReference.wkid,this.units="esriFeet"===r.units?"ft":"m",r.tileInfo){this.tileSize=new OpenLayers.Size(r.tileInfo.width||r.tileInfo.cols,r.tileInfo.height||r.tileInfo.rows),this.tileOrigin=new OpenLayers.LonLat(r.tileInfo.origin.x,r.tileInfo.origin.y);var s=new OpenLayers.Geometry.Point(n.left,n.top),o=new OpenLayers.Geometry.Point(n.right,n.bottom);this.useScales?this.scales=[]:this.resolutions=[],this.lods=[];for(var a in r.tileInfo.lods)if(r.tileInfo.lods.hasOwnProperty(a)){var l=r.tileInfo.lods[a];this.useScales?this.scales.push(l.scale):this.resolutions.push(l.resolution);var p=this.getContainingTileCoords(s,l.resolution);l.startTileCol=p.x,l.startTileRow=p.y;var h=this.getContainingTileCoords(o,l.resolution);l.endTileCol=h.x,l.endTileRow=h.y,this.lods.push(l)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]),this.serverResolutions=this.resolutions,this.overrideDPI&&r.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=r.tileInfo.dpi)}}},getContainingTileCoords:function(e,t){return new OpenLayers.Pixel(Math.max(Math.floor((e.x-this.tileOrigin.lon)/(this.tileSize.w*t)),0),Math.max(Math.floor((this.tileOrigin.lat-e.y)/(this.tileSize.h*t)),0))},calculateMaxExtentWithLOD:function(e){var t=e.endTileCol-e.startTileCol+1,i=e.endTileRow-e.startTileRow+1,r=this.tileOrigin.lon+e.startTileCol*this.tileSize.w*e.resolution,n=r+t*this.tileSize.w*e.resolution,s=this.tileOrigin.lat-e.startTileRow*this.tileSize.h*e.resolution,o=s-i*this.tileSize.h*e.resolution;return new OpenLayers.Bounds(r,o,n,s)},calculateMaxExtentWithExtent:function(e,t){var i=new OpenLayers.Geometry.Point(e.left,e.top),r=new OpenLayers.Geometry.Point(e.right,e.bottom),n=this.getContainingTileCoords(i,t),s=this.getContainingTileCoords(r,t),o={resolution:t,startTileCol:n.x,startTileRow:n.y,endTileCol:s.x,endTileRow:s.y};return this.calculateMaxExtentWithLOD(o)},getUpperLeftTileCoord:function(e){var t=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(t,e)},getLowerRightTileCoord:function(e){var t=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(t,e)},getMaxExtentForResolution:function(e){var t=this.getUpperLeftTileCoord(e),i=this.getLowerRightTileCoord(e),r=i.x-t.x+1,n=i.y-t.y+1,s=this.tileOrigin.lon+t.x*this.tileSize.w*e,o=s+r*this.tileSize.w*e,a=this.tileOrigin.lat-t.y*this.tileSize.h*e,l=a-n*this.tileSize.h*e;return new OpenLayers.Bounds(s,l,o,a)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},initGriddedTiles:function(e){delete this._tileOrigin,OpenLayers.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)},getMaxExtent:function(){var e=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(e)},getTileOrigin:function(){if(!this._tileOrigin){var e=this.getMaxExtent();this._tileOrigin=new OpenLayers.LonLat(e.left,e.bottom)}return this._tileOrigin},getURL:function(e){var t=this.getResolution(),i=this.tileOrigin.lon+t*this.tileSize.w/2,r=this.tileOrigin.lat-t*this.tileSize.h/2,n=e.getCenterLonLat(),s=Math.round(Math.abs((n.lon-i)/(t*this.tileSize.w))),o=Math.round(Math.abs((r-n.lat)/(t*this.tileSize.h))),a=this.map.getZoom();if(this.lods){var l=this.lods[this.map.getZoom()];if(s<l.startTileCol||s>l.endTileCol||o<l.startTileRow||o>l.endTileRow)return null}var p=this.url,h=""+s+o+a;return OpenLayers.Util.isArray(p)&&(p=this.selectUrl(h,p)),this.useArcGISServer?(p+="/tile/${z}/${y}/${x}",p=OpenLayers.String.format(p,{x:s,y:o,z:a}),OpenLayers.Util.urlAppend(p,OpenLayers.Util.getParameterString(this.params))):p+"/L"+a.toString().padLeft("0",2)+"/R"+s.toString(16).padLeft("0",8)+"/C"+o.toString(16).padLeft("0",8)+"."+this.type},getZXY:function(e){var t=this.getResolution(),i=this.tileOrigin.lon+t*this.tileSize.w/2,r=this.tileOrigin.lat-t*this.tileSize.h/2,n=e.getCenterLonLat(),s=Math.round(Math.abs((n.lon-i)/(t*this.tileSize.w))),o=Math.round(Math.abs((r-n.lat)/(t*this.tileSize.h))),a=this.map.getZoom();if(this.lods){var l=this.lods[this.map.getZoom()];if(s<l.startTileCol||s>l.endTileCol||o<l.startTileRow||o>l.endTileRow)return null}else{var p=this.getUpperLeftTileCoord(t),h=this.getLowerRightTileCoord(t);if(s<p.x||s>=h.x||o<p.y||o>=h.y)return null}return{x:s,y:o,z:a}},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"}),OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"zh-cn",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(e){e=OpenLayers.Util.applyDefaults({sphericalMercator:!0},e);var t=e.name||"Bing "+(e.type||this.type),i=[t,null,e];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,i),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"Anonymous"},this.options.tileOptions),this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_"),window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var e=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),t=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(e),i=document.createElement("script");i.type="text/javascript",i.src=t,i.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(i)},initLayer:function(){var e=this.metadata.resourceSets[0].resources[0],t=e.imageUrl.replace("{quadkey}","${quadkey}");t=t.replace("{culture}",this.culture),t=t.replace(this.protocolRegex,this.protocol),this.url=[];for(var i=0;i<e.imageUrlSubdomains.length;++i)this.url.push(t.replace("{subdomain}",e.imageUrlSubdomains[i]));this.addOptions({maxResolution:Math.min(this.serverResolutions[e.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(e.zoomMax+1-e.zoomMin,this.numZoomLevels)},!0),this.isBaseLayer||this.redraw(),this.updateAttribution()},getURL:function(e){if(this.url){for(var t=this.getXYZ(e),i=t.x,r=t.y,n=t.z,s=[],o=n;o>0;--o){var a="0",l=1<<o-1;0!==(i&l)&&a++,0!==(r&l)&&(a++,a++),s.push(a)}var p=s.join(""),h=this.selectUrl(""+n+r+i,this.url);return h="http:"+h,OpenLayers.String.format(h,{quadkey:p})}},updateAttribution:function(){var e=this.metadata;if(e.resourceSets&&this.map&&this.map.center){var t,i,r,n,s,o,a,l=e.resourceSets[0].resources[0],p=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),h=l.imageryProviders||[],u=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),y="";for(i=0,r=h.length;i<r;++i)for(t=h[i],n=0,s=t.coverageAreas.length;n<s;++n)a=t.coverageAreas[n],o=OpenLayers.Bounds.fromArray(a.bbox,!0),p.intersectsBounds(o)&&u<=a.zoomMax&&u>=a.zoomMin&&(y+=t.attribution+" ");var c=e.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:c,copyrights:y}),this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments),this.map.events.register("moveend",this,this.updateAttribution)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Bing(this.options)),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution),OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"}),OpenLayers.Layer.Bing.processMetadata=function(e){this.metadata=e,this.initLayer();var t=document.getElementById(this._callbackId);t.parentNode.removeChild(t),window[this._callbackId]=void 0,delete this._callbackId},OpenLayers.Layer.QQMap=OpenLayers.Class(OpenLayers.Layer.TileCache,{sateTiles:!1,initialize:function(e,t,i){var r=OpenLayers.Util.extend({format:"image/png",isBaseLayer:!0},i);OpenLayers.Layer.TileCache.prototype.initialize.apply(this,[e,t,{},r]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"==this.extension?"jpeg":this.extension,this.transitionEffect="resize",this.buffer=0},getURL:function(e){var t=this.map.getResolution(),i=this.map.getMaxExtent().top,r=this.map.getMaxExtent().left,n=Math.round((e.left-r)/(t*this.tileSize.w)),s=Math.round((i-e.top)/(t*this.tileSize.h)),o=this.map.getZoom();s=Math.pow(2,o)-1-s;var a=Math.abs((n+s)%this.url.length);return OpenLayers.String.format(this.url[a],{x:n,y:s,z:o})},clone:function(e){return null==e&&(e=new OpenLayers.Layer.QQMap(this.name,this.url,this.options)),e=OpenLayers.Layer.TileCache.prototype.clone.apply(this,[e])},CLASS_NAME:"OpenLayers.Layer.QQMap"}),OpenLayers.Layer.Baidu=OpenLayers.Class(OpenLayers.Layer.TileCache,{trafficStatus:!1,arrLineCap:["round","butt","square"],arrLineJoin:["miter","round","bevel"],curViewLabels:[],isLabelTimeout:!1,labelCount:0,iconCache:{},isIphone:!0,trafficInterval:3e5,trafficTimeStamp:0,mutilNpgisQuery:!1,onlineUrl:["http://mapor0.bdimg.com/pvd/?qt=tile&x=${x}&y=${y}&z=${z}&styles=pl&p=1&limit=80&v=088&udt=20170216"],iconURLs:["//mapor0.bdimg.com/sty/vpl_icons/","//mapor0.bdimg.com/sty/vpl_icons/"],jsonCache:{},cacheSize:0,onlyLabel:!1,initialize:function(e,t,i){var n=OpenLayers.Util.extend({format:"image/png",isBaseLayer:!0},i);if(OpenLayers.Layer.TileCache.prototype.initialize.apply(this,[e,t,{},n]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"===this.extension?"jpeg":this.extension,this.transitionEffect="resize",this.buffer=0,OpenLayers.Util.isArray(this.url)||(this.url=[this.url]),i.isVectorTile&&(this.isVectorLayer=!0,this.onlyLabel=!0,this.isVectorTile=!0,this.labelUrl=i.labelUrl),this.isVectorLayer){this.featureStyle=window.FeatureStyle,this.ratio=2,this.iconSetInfoHigh=window.iconSetInfo_high;var s=OpenLayers._getScriptLocation()+"baiduImg/";this.iconURLs=[s],CanvasRenderingContext2D.prototype.drawRoundedRectWithRubberbandRect=function(e,t,i,n){return r=3,e-=2,i+=2,n+=1.5,i<2*r&&(r=i/2),n<2*r&&(r=n/2),this.beginPath(),this.moveTo(e+r,t),this.arcTo(e+i,t,e+i,t+n,r),this.arcTo(e+i,t+n,e,t+n,r),this.arcTo(e,t+n,e,t,r),this.arcTo(e,t,e+i,t,r),this.stroke(),this.fill(),this}}},currentZoom:null,setMap:function(e){if(OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.isBaseLayer||this.setZIndex(parseInt(this.map.baseLayer.getZIndex())+1),this.isVectorTile||this.isVectorLayer){e.viewPortDiv.style.backgroundColor="rgb(245, 243, 240)",e.events.register("moveend",this,function(e){this.currentZoom!=this.map.getZoom()&&(this.clearLabel(),this.currentZoom=this.map.getZoom()),this.moveGriddedTiles(!0)}),e.config={trafficStatus:!1},this._opts={maxZoom:e.maxZoom};this.mapType={getZoomUnits:function(e){var t=18;return Math.pow(2,t-e)}};var t=2,i=document.createElement("canvas");i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width=e.viewPortDiv.offsetWidth+"px",i.style.height=e.viewPortDiv.offsetHeight+"px",i.width=e.viewPortDiv.offsetWidth*t,i.height=e.viewPortDiv.offsetHeight*t,i.style.zIndex=2,i.textBaseline="top",this.labelCanvas=i,this.div.appendChild(i),this.labelCtx=i.getContext("2d"),this.labelCtx.scale(t,t),this.labelCanvas.id="biaozhu"}},gloableUrl:!1,getURL:function(e,t){var i=this.map.zoom-1,r=this.map.getResolution(),n=this.tileSize,s=Math.round((e.left-this.tileOrigin.lon)/(r*n.w)),o=Math.round((e.bottom-this.tileOrigin.lat)/(r*n.h))+0;i+=1;var a,l;this.gloableUrl?(a=s.toString(),l=o.toString()):(a=s.toString().replace("-","M"),l=o.toString().replace("-","M"));var p=Math.abs((s+o)%this.url.length);return OpenLayers.String.format(this.url[p],{x:a,y:l,z:i})},getPixPosition:function(e,t,i,r,n){var s=this.resolutions[i],o=n*(256*s)+this.tileOrigin.lon+s*e,a=r*(256*s)+this.tileOrigin.lat+s*t;return{x:o,y:a}},getXY:function(e,t){var t=t||this.map.getZoom(),i=this.resolutions[t];e=NPMap.T.setPoint(map,{lon:e.x,lat:e.y});var r=(this.tileOrigin.lon+e.lon)/i,n=(this.tileOrigin.lat+e.lat)/i,s=Math.floor(r/256),o=Math.floor(n/256);return{key:[t,s,o].join("_"),location:this.getPixPosition(0,0,t,o,s),points:{drawX:parseFloat((r%256).toFixed(2)),drawY:parseFloat((n%256).toFixed(2))}}},formatUrl:function(e,t,i,r){var n=Math.abs((e+t)%r.length);return OpenLayers.String.format(r[n],{x:e,y:t,z:i})},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Baidu(this.name,this.url,this.options)),e=OpenLayers.Layer.TileCache.prototype.clone.apply(this,[e])},clearLabel:function(){this.labelCanvas.getContext("2d").clearRect(0,0,this.labelCanvas.width,this.labelCanvas.height)},showLabel:function(e){return!0},districts:null,drawIconAndText:function(e){var t=1,i=this.map.getZoom(),r=1;i>19&&(r=Math.pow(2,i-19));var n=this.labelCtx,s=this.districts&&0!=this.districts.length&&i>=this.districts.minZoom&&i<=this.districts.maxZoom;if(s)for(var o=this.map.getSize(),a=o.w,l=o.h,p=this.districts.length-1;p>=0;p--){var h=this.districts[p];if(s=!0,s&&h.regions[i]&&h.regions[i].length>0){var u=this.map.getCenter();n.fillStyle=h.fillStyle,n.strokeStyle=h.strokeStyle;for(var y=h.regions[i].length-1;y>=0;y--){var c=h.regions[i][y];n.beginPath();for(var d=0;d<c.length;d++)for(var m=(c[d].location.x-u.lon)/this.resolutions[i]+a/2,f=(u.lat-c[d].location.y)/this.resolutions[i]+l/2,g=c[d].points,L=0;L<g.length;L++)d==L&&0==L?n.moveTo(m+g[L].drawX,f+g[L].drawY):n.lineTo(m+g[L].drawX,f+g[L].drawY);n.closePath(),n.fill()}}}for(var n=this.labelCtx,v=(this.ratio,0),d=e.length;d>v;v++){var O=e[v];if(this.showLabel(O)&&O.isDel===!1){var o=O.baseDrawX,a=O.baseDrawY;if("fixed"===O.type){var l=O.iconPos,P=O.textPos,b=O.style0,w=O.style1;if(l){var M=b[1],_=l.width,x=l.height;this.drawIcon(n,M,o,a,_,x)}if(P){var C=void 0;C=w&&w[0]===t?w:b;var S=this.beforDrawText(O,4,C[4]),N=this.beforDrawText(O,5,C[5]),E=C[6];E&&"null"!==E&&(n.fillStyle="rgba("+N+")",n.drawRoundedRectWithRubberbandRect(O.minX,O.minY,O.maxX-O.minX,O.maxY-O.minY)),n.font=this.getFont(C),n.fillStyle="rgba("+S+")";var T=O.name.split("$"),A=P[0];if(N&&(n.strokeStyle="rgba("+N+")",n.strokeText(T[0],A.drawX,A.drawY+11)),n.fillText(T[0],A.drawX,A.drawY+11),2===P.length){var I=P[1];N&&n.strokeText(T[1],I.drawX,I.drawY+11),n.fillText(T[1],I.drawX,I.drawY+11)}}}else if("line"===O.type){var G=O.wordsInfo,F=O.tileX,R=O.tileY,D=O.style,S=this.beforDrawText(O,4,D[4]),N=this.beforDrawText(O,5,D[5]);n.font=this.getFont(D),n.fillStyle="rgba("+S+")";for(var k=0,B=G.length;B>k;k++){var z=G[k],U=F+(z.destX+z.width/2)*r-z.width/2,j=R+(z.destY+z.height/2)*r-z.height/2,V=z.angle,H=z.wd;if(V>10&&350>V){n.save();var y=U+z.width/2,W=j+z.height/2;n.translate(y,W),n.rotate(-V/180*Math.PI),n.fillText(H,-z.width/2,-z.height/2),n.restore()}else N&&(n.strokeStyle="rgba("+N+")",n.strokeText(H,U,j)),n.fillText(H,U,j)}}else if("biaopai"===O.type){var Z=O.name,D=O.style,M=D[1],Y=O.pos,_=Y.width,x=Y.height,X={name:Z,style:D,callback:this.drawBiaoPaiText,r:O,that:this};this.drawIcon(n,M,o,a,_,x,X)}}}},drawBiaoPaiText:function(e,t,i,r){var n=e.labelCtx,s=r.name,o=r.style,a=this.that.beforDrawText(this.r,5,o[5]);n.font=e.getBiaoPaiFont(),n.fillStyle="rgba("+a+")",n.fillText(s,t,i+10.5)},drawIcon:function(e,t,i,r,n,s,o){var a=this,l=i-n/2,p=r-s/2;if(a.iconCache[t])e.drawImage(a.iconCache[t],l,p,n,s),o&&o.callback(a,l,p,o);else{var h=a.getIconUrl(t),u=new Image,y=a.map,c=y.getCenter(),d=y.getZoom();u.onload=function(){a.iconCache[t]=this;var i=y.getCenter(),r=y.getZoom();i.equals(c)&&d===r&&(e.drawImage(this,l,p,n,s),o&&o.callback(a,l,p,o)),u.onload=null,delete u.onload},u.src=h}},createLabelCanvas:function(){var e=this.map,t=e.tileMgr,i=this.ratio,r=e.getSize(),n=r.width,o=r.height,a=s.create("canvas"),l=a.style;l.cssText="position: absolute;left:0;top:0;width:"+n+"px;height:"+o+"px;z-index:2;",a.width=n*i,a.height=o*i,this.labelCanvas=a,this.labelCtx=a.getContext("2d"),this.labelCtx.scale(i,i),this.labelCtx.textBaseline="top",t._vectorLayerContainer.appendChild(a),e._labelCanvas=a},objInCanvas:{},extentCanvas:[],createBgCanvas:function(e){var t=document.createElement("canvas");return t.style.background="#F5F3F0",t.style.position="absolute",t.style.width="256px",t.style.height="256px",t.width=512,t.height=512,this.onlyLabel?this.extentCanvas.push(t):this.div.appendChild(t),t},setTrafficOff:function(){this.map.config.trafficStatus=!1,this.reDrawVectorMap()},setTrafficOn:function(){this.map.config.trafficStatus=!0,this.reDrawVectorMap()},reDrawVectorMap:function(){for(var e=0;e<this.div.childNodes.length;e++)"biaozhu"!=this.div.childNodes[e].id&&(this.div.childNodes[e]._drawFinished=!1);this.moveGriddedTiles(!0)},getTilesInfo:function(){var e=[],t=this.objInCanvas;if(t)for(var i in t)delete t[i];else this.objInCanvas={};var r=this.map.getZoom();r>19&&(r=19);for(var n=this.resolutions[r],s=this.map.getExtent(),o=this.tileSize,a=this.map.getCenter(),l=[],p=[],h=this.onlyLabel?this.extentCanvas:this.div.childNodes,u=0;u<h.length;u++)"biaozhu"!=h[u].id&&l.push(h[u]);for(var y=Math.floor((s.left-this.tileOrigin.lon)/(256*n)),c=Math.ceil((s.top-this.tileOrigin.lat)/(256*n)),d=Math.ceil((s.right+this.tileOrigin.lon)/(256*n)),m=Math.floor((s.bottom-this.tileOrigin.lat)/(256*n)),u=y;u<d+1;u++)for(var f=m;f<c+1;f++){var g=u*(n*o.w)-0,L=(u+1)*(n*o.w)-0,v=(f+1)*(n*o.w),O=f*(n*o.w),P=new OpenLayers.Bounds(g,O,L,v),b=this.map.getPixelFromLonLat(new OpenLayers.LonLat(g,v)),w=(this.getURL(P,!0),Math.round((P.left-this.tileOrigin.lon)/(n*o.w))),M=Math.round((P.bottom-this.tileOrigin.lat)/(n*o.h)),_=P.getCenterLonLat();
p.push({key:r+"_"+w+"_"+M,i:u,j:f,zoom:r,postion:{x:b.x,y:b.y},distance:Math.pow(_.lon-a.lon,2)+Math.pow(_.lat-a.lat,2)})}p.sort(function(e,t){return t.distance-e.distance});for(var x=[],u=l.length-1;u>=0;u--){l[u]._isInCurrentView=!1;for(var f=p.length-1;f>=0;f--)if(l[u].id==p[f].key){l[u]._isInCurrentView=!0,this.objInCanvas[l[u].id]=l[u];break}}for(var u=l.length-1;u>=0;u--){var C=l[u];C._isInCurrentView||(C._vtd=null,C.image=null,delete C.image,delete C._vtd,C._drawFinished=!1,x.push(C))}for(var u=p.length-1;u>=0;u--){var S=this.objInCanvas[p[u].key],N=p[u];S?(S._drawFinished?S._vtd&&S._vtd._arrLabelInfo&&this.curViewLabels.push(S._vtd._arrLabelInfo):(S._vtd=null,delete S._vtd,e.push(S)),S.image||(S.image=N)):(x.length>0?(S=x.shift(),!this.onlyLabel&&S.getContext("2d").clearRect(0,0,256,256)):S=this.createBgCanvas(),S.image=N,S.id=N.key,e.push(S)),S.style.top=N.postion.y-parseFloat(this.map.layerContainerDiv.style.top.replace("px",""))+"px",S.style.left=N.postion.x-parseFloat(this.map.layerContainerDiv.style.left.replace("px",""))+"px",S.style.visibility=this.onlyLabel?"hidden":""}for(var u=x.length-1;u>=0;u--)x[u].style.visibility="hidden";return e},request:function(e,t){var i=document.createElement("script");i.src=e,i.type="text/javascript",i.charset="utf-8",i.addEventListener("load",function(e){var t=e.target;t.parentNode.removeChild(t)},!1),document.getElementsByTagName("head")[0].appendChild(i),i=null},loadNpgisTile:function(e,t){var i=(this.labelUrl||this.url)+"?t=",r=new XMLHttpRequest,n=(this.map.getZoom(),{}),s=[],o=[],a={layer:this};return t.map(function(e){if(a.layer.jsonCache[e.image.key]){var t=a.layer.jsonCache[e.image.key];s.push({key:t.key,poi:t.poi,road:t.road})}else o.push(e.image.key.replace(/_/g,","));n[e.image.key]=e}),0==o.length?(s.map(function(e){a.layer.drawTile(a,e,n)}),void this.updateLabel()):(i+=o.join(";"),r.onreadystatechange=function(){4===r.readyState&&(JSON.parse(r.responseText).concat(s).map(function(e){a.layer.drawTile(a,e,n)}),a.layer.updateLabel())},r.onerror=function(){},r.open("GET",i,!0),void r.send())},drawTile:function(e,t,i){if(e.layer.cacheSize<102400&&(e.layer.jsonCache[t.key]={key:t.key,poi:t.poi,road:t.road},e.layer.cacheSize++),i[t.key]){var n=i[t.key],s=e.layer.map.getZoom(),o=Number(t.key.split("_")[0]);if(e.canvas=n,e.image=n.image,s==o){var a=t,l=e.layer,p=l.map.config.trafficStatus,h=[];e.layer.onlyLabel?(n._drawFinished=!0,a.poi&&(a.poi.onlyText&&(h=h.concat(a.poi.onlyText)),a.poi.iconText&&(h=h.concat(a.poi.iconText)),a.poi.onlyIcon&&(h=h.concat(a.poi.onlyIcon))),a.road&&(a.road.biaopaiRoad&&(h=h.concat(a.road.biaopaiRoad)),a.road.roadText&&(h=h.concat(a.road.roadText))),h.x=e.image.i,h.y=e.image.j,h.z=e.image.zoom):(content=n.getContext("2d"),p&&(a=r[0],a.trafficData=r[1]),l.drawBackGround(a,e.canvas,e.image.i,e.image.j,e.image.zoom,l.map.getCenter()),h=l.calcIconAndTextInfo(a,e.image.i,e.image.j,e.image.zoom)),a._arrLabelInfo=h,e.canvas._vtd=a,h._bounds=e.image.bounds,l.curViewLabels.push(h)}}},loadData:function(e,t){if(e._drawFinished=!1,!e.image)return void this.labelCount--;var i="_P"+parseInt(Math.abs(e.image.i)+""+Math.abs(e.image.j)).toString(36);this._tilesQ[e.id]=i;var r={image:e.image,layer:this,canvas:e};window[i]=function(i){var n=r.layer.map.getZoom();if(n==t){var s=i||{},o=r.layer,a=o.map.config.trafficStatus,l=[];r.layer.onlyLabel?(e._drawFinished=!0,s.poi&&(s.poi.onlyText&&(l=l.concat(s.poi.onlyText)),s.poi.iconText&&(l=l.concat(s.poi.iconText)),s.poi.onlyIcon&&(l=l.concat(s.poi.onlyIcon))),s.road&&(s.road.biaopaiRoad&&(l=l.concat(s.road.biaopaiRoad)),s.road.roadText&&(l=l.concat(s.road.roadText))),l.x=r.image.i,l.y=r.image.j,l.z=r.image.zoom):(content=r.canvas.getContext("2d"),a&&(s=i[0],s.trafficData=i[1]),o.drawBackGround(s,r.canvas,r.image.i,r.image.j,r.image.zoom,o.map.getCenter()),l=o.calcIconAndTextInfo(s,r.image.i,r.image.j,r.image.zoom)),s._arrLabelInfo=l,r.canvas._vtd=s,l._bounds=r.image.bounds,o.curViewLabels.push(l),o.isLabelTimeout===!1&&o.labelCount--,(0===o.labelCount||o.isLabelTimeout===!0)&&o.updateLabel()}};var n=this.map.config.trafficStatus?"&trafficstamp="+this.trafficTimeStamp+"&":"&";this.request(this.formatUrl(e.image.i,e.image.j,e.image.zoom,this.labelUrl||this.url)+n+"fn=window."+i,i)},beforDrawText:function(e,t,i){return i},_tilesQ:{},moveGriddedTiles:function(e){if(!this.isVectorLayer)return void OpenLayers.Layer.Grid.prototype.moveGriddedTiles.call(this);if(this.isVectorTile&&OpenLayers.Layer.Grid.prototype.moveGriddedTiles.call(this),e){this.labelCount=0,this.isLabelTimeout=!1,this.curViewLabels=[];var t=this.map.getZoom(),i=this.getTilesInfo();if(0==i.length)return void this.updateLabel();var r=this,n=(new Date).getTime();n-r.trafficTimeStamp>=r.trafficInterval&&(r.trafficTimeStamp=n),this.labelCount=i.length;for(var s in this._tilesQ)delete window[this._tilesQ[s]];if(this._tilesQ={},this.mutilNpgisQuery){var o=[];return i.map(function(e){o.push([e.image.zoom,e.image.i,e.image.j].join(","))}),void this.loadNpgisTile(o.join(";"),i)}for(var a=0,l=i.length;a<l;++a)this.loadData(i[a],t);window.clearTimeout(this.timeout);var p=this;this.timeout=setTimeout(function(){p.isLabelTimeout=!1,p.updateLabel()},1e3)}},drawBackGround:function(e,t,i,r,n,s){var o=this,a=t.getContext("2d");o.ratio>1&&!t._scale&&(a.scale(o.ratio,o.ratio),t._scale=!0);var l=o.featureStyle||(o.featureStyle=window.FeatureStyle,window.FeatureStyle),p=o.tileSize.w;l||(l=window.FeatureStyle),a.fillStyle="#F5F3F0",a.drawRoundedRectWithRubberbandRect(0,0,p,p);for(var h=5,u=6,y=e[2]||[],c=[],d=[],m=0,f=y.length;f>m;m++){var g=y[m],L=l[g[5]];L[0]===h?(g=o.parseFeature(g,p),g.style0=L,g[4]&&"090301"===g[4]?c.push(g):o.drawPolygon(a,g)):L[0]===u&&(g=o.parseFeature(g,p),g.style0=L,d.push(g))}setTimeout(function(){var s=(o.map.getCenter(),o.map.getZoom());s===n&&o.drawRoads(a,e,t,c,d,i,r,n)},1)},drawRoads:function(e,t,i,r,n,s,o,a){for(var l=4,p=this,h=p.featureStyle,u=p.tileSize.w,y=t[1]||[],c=[],d=[],m=[],f={crossoverBridge:[],underGroundRoad:[]},g=0,L=y.length;L>g;g++){var v=y[g],O=v[5],P=O.split(","),b=null,w=null,M=P.length;1==M?b=h[P[0]]:2==M?(b=h[P[0]],w=h[P[1]]):3==M&&(b=h[P[0]],w=h[P[1]]),b&&b[0]===l&&(v=p.parseFeature(v,u),v.style0=b,v.style1=w,a>=17&&("1.0,6.0"===b[3]||"1.0,10.0"===b[3])&&(b[3]=null),v[4]&&v[4].indexOf("050202")>-1?d.push(v):a>=17&&v[4]&&v[4].indexOf("040C05")>-1?f.crossoverBridge.push(v):a>=17&&v[4]&&v[4].indexOf("040C04")>-1?f.underGroundRoad.push(v):c.push(v)),a>=18&&v[10]&&v[10].length>0&&m.push(v[10])}for(var _=f.underGroundRoad,g=0,L=_.length;L>g;g++){var x=_[g];this.drawPolyline(e,x[0],x.style0)}for(var g=0,L=_.length;L>g;g++){var x=_[g];this.drawPolyline(e,x[0],x.style1)}p.renderRoad(e,c,0,function(){for(var s=f.crossoverBridge,o=0,l=s.length;l>o;o++){var y=s[o];p.drawPolyline(e,y[0],y.style0)}for(var o=0,l=s.length;l>o;o++){var y=s[o];p.drawPolyline(e,y[0],y.style1)}if(a>=17)for(var c=t[3]||[],o=0,l=c.length;l>o;o++){var g=p.parseFeature(c[o],u),L=g[5],v=L.split(","),O=h[v[0]];S=h[v[1]],p.drawPolyline(e,g[0],O),p.drawPolyline(e,g[0],S)}if(a>=18){e.strokeStyle="rgba(0,0,0,0.3)",e.fillStyle="rgba(0,0,0,0.3)",e.lineWidth=1.5,e.lineCap="butt",e.lineJoin="miter";for(var o=0,l=m.length;l>o;o++)for(var P=m[o],b=0,w=P.length;w>b;b++){var M=P[b],_=M[0],x=_[0][0],C=_[1][0];x[1]=u-x[1],C[1]=u-C[1],p.drawArrow(e,x,C,e.lineWidth)}for(var o=0,l=n.length;l>o;o++){var g=n[o];p.draw3DBuilding(e,g)}}if(a>=12){for(var o=0,l=d.length;l>o;o++){var g=d[o],O=g.style0,S=g.style1;p.isDashedLine(O,S)?p.drawDashedPolyline(e,g[0],O,S):(p.drawPolyline(e,g[0],g.style0),p.drawPolyline(e,g[0],g.style1))}for(var o=0,l=r.length;l>o;o++)p.drawPolygon(e,r[o])}var N=p.map.config.trafficStatus;N&&t.trafficData&&p.drawTraffic(e,t.trafficData),i._drawFinished=!0})},parseFeature:function(e,t){for(var i=e[0],r=0,n=0,s=0,o=i.length;o>s;s++)r+=i[s][0],n+=i[s][1],i[s][0]=r,i[s][1]=t-n;return e},parseTrafficFeature:function(e){for(var t=e[1],i=0,r=0,n=0,s=t.length;s>n;n+=2)i+=t[n]/10,r+=t[n+1]/10,t[n]=i,t[n+1]=r;return e},drawPolygon:function(e,t){var i=t.style0,r=i[1],n=t[0];e.fillStyle="rgba("+r+")",e.strokeStyle=e.fillStyle,e.beginPath(),e.moveTo(n[0][0],n[0][1]);for(var s=1,o=n.length;o>s;s++)e.lineTo(n[s][0],n[s][1]);e.closePath(),e.fill();var a=i[3];a&&(e.lineWidth=a,e.stroke())},drawPolyline:function(e,t,i){e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(var r=1,n=t.length;n>r;r++)e.lineTo(t[r][0],t[r][1]);e.strokeStyle="rgba("+i[1]+")",e.lineCap=this.arrLineCap[i[4]],e.lineJoin=this.arrLineJoin[i[5]],e.lineWidth=i[2],e.stroke()},renderRoad:function(e,t,i,r){var n=t.length,s=i;if(n>s){for(var o=t[i],a=o[4],l=this.getRoadLevel(a),p=s+1;n>p;p++){var h=t[p],u=h[4],y=this.getRoadLevel(u);if(l!==y)break}for(var c=p,d=s;c>d;d++){var m=t[d],f=m.style0,g=m.style1;this.isDashedLine(f,g)?m.isDashed=!0:this.drawPolyline(e,m[0],f)}for(var d=s;c>d;d++){var m=t[d],f=m.style0,g=m.style1;m.isDashed?this.drawDashedPolyline(e,m[0],f,g):g&&this.drawPolyline(e,m[0],g)}var L=this;setTimeout(function(){L.renderRoad(e,t,c,r)},1)}else r&&r()},getRoadLevel:function(e){return e&&e.indexOf("0C08")>-1?8:e&&(e.indexOf("jct")>-1||e.indexOf("0C01")>-1)?1:0},isDashedLine:function(e,t){return!!(e[3]&&e[3].length>0||t&&t[3]&&t[3].length>0)},drawDashedPolyline:function(e,t,i,r){var n,s,o,a,l,p,h,u,y;r&&r[3]&&r[3].length>0?(n=i[2],s=r[2],o="rgba("+i[1]+")",a="rgba("+r[1]+")",arrDash=r[3].split(","),l=arrDash[0],p=this.arrLineCap[i[4]],h=this.arrLineCap[r[4]],u=this.arrLineJoin[i[5]],y=this.arrLineJoin[r[5]]):(n=i[2],s=n,o="rgba(0,0,0,0)",a="rgba("+i[1]+")",arrDash=i[3].split(","),l=arrDash[0],p=this.arrLineCap[i[4]],h=p,u=this.arrLineJoin[i[5]],y=u),e.beginPath(),e.lineWidth=n,e.strokeStyle=o,e.lineCap=p,e.lineJoin=u,e.moveTo(t[0][0],t[0][1]);for(var c=1,d=t.length;d>c;c++)e.lineTo(t[c][0],t[c][1]);if(e.stroke(),e.beginPath(),e.lineWidth=s,e.strokeStyle=a,e.lineCap=h,e.lineJoin=y,this.isSupportDashedLine){e.save(),e.setLineDash(arrDash),e.lineDashOffset=0,e.moveTo(t[0][0],t[0][1]);for(var c=1,d=t.length;d>c;c++)e.lineTo(t[c][0],t[c][1]);e.stroke(),e.restore()}else{for(var m=!0,c=0,d=t.length;d-1>c;c++){var f=t[c][0],g=t[c][1],L=t[c+1][0],v=t[c+1][1],O=L-f,P=v-g,b=0!==O?P/O:P>0?1e15:-1e15,w=Math.sqrt(O*O+P*P),M=l;for(e.moveTo(f,g);w>=.1;){M>w&&(M=w);var _=Math.sqrt(M*M/(1+b*b));0>O&&(_=-_),f+=_,g+=b*_,e[m?"lineTo":"moveTo"](f,g),w-=M,m=!m}}e.stroke()}},drawArrow:function(e,t,i,r){e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(i[0],i[1]),e.stroke();var n=this.calcArrowPts(t,i,r),s=n[0],o=n[1];e.beginPath(),e.moveTo(s[0],s[1]),e.lineTo(o[0],o[1]),e.lineTo(i[0],i[1]),e.closePath(),e.stroke()},calcArrowPts:function(e,t,i){var r=3.5*Math.pow(i,.8),n=.3,s=t[1]-e[1],o=t[0]-e[0],a=1.8*Math.sqrt(o*o+s*s),l=t[0]+o/a*r,p=t[1]+s/a*r,h=Math.atan2(s,o)+Math.PI,u=[l+r*Math.cos(h-n),p+r*Math.sin(h-n)],y=[l+r*Math.cos(h+n),p+r*Math.sin(h+n)];return[u,y]},draw3DBuilding:function(e,t){var i=t[0],r=t.style0,n="rgba("+r[1]+")",s="rgba("+r[2]+")",o=r[3];e.beginPath(),e.moveTo(i[0][0],i[0][1]);for(var a=1,l=i.length;l>a;a++)e.lineTo(i[a][0],i[a][1]);e.closePath(),e.strokeStyle=s,e.lineWidth=o,e.fillStyle=n,e.stroke(),e.fill()},drawTraffic:function(e,t){for(var i=(this.tileSize.w,0),r=t.length;r>i;i++){var n=this.parseTrafficFeature(t[i]),s=n[1],o=(this.arrTrafficStyles[n[2]],this.arrTrafficStyles[n[3]]);e.beginPath(),e.moveTo(s[0],s[1]);for(var a=2,l=s.length;l>a;a+=2)e.lineTo(s[a],s[a+1]);e.strokeStyle="rgba(255,255,255,1)",e.lineWidth=4,e.lineCap="butt",e.lineJoin="miter",e.stroke(),e.strokeStyle="rgba("+o[1]+")",e.lineWidth=o[2],e.lineCap=this.arrLineCap[o[3]],e.lineJoin=this.arrLineJoin[o[4]],e.stroke()}},calcIconAndTextInfo:function(e,t,i,r){var n=this,s=n.featureStyle,o=this.tileSize.w,a=1,l=0,p=3,h=2,u=[];u.x=t,u.y=i,u.z=r;for(var y=e[0]||[],c=0,d=y.length;d>c;c++){var m=y[c],f=m[5],g=m[2],L=m[4],v=f.split(","),O=s[v[0]],P=null,b=m[6],w=m[1];if(m[0][1]=o-m[0][1],2==v.length&&(P=s[v[1]]),P&&P[0]!==a&&O[0]===a){var M=P;P=O,O=M}var _={type:"fixed",name:g,rank:m[3],catalog:L,baseX:m[0][0],baseY:m[0][1],iconPos:null,textPos:null,guid:w,style0:O,style1:P},x=g.split("$");if(O&&O[0]===l&&P&&P[0]===a){var C=this.calcIconPos(m,O),S=C.width,N=C.height;_.iconPos=C;var E=this.calcTxtSize(x,P);r>=3&&9>=r?0===b?(_.textPos=this.calcTextPosTop(m,E,N),_.textDirTop=!0):1===b?(_.textPos=this.calcTextPosBottom(m,E,N),_.textDirBottom=!0):2===b?(_.textPos=this.calcTextPosLeft(m,E,S),_.textDirLeft=!0):_.textPos=this.calcTextPos(m,E,S):(12===r&&"65e1ee886c885190f60e77ff"===w&&(b=1),b?(_.textPos=this.calcTextPosLeft(m,E,S),_.textDirLeft=!0):_.textPos=this.calcTextPos(m,E,S))}else if(O&&O[0]===l)_.iconPos=this.calcIconPos(m,O);else if(O&&O[0]===a){var E=this.calcTxtSize(x,O);_.textPos=this.calcTextPos(m,E)}else _=null;_&&u.push(_)}for(var T=e[5]||[],c=0,d=T.length;d>c;c++){var A=T[c],f=A[5],v=f.split(",");if(3===v.length){var I=this.featureStyle[v[2]];I&&(I[0]===p?this.addLineTextPos(u,A,I,o):I[0]===h&&this.addLineBiaoPaiPos(u,A,I,o))}}return u},addLineTextPos:function(e,t,i,r){for(var n=t[2].split(""),s=[],o=0,a=n.length;a>o;o++){var l=this.calcTxtSize(n[o],i);s.push(l)}for(var p=t[8],o=0,a=p.length;a>o;o++){var h=[],u=p[o],y=1===u[1],c=u[0];y&&(n.reverse(),s.reverse());for(var d=c[0][0][0],m=r-c[0][0][1],f=0,g=s[f][0],L=d-g[0]/2,v=m-g[1]/2,O=L+g[0],P=v+g[1],b=0,w=c.length;w>b;b++){g=s[f][0];var M=c[b],_=g[0],x=g[1],C=M[0][0]-_/2,S=r-M[0][1]-x/2,N={wd:n[f],angle:M[1],destX:C,destY:S,width:_,height:x};L>C&&(L=C),v>S&&(v=S),C+_>O&&(O=C+_),S+x>P&&(P=S+x),h.push(N),f++}var E={type:"line",rank:t[3],baseX:d,baseY:m,wordsInfo:h,_minX:L,_minY:v,_maxX:O,_maxY:P,style:i};e.push(E)}},addLineBiaoPaiPos:function(e,t,i,r){this.iconSetInfoHigh||(this.iconSetInfoHigh=window.iconSetInfo_high);var n=t[2],s=t[8],o=s[0],a=o[0],l=a[0][0][0],p=r-a[0][0][1],h=i[1],u=this.iconSetInfoHigh[h],y=Math.ceil(u[3]/2);this.labelCtx.font=this.getBiaoPaiFont();var c=this.labelCtx.measureText(n).width,d={type:"biaopai",name:n,rank:t[3],baseX:l,baseY:p,pos:{destX:l-c/2,destY:p-y/2,width:c,height:y},style:i};e.push(d)},getFont:function(e){var t=[],i=1===e[1]?"italic":"",r=e[3];return t.push(i),this.isIphone?(t.push("bold"),t.push(r+"px"),t.push("arial,黑体")):(t.push(r+"px"),t.push("黑体")),t.join(" ")},getBiaoPaiFont:function(){var e=11,t=[];return this.isIphone?(t.push("bold"),t.push(e+"px"),t.push("arial,黑体")):(t.push(e+"px"),t.push("黑体")),t.join(" ")},calcTxtSize:function(e,t){var i=[],r=this.labelCtx;r.font=this.getFont(t);var n=t[3];if(e.length>1){var s=e[0],o=e[1],a=r.measureText(s).width,l=r.measureText(o).width;i.push([a,n],[l,n])}else{var p=e[0],a=r.measureText(p).width;i.push([a,n])}return i},calcIconPos:function(e,t){var i=e[0],r=i[0],n=i[1],s=t[1];isNaN(s[0])||(s="_"+s);var o=this.iconSetInfoHigh[s],a=o[2]/2,l=o[3]/2;return{destX:r-a/2,destY:n-l/2,width:a,height:l}},calcTextPos:function(e,t,i){var r=[],n=e[0],s=n[0],o=n[1];if(t.length<=1){var a=t[0],l=i?i/2:-a[0]/2,p={destX:s+l,destY:o-a[1]/2,width:a[0],height:a[1]};r.push(p)}else{var a=t[0],l=i?i/2:-a[0]/2,p={destX:s+l,destY:o-a[1],width:a[0],height:a[1]},h=t[1],u=i?i/2:-h[0]/2,y={destX:s+u,destY:o,width:h[0],height:h[1]};r.push(p),r.push(y)}return r},calcTextPosLeft:function(e,t,i){var r=[],n=e[0],s=n[0],o=n[1],a=i/2;if(t.length<=1){var l=t[0],p={destX:s-a-l[0],destY:o-l[1]/2,width:l[0],height:l[1]};r.push(p)}else{var l=t[0],p={destX:s-a-l[0],destY:o-l[1],width:l[0],height:l[1]},l=t[1],h={destX:s-a-l[0],destY:o,width:l[0],height:l[1]};r.push(p),r.push(h)}return r},calcTextPosTop:function(e,t,i){var r=e[0],n=r[0],s=r[1],o=t[0];return[{destX:n-o[0]/2,destY:s-i/2-o[1],width:o[0],height:o[1]}]},calcTextPosBottom:function(e,t,i){var r=e[0],n=r[0],s=r[1],o=t[0];return[{destX:n-o[0]/2,destY:s+i/2,width:o[0],height:o[1]}]},updateLabel:function(){(new Date).getTime(),this.map;this.labelCanvas.style.left=0-parseFloat(this.map.layerContainerDiv.style.left.replace("px",""))+"px",this.labelCanvas.style.top=0-parseFloat(this.map.layerContainerDiv.style.top.replace("px",""))+"px",this.labelCanvas.style.width=this.map.viewPortDiv.offsetWidth+"px",this.labelCanvas.style.height=this.map.viewPortDiv.offsetHeight+"px",this.labelCanvas.width=2*this.map.viewPortDiv.offsetWidth,this.labelCanvas.height=2*this.map.viewPortDiv.offsetHeight;var e=this.preComputeLabel(this.curViewLabels);this.labelCtx=this.labelCanvas.getContext("2d"),this.labelCtx.scale(2,2),this.clearLabel(),this.drawIconAndText(e),this.curViewLabels.length>0},getIconVersionInfo:function(){return this.iconVersionInfo?this.iconVersionInfo:(this.iconVersionInfo={ver:"001",udt:"20170118"},this.iconVersionInfo)},getIconUrl:function(e){var t=this.iconURLs,i=e.length%t.length,r=this.getIconVersionInfo(),n=r.ver,s=r.udt;return this.iconURLs[i]+e+".png?v="+n+"&udt="+s},getIconUrl:function(e){var t=this.iconURLs,i=e.length%t.length,r=this.getIconVersionInfo(),n=r.ver,s=r.udt;return this.iconURLs[i]+e+".png?v="+n+"&udt="+s},preComputeLabel:function(e){var t=[],i=this.map,r=i.getCenter(),n=i.getZoom(),n=n>19?19:n,s=i.getSize(),o=s.w,a=s.h,l=r.lon,p=r.lat,h=this.mapType.getZoomUnits(n),u=this.tileSize.w,y=h*u,c=(this.ratio,0);5===n&&(c=1),e.sort(function(e,t){return e.x*e.y<t.x*t.y?-1:1});var d=this.map.getZoom(),m=1;d>19&&(m=Math.pow(2,d-19));for(var f=0,g=e.length;g>f;f++)for(var L=e[f],v=L.x,O=L.y,P=(L.z,v*y),b=(O+1)*y,w=(P-l)*m/h+o/2,M=(p-b)*m/h+a/2,_=0,x=L.length;x>_;_++){var C=L[_],S=void 0,N=void 0,E=void 0,T=void 0;if(C.baseDrawX=w+C.baseX*m,C.baseDrawY=M+C.baseY*m,"fixed"===C.type){var A=C.iconPos,I=C.textPos;if(A&&(A.drawX=m>1?w+(A.destX+A.width/2)*m-A.width/2:w+A.destX,A.drawY=m>1?M+(A.destY+A.height/2)*m-A.height/2:M+A.destY,S=A.drawX,N=A.drawY,E=A.drawX+A.width,T=A.drawY+A.height),I){var G=I[0];if(G.drawX=A?A.drawX-A.destX+G.destX:w+G.destX*m,G.drawY=A?A.drawY-A.destY+G.destY:M+G.destY*m,void 0!=S?(G.drawX<S&&(S=G.drawX),G.drawY<N&&(N=G.drawY),G.drawX+G.width>E&&(E=G.drawX+G.width),G.drawY+G.height>T&&(T=G.drawY+G.height)):(S=G.drawX,N=G.drawY,E=G.drawX+G.width,T=G.drawY+G.height),2==I.length){var F=I[1];F.drawX=A?A.drawX-A.destX+F.destX:w+F.destX*m,F.drawY=A?A.drawY-A.destY+F.destY:M+F.destY*m,F.drawX<S&&(S=F.drawX),F.drawY<N&&(N=F.drawY),F.drawX+F.width>E&&(E=F.drawX+F.width),F.drawY+F.height>T&&(T=F.drawY+F.height)}}}else if("line"===C.type)C.tileX=w,C.tileY=M,S=w+C._minX*m,N=M+C._minY*m,E=w+C._maxX+C._minX*(m-1),T=M+C._maxY+C._minY*(m-1);else if("biaopai"===C.type){var R=C.pos;R.drawX=w+R.destX*m,R.drawY=M+R.destY*m,S=R.drawX,N=R.drawY,E=R.drawX+R.width,T=R.drawY+R.height}void 0!=S&&(C.minX=S,C.minY=N,C.maxX=E,C.maxY=T,t.push(C))}t.sort(function(e,t){return t.rank-e.rank});for(var f=0,g=t.length;g>f;f++){var D=t[f];for(D.isDel=!1,D.arrIntersectIndex=[],_=f+1;g>_;_++){var k=t[_];D.maxX-c<k.minX||D.minX>k.maxX-c||D.maxY-c<k.minY||D.minY>k.maxY-c||D.arrIntersectIndex.push(_)}}for(var f=0,g=t.length;g>f;f++){var B=t[f];if(0==B.isDel)for(var z=B.arrIntersectIndex,_=0,x=z.length;x>_;_++){var U=t[z[_]];U.isDel=!0}}return t},resetImages:function(e,t,i,r){for(var n in this.images){var s=n.split(","),o=parseInt(s[1]),a=parseInt(s[2]);(o<e||o>t||a<i||a>r)&&(this.images[n]=null,delete this.images[n])}},clearImages:function(){for(var e in this.images)this.images[e]=null;this.images={}},CLASS_NAME:"OpenLayers.Layer.Baidu"}),OpenLayers.Layer.SuperMap=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(e,t,i){var r=[];r.push(e,t,{},i),OpenLayers.Layer.Grid.prototype.initialize.apply(this,r)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.SuperMap(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){e=this.adjustBounds(e);var t=this.getServerResolution(),i=Math.round((e.left-this.tileOrigin.lon)/(t*this.tileSize.w)),r=Math.round((this.tileOrigin.lat-e.top)/(t*this.tileSize.h)),n=this.getServerZoom(),s="x="+i+"&y="+r+"&z="+n,o=this.url instanceof Array?this.url[(i+r+n)%this.url.length]:this.url;return o+s},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,86.3+this.map.maxExtent.top))},CLASS_NAME:"OpenLayers.Layer.SuperMap"}),OpenLayers.Layer.gaode=OpenLayers.Class(OpenLayers.Layer.TMS,{itileOriginCorner:"tl",limg:"http://vdata.amap.com/limg?&font=small&scl=1&lv=",type:"png",wrapDateLine:!0,isLocalMap:!1,isVectorLayer:!1,numZoomLevels:23,imgCache:!0,resolutions:[156543.0339,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677],tileOrigin:new OpenLayers.LonLat((-20037508.3427892),20037508.3427892),initialize:function(e,t,i){if(i.numZoomLevels=23,OpenLayers.Layer.TMS.prototype.initialize.apply(this,[e,t,i]),!this.isLocalMap&&this.url)if(OpenLayers.Util.isArray(this.url))for(var r=this.url.length-1;r>=0;r--)this.url[r]=this.url[r].indexOf("?")!=-1?this.url[r]:this.url[r]+"?";else this.url=this.url.indexOf("?")!=-1?this.url:this.url+"?";this.isVectorLayer&&(this.normalsmall=OpenLayers.Util.getImageLocation("icon-normal-small.png"),this.bizsmall=OpenLayers.Util.getImageLocation("icon-biz-small.png"),window.localforage,this.layerInfo&&this.layerInfo.layerType&&(this.npgisService="gaodeVector"==this.layerInfo.layerType,this.isVectorTile=!1))},initDb:function(){var e=this;e.index=1;var t=e.customerStyle?e.roadCache:e.cache;this.db.iterate(function(i,r){return!i||(t[r]||(i.img&&("loading"==i.img.state,e.loadImage(i.img.url,null,null)),t[r]=i),void e.index++)})},clearLabel:function(e){e=e||this.labelCanvas,e.getContext("2d").clearRect(0,0,e.width,e.height);var t="npmap-labels"!=e.className&&this.isBaseLayer?this.beforeDrawRoad({labels:"regions:land"},1):null;t&&(e.getContext("2d").fillStyle=t,e.getContext("2d").fillRect(0,0,e.width,e.height))},setMap:function(e){if(OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.isVectorLayer){e.viewPortDiv.style.backgroundColor="rgb(245, 243, 240)",e.events.register("moveend",this,function(e){this.currentZoom!=this.map.getZoom()&&(this.clearLabel(),this.clearLabel(this.layerCanvas),this.currentZoom=this.map.getZoom()),this.moveGriddedTiles(!0)});var t=2,i=document.createElement("canvas");i.className="npmap-labels",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width=e.viewPortDiv.offsetWidth+"px",i.style.height=e.viewPortDiv.offsetHeight+"px",i.width=e.viewPortDiv.offsetWidth*t,i.height=e.viewPortDiv.offsetHeight*t,i.style.zIndex=3,i.textBaseline="top",this.labelCanvas=i,this.div.appendChild(i),this.labelCtx=i.getContext("2d"),this.labelCtx.scale(t,t),this.labelCanvas.id="biaozhu";var r=document.createElement("canvas");r.className="npmap-layer",r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.width=e.viewPortDiv.offsetWidth+"px",r.style.height=e.viewPortDiv.offsetHeight+"px",r.width=e.viewPortDiv.offsetWidth*t,r.height=e.viewPortDiv.offsetHeight*t,r.style.zIndex=2,r.textBaseline="top",this.layerCanvas=r,this.div.appendChild(r),this.layerCtx=r.getContext("2d"),this.layerCtx.scale(t,t)}},getXYZ:function(e){var t=this.map.getResolution(),i=parseInt((e.getCenterLonLat().lon-this.tileOrigin.lon)/(256*t)),r=parseInt((this.tileOrigin.lat-e.getCenterLonLat().lat)/(256*t)),n=this.map.getZoom();if(Math.abs(this.resolutions[n]-t)>1e-19)for(var s=0;s<this.resolutions.length;s++)if(Math.abs(this.resolutions[s]-t)<=1e-19){n=s;break}return{x:i,y:r,z:n}},getPixPosition:function(e,t,i,r,n){var s=20037508.3427892,o=this.resolutions[i],a=n*(256*o)-s+o*e,l=s-r*(256*o)-o*t;return{x:a,y:l}},getXY:function(e,t){var i=20037508.3427892,t=t||this.map.getZoom(),r=this.resolutions[t];e=NPMap.T.setPoint(map,{lon:e.x,lat:e.y});var n=(i+e.lon)/r,s=(i-e.lat)/r,o=Math.floor(n/256),a=Math.floor(s/256);return{key:[t,o,a].join("_"),location:this.getPixPosition(0,0,t,a,o),points:{drawX:parseFloat((n%256).toFixed(2)),drawY:parseFloat((s%256).toFixed(2))}}},getTilesInfo:function(){var e=this.map.getZoom();e>18&&(e=18);for(var t=this.resolutions[e],i=this.map.getExtent(),r=(this.tileSize,this.map.getCenter(),[]),n=20037508.3427892,s=Math.floor((i.left+n)/(256*t)),o=Math.ceil((n-i.bottom)/(256*t)),a=Math.ceil((n+i.right)/(256*t)),l=Math.floor((n-i.top)/(256*t)),p=s;p<a+1;p++)for(var h=l;h<o+1;h++)r.push({x:p,y:h,z:e});return r},WW:"ASDFGHJKLQWERTYUIO!sdfghjkl",NC:function(e){var t,i,r,n,s;for(i=[],r=NaN,n=0,s=e.length;n<s;n+=1)t=e[n],t=this.WW.indexOf(t),isNaN(r)?r=27*t:(i.push(r+t-333),r=NaN);return i},cache:{},debug:!1,jM:function(e,t){var i=0,r=0,n=1,i=256*t.x,r=256*t.y,n=t.N;return[(i+e[0])*n,(r+e[1])*n]},style:{},running:!1,db:null,saveItem:function(e){if(this.db)for(var t=e.length-1;t>=0;t--)e[t].value&&this.db.setItem(e[t].tileKey,e[t].value)},normalsmall:"http://vdata.amap.com/style_icon/icon-normal-small.png",bizsmall:"http://vdata.amap.com/style_icon/icon-biz-small.png",DB:function(e,i){if(this.r){var r=this.normalsmall;this.loadImage(r,null,null);for(var n=0,s=e.length;n<s;n+=1){var o=e[n];if(o)if(o=JSON.parse(o),o["x-vd-v"])this.hk=o["x-vd-v"];else{var a=o[0].split("-"),l=a[3],p=[];if(!this.cache[a.slice(0,3).join("_")]){var h=this.getPixPosition(0,0,i,parseInt(a[2]),parseInt(a[1]));this.cache[a.slice(0,3).join("_")]={location:{lon:h.x,lat:h.y},poilabel:[],roadlabel:[]}}if("roadlabel"==l){for(var u=1;u<o.length;u++){var y=o[u],c=this.NC(o[u][1]),d=this.jM(c,{N:Math.pow(2,20-parseInt(a[0])),x:parseInt(a[1]),y:parseInt(a[2]),z:parseInt(a[0])}),c={name:y[0],visible:!0,ym:!0,baseX:c[0],baseY:c[1],type:l,pe:11,lb:[],Au:[]};c.vr=15>y[2]%90||75<y[2]%90?90*Math.floor((y[2]+15)/90):y[2];var d=y[3],m=d[2],f=-Math.floor(d[3]/2);if(c.location=d,y[4]){var g=y[5]?y[5].split(":")[1]:null;if(g){var L=g,v=!1,O=!1,L=parseInt(L)-1,P=Math.floor(L/10),b=L%10,w=0,M=0,_=0;v?(w=48,_=M=40):O?(w=M=40,_=36):(w=M=24,_=20);var x=w*Math.max(m+2,_)/_,P=[-x/2,-w/2,x,w,M*b,M*P,M,M];c.lb.push(P),c.Au.push(r),c.Au.push(this.cache[a.slice(0,3).join("_")].img.url),c.lb.push([-Math.floor(m/2),f,m,d[3],d[0],d[1],d[2],d[3]]),p.push(c)}}}this.cache[a.slice(0,3).join("_")].roadlabel=p}else if("poilabel"==l){for(var u=o.length-1;u>=1;u--){var y=o[u],C=this.NC(o[u][1]),d=this.jM(C,{N:Math.pow(2,20-parseInt(a[0])),x:parseInt(a[1]),y:parseInt(a[2]),z:parseInt(a[0])}),S={name:o[u][0].split("^"),location:o[u][2],baseX:C[0],baseY:C[1],type:l,lb:[],Au:[],Kk:y[8]},L=0;y[6]&&("v5"===this.hk?(P=y[6].split(":"),L=P[1],f=Math.floor((parseInt(P[0].split("_")[1])-28)/2)):L=y[6]),L&&y[3]&&(S.Au.push(r),L=parseInt(L)-1,P=Math.floor(L/10),b=L%10,v?(w=48,M=40,_=28):O?(w=M=40,_=28):(w=M=24,_=20),x=w,151!==L&&152!==L&&153!==L||(_-=4,m=y[7][0][2],x=w*Math.max(m+2,_)/_),P=[-x/2,-w/2,x,w,M*b,M*P,M,M],S.lb.push(P));var v=!1;if(y[2]&&y[7]){for(S.pe=y[7][0][3]-4,m=y[2],P=0;P<y[2].length;P+=1)S.Au.push(this.cache[a.slice(0,3).join("_")].img.url),d=y[7][P],v&&!s&&(m[P][0]=Math.round(m[P][0]*t),m[P][1]=Math.round(m[P][1]*t),m[P][2]=Math.round(m[P][2]*t),m[P][3]=Math.round(m[P][3]*t)),x=m[P][0],b=m[P][1]-(v?4:2),w=d[3],M=d[2],x<-M&&L&&y[3]&&(x=-M+S.lb[0][0]),"v5"!==n?"375"!==L&&"3751"!==L||(M=Math.min(m[P][2],v?24:14),x=-Math.floor(M/2),b=-Math.floor(w/2)):x-=2,S.pe=w-4,4===a&&"北京"===c.name&&(b=v?-50:-26),S.lb.push([x,b,M,d[3],d[0],d[1],d[2],d[3]]);p.push(S)}}this.cache[a.slice(0,3).join("_")].poilabel=p}else if(o[1]&&(this.cache[a.slice(0,3).join("_")].img={url:"data:image/png;base64,"+o[1],state:"loading"},"loading"==this.cache[a.slice(0,3).join("_")].img.state)){var N=this;this.loadImage("data:image/png;base64,"+o[1],function(e,t){N.cache[t].img.state="loaded"},a.slice(0,3).join("_"))}}}}},imageCache:{},loadImage:function(e,t,i){var r=e;if(this.imageCache[r]&&"loaded"==this.imageCache[r].state)return void(t&&t(this.imageCache[r],i));var n=new Image;n.state="loading";var s=this;n.onload=function(){s.imageCache[r]=n,n.state="loaded",t&&t(n,i)},"icon-normal-small.png"==e&&(e=this.normalsmall),"icon-biz-small.png"==e&&(e=this.bizsmall),n.src=e},preComputeLabel:function(){},updateLabel:function(){var e=((new Date).getTime(),this.map);this.labelCanvas.style.left=0-parseFloat(e.layerContainerDiv.style.left.replace("px",""))+"px",this.labelCanvas.style.top=0-parseFloat(e.layerContainerDiv.style.top.replace("px",""))+"px",this.labelCanvas.style.width=e.viewPortDiv.offsetWidth+"px",this.labelCanvas.style.height=e.viewPortDiv.offsetHeight+"px",this.labelCanvas.width=2*e.viewPortDiv.offsetWidth,this.labelCanvas.height=2*e.viewPortDiv.offsetHeight;var t=this.preComputeLabel(this.curViewLabels);if(this.labelCtx=this.labelCanvas.getContext("2d"),this.labelCtx.scale(2,2),this.clearLabel(),this.drawIconAndText(t),this.curViewLabels.length>0&&this.db){for(var i=[],r=this.curViewLabels.length-1;r>=0;r--){var n=this.curViewLabels[r],s=[n.z,n.x,n.y].join("_");i.push({tileKey:s,value:(this.customerStyle?this.roadCache:this.cache)[s]})}this.saveItem(i)}},updateLayer:function(){window.clearTimeout(this.layerTimer);var e=((new Date).getTime(),this.map);this.layerCanvas.style.left=0-parseFloat(this.map.layerContainerDiv.style.left.replace("px",""))+"px",this.layerCanvas.style.top=0-parseFloat(this.map.layerContainerDiv.style.top.replace("px",""))+"px",this.layerCanvas.style.width=e.viewPortDiv.offsetWidth+"px",this.layerCanvas.style.height=e.viewPortDiv.offsetHeight+"px",this.layerCanvas.width=2*e.viewPortDiv.offsetWidth,this.layerCanvas.height=2*e.viewPortDiv.offsetHeight,this.layerCtx=this.layerCanvas.getContext("2d"),this.layerCtx.scale(2,2);var t=this.preComputeLabel(this.curViewLabels);if(this.clearLabel(this.layerCanvas),this.drawTiles(t),this.curViewLabels.length>0&&this.db){for(var i=[],r=this.curViewLabels.length-1;r>=0;r--){var n=this.curViewLabels[r],s=[n.z,n.x,n.y,"region,building,road"].join("_");i.push({tileKey:s,value:(this.customerStyle?this.roadCache:this.cache)[s]})}this.saveItem(i)}},drawDashLine:function(e,t,i,r,n,s){for(var o=void 0===s?6:s,a=r-t,l=n-i,p=Math.floor(Math.sqrt(a*a+l*l)/o),h=0;h<p;h++)h%2===0?e.moveTo(t+a/p*h,i+l/p*h):e.lineTo(t+a/p*h,i+l/p*h);e.stroke()},lineTypes:["solid","solid_roundcap","solid_squarecap","dash","railway","dash_crewel"],districts:[],drawTiles:function(){var e=this.map.getZoom(),t=e>18?t=Math.pow(2,e-18):1,i=this.layerCtx,r=this.districts&&0!=this.districts.length&&e>=this.districts.minZoom&&e<=this.districts.maxZoom;if(r)for(var n=this.districts.length-1;n>=0;n--){var s=this.districts[n];if(r=!0){r=!1;for(var o=this.curViewLabels.length-1;o>=0;o--){var a=this.curViewLabels[o];if(s.keys[[a.z,a.x,a.y].join("_")]){r=!0;break}}}if(r&&s.regions[e]&&s.regions[e].length>0)for(var l=this.map.getExtent(),p=s.regions[e].length-1;p>=0;p--){var h=s.regions[e][p];if("边界"==s.name){"string"==typeof s.fillStyle&&(s.fillStyle=["#DAA520","#FFD700"]);for(var u=s.fillStyle.length-1;u>=0;u--){i.strokeStyle=s.fillStyle[u],i.lineWidth=3*(u+1),i.lineJoin="round",i.setLineDash([0,0]),i.save(),i.beginPath();for(var o=0;o<h.length;o++)for(var y=(h[o].location.x-l.left)/this.resolutions[e],c=(l.top-h[o].location.y)/this.resolutions[e],d=h[o].points,m=0;m<d.length;m++)o==m&&0==m?i.moveTo(y+d[m].drawX,c+d[m].drawY):i.lineTo(y+d[m].drawX,c+d[m].drawY);i.stroke(),i.restore()}}else{i.fillStyle=s.fillStyle,i.strokeStyle=s.strokeStyle,i.save(),i.beginPath();for(var o=0;o<h.length;o++)for(var y=(h[o].location.x-l.left)/this.resolutions[e],c=(l.top-h[o].location.y)/this.resolutions[e],d=h[o].points,m=0;m<d.length;m++)o==m&&0==m?i.moveTo(y+d[m].drawX,c+d[m].drawY):i.lineTo(y+d[m].drawX,c+d[m].drawY);i.closePath(),i.fill(),i.restore()}}}if(this.curViewLabels.length>0)for(var l=this.map.getExtent(),o=this.curViewLabels.length-1;o>=0;o--){var a=this.curViewLabels[o],f=[a.z,a.x,a.y,"region,building,road"].join("_"),g=this.roadCache[f];if(g){var y=(g.location.lon-l.left)/this.resolutions[e],c=(l.top-g.location.lat)/this.resolutions[e];
if(g.region&&g.region.length>0)for(var L=g.region.length-1;L>=0;L--){var v=g.region[L];if(this.showRoad(v)){i.fillStyle=this.beforeDrawRoad(v,1)||v.style[0],i.save();for(var O=v.regions.length-1;O>=0;O--){i.beginPath();var d=v.regions[O];i.moveTo(y+d[0]*t,c+d[1]*t);for(var p=2;p<d.length;p+=2)i.lineTo(y+d[p]*t,c+d[p+1]*t);i.closePath(),i.fill()}i.restore()}}if(g.building&&g.building.length>0)for(var L=g.building.length-1;L>=0;L--){var v=g.building[L];if(this.showRoad(v)){i.strokeStyle=this.beforeDrawRoad(v,1)||v.style[2],i.fillStyle=this.beforeDrawRoad(v,0)||v.style[0],i.lineWidth=parseInt(v.style[1]),i.save();for(var O=v.buildings.length-1;O>=0;O--){for(var d=v.buildings[O],p=0;p<d.length;p+=4)i.beginPath(),i.lineTo(y+d[p]*t,c+d[p+1]*t),i.lineTo(y+d[p+2]*t,c+d[p+3]*t),i.lineTo(y+d[p+2]*t,c+d[p+3]*t+.1*v.offset*t),i.lineTo(y+d[p]*t,c+d[p+1]*t+.1*v.offset*t),i.closePath();i.fill(),i.restore(),i.beginPath(),i.moveTo(y+d[0]*t,c+d[1]*t+.1*v.offset*t);for(var p=2;p<d.length;p+=2)i.lineTo(y+d[p]*t,c+d[p+1]*t+.1*v.offset*t);i.closePath()}i.fill(),i.stroke()}}if(g.road&&g.road.length>0)for(var m=0;m<g.road.length;m++){var P=g.road[m],b=P.roads;if(this.showRoad(P)){if(""!=P.style[5]){if(i.beginPath(),i.strokeStyle=this.beforeDrawRoad(P,0)||P.fillStyle,i.lineWidth=parseInt(P.style[3])+parseInt(P.style[0]),x=P.style[5].split("_"),x.length>=2?i.lineCap=x[1].replace("cap",""):i.lineCap="butt",i.lineJoin="round","solid"!=x[0]){var w=parseInt(x[0].split(",")[1].replace(")",""));i.setLineDash([w,w])}else i.setLineDash([0,0]);i.save();for(var M=0;M<b.length;M++){var _=b[M];i.moveTo(y+_[0]*t,c+_[1]*t);for(var p=2;p<_.length-1;p+=2)i.lineTo(y+_[p]*t,c+_[p+1]*t)}i.stroke()}i.restore(),i.beginPath(),i.strokeStyle=this.beforeDrawRoad(P,1)||P.strokeStyle,i.lineWidth=parseInt(P.style[0]);var x=P.style[2].split("_");if(x.length>=2?i.lineCap=x[1].replace("cap",""):i.lineCap="square","solid"!=x[0]){var w=parseInt(x[0].split(",")[1].replace(")",""));i.setLineDash([w,w])}else i.setLineDash([0,0]);i.save();for(var M=0;M<b.length;M++){var _=b[M];i.moveTo(y+_[0]*t,c+_[1]*t);for(var p=2;p<_.length-1;p+=2)i.lineTo(y+_[p]*t,c+_[p+1]*t)}i.stroke()}}i.restore(),this.debug&&(f=[a.z,a.x,a.y].join("_"),i.fillStyle="red",i.fillText(f,y+125*t,c+125*t),i.strokeStyle="green",i.lineWidth=1,i.setLineDash([0,0]),i.save(),i.beginPath(),i.moveTo(y,c),i.lineTo(y+256*t,c),i.lineTo(y+256*t,c+256*t),i.lineTo(y,c+256*t),i.stroke(),i.restore())}}},customerStyle:!0,drawIconAndText:function(){function e(e,i,r,n,s,o){var a=i.imageCache[s];if(!a||"loaded"!=a.state){if(t){var l=s.indexOf("data:image/png;")!=-1;if(l)return!0}return i.loadImage(s,function(){}),!1}var p=e[2],h=e[3],u=e[0],y=a,c=e[1];if(o=(o||0)%360*-Math.PI/180,0!==o){var d=Math.cos(o),m=Math.sin(o),i=n[0],f=n[1];r.transform(d,m,-m,d,(1-d)*i+m*f,(1-d)*f-m*i)}return u=n[0]+u,n=n[1]+c,4===e.length?r.drawImage(y,u,n,p,h):r.drawImage(y,e[4],e[5],e[6],e[7],u,n,p,h),!0}this.drawTimer&&window.clearTimeout(this.drawTimer);var t=this.customerStyle,i=this.map.getZoom(),r=i>18?r=Math.pow(2,i-18):1;if(this.curViewLabels.length>0){for(var n=this.labelCtx,s=this.map.getExtent(),o=!0,a=this.curViewLabels.length-1;a>=0;a--){var l=this.curViewLabels[a],p=[l.z,l.x,l.y].join("_"),h=this.roadCache[p];if(h){var u,y=(h.location.lon-s.left)/this.resolutions[i],c=(s.top-h.location.lat)/this.resolutions[i];if(h&&h.poilabel&&h.poilabel.length>0){for(var d=h.poilabel.length-1;d>=0;d--){var m=h.poilabel[d];if(this.showLabel(m)){for(var f=y+m.baseX*r,g=c+m.baseY*r,L=0;L<m.lb.length;L++)u=e(m.lb[L],this,n,[f,g],m.Au[L],m.vr),u||(o=!1);if(t)for(var v=m.name.length-1;v>=0;v--)if(m.location[v]){var O=f+m.location[v][0],P=g+m.location[v][1];if(m.bgColor){n.font=m.location[v][3]+"px SimHei",n.fillStyle=m.bgColor;var b=n.measureText(m.name[v]);n.fillRect(O,P-3,b.width,18)}n.font=m.location[v][3]+"px SimHei",n.strokeStyle=this.beforeDrawLabel(m,0)||m.strokeStyle,n.strokeText(m.name[v],O,P+10),n.fillStyle=this.beforeDrawLabel(m,1)||m.fillStyle,n.fillText(m.name[v],O,P+10)}}}if(h&&h.roadlabel&&h.roadlabel.length>0)for(var d=h.roadlabel.length-1;d>=0;d--){var m=h.roadlabel[d],f=y+m.baseX*r,g=c+m.baseY*r;if(this.showLabel(m))for(var L=0;L<m.lb.length;L++)u=e(m.lb[L],this,n,[f,g],m.Au[L],m.vr),u||(o=!1);this.showLabel(m)&&"roads:other"!=m.labels&&(m.location.length>0&&(f+=m.location[0],g+=5),n.font=(m.fontSize||12)+"px SimHei",n.strokeStyle=this.beforeDrawLabel(m,0)||m.strokeStyle||"rgba(0,167,210,1)",n.strokeText(m.name[0],f,g),n.fillStyle=this.beforeDrawLabel(m,1)||m.fillStyle||"rgba(3,52,71,1)",n.fillText(m.name[0],f,g))}}}}!o&&(n=this,this.drawTimer=window.setTimeout(function(){n.updateLabel()},15))}},set:function(e,t){},pp:function(e,t,i){},moveGriddedTiles:function(e){function t(e,t){if(o===h.qc){var i=e.split("|");i[0]=t+i[0];var r=i,n="";return i[i.length-1]&&(n=i[i.length-1],r=i.splice(0,i.length-1)),h.DB(r,o,!0),""==n&&h.updateLabel(),n}l.OE=!0,l.startTime||(l.onreadystatechange="")}if(!this.isVectorLayer)return void OpenLayers.Layer.Grid.prototype.moveGriddedTiles.call(this);if(e){this.curViewLabels=this.getTilesInfo();for(var i=[],r=this.customerStyle?this.roadCache:this.cache,n=this.curViewLabels.length-1;n>=0;n--){var s=this.curViewLabels[n];r[[s.z,s.x,s.y].join("_")]||i.push(this.formatXYZ(s))}if(0==i.length)return this.updateLabel(),void this.updateLayer();if(this.npgisService)return void this.getNpgisVectory(i.join(";"));if(this.roadBuildingReginResove(i.join(";")),this.customerStyle)return void this.road(i.join(";"));i=this.limg+this.map.getZoom()+"&t="+i.join(";");var o=this.map.getZoom();this.qc=o,this.r=!0,this.fo=!0;var l=new XMLHttpRequest,p=0,h=this;l.$u="",l.onreadystatechange=function(){if(h.r)if(3===l.readyState){if(!l.OE){var e=l.responseText.substring(p);l.$u=t(e,l.$u),p=l.responseText.length,l.yE=!0}}else 4===l.readyState&&(l.OE||(e=l.responseText.substring(p),h.fo&&(e+="|"),t(e,l.$u),l.$u="",l.yE=!0),l.startTime&&V.Ld.De.push({id:h.l.da.id,key:"ds",Vk:l.responseText.length/2}),l.yE||h.pp(a,o,k))},l.onerror=function(){},l.open("GET",i,!0),l.send()}},Xz:function(e,t,i){var r,n;return r=Math.floor(i/2),n=i-r,r=(1<<r)-1<<n,n=(1<<n)-1,[i,e&r|t&n,t&r|e&n]},formatXYZ:function(e){var t=e.z,i=e.y,r=e.x;if(this.npgisService)return[t,r,i].join(",");if(10>t){var n=Math.pow(2,t);(r>=n||0>r)&&(r=(r+n)%n)}return this.Xz(r,i,t).join(",")},getURL:function(e){var t=this.getXYZ(e),i=t.x,r=t.y,n=t.z,s=this.url;if(OpenLayers.Util.isArray(this.url)){var o=(i+r)%this.url.length;s=this.url[o]}if(s.indexOf("$")>-1)return s.indexOf("trafficTile")>-1?OpenLayers.String.format(s,{x:i,y:r,z:17-n})+"&t="+(new Date).getTime():OpenLayers.String.format(s,{x:i,y:r,z:n})+"&imgCache="+(this.imgCache?"true":"false");if(this.isLocalMap)return this.url+"/"+n+"/"+i+"/"+r+"."+this.type;if(OpenLayers.Util.isArray(this.url)){var a=(i+r)%this.url.length;return(this.url[a].indexOf("?")!=-1?this.url[a]:this.url[a]+"?")+"&L="+n+"&Z="+n+"&Y="+r+"&X="+i+"&imgCache="+(this.imgCache?"true":"false")}return(this.url.indexOf("?")!=-1?this.url:this.url+"?")+"&Z="+n+"&L="+n+"&Y="+r+"&X="+i+"&imgCache="+(this.imgCache?"true":"false")},roadCache:{},k:function(e){for(var t=[],i=0,r=e.length;i<r;i+=2)t.push(parseInt(e.substr(i,2),16)/255);return t.push(t.shift()),t},labelType:{},road:function(e){e="http://vdata.amap.com/tiles?mapType=normal&v=2&style=5&rd=1&flds=poilabel,roadlabel&t="+e;var t=new XMLHttpRequest,i=this;t.$u="",t.onreadystatechange=function(){if(4===t.readyState){for(var e=t.responseText.split("|"),r=e.length-1;r>=1;r--)if(""!=e[r]){var n=JSON.parse(e[r]);if(n){var s=n[0].split("-"),o={z:parseInt(s[0]),x:parseInt(s[1]),y:parseInt(s[2])},a=[o.z,o.x,o.y].join("_"),l=s[3],p=i.getPixPosition(0,0,parseInt(s[0]),parseInt(s[2]),parseInt(s[1]));i.roadCache[a]||(i.roadCache[a]={location:{lon:p.x,lat:p.y}});for(var h=[],u=n.length-1;u>=1;u--)for(var y=n[u],c=y[1].split("&"),d=i.getRgb(c[2]),m=i.getRgb(c[3]),f=c[0],g=0;g<y[0].length;g++){var L=y[0][g],v=i.poiFill(L,s);v.poiType=y["roadlabel"==l?4:6],v.fontSize=c[1],v.labels=y["roadlabel"==l?3:4],i.labelType[v.labels]||(i.labelType[v.labels]=v.name),v.fillStyle=d,v.strokeStyle=m,i.poiLabelIcon(L,v,f,c),"poilabel"==l&&""!=c[4]&&(v.bgColor=i.getRgb(c[4])),h.push(v)}i.roadCache[a][l]=h}}i.updateLabel()}},t.onerror=function(){},t.open("GET",e,!0),t.send()},poiLabelIcon:function(e,t,i,r){var n=!1,s=!1;if("poilabel"==t.type)i&&e[3]&&(t.Au.push("1"==r[r.length-1]?this.bizsmall:this.normalsmall),i=parseInt(i)-1,p=Math.floor(i/10),h=i%10,n?(u=48,y=40,d=28):s?(u=y=40,d=28):(u=y=24,d=20),m=u,p=[-m/2,-u/2,m,u,y*h,y*p,y,y],t.lb.push(p));else if("roadlabel"==t.type&&i){var o=e[3],a=o[2];if(""==o||!a)return;var l=-Math.floor(o[3]/2);i=parseInt(i)-1;var p=Math.floor(i/10),h=i%10,u=0,y=0,c=t,d=0;n?(u=48,d=y=40):s?(u=y=40,d=36):(u=y=24,d=20);var m=u*Math.max(a+2,d)/d,p=[-m/2,-u/2,m,u,y*h,y*p,y,y];c.lb.push(p),c.Au.push(1==l?this.bizsmall:this.normalsmall),c.location=[-Math.floor(a/2),l,0,0]}},poiFill:function(e,t){var i=this.NC(e[1]),r=(this.jM(i,{N:Math.pow(2,20-parseInt(t[0])),x:parseInt(t[1]),y:parseInt(t[2]),z:parseInt(t[0])}),{name:e[0].split("^"),location:e[2],baseX:i[0],baseY:i[1],type:t[3],lb:[],Au:[]});return e[4]&&(r.id=e[4]),r},clone:function(e){return null==e&&(e=new OpenLayers.Layer.gaode(this.name,this.url,this.options)),OpenLayers.Layer.TMS.prototype.clone.apply(this,[e])},roadBuildingReginResove:function(e){e="http://vdata.amap.com/tiles?mapType=normal&v=2&style=5&rd=1&flds=region,building,road&t="+e;var t=new XMLHttpRequest,i=this;t.$u="",t.onreadystatechange=function(){if(4===t.readyState){for(var e=t.responseText.split("|"),r=e.length-1;r>=1;r--)if(""!=e[r]){var n=JSON.parse(e[r]);if(n){var s=n[0].split("-"),o={z:parseInt(s[0]),x:parseInt(s[1]),y:parseInt(s[2])},a=[o.z,o.x,o.y,"region,building,road"].join("_"),l=s[3],p=i.getPixPosition(0,0,parseInt(s[0]),parseInt(s[2]),parseInt(s[1]));i.roadCache[a]||(i.roadCache[a]={location:{lon:p.x,lat:p.y}});for(var h=[],u=1;u<n.length;u++){var y=n[u];switch(l){case"road":i.roadLine(h,y,l,u-1);break;case"region":i.region(h,y,l);break;case"building":i.building(h,y,l)}}i.roadCache[a][l]=h.sort(function(e,t){return e.rank-t.rank})}}i.updateLayer()}},t.onerror=function(){},t.open("GET",e,!0),t.send()},getRgb:function(e){if(""==e)return null;var t=this.k(e);return"rgba("+[255*t[0],255*t[1],255*t[2],t[3]].join(",")+")"},building:function(e,t,i){var r=t[1].split("&"),n=[this.getRgb(r[0]),r[1],this.getRgb(r[2]),this.getRgb(r[3]),this.getRgb(r[4]),r[5],r[6]],s={origin:t[1],labels:t[2],type:i,style:n,buildings:[],rank:t[3],offset:t[3]*Math.pow(2,2)};this.labelType[s.labels]||(this.labelType[s.labels]=s.type);for(var o=0;o<t[0].length;o++){var a=t[0][o];s.buildings.push(this.NC(a))}e.push(s)},region:function(e,t,i){var r=t[1].split("&"),n=[this.getRgb(r[0])],s={regions:[],labels:t[3],type:i,style:n,rank:"regions:traffic"==t[3]?63:t[2]};this.labelType[s.labels]||(this.labelType[s.labels]=s.type);for(var o=0;o<t[0].length;o++){var a=t[0][o];s.regions.push(this.NC(a))}e.push(s)},roadLine:function(e,t,i,r){var n=t[1].split("&"),s=this.getRgb(n[4]),o=this.getRgb(n[1]),a=parseInt(n[0]),l={labels:t[3],type:i,fillStyle:s,strokeStyle:o,width:a,style:n,rank:t[2],roads:[],FK:r};this.labelType[l.labels]||(this.labelType[l.labels]=l.type);for(var p=0;p<t[0].length;p++){var h=t[0][p];l.roads.push(this.NC(h))}e.push(l)},getgaodeRequest:function(e,t,i){return"http://vdata.amap.com/tiles?mapType=normal&v=2&style=5&rd=1&flds=poilabel,roadlabel&t="+this.formatXYZ({z:i,x:e,y:t})},npgisService:!1,getNpgisVectory:function(e){var t=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&t&&i.responseText&&t(i.responseText)},i.onerror=function(){},i.open("GET",e,!0),i.send()},i=this;this.url&&t(this.url[0].lastIndexOf("?")==-1?this.url[0]+"?t="+e:this.url[0]+"&t="+e,function(e){for(var t=JSON.parse(e),r=t.length-1;r>=0;r--)null!=t[r]&&(i.roadCache[t[r].key]={building:t[r].building?JSON.parse(t[r].building):[],location:JSON.parse(t[r].location),region:t[r].region?JSON.parse(t[r].region):[],road:t[r].road?JSON.parse(t[r].road):[]});i.updateLayer()}),t(this.labelUrl[0]+"?t="+e,function(e){for(var t=JSON.parse(e),r=t.length-1;r>=0;r--)null!=t[r]&&(i.roadCache[t[r].key]={location:JSON.parse(t[r].location),poilabel:t[r].poilabel?JSON.parse(t[r].poilabel):[],roadlabel:t[r].roadlabel?JSON.parse(t[r].roadlabel):[]});i.updateLabel()})},destroy:function(){if(this.labelCanvas&&(this.div.removeChild(this.labelCanvas),this.labelCanvas=null,this.labelCtx=null),this.layerCanvas&&(this.div.removeChild(this.layerCanvas),this.layerCanvas=null,this.layerCtx=null),OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments),this.roadCache){for(var e in this.roadCache)delete this.roadCache[e];this.roadCache=null}this.districts&&(this.districts=null),this.labelUrl=null,this.curViewLabels&&(this.curViewLabels.length=0)},showLabel:function(e){return!0},beforeDrawLabel:function(e){!this.style[e.labels]&&(this.style[e.labels]={}),this.style[e.labels][e.poiType]=e},showRoad:function(e){return!0},beforeDrawRoad:function(e){},CLASS_NAME:"OpenLayers.Layer.gaode"}),OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(e,t,i,r,n,s,o){var a=[e,t,i,r,s,o];OpenLayers.Popup.prototype.initialize.apply(this,a),this.anchor=null!=n?n:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null,this.relativePosition=null,OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition(),this.prevPositon={left:this.div.style.left,top:this.div.style.top},OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(e){OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(e))},setSize:function(e){if(OpenLayers.Popup.prototype.setSize.apply(this,arguments),this.lonlat&&this.map){var t=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(t)}},calculateRelativePosition:function(e){var t=this.map.getLonLatFromLayerPx(e),i=this.map.getExtent(),r=i.determineQuadrant(t);return OpenLayers.Bounds.oppositeQuadrant(r)},updateRelativePosition:function(){},calculateNewPx:function(e){var t=e.offset(this.anchor.offset),i=this.size||this.contentSize;if(this.relativePosition){var r="t"==this.relativePosition.charAt(0);t.y+=r?-i.h:this.anchor.size.h;var n="l"==this.relativePosition.charAt(1);t.x+=n?-i.w:this.anchor.size.w}return t},CLASS_NAME:"OpenLayers.Popup.Anchored"}),OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(e,t,i,r,n,s,o){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments),this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(e){return this.relativePosition}),this.contentDiv.style.position="absolute",this.contentDiv.style.zIndex=1,s&&(this.closeDiv.style.zIndex=1),this.groupDiv.style.position="absolute",this.groupDiv.style.top="0px",this.groupDiv.style.left="0px",this.groupDiv.style.height="100%",this.groupDiv.style.width="100%",this.groupDiv.style.overflow="visible"},destroy:function(){if(this.imageSrc=null,this.imageSize=null,this.isAlphaImage=null,this.fixedRelativePosition=!1,this.positionBlocks=null,this.blocks)for(var e=0;e<this.blocks.length;e++){var t=this.blocks[e];t.image&&t.div.removeChild(t.image),delete t.image,t.image=null,t.div&&this.groupDiv.removeChild(t.div),t.div=null}this.blocks=null,OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},moveTo:function(e){this.relativePosition;this.relativePosition=this.calculateRelativePosition(e),OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(e)),this.updateRelativePosition()},setBackgroundColor:function(e){},setBorder:function(){},setOpacity:function(e){},setSize:function(e){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.updateBlocks()},updateRelativePosition:function(){if(this.padding=this.positionBlocks[this.relativePosition].padding,this.closeDiv){var e=this.getContentDivPadding();this.closeDiv.style.right=e.right+this.padding.right+"px",this.closeDiv.style.top=e.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(e){var t=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return t=t.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var e=null;for(var t in this.positionBlocks){e=t;break}for(var i=this.positionBlocks[e],r=0;r<i.blocks.length;r++){var n={};this.blocks.push(n);var s=this.id+"_FrameDecorationDiv_"+r;n.div=OpenLayers.Util.createDiv(s,null,null,null,"absolute",null,"hidden",null);var o=this.id+"_FrameDecorationImg_"+r,a=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;n.image=a(o,null,this.imageSize,this.imageSrc,"absolute",null,null,null),n.div.appendChild(n.image),this.groupDiv.appendChild(n.div)}},updateBlocks:function(){if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(var e=this.positionBlocks[this.relativePosition],t=0;t<e.blocks.length;t++){var i=e.blocks[t],r=this.blocks[t],n=i.anchor.left,s=i.anchor.bottom,o=i.anchor.right,a=i.anchor.top,l=isNaN(i.size.w)?this.size.w-(o+n):i.size.w,p=isNaN(i.size.h)?this.size.h-(s+a):i.size.h;s-=p,r.div.style.width=(l<0?0:l)+"px",r.div.style.height=(p<0?0:p)+"px",r.div.style.left=null!=n?n+"px":"",r.div.style.bottom=null!=s?s+"px":"",r.div.style.right=null!=o?o+"px":"",r.div.style.top=null!=a?a+"px":"",r.image.style.left=i.position.x+"px",r.image.style.top=i.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px",this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"}),OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!1,imageSize:new OpenLayers.Size(60,40),isAlphaImage:!1,fixedRelativePosition:!0,relativePosition:"tr",positionBlocks:{tr:{offset:new OpenLayers.Pixel((-60),0),padding:new OpenLayers.Bounds(0,42,0,0),blocks:[{size:new OpenLayers.Size(60,40),anchor:new OpenLayers.Bounds(60,3,null,null),position:new OpenLayers.Pixel(0,0)}]}},minSize:new OpenLayers.Size(150,60),maxSize:new OpenLayers.Size(1200,660),setSize:function(e){var t=2,i=2;e&&(e.w-=t,e.h-=i),OpenLayers.Popup.Framed.prototype.setSize.call(this,e)},createBlocks:function(){this.blocks=[];var e=null;for(var t in this.positionBlocks){e=t;break}for(var i=this.positionBlocks[e],r=0;r<i.blocks.length;r++){var n={};this.blocks.push(n);var s=this.id+"_FrameDecorationDiv_"+r;n.div=OpenLayers.Util.createDiv(s,null,null,null,"absolute",null,"hidden",null),n.div.style.zIndex=1e4;var o=this.id+"_FrameDecorationImg_"+r,a=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;n.image=a(o,null,this.imageSize,this.imageSrc,"absolute",null,null,null),n.div.appendChild(n.image),this.groupDiv.appendChild(n.div)}},initialize:function(e,t,i,r,n,s,o,a){this.imageSrc=OpenLayers.Util.getImageLocation("iw_tail.png"),this.positionBlocks={tr:{offset:new OpenLayers.Pixel((-60),0),padding:new OpenLayers.Bounds(0,42,0,0),blocks:[{size:new OpenLayers.Size(60,40),anchor:new OpenLayers.Bounds(60,3,null,null),position:new OpenLayers.Pixel(0,0)}]}},a&&(a.offset&&(this.positionBlocks.tr.offset=a.offset),a.padding&&(this.positionBlocks.tr.padding=a.padding),a.blocks&&(this.positionBlocks.tr.blocks=a.blocks),a.imageSize&&(this.imageSize=a.imageSize),a.imageSrc&&(this.imageSrc=a.imageSrc)),OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments),this.contentDiv.className=this.contentDisplayClass,this.div.style.padding="1px"},setContentDom:function(e){if(this.contentHTML=e.innerHTML,null!=this.contentDiv){for(;this.contentDiv.childNodes.length>0;)this.contentDiv.removeChild(this.contentDiv.firstChild);this.contentDiv.appendChild(e),this.autoSize&&(this.registerImageListeners(),this.updateSize()),this.prevPositon={left:this.div.style.left,top:this.div.style.top},this.show()}},CLASS_NAME:"OpenLayers.Popup.FramedCloud"}),OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,i){this.layer=e,this.lonlat=t,this.data=null!=i?i:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.layer=null,this.id=null,this.lonlat=null,this.data=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var e=!1;if(null!=this.layer&&null!=this.layer.map){var t=this.layer.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){if(null!=this.lonlat){if(!this.popup){var t=this.marker?this.marker.icon:null,i=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new i(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,t,e)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",flashTimes:0,_m_iSeq:0,flashCount:6,modified:null,initialize:function(e,t,i){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]),this.lonlat=null,this.geometry=e?e:null,this.state=null,this.attributes={},t&&(this.attributes=t),this.style=i?i:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,this.modified=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=!1;if(this.layer&&this.layer.map){var i=this.layer.map.getExtent();if(e){var r=this.geometry.getBounds();t=i.intersectsBounds(r)}else{var n=i.toGeometry();t=n.intersects(this.geometry)}}return t},getVisibility:function(){return!(this.style&&"none"===this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"===this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,i){var r=!1;return this.geometry&&(r=this.geometry.atPoint(e,t,i)),r},destroyPopup:function(){},move:function(e){if(this.layer&&this.geometry.move){var t;t="OpenLayers.LonLat"===e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e;var i=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),r=this.layer.map.getResolution();return this.geometry.move(r*(t.x-i.x),r*(i.y-t.y)),this.layer.drawFeature(this),i}},toState:function(e){if(e===OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(e===OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e}else if(e===OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e}else e===OpenLayers.State.UNKNOWN&&(this.state=e)},show:function(){this.getVisibility()||this.layer&&(this.style.display="",this.layer.drawFeature(this))},hide:function(){this.getVisibility()&&this.layer&&(this.style.display="none",this.layer.drawFeature(this))},flash:function(e){this.flashTimes=0,e?this.flashCount=e:this.flashCount=6,this._flashInterval(e)},flashStop:function(){this.flashTimeOut&&(window.clearTimeout(this.flashTimeOut),this.show())},_flashInterval:function(e){return this.flashTimes<this.flashCount?(this.flashTimes++,this.getVisibility()?this.hide():this.show(),void(this.flashTimeOut=this.setTimeout("this._flashInterval()",400))):void this.show()},setTimeout:function(ie,Bi){var ke="tempVar"+this._m_iSeq+"_"+this.id;if(this._m_iSeq++,this._m_iSeq===Number.MAX_VALUE-1&&(this._m_iSeq=0),eval(ke+" = this;"),"function"!=typeof ie.replace)return window.setTimeout(";",Bi);var Rh=ie.replace(/\\/g,"\\\\").replace(/\"/g,'\\"');return window.setTimeout(ke+'._setTimeoutDispatcher("'+Rh+'");',Bi)},_setTimeoutDispatcher:function(ie){eval(ie)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}},OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(e,t,i){OpenLayers.Util.extend(this,i),this.control=e,this.callbacks=t;var r=this.map||e.map;r&&this.setMap(r),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(e){this.map=e},checkModifiers:function(e){if(null==this.keyMask)return!0;var t=(e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0)|(e.metaKey?OpenLayers.Handler.MOD_META:0);return t==this.keyMask},activate:function(){if(this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;t<i;t++)this[e[t]]&&this.register(e[t],this[e[t]]);return this.active=!0,!0},deactivate:function(){if(!this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;t<i;t++)this[e[t]]&&this.unregister(e[t],this[e[t]]);return this.touch=!1,this.active=!1,!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var e=["mousedown","mouseup","mousemove","click","dblclick","mouseout"],t=0,i=e.length;t<i;t++)this[e[t]]&&this.unregister(e[t],this[e[t]])}},callback:function(e,t){e&&this.callbacks[e]&&this.callbacks[e].apply(this.control,t)},register:function(e,t){this.map.events.registerPriority(e,this,t),this.map.events.registerPriority(e,this,this.setEvent)},unregister:function(e,t){this.map.events.unregister(e,this,t),this.map.events.unregister(e,this,this.setEvent)},setEvent:function(e){return this.evt=e,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.MOD_META=8,OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:50,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(e){return this.startTouch(),this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},touchmove:function(e){return this.last=this.getEventInfo(e),!0},touchend:function(e){return this.down&&(e.xy=this.last.xy,e.lastTouches=this.last.touches,this.handleSingle(e),this.down=null),!0},mousedown:function(e){return this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},mouseup:function(e){var t=!0;return this.checkModifiers(e)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(e)&&(t=this.rightclick(e)),t},rightclick:function(e){if(this.passesTolerance(e)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[e]),!this.stopDouble;var t=this["double"]?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]),i=OpenLayers.Function.bind(this.delayedRightCall,this,t);this.rightclickTimerId=window.setTimeout(i,this.delay)}return!this.stopSingle},delayedRightCall:function(e){this.rightclickTimerId=null,e&&this.callback("rightclick",[e])},click:function(e){this.last||(this.last=this.getEventInfo(e));var t=this.getFeatures(e);return t&&0!=t.length?this.featureClickFun&&this.featureClickFun(e):this.handleSingle(e),!this.stopSingle},getFeatures:function(e){return this.map.getFeatures(e)},dblclick:function(e){return this.handleDouble(e),!this.stopDouble},handleDouble:function(e){this.passesDblclickTolerance(e)&&(this["double"]&&this.callback("dblclick",[e]),this.clearTimer())},handleSingle:function(e){if(this.passesTolerance(e))if(null!=this.timerId)this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.preventDefault(e),this.handleDouble(e)),this.last.touches&&2===this.last.touches.length||this.clearTimer();else{this.first=this.getEventInfo(e);var t=this.single?OpenLayers.Util.extend({},e):null;this.queuePotentialClick(t)}},queuePotentialClick:function(e){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)},passesTolerance:function(e){var t=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(t=this.pixelTolerance>=this.down.xy.distanceTo(e.xy),t&&this.touch&&this.down.touches.length===this.last.touches.length))for(var i=0,r=this.down.touches.length;i<r;++i)if(this.getTouchDistance(this.down.touches[i],this.last.touches[i])>this.pixelTolerance){t=!1;break}return t},getTouchDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))},passesDblclickTolerance:function(e){var t=!0;return this.down&&this.first&&(t=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),t},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(e){this.timerId=null,e&&this.callback("click",[e])},getEventInfo:function(e){var t;if(e.touches){var i=e.touches.length;t=new Array(i);for(var r,n=0;n<i;n++)r=e.touches[n],t[n]={clientX:r.olClientX,clientY:r.olClientY}}return{xy:e.xy,touches:t}},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.down=null,this.first=null,this.last=null,e=!0),e},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(e){return this.passesTolerance(e.xy)&&(this.clearTimer(),this.callback("move",[e]),this.px=e.xy,e=OpenLayers.Util.extend({},e),
this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)),!this.stopMove},mouseout:function(e){return OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[e])),!0},passesTolerance:function(e){var t=!0;if(this.pixelTolerance&&this.px){var i=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));i<this.pixelTolerance&&(t=!1)}return t},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(e){this.callback("pause",[e])},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),e=!0),e},CLASS_NAME:"OpenLayers.Handler.Hover"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e),this.map.addLayer(this.layer),!0},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,!0)},destroyFeature:function(e){!this.layer||!e&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>1&&this.layer.features[0].destroy()},finalize:function(e){var t=e?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(t,[this.geometryClone()]),this.destroyFeature(e)},cancel:function(){this.finalize(!0)},click:function(e){return OpenLayers.Event.stop(e),!1},dblclick:function(e){return OpenLayers.Event.stop(e),!1},modifyFeature:function(e){this.point||this.createFeature(e);var t=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=t.lon,this.point.geometry.y=t.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var e=this.point&&this.point.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPoint([e])),e},geometryClone:function(){var e=this.getGeometry();return e&&e.clone()},mousedown:function(e){return this.down(e)},touchstart:function(e){return this.startTouch(),this.lastTouchPx=e.xy,this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){return this.lastTouchPx=e.xy,this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){return e.xy=this.lastTouchPx,this.up(e)},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(e){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy),!0},up:function(e){return this.mouseDown=!1,this.stoppedDown=this.stopDown,!this.checkModifiers(e)||(!(!this.lastUp||!this.lastUp.equals(e.xy))||(!this.lastDown||!this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||(this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.finalize(),!this.stopUp)))},mouseout:function(e){OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(e,t,i){var r=!0;if(null!=i&&e&&t){var n=e.distanceTo(t);n>i&&(r=!1)}return r},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,lineCount:0,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.pointStyle={};for(var r in this.style)this.pointStyle[r]=this.style[r];this.pointStyle.strokeDashstyle="solid",this.point=new OpenLayers.Feature.Vector(i),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(e){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,e),this.line=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(e){this.layer.removeFeatures([this.point]);var t=this.layer.getLonLatFromViewPortPx(e);if(this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),!this.freehand){var i=this.point.clone();i.style=this.pointStyle,this.layer.addFeatures([i])}this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(e,t){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(e,t),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(e,t){var i=this.getCurrentPointIndex()-1,r=this.line.geometry.components[i];!r||isNaN(r.x)||isNaN(r.y)||this.insertXY(r.x+e,r.y+t)},insertDirectionLength:function(e,t){e*=Math.PI/180;var i=t*Math.cos(e),r=t*Math.sin(e);this.insertDeltaXY(i,r)},insertDeflectionLength:function(e,t){var i=this.getCurrentPointIndex()-1;if(i>0){var r=this.line.geometry.components[i],n=this.line.geometry.components[i-1],s=Math.atan2(r.y-n.y,r.x-n.x);this.insertDirectionLength(180*s/Math.PI+e,t)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,t=e.components,i=this.getCurrentPointIndex()-1,r=t[i],n=e.removeComponent(r);if(n){if(this.touch&&i>0){t=e.components;var s=t[i-1],o=this.getCurrentPointIndex(),a=t[o];a.x=s.x,a.y=s.y}this.redoStack||(this.redoStack=[]),this.redoStack.push(r),this.drawFeature()}return n},redo:function(){var e=this.redoStack&&this.redoStack.pop();return e&&(this.line.geometry.addComponent(e,this.getCurrentPointIndex()),this.drawFeature()),!!e},freehandMode:function(e){return this.freehandToggle&&e[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,t){this.line||this.createFeature(e);var i=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=i.lon,this.point.geometry.y=i.lat,this.callback("modify",[this.point.geometry,this.getSketch(),t]),this.callback("measuremoving",[this.point.geometry,this.getGeometry()]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.pointStyle)},getSketch:function(){return this.line},getGeometry:function(){var e=this.line&&this.line.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiLineString([e])),e},touchstart:function(e){return this.timerId&&this.passesTolerance(this.lastTouchPx,e.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,e))},down:function(e){var t=this.stopDown;return this.freehandMode(e)&&(t=!0,this.touch&&(this.modifyFeature(e.xy,!!this.lastUp),OpenLayers.Event.stop(e))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||this.modifyFeature(e.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=e.xy,this.stoppedDown=t,!t},move:function(e){return this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(e.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy,!!this.lastUp),!0)},up:function(e){return!this.mouseDown||this.lastUp&&this.lastUp.equals(e.xy)||(this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(e.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(e.xy),this.lastUp=e.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),2===e.button?(this.freehandMode(e)||this.finishGeometry(!0),!0):(this.lineCount++,this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp)},finishGeometry:function(e){if(this.line){var t=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[t]),e&&this.lineCount<this.line.geometry.components.length&&this.line.geometry.removeComponent(this.line.geometry.components[t-1]),this.removePoint(),this.finalize(),this.lineCount=0}},dblclick:function(e){return this.freehandMode(e)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.pointStyle={};for(var r in this.style)this.pointStyle[r]=this.style[r];this.pointStyle.strokeDashstyle="solid",this.point=new OpenLayers.Feature.Vector(i),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(e){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var t,i,r=this.point.geometry,n=this.control.layer.features,s=n.length-1;s>=0;--s)if(t=n[s].geometry,(t instanceof OpenLayers.Geometry.Polygon||t instanceof OpenLayers.Geometry.MultiPolygon)&&t.intersects(r)){i=n[s],this.control.layer.removeFeatures([i],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),i.geometry.addComponent(this.line.geometry),this.polygon=i,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){var t=e.vertex,i=this.line.geometry.components;if(!this.polygon.geometry.intersects(t)){var r=i[i.length-3];t.x=r.x,t.y=r.y}},finishGeometry:function(){var e=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[e]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var e=this.line.geometry,t=0!==e.getArea();if(t){for(var i=this.polygon.geometry.components,r=i.length-2;r>=0;--r)if(e.intersects(i[r])){t=!1;break}if(t){e:for(var r=i.length-2;r>0;--r)for(var n=i[r].components,s=0,o=n.length;s<o;++s)if(e.containsPoint(n[s])){t=!1;break e}}}return t?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(e),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(e){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,e||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(e){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,e),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.pointStyle)},getSketch:function(){return this.polygon},getGeometry:function(){var e=this.polygon&&this.polygon.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPolygon([e])),e},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{contextmenu:{"in":"contextmenu",out:"contextmenuout"},click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(e,t,i,r){OpenLayers.Handler.prototype.initialize.apply(this,[e,i,r]),this.layer=t},touchstart:function(e){return this.startTouch(),!!OpenLayers.Event.isMultiTouch(e)||this.mousedown(e)},touchmove:function(e){OpenLayers.Event.preventDefault(e)},mousedown:function(e){return(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))&&(this.down=e.xy),!this.handle(e)||!this.stopDown},mouseup:function(e){return this.up=e.xy,!this.handle(e)||!this.stopUp},click:function(e){return!this.handle(e)||!this.stopClick},contextmenu:function(e){return!this.handle(e)||!this.stopClick},mousemove:function(e){return!this.callbacks.over&&!this.callbacks.out||(this.handle(e),!0)},dblclick:function(e){return!this.handle(e)},geometryTypeMatches:function(e){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)>-1},handle:function(e){this.feature&&!this.feature.layer&&(this.feature=null);var t=e.type,i=!1,r=!!this.feature,n="click"==t||"dblclick"==t||"touchstart"==t||"contextmenu"==t||"mouseup"==t||"mousedown"==t;if(this.feature=this.layer.getFeatureFromEvent(e),this.feature&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature){"touchstart"===t&&OpenLayers.Event.preventDefault(e);var s=this.feature!=this.lastFeature;this.geometryTypeMatches(this.feature)?(r&&s?(this.lastFeature&&this.triggerCallback(t,"out",[this.lastFeature]),this.triggerCallback(t,"in",[this.feature,t])):r&&!n||this.triggerCallback(t,"in",[this.feature,t]),this.lastFeature=this.feature,i=!0):(this.lastFeature&&(r&&s||n)&&this.triggerCallback(t,"out",[this.lastFeature]),this.feature=null)}else this.lastFeature&&(r||n)&&this.triggerCallback(t,"out",[this.lastFeature]);return i},triggerCallback:function(e,t,i){var r=this.EVENTMAP[e][t];if(r)if("click"==e&&"out"==t&&this.up&&this.down){var n=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));n<=this.clickTolerance&&this.callback(r,i),this.up=this.down=null}else this.callback(r,i)},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.feature=null,this.lastFeature=null,this.down=null,this.up=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},handleMapEvents:function(e){"removelayer"!=e.type&&"order"!=e.property||this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(e,t,i){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.documentDrag===!0){var r=this;this._docMove=function(e){r.mousemove({xy:{x:e.clientX,y:e.clientY},element:document})},this._docUp=function(e){r.mouseup({xy:{x:e.clientX,y:e.clientY}})}}},dragstart:function(e){var t=!0;return this.dragging=!1,this.checkModifiers(e)&&(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))?(this.started=!0,this.start=e.xy,this.last=e.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(e),this.callback("down",[e.xy]),OpenLayers.Event.preventDefault(e),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,t=!this.stopDown):OpenLayers.Event.isRightClick(e)&&this.dragend(e),t},dragmove:function(e){return this.lastMoveEvt=e,!this.started||this.timeoutId||e.xy.x==this.last.x&&e.xy.y==this.last.y||(this.documentDrag===!0&&this.documentEvents&&(e.element===document?(this.adjustXY(e),this.setEvent(e)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(e),this.callback("move",[e.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=e.xy),!0},dragend:function(e){if("OpenLayers.Handler.RegularPolygon"!==this.CLASS_NAME&&"OpenLayers.Handler.RegularPolygonExtend"!==this.CLASS_NAME||2===e.button&&(this.deactivate(),this.callback("done",[e.xy])),this.started){this.documentDrag===!0&&this.documentEvents&&(this.adjustXY(e),this.removeDocumentEvents());this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(e),this.callback("up",[e.xy]),this.callback("done",[e.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(e){},move:function(e){},up:function(e){},out:function(e){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){return this.startTouch(),this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(e){return this.dragend(e)},touchend:function(e){return e.xy=this.last,this.dragend(e)},mouseout:function(e){if(this.started&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var t=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(e),this.callback("out",[e.xy]),t&&this.callback("done",[e.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}else if(this.started&&this.map.div.contains(e.toElement)){var i=this.map.getControlsByClass("OpenLayers.Control.LTOverviewMap");if(i&&i[0]&&(e.toElement==i[0].div||i[0].div.contains(e.toElement))){var t=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(e),this.callback("out",[e.xy]),t&&this.callback("done",[e.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}}return!0},click:function(e){return this.start==this.last},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.dragging=!1,this.start=null,this.last=null,e=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),e},adjustXY:function(e){var t=OpenLayers.Util.pagePosition(this.map.viewPortDiv);e.xy.x-=t[0],e.xy.y-=t[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(e){var t=!0;if(this.pinching=!1,OpenLayers.Event.isMultiTouch(e))this.started=!0,this.last=this.start={distance:this.getDistance(e.touches),delta:0,scale:1},this.callback("start",[e,this.start]),t=!this.stopDown;else{if(this.started)return!1;this.started=!1,this.start=null,this.last=null}return OpenLayers.Event.preventDefault(e),t},touchmove:function(e){if(this.started&&OpenLayers.Event.isMultiTouch(e)){this.pinching=!0;var t=this.getPinchData(e);this.callback("move",[e,t]),this.last=t,OpenLayers.Event.stop(e)}else if(this.started)return!1;return!0},touchend:function(e){return!(this.started&&!OpenLayers.Event.isMultiTouch(e))||(this.started=!1,this.pinching=!1,this.callback("done",[e,this.start,this.last]),this.start=null,this.last=null,!1)},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.pinching=!1,this.start=null,this.last=null,e=!0),e},getDistance:function(e){var t=e[0],i=e[1];return Math.sqrt(Math.pow(t.olClientX-i.olClientX,2)+Math.pow(t.olClientY-i.olClientY,2))},getPinchData:function(e){var t=this.getDistance(e.touches),i=t/this.start.distance;return{distance:t,delta:this.last.distance-t,scale:i}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.Drag.prototype.initialize.apply(this,[e,t,i]),this.options=i?i:{}},setOptions:function(e){OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e)},activate:function(){var e=!1;if(OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)){var t=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,t),this.map.addLayer(this.layer),e=!0}return e},deactivate:function(){var e=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.layer=null,this.feature=null,e=!0),e},down:function(e){this.fixedRadius=!!this.radius;var t=this.layer.getLonLatFromViewPortPx(e.xy);this.origin=new OpenLayers.Geometry.Point(t.lon,t.lat),this.fixedRadius&&!this.irregular||(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style)},move:function(e){var t=this.layer.getLonLatFromViewPortPx(e.xy),i=new OpenLayers.Geometry.Point(t.lon,t.lat);if(this.irregular){var r=Math.sqrt(2)*Math.abs(i.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,r)}else this.fixedRadius?this.origin=i:(this.calculateAngle(i,e),this.radius=Math.max(this.map.getResolution()/2,i.distanceTo(this.origin)));if(this.modifyGeometry(),this.irregular){var n,s=i.x-this.origin.x,o=i.y-this.origin.y;n=0==o?s/(this.radius*Math.sqrt(2)):s/o,this.feature.geometry.resize(1,this.origin,n),this.feature.geometry.move(s/2,o/2)}this.layer.drawFeature(this.feature,this.style)},up:function(e){this.finalize(),this.start==this.last&&this.callback("done",[e.xy])},out:function(e){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-.5),this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180)),this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var e,t,i=this.feature.geometry.components[0];i.components.length!=this.sides+1&&(this.createGeometry(),i=this.feature.geometry.components[0]);for(var r=0;r<this.sides;++r)t=i.components[r],e=this.angle+2*r*Math.PI/this.sides,t.x=this.origin.x+this.radius*Math.cos(e),t.y=this.origin.y+this.radius*Math.sin(e),t.clearBounds()},calculateAngle:function(e,t){var i=Math.atan2(e.y-this.origin.y,e.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!t[this.snapToggle]){var r=Math.PI/180*this.snapAngle;this.angle=Math.round(i/r)*r}else this.angle=i},cancel:function(){this.callback("cancel",null),this.finalize()},finalize:function(){this.origin=null,this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(e,t){this.callbacks[e]&&this.feature?this.callbacks[e].apply(this.control,[this.feature.geometry.clone()]):this.callbacks[e]&&this.callbacks[e].apply(this.control),this.persist||"done"!=e&&"cancel"!=e||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"}),OpenLayers.Handler.RegularPolygonExtend=OpenLayers.Class(OpenLayers.Handler.RegularPolygon,{feature_line:null,newOrigin:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.RegularPolygon.prototype.initialize.apply(this,[e,t,i]),this.options=i?i:{}},down:function(e){this.fixedRadius=!!this.radius;var t=this.layer.getLonLatFromViewPortPx(e.xy);this.origin=new OpenLayers.Geometry.Point(t.lon,t.lat),this.newOrigin=this.origin,this.fixedRadius&&!this.irregular||(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style),this.feature_line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.origin,this.origin])),this.layer.addFeatures([this.feature_line],{silent:!0})},move:function(e){var t=this.layer.getLonLatFromViewPortPx(e.xy),i=new OpenLayers.Geometry.Point(t.lon,t.lat);if(this.irregular){var r=Math.sqrt(2)*Math.abs(i.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,r)}else this.fixedRadius?this.origin=i:(this.calculateAngle(i,e),this.radius=Math.max(this.map.getResolution()/2,i.distanceTo(this.origin))/2,this.newOrigin=new OpenLayers.Geometry.Point((i.x+this.origin.x)/2,(i.y+this.origin.y)/2));if(this.modifyGeometry(),this.feature_line.geometry.components[1]=i,this.irregular){var n,s=i.x-this.origin.x,o=i.y-this.origin.y;n=0==o?s/(this.radius*Math.sqrt(2)):s/o,this.feature.geometry.resize(1,this.origin,n),this.feature.geometry.move(s/2,o/2)}this.layer.drawFeature(this.feature,this.style),this.layer.drawFeature(this.feature_line,this.style)},up:function(e){this.finalize(),this.start==this.last&&this.callback("done",[e.xy])},modifyGeometry:function(){var e,t,i=this.feature.geometry.components[0];i.components.length!=this.sides+1&&(this.createGeometry(),i=this.feature.geometry.components[0]);for(var r=0;r<this.sides;++r)t=i.components[r],e=this.angle+2*r*Math.PI/this.sides,t.x=this.newOrigin.x+this.radius*Math.cos(e),t.y=this.newOrigin.y+this.radius*Math.sin(e),t.clearBounds()},finalize:function(){this.newOrigin=null,this.feature_line=null,OpenLayers.Handler.RegularPolygon.prototype.finalize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Handler.RegularPolygonExtend"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.outBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(e){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(e)},startBox:function(e){this.zoomBox&&this.map.viewPortDiv.removeChild(this.zoomBox),this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999}),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},outBox:function(e){var t,i=this.dragHandler.start;if(i){var r=Math.min(i.y,e.y),n=Math.max(i.y,e.y),s=Math.min(i.x,e.x),o=Math.max(i.x,e.x);t=new OpenLayers.Bounds(s,n,o,r)}this.removeBox(),t&&this.callback("done",[t])},moveBox:function(e){var t=this.dragHandler.start.x,i=this.dragHandler.start.y,r=Math.abs(t-e.x),n=Math.abs(i-e.y),s=this.getBoxOffsets();this.zoomBox.style.width=r+s.width+1+"px",this.zoomBox.style.height=n+s.height+1+"px",this.zoomBox.style.left=(e.x<t?t-r-s.left:t-s.left)+"px",this.zoomBox.style.top=(e.y<i?i-n-s.top:i-s.top)+"px"},endBox:function(e){var t;if(Math.abs(this.dragHandler.start.x-e.x)>5||Math.abs(this.dragHandler.start.y-e.y)>5){var i=this.dragHandler.start,r=Math.min(i.y,e.y),n=Math.max(i.y,e.y),s=Math.min(i.x,e.x),o=Math.max(i.x,e.x);t=new OpenLayers.Bounds(s,n,o,r)}else t=this.dragHandler.start.clone();this.removeBox(),t&&this.callback("done",[t])},removeBox:function(){this.zoomBox&&this.map.viewPortDiv.removeChild(this.zoomBox),this.zoomBox=null,this.boxOffsets=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return!!OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragHandler.activate(),!0)},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0)},getBoxOffsets:function(){if(!this.boxOffsets){var e=document.createElement("div");e.style.position="absolute",e.style.border="1px solid black",e.style.width="3px",document.body.appendChild(e);var t=3==e.clientWidth;document.body.removeChild(e);var i=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),r=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),n=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),s=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));
this.boxOffsets={left:i,right:r,top:n,bottom:s,width:t===!1?i+r:0,height:t===!1?n+s:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(e,t){if(this.map&&this.checkModifiers(e)){for(var i=!1,r=t,n=!1,s=OpenLayers.Event.element(e);null!=s&&!n&&!i;){if(!i)try{var o;if(s.currentStyle)o=s.currentStyle.overflow;else{var a=document.defaultView.getComputedStyle(s,null);o=a.getPropertyValue("overflow")}i=o&&"auto"==o||"scroll"==o}catch(l){}if(!r&&(r=OpenLayers.Element.hasClass(s,"olScrollable"),!r))for(var p=0,h=this.map.layers.length;p<h;p++){var u=this.map.layers[p];if(s==u.div||s==u.pane){r=!0;break}}n=s==this.map.div,s=s.parentNode}if(!i&&n){if(r){var y=0;if(e.wheelDelta?(y=e.wheelDelta,y%160===0&&(y=.75*y),y/=120):e.detail&&(y=-(e.detail/Math.abs(e.detail))),this.delta+=y,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var c=OpenLayers.Util.extend({},e);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(c)},this),this.interval)}else this.wheelZoom(e)}OpenLayers.Event.stop(e)}}},wheelZoom:function(e){var t=this.delta;this.delta=0,t&&(e.xy=this.map.events.getMousePosition(e),t<0?this.callback("down",[e,this.cumulative?Math.max(-this.maxDelta,t):-1]):this.callback("up",[e,this.cumulative?Math.min(this.maxDelta,t):1]))},activate:function(e){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var t=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",t),OpenLayers.Event.observe(window,"mousewheel",t),OpenLayers.Event.observe(document,"mousewheel",t),!0}return!1},deactivate:function(e){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var t=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",t),OpenLayers.Event.stopObserving(window,"mousewheel",t),OpenLayers.Event.stopObserving(document,"mousewheel",t),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"}),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(e,t,i){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var e=0,t=this.KEY_EVENTS.length;e<t;e++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[e],this.eventListener);return!0}return!1},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var t=0,i=this.KEY_EVENTS.length;t<i;t++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[t],this.eventListener);e=!0}return e},handleKeyEvent:function(e){this.checkModifiers(e)&&this.callback(e.type,[e])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,className:null,initialize:function(e){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,e),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&"function"==typeof this.handlers[e].destroy&&this.handlers[e].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(e){this.map=e,this.handler&&this.handler.setMap(e)},draw:function(e){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.className&&(this.div.className+=" "+this.className),this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!==this.title&&(this.div.title=this.title)),null!=e&&(this.position=e.clone()),this.moveTo(this.position),this.div},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},activate:function(){return!this.active&&(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return!!this.active&&(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0)},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(e){e=e||window.location.href;var t=OpenLayers.Util.getParameters(e),i=e.indexOf("#");return i>0&&(e="?"+e.substring(i+1,e.length),OpenLayers.Util.extend(t,OpenLayers.Util.getParameters(e))),t},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var t=0,i=this.map.controls.length;t<i;t++){var r=this.map.controls[t];if(r!==this&&"OpenLayers.Control.ArgParser"===r.CLASS_NAME){r.displayProjection!==this.displayProjection&&(this.displayProjection=r.displayProjection);break}}if(t===this.map.controls.length){var n=this.getParameters();n.layers&&(this.layers=n.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),n.lat&&n.lon&&(this.center=new OpenLayers.LonLat(parseFloat(n.lon),parseFloat(n.lat)),n.zoom&&(this.zoom=parseFloat(n.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter())}},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length===this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var e=0,t=this.layers.length;e<t;e++){var i=this.map.layers[e],r=this.layers.charAt(e);"B"===r?this.map.setBaseLayer(i):"T"!==r&&"F"!==r||i.setVisibility("T"===r)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"}),OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this}),this.updateAttribution(),this.div},updateAttribution:function(){var e,t=[];if(this.map&&this.map.layers){for(var i=0,r=this.map.layers.length;i<r;i++){var n=this.map.layers[i];n.attribution&&n.getVisibility()&&(e="object"==typeof n.attribution?OpenLayers.String.format(this.layerTemplate,n.attribution):n.attribution,OpenLayers.Util.indexOf(t,e)===-1&&t.push(e))}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:t.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"}),OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"}),OpenLayers.Control.ClickControl=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!0,pixelTolerance:0,stopSingle:!1,stopDouble:!1},handleRightClicks:!0,initialize:function(e){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,this.eventMethods,this.handlerOptions)},setFeaturesClick:function(e){this.handler.featureClickFun=e},CLASS_NAME:"OpenLayers.Control.ClickControl"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(e){if(this.handler.removeBox(),e instanceof OpenLayers.Bounds){var t,i=e.getCenterPixel();if(this.out){var r=e.right-e.left,n=e.bottom-e.top,s=Math.min(this.map.size.h/n,this.map.size.w/r),o=this.map.getExtent(),a=this.map.getLonLatFromPixel(i),l=a.lon-o.getWidth()/2*s,p=a.lon+o.getWidth()/2*s,h=a.lat-o.getHeight()/2*s,u=a.lat+o.getHeight()/2*s;t=new OpenLayers.Bounds(l,h,p,u)}else{var y=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),c=this.map.getLonLatFromPixel({x:e.right,y:e.top});t=new OpenLayers.Bounds(y.lon,y.lat,c.lon,c.lat)}var d=this.map.getZoom(),m=this.map.getSize(),f={x:m.w/2,y:m.h/2},g=this.map.getZoomForExtent(t);if(this.out||g!==d||(g+=1),this.map.baseLayer instanceof OpenLayers.Layer.TMS_PGIS){var L=0;6===Math.abs(g-d)?L=4:5===Math.abs(g-d)?L=3:4===Math.abs(g-d)&3===Math.abs(g-d)&&(L=2),g=this.out?g+L:g-L}var v=this.map.getResolution(),O=this.map.getResolutionForZoom(g);if(v===O)this.map.setCenter(this.map.getLonLatFromPixel(i));else{var P={x:(v*i.x-O*f.x)/(v-O),y:(v*i.y-O*f.y)/(v-O)};this.map.zoomTo(g,P)}d===this.map.getZoom()&&this.alwaysZoom===!0&&this.map.zoomTo(d+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,e):this.map.zoomTo(this.map.getZoom()+1,e))},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,startFun:null,endFun:null,movingFun:null,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(e)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(e){this.kinetic&&this.kinetic.begin(),this.startFun&&this.startFun.apply(this),this.isDragStart=!1,this.moving=!1},panMap:function(e){this.kinetic&&this.kinetic.update(e),this.isDragStart||(this.isDragStart=!0,this.dragStartFun&&this.dragStartFun.apply(this,arguments)),this.panned=!0,this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!0,animate:!1}),this.movingFun&&this.movingFun.apply(this,arguments),this.moving=!0},panMapDone:function(e){if(this.panned){var t=null;if(this.kinetic&&(t=this.kinetic.end(e)),this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!t,animate:!1}),t){var i=this;this.kinetic.move(t,function(e,t,r){i.map.pan(e,t,{dragging:!r,animate:!1})})}this.panned=!1}this.endFun&&this.endFun.apply(this),this.moving&&this.dragEndFun&&this.dragEndFun.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,isDrag:!1,initialize:function(e){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var e={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},t={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,e,t),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));var i=this;this.dragPan.movingFun=function(e){i.map.events.triggerEvent("dragging",{xy:e})},this.dragPan.dragStartFun=function(e){i.isDrag=!0,i.map.events.triggerEvent("dragstart",{xy:e})},this.dragPan.dragEndFun=function(e){i.map.events.triggerEvent("dragend",{xy:e}),i.isDrag=!1},this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw();var r=this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(r,this.mouseWheelOptions)),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(e){e.lastTouches&&2===e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){0===this.getFeatures(e).length&&this.map.zoomTo(this.map.zoom+1,e.xy)},getFeatures:function(e){return this.map.getFeatures(e)},defaultDblRightClick:function(e){this.map.zoomTo(this.map.zoom-1,e.xy)},wheelChange:function(e,t){this.map.fractionalZoom||(t=Math.round(t));var i=this.map.getZoom(),r=i+t;r=Math.max(r,0),r=Math.min(r,this.map.getNumZoomLevels()),r!==i&&this.map.zoomTo(r,e.xy,"wheelChange")},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:'<span style="font-size: 11px">',separator:", ",suffix:"</span>",numDigits:7,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0)},deactivate:function(){return!!OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.div.left="",this.div.top="",this.element=this.div),this.div.id="MousePosition",this.div.style.bottom="0px",this.div.style.right="25px",document.getElementById("OpenLayers_Control_minimizeDiv")&&""===document.getElementById("OpenLayers_Control_minimizeDiv").style.display&&(this.div.style.right="200px"),this.div},redraw:function(e){var t;if(null==e)return void this.reset();if(null==this.lastXy||Math.abs(e.xy.x-this.lastXy.x)>this.granularity||Math.abs(e.xy.y-this.lastXy.y)>this.granularity)return void(this.lastXy=e.xy);if(t=this.map.getLonLatFromPixel(e.xy)){this.displayProjection&&t.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=e.xy;var i=this.formatOutput(t);i!==this.element.innerHTML&&(this.element.innerHTML=i)}},reset:function(e){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(e){var t=parseInt(this.numDigits);e=NPMap.T.getPoint(this.map,e);var i=this.prefix+e.lon.toFixed(t)+this.separator+e.lat.toFixed(t)+this.suffix;return i},CLASS_NAME:"OpenLayers.Control.MousePosition"}),OpenLayers.Control.MouseContext=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,context:null,offset:{x:0,y:0},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(id=this.id+"OpenLayers_MouseContext",this.element=OpenLayers.Util.createDiv(id,null,null,null,"absolute"),this.element.style.zIndex=9999,this.element.style.left="2000px",this.element.filter="alpha(opacity=50)",this.element.style.width="130px",this.element.style.height="40px",this.element.style.border="1px solid red",this.element.style.background="#fff",this.div.appendChild(this.element),this.context||(this.context="<span style='font-size: 11px'>按住鼠标左键拖选区域,<br>释放完成绘制。</span>"),this.element.innerHTML=this.context),this.div},setContext:function(e){this.context="<span style='font-size: 11px'>"+e+"</span>",this.element&&(this.element.innerHTML=this.context)},setContextSize:function(e,t){this.element&&(this.element.style.width=e+"px",this.element.style.height=t+"px")},setContextStyle:function(e){if(e&&this.element)for(var t in e)this.element.style[t]=e[t]},getContextStyle:function(){if(this.element)return this.element.style},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.map.events.register("mousemove",this,this.updateLocation),this.map.events.register("mouseout",this,this.hideControl),!0)},getElement:function(){return this.element},deactivate:function(){return!!OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.map.events.unregister("mousemove",this,this.updateLocation),this.map.events.unregister("mouseout",this,this.hideControl),this.element.style.left="2000px",this.element.innerHTML="",!0)},hideControl:function(){this.element.style.visibility="hidden"},updateLocation:function(e){if(null!=e&&this.element){this.element.style.visibility="visible";var t=e.xy.x+5,i=e.xy.y+3;this.element.style.top=i+this.offset.y+5+"px",this.element.style.left=t+this.offset.x+"px"}},CLASS_NAME:"OpenLayers.Control.MouseContext"}),OpenLayers.Control.JWMousePosition=OpenLayers.Class(OpenLayers.Control.MousePosition,{redraw:function(e){var t;if(null==e)return void this.reset();if(null==this.lastXy||Math.abs(e.xy.x-this.lastXy.x)>this.granularity||Math.abs(e.xy.y-this.lastXy.y)>this.granularity)return void(this.lastXy=e.xy);if(t=this.map.getLonLatFromPixel(e.xy)){t.transform(this.map.getProjectionObject(),"EPSG:4326"),this.lastXy=e.xy;var i=this.formatOutput(t);i!==this.element.innerHTML&&(this.element.innerHTML=i)}},formatOutput:function(e){var t=parseInt(this.numDigits),i=this.angleConver(e.lon.toFixed(t)),r=this.angleConver(e.lat.toFixed(t)),n=this.prefix+(e.lon>0?"东经：":"西经：")+i+this.separator+(e.lat>0?"北纬：":"南纬: ")+r+this.suffix;return n},angleConver:function(e){var t=e%1;if(0===t)return e+"度";var i=parseInt(60*t),r=parseInt(60*t%1*60);return Math.abs(parseInt(e))+"°"+i+"'"+r+"  ''"},CLASS_NAME:"OpenLayers.Control.JWMousePosition"}),OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(e){this.layers=[],this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,[e]),this.active=!1},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},close:function(){document.getElementById("copyright")&&(document.getElementById("copyright").style.right="5px"),document.getElementById("scale")&&(document.getElementById("scale").style.right="5px"),document.getElementById("MousePosition")&&(document.getElementById("MousePosition").style.right="5px")},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),0===this.layers.length){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var e=this.map.baseLayer.clone();this.layers=[e]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var t=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,t,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton",this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle),this.div.appendChild(this.maximizeDiv),t=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png"),this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,t,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton",this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle),this.div.appendChild(this.minimizeDiv),this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this}),this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw(),this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(e){var t=this.handlers.drag.last.x-e.x,i=this.handlers.drag.last.y-e.y;if(0!==t||0!==i){var r=this.rectPxBounds.top,n=this.rectPxBounds.left,s=Math.abs(this.rectPxBounds.getHeight()),o=this.rectPxBounds.getWidth(),a=Math.max(0,r-i);a=Math.min(a,this.ovmap.size.h-this.hComp-s);var l=Math.max(0,n-t);l=Math.min(l,this.ovmap.size.w-this.wComp-o),this.setRectPxBounds(new OpenLayers.Bounds(l,a+s,l+o,a))}},mapDivClick:function(e){var t=this.rectPxBounds.getCenterPixel(),i=e.xy.x-t.x,r=e.xy.y-t.y,n=this.rectPxBounds.top,s=this.rectPxBounds.left,o=Math.abs(this.rectPxBounds.getHeight()),a=this.rectPxBounds.getWidth(),l=Math.max(0,n+r);l=Math.min(l,this.ovmap.size.h-o);var p=Math.max(0,s+i);p=Math.min(p,this.ovmap.size.w-a),this.setRectPxBounds(new OpenLayers.Bounds(p,l+o,p+a,l)),this.updateMapToRect()},onButtonClick:function(e){e.buttonElement===this.minimizeDiv?this.minimizeControl():e.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(e){this.element.style.display="",document.getElementById("copyright")&&(document.getElementById("copyright").style.right="200px"),document.getElementById("scale")&&(document.getElementById("scale").style.right="200px"),document.getElementById("MousePosition")&&(document.getElementById("MousePosition").style.right="200px"),this.showToggle(!1),null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.element.style.display="none",document.getElementById("copyright")&&(document.getElementById("copyright").style.right="25px"),document.getElementById("scale")&&(document.getElementById("scale").style.right="25px"),document.getElementById("MousePosition")&&(document.getElementById("MousePosition").style.right="25px"),this.showToggle(!0),null!=e&&OpenLayers.Event.stop(e),this.active=!1},showToggle:function(e){this.maximizeDiv&&(this.maximizeDiv.style.display=e?"":"none"),this.minimizeDiv&&(this.minimizeDiv.style.display=e?"none":"")},update:function(){null==this.ovmap&&this.createMap(),!this.autoPan&&this.isSuitableOverview()||this.updateOverview(),this.updateRectToMap()},isSuitableOverview:function(){var e=this.map.getExtent(),t=this.map.getMaxExtent(),i=new OpenLayers.Bounds(Math.max(e.left,t.left),Math.max(e.bottom,t.bottom),Math.min(e.right,t.right),Math.min(e.top,t.top));this.ovmap.getProjection()!==this.map.getProjection()&&(i=i.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var r=this.ovmap.getResolution()/this.map.getResolution();return r>this.minRatio&&r<=this.maxRatio&&this.ovmap.getExtent().containsBounds(i)},updateOverview:function(){var e=this.map.getResolution(),t=this.ovmap.getResolution(),i=t/e;i>this.maxRatio?t=this.minRatio*e:i<=this.minRatio&&(t=this.maxRatio*e);var r;this.ovmap.getProjection()!==this.map.getProjection()?(r=this.map.center.clone(),r.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):r=this.map.center;var n=this.ovmap.getZoomForResolution(t*this.resolutionFactor);this.map.isValidZoomLevel(n)||(n="number"==typeof this.map.minZoom?this.map.minZoom:this.map.getZoom()),this.ovmap.setCenter(r,n),this.updateRectToMap()},createMap:function(){var e=OpenLayers.Util.extend({controls:[],fallThrough:!1,originCenter:this.map.originCenter,minZoom:this.map.minZoom,maxZoom:this.map.maxZoom},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,e);var t=new OpenLayers.Control.Navigation;t.zoomWheelEnabled=!1,this.ovmap.addControl(t),this.ovmap.viewPortDiv.appendChild(this.extentRectangle),OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy),this.ovmap.addLayers(this.layers),this.ovmap.zoomToMaxExtent(),this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")),this.wComp=this.wComp?this.wComp:2,this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")),this.hComp=this.hComp?this.hComp:2,this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap}),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap}),this.handlers.click.activate(),this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,(!0));var i=this;if(this.rectEvents.register("mouseover",this,function(e){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate(),i.active=!0}),this.rectEvents.register("mouseout",this,function(e){this.handlers.drag.dragging||this.handlers.drag.deactivate(),i.active=!1}),this.ovmap.getProjection()!==this.map.getProjection()){var r=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,n=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=r&&n?OpenLayers.INCHES_PER_UNIT[r]/OpenLayers.INCHES_PER_UNIT[n]:1}this.ovmap.events.register("mouseover",this.ovmap,function(e){i.active=!0}),this.ovmap.events.register("mouseout",this.ovmap,function(e){i.active=!1}),this.ovmap.events.register("moveend",this.ovmap,function(e){if(i.active){var t=e.object,r=t.getCenter(),n=i.map.getCenter();r.lon.toFixed(6)===n.lon.toFixed(6)&&r.lat.toFixed(6)===n.lat.toFixed(6)||i.map.setCenter(r)}})},updateRectToMap:function(){var e;e=this.ovmap.getProjection()!==this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();var t=this.getRectBoundsFromMapBounds(e);t&&this.setRectPxBounds(t)},updateMapToRect:function(){var e=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!==this.map.getProjection()&&(e=e.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(e.getCenterLonLat())},setRectPxBounds:function(e){var t=Math.max(e.top,0),i=Math.max(e.left,0),r=Math.min(e.top+Math.abs(e.getHeight()),this.ovmap.size.h-this.hComp),n=Math.min(e.left+e.getWidth(),this.ovmap.size.w-this.wComp),s=Math.max(n-i,0),o=Math.max(r-t,0);if(this.extentRectangle.style.display="",s<this.minRectSize||o<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var a=i+s/2-this.minRectSize/2,l=t+o/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(l)+"px",this.extentRectangle.style.left=Math.round(a)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"}else(o>=this.size.h||s+2>=this.size.w)&&(o=this.size.h/4,s=this.size.w/4,t=this.size.h/3,i=this.size.w/3,this.extentRectangle.style.display="none"),this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(t)+"px",this.extentRectangle.style.left=Math.round(i)+"px",this.extentRectangle.style.height=Math.round(o)+"px",this.extentRectangle.style.width=Math.round(s)+"px";this.rectPxBounds=new OpenLayers.Bounds(Math.round(i),Math.round(r),Math.round(n),Math.round(t))},getRectBoundsFromMapBounds:function(e){var t=this.getOverviewPxFromLonLat({lon:e.left,lat:e.bottom}),i=this.getOverviewPxFromLonLat({lon:e.right,lat:e.top}),r=null;return t&&i&&(r=new OpenLayers.Bounds(t.x,t.y,i.x,i.y)),r},getMapBoundsFromRectBounds:function(e){var t=this.getLonLatFromOverviewPx({x:e.left,y:e.bottom}),i=this.getLonLatFromOverviewPx({x:e.right,y:e.top});return new OpenLayers.Bounds(t.lon,t.lat,i.lon,i.lat)},getLonLatFromOverviewPx:function(e){
var t=this.ovmap.size,i=this.ovmap.getResolution(),r=this.ovmap.getExtent().getCenterLonLat(),n=e.x-t.w/2,s=e.y-t.h/2;return{lon:r.lon+n*i,lat:r.lat-s*i}},getOverviewPxFromLonLat:function(e){var t=this.ovmap.getResolution(),i=this.ovmap.getExtent();if(i)return{x:Math.round(1/t*(e.lon-i.left)),y:Math.round(1/t*(i.top-e.lat))}},CLASS_NAME:"OpenLayers.Control.OverviewMap"}),OpenLayers.Control.LTOverviewMap=OpenLayers.Class(OpenLayers.Control.OverviewMap,{initialize:function(e){e.size=new OpenLayers.Size(180,120),OpenLayers.Control.OverviewMap.prototype.initialize.apply(this,[e]),this.mapOptions=e},setOvMapCenter:function(){this.ovmap&&this.ovmap.setCenter(this.map.getExtent().getCenterLonLat())},updateMapToRect:function(){this.ovmap&&(OpenLayers.Control.OverviewMap.prototype.updateMapToRect.apply(this,arguments),this.ovmap.setCenter(this.map.getCenter()))},createMap:function(){OpenLayers.Control.OverviewMap.prototype.createMap.apply(this,arguments),this.ovmap.events.register("moveend",this,this.updateRectToMap),this.ovmap.events.register("zoomend",this,this.updateRectToMap)},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!(this.layers.length>0)){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var e=this.map.baseLayer.clone();this.layers=[e]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.mapDiv.appendChild(this.extentRectangle),this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var t=OpenLayers.Util.getImagesLocation(),i=t+"overup1.png",r=t+"overup2.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,new OpenLayers.Size(14,14),i,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton",this.maximizeDiv.title="CN"===NPMap.CULTURE?"打开鹰眼":"Open Overview Map",OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this)),OpenLayers.Event.observe(this.maximizeDiv,"mouseover",function(e){e.srcElement.src=r}),OpenLayers.Event.observe(this.maximizeDiv,"mouseout",function(e){e.srcElement.src=i}),this.div.appendChild(this.maximizeDiv);var n=t+"overdown1.png",s=t+"overdown2.png";this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,new OpenLayers.Size(14,14),n,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton",this.minimizeDiv.title="CN"===NPMap.CULTURE?"关闭鹰眼":"Close Overview Map",OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this)),OpenLayers.Event.observe(this.minimizeDiv,"mouseover",function(e){e.srcElement.src=s}),OpenLayers.Event.observe(this.minimizeDiv,"mouseout",function(e){e.srcElement.src=n}),this.div.appendChild(this.minimizeDiv);for(var o=["dblclick","mousedown"],a=0,l=o.length;a<l;a++)OpenLayers.Event.observe(this.maximizeDiv,o[a],OpenLayers.Event.stop),OpenLayers.Event.observe(this.minimizeDiv,o[a],OpenLayers.Event.stop);this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.register("moveend",this,this.update),this.map.events.register("zoomend",this,this.update),this.map.events.register("dragend",this,this.update),this.map.events.register("moveend",this,this.setOvMapCenter),this.map.events.register("zoomend",this,this.setOvMapCenter),this.map.events.register("dragend",this,this.setOvMapCenter),this.maximized&&this.maximizeControl(),this.div},CLASS_NAME:"OpenLayers.Control.LTOverviewMap"}),OpenLayers.Control.CopyRightControl=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,copyright:"东方网力",initialize:function(e,t){e&&(this.copyright=e),OpenLayers.Control.prototype.initialize.apply(this,[t])},destroy:function(){this.element&&this.element.parentNode===this.div&&(this.div.removeChild(this.element),this.element=null),this.map&&this.map.events.unregister("moveend",this,this.updateLink),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var t=0,i=this.map.controls.length;t<i;t++){var r=this.map.controls[t];if("OpenLayers.Control.ArgParser"===r.CLASS_NAME){r.displayProjection!==this.displayProjection&&(this.displayProjection=r.displayProjection);break}}t===this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("span"),this.element.innerHTML=OpenLayers.i18n(this.copyright),this.div.appendChild(this.element)),this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this}),this.updateLink(),this.div.style.bottom="0px",this.div.style.left="9px",document.getElementById("OpenLayers_Control_minimizeDiv")&&""===document.getElementById("OpenLayers_Control_minimizeDiv").style.display&&(this.div.style.right="200px"),this.div.id="copyright",this.div.unselectable="on",this.element.innerHTML=OpenLayers.i18n(this.copyright),this.div},updateLink:function(){},createParams:function(e,t,i){e=e||this.map.getCenter();var r=OpenLayers.Util.getParameters(this.base);if(e){r.zoom=t||this.map.getZoom();var n=e.lat,s=e.lon;if(this.displayProjection){var o=OpenLayers.Projection.transform({x:s,y:n},this.map.getProjectionObject(),this.displayProjection);s=o.x,n=o.y}r.lat=Math.round(1e5*n)/1e5,r.lon=Math.round(1e5*s)/1e5,i=i||this.map.layers,r.layers="";for(var a=0,l=i.length;a<l;a++){var p=i[a];p.isBaseLayer?r.layers+=p===this.map.baseLayer?"B":"0":r.layers+=p.getVisibility()?"T":"F"}}return r},CLASS_NAME:"OpenLayers.Control.CopyRightControl"}),OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){var e=this.observeElement||document;this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:e})},defaultKeyPress:function(e){var t,i=!0,r=OpenLayers.Event.element(e);if(!r||"INPUT"!==r.tagName&&"TEXTAREA"!==r.tagName&&"SELECT"!==r.tagName){switch(e.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:t=this.map.getSize(),this.map.pan(0,-.75*t.h);break;case 34:t=this.map.getSize(),this.map.pan(0,.75*t.h);break;case 35:t=this.map.getSize(),this.map.pan(.75*t.w,0);break;case 36:t=this.map.getSize(),this.map.pan(-.75*t.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:i=!1}i&&OpenLayers.Event.stop(e)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"}),OpenLayers.Control.NorthControl=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,copyright:"东方网力",initialize:function(e,t){e&&(this.copyright=e),OpenLayers.Control.prototype.initialize.apply(this,[t])},destroy:function(){this.element&&this.element.parentNode===this.div&&(this.div.removeChild(this.element),this.element=null),this.map&&this.map.events.unregister("moveend",this,this.updateLink),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var t=0,i=this.map.controls.length;t<i;t++){var r=this.map.controls[t];if("OpenLayers.Control.ArgParser"===r.CLASS_NAME){r.displayProjection!==this.displayProjection&&(this.displayProjection=r.displayProjection);break}}t===this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("img"),this.element.src=OpenLayers._getScriptLocation()+"img/north.png",this.div.appendChild(this.element)),this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this}),this.updateLink(),this.div.style.position="absolute",this.div.style.zIndex=1004,this.div.style.left="60px",this.div.style.top="15px",this.div},updateLink:function(){},createParams:function(e,t,i){e=e||this.map.getCenter();var r=OpenLayers.Util.getParameters(this.base);if(e){r.zoom=t||this.map.getZoom();var n=e.lat,s=e.lon;if(this.displayProjection){var o=OpenLayers.Projection.transform({x:s,y:n},this.map.getProjectionObject(),this.displayProjection);s=o.x,n=o.y}r.lat=Math.round(1e5*n)/1e5,r.lon=Math.round(1e5*s)/1e5,i=i||this.map.layers,r.layers="";for(var a=0,l=i.length;a<l;a++){var p=i[a];p.isBaseLayer?r.layers+=p===this.map.baseLayer?"B":"0":r.layers+=p.getVisibility()?"T":"F"}}return r},CLASS_NAME:"OpenLayers.Control.NorthControl"}),OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(e){e&&e.xy&&(OpenLayers.Control.PanZoom.X=e.xy.x,OpenLayers.Control.PanZoom.Y=e.xy.y),this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y),OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),this.removeButtons(),this.buttons=null,this.position=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments),e=this.position,this.buttons=[];var t={w:18,h:18},i=new OpenLayers.Pixel(e.x+t.w/2,e.y);return this._addButton("panup","north-mini.png",i,t,"CN"===NPMap.CULTURE?"向上平移":"Move Up"),e.y=i.y+t.h,this._addButton("panleft","west-mini.png",e,t,"CN"===NPMap.CULTURE?"向左平移":"Move Left"),this._addButton("panright","east-mini.png",e.add(t.w,0),t,"CN"===NPMap.CULTURE?"向右平移":"Move Right"),this._addButton("pandown","south-mini.png",i.add(0,2*t.h),t,"CN"===NPMap.CULTURE?"向下平移":"Move Down"),this._addButton("zoomin","zoom-plus-mini.png",i.add(0,3*t.h+5),t,"CN"===NPMap.CULTURE?"放大一级":"zoom In"),this._addButton("zoomworld","zoom-world-mini.png",i.add(0,4*t.h+5),t,"CN"===NPMap.CULTURE?"全图":"View All"),this._addButton("zoomout","zoom-minus-mini.png",i.add(0,5*t.h+5),t,"CN"===NPMap.CULTURE?"缩小一级":"Zoom Out"),this.div},_addButton:function(e,t,i,r,n){var s=OpenLayers.Util.getImageLocation(t),o=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+e,i,r,s,"absolute");return o.style.cursor="pointer",this.div.appendChild(o),o.action=e,o.className="olButton",n&&(o.title=n),this.buttons.push(o),o},_removeButton:function(e){this.div.removeChild(e),OpenLayers.Util.removeItem(this.buttons,e)},removeButtons:function(){for(var e=this.buttons.length-1;e>=0;--e)this._removeButton(this.buttons[e])},onButtonClick:function(e){var t=e.buttonElement;switch(t.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"),{isPan:!0});break;case"pandown":this.map.pan(0,this.getSlideFactor("h"),{isPan:!0});break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0,{isPan:!0});break;case"panright":this.map.pan(this.getSlideFactor("w"),0,{isPan:!0});break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":if(this.map.originCenter){var i=this.map.originCenter,r=new OpenLayers.LonLat(i[0],i[1]),n=void 0!==this.map.minZoom?this.map.minZoom:this.map.getZoom();this.map.setCenter(r),this.map.zoomTo(n)}else this.map.zoomToMaxExtent()}},getSlideFactor:function(e){return this.slideRatio?this.map.getSize()[e]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"}),OpenLayers.Control.PanZoom.X=4,OpenLayers.Control.PanZoom.Y=4,OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,backZoombar:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!0,panIcons:!0,forceFixedZoomLevel:!0,mouseDragStart:null,deltaY:null,zoomStart:null,slideRatio:.5,destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(e){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw()},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments),e=this.position.clone(),this.buttons=[];var t={w:18,h:18};if(this.panIcons){var i=t.w,r=new OpenLayers.Pixel(e.x+t.w,e.y),n={w:44,h:44};if(this._addButton("panground","panGround.png",r.add(-14,0),n),this._addButton("panup","north-mini-1.png",r.add(-1,0),t,"CN"===NPMap.CULTURE?"向上平移":"Move Up"),e.y=r.y+t.h,this._addButton("panleft","west-mini-1.png",e.add(i-14,-4),t,"CN"===NPMap.CULTURE?"向左平移":"Move Left"),this.zoomWorldIcon){var s={w:12,h:12};this._addButton("zoomworld","zoomworld.png",e.add(s.w+8,-2),s,"CN"===NPMap.CULTURE?"全图":"View All")}i*=2,this._addButton("panright","east-mini-1.png",e.add(i-6,-5),t,"CN"===NPMap.CULTURE?"向右平移":"Move Right"),this._addButton("pandown","south-mini-1.png",r.add(-1,2*t.h-10),t,"CN"===NPMap.CULTURE?"向下平移":"Move Down"),this._addButton("zoomin","zoom-plus-mini.png",r.add(-2,3*t.h-9),t,"CN"===NPMap.CULTURE?"放大一级":"Zoom In"),r=this._addZoomBar(r.add(0,4*t.h-9)),this._addButton("zoomout","zoom-minus-mini.png",r.add(-2,9),t,"CN"===NPMap.CULTURE?"缩小一级":"Zoom Out")}else this._addButton("zoomin","zoom-plus-mini.png",e,t),r=this._addZoomBar(e.add(0,t.h)),this._addButton("zoomout","zoom-minus-mini.png",r,t),this.zoomWorldIcon&&(r=r.add(0,t.h+3),this._addButton("zoomworld","zoom-world-mini.png",r,t));return this.moveZoomBar(),this.div},_addZoomBar:function(e){var t=OpenLayers.Util.getImageLocation("slider.png"),i=this.id+"_"+this.map.id,r=this.map.minZoom,n=this.map.maxZoom-r,s=n*this.zoomStopHeight;"safari"===OpenLayers.BROWSER_NAME&&(s-=4);var o=OpenLayers.Util.createAlphaImageDiv(i,e.add(-1,s),{w:20,h:9},t,"absolute"),a=OpenLayers.Util.getImageLocation("openhand.cur");o.style.cursor="url("+a+"), default",o.style.fontFamily="宋体",this.slider=o,this.sliderEvents=new OpenLayers.Events(this,o,null,(!0),{includeXY:!0}),this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var l={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.maxZoom+1-r)};t=OpenLayers.Util.getImageLocation("zoombar.png");var p;return OpenLayers.Util.alphaHack()?(i=this.id+"_"+this.map.id,p=OpenLayers.Util.createAlphaImageDiv(i,e,{w:l.w,h:this.zoomStopHeight},t,"absolute",null,"crop"),p.style.height=l.h+"px"):p=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,e,l,t),p.style.cursor="pointer",p.className="olButton",p.title="CN"===NPMap.CULTURE?"放置到此级别":"Adjust to this level",this.zoombarDiv=p,this.div.appendChild(p),this.startTop=e.y,this.div.appendChild(o),this.map.events.register("zoomend",this,this.moveZoomBar),e=e.add(0,this.zoomStopHeight*(this.map.maxZoom-r))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider),this.slider=null,this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(e){if(OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments),e.buttonElement===this.zoombarDiv){var t=e.buttonXY.y/this.zoomStopHeight;!this.forceFixedZoomLevel&&this.map.fractionalZoom||(t=Math.floor(t));var i=this.map.maxZoom-t;i=Math.min(Math.max(i,0),this.map.maxZoom),this.map.zoomTo(i)}},passEventToSlider:function(e){this.sliderEvents.handleBrowserEvent(e)},mapMouseout:function(e){if(!this.map.div.contains(e.toElement)&&this.mouseDragStart){this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,mouseout:this.mapMouseout,scope:this});var t=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(t+=this.deltaY/this.zoomStopHeight,t=Math.min(Math.max(t,0),this.map.maxZoom)):(t+=this.deltaY/this.zoomStopHeight,t=Math.max(Math.round(t),0)),t>this.map.maxZoom?this.map.zoomTo(this.map.maxZoom):t<this.map.minZoom?this.map.zoomTo(this.map.minZoom):this.map.zoomTo(t),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(e)}},zoomBarDown:function(e){if(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e)){this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,mouseout:this.mapMouseout,scope:this}),this.mouseDragStart=e.xy.clone(),this.zoomStart=e.xy.clone();var t=OpenLayers.Util.getImageLocation("closedhand.cur");this.slider.style.cursor="url("+t+"), move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(e)}},zoomBarDrag:function(e){if(null!=this.mouseDragStart){var t=this.mouseDragStart.y-e.xy.y,i=OpenLayers.Util.pagePosition(this.zoombarDiv);if(e.clientY-i[1]>0&&e.clientY-i[1]<parseInt(this.zoombarDiv.style.height)-2){var r=parseInt(this.slider.style.top)-t;r<this.startTop&&(r=this.startTop);var n=this.map.maxZoom;this.map.minZoom&&(n-=this.map.minZoom);var s=this.startTop+n*this.zoomStopHeight;r>s&&(r=s),this.slider.style.top=r+"px",this.mouseDragStart=e.xy.clone()}this.deltaY=this.zoomStart.y-e.xy.y,OpenLayers.Event.stop(e)}},zoomBarUp:function(e){if((OpenLayers.Event.isLeftClick(e)||"touchend"===e.type)&&this.mouseDragStart){var t=OpenLayers.Util.getImageLocation("openhand.cur");this.slider.style.cursor="url("+t+"), default",this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,mouseout:this.mapMouseout,scope:this});var i=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(i+=this.deltaY/this.zoomStopHeight,i=Math.min(Math.max(i,0),this.map.maxZoom)):(i+=this.deltaY/this.zoomStopHeight,i=Math.max(Math.round(i),0)),i>this.map.maxZoom?this.map.zoomTo(this.map.maxZoom):i<this.map.minZoom?this.map.zoomTo(this.map.minZoom):this.map.zoomTo(i),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(e)}},moveZoomBar:function(){var e=(this.map.maxZoom-this.map.getZoom())*this.zoomStopHeight+this.startTop;this.map.maxZoom===this.map.getZoom()&&(e=this.startTop),this.slider.style.top=e+"px","CN"===NPMap.CULTURE?this.slider.title="当前"+this.map.getZoom()+"级":this.slider.title="Current Level:"+this.map.getZoom()},CLASS_NAME:"OpenLayers.Control.PanZoomBar"}),OpenLayers.Control.NPanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,backZoombar:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!0,panIcons:!0,forceFixedZoomLevel:!0,mouseDragStart:null,deltaY:null,zoomStart:null,slideRatio:.5,zoombar_1_div:null,destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(e){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw(),this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments),e=this.position.clone(),this.buttons=[];var t={w:16,h:16};if(this.panIcons){var i=t.w,r=new OpenLayers.Pixel(e.x+t.w,e.y),n={w:48,h:48};this._addButton("panground","navigator/panGround.png",r.add(-17,-4),n);var s=this._addButton("panup","navigator/north-mini.png",r.add(-1,-1),t,"CN"===NPMap.CULTURE?"向上平移":"Move Up");this.panup_event=new OpenLayers.Events(s,s,null,(!0),{includeXY:!0}),this.panup_event.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/north-mini-1.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/north-mini.png")}}),e.y=r.y+t.h;var o=this._addButton("panleft","navigator/west-mini.png",e.add(i-14,-4),t,"CN"===NPMap.CULTURE?"向左平移":"Move Left");if(this.zoomWorldIcon){var a={w:12,h:12},l=this._addButton("zoomworld","navigator/zoomworld.png",e.add(a.w+5,-2),a,"CN"===NPMap.CULTURE?"全图":"View All");"msie"===OpenLayers.BROWSER_NAME,this.zoomworld_event=new OpenLayers.Events(l,l,null,(!0),{includeXY:!0}),this.zoomworld_event.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoomworld-hover.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoomworld.png")}})}this.panleft_event=new OpenLayers.Events(o,o,null,(!0),{includeXY:!0}),this.panleft_event.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/west-mini-1.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/west-mini.png")}}),i*=2;var p=this._addButton("panright","navigator/east-mini.png",e.add(i-5,-4),t,"CN"===NPMap.CULTURE?"向右平移":"Move Right");this.panright_event=new OpenLayers.Events(p,p,null,(!0),{includeXY:!0}),this.panright_event.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/east-mini-1.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/east-mini.png")}});var h=this._addButton("pandown","navigator/south-mini.png",r.add(-1,2*t.h-8),t,"CN"===NPMap.CULTURE?"向下平移":"Move Down");this.pandown_event=new OpenLayers.Events(h,h,null,(!0),{includeXY:!0}),this.pandown_event.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/south-mini-1.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/south-mini.png")}});var u=this._addButton("zoomin","navigator/zoom-plus-mini.png",r.add(-6,3*t.h),{h:24,w:24},"CN"===NPMap.CULTURE?"放大一级":"Zoom In");this.zoom_plus_mini_event=new OpenLayers.Events(u,u,null,(!0),{includeXY:!0}),this.zoom_plus_mini_event.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoom-plus-mini-hover.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoom-plus-mini.png")}}),r=this._addZoomBar(r.add(0,4*t.h+7));var y=this._addButton("zoomout","navigator/zoom-minus-mini.png",r.add(-6,5),{h:24,w:24},"CN"===NPMap.CULTURE?"缩小一级":"Zoom Out");this.zoom_minus_mini_event=new OpenLayers.Events(y,y,null,(!0),{includeXY:!0}),this.zoom_minus_mini_event.on({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoom-minus-mini-hover.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoom-minus-mini.png")}})}else this._addButton("zoomin","navigator/zoom-plus-mini.png",e,t),r=this._addZoomBar(e.add(0,t.h)),this._addButton("zoomout","navigator/zoom-minus-mini.png",r,t),this.zoomWorldIcon&&(r=r.add(0,t.h+3),this._addButton("zoomworld","navigator/zoom-world-mini.png",r,t));return this.moveZoomBar(),this.div},_addZoomBar:function(e){var t=OpenLayers.Util.getImageLocation("navigator/slider.png"),i=this.id+"_"+this.map.id,r=this.map.minZoom,n=this.map.maxZoom-r,s=n*this.zoomStopHeight;"safari"===OpenLayers.BROWSER_NAME&&(s-=4);var o=OpenLayers.Util.createAlphaImageDiv(i,e.add(-6,s),{w:24,h:12},t,"absolute"),a=OpenLayers.Util.getImageLocation("openhand.cur");o.style.cursor="url("+a+"), default",o.style.fontFamily="宋体",this.slider=o,this.sliderEvents=new OpenLayers.Events(this,o,null,(!0),{includeXY:!0}),this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,mouseout:function(e){this.slider.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/slider.png")},mouseover:function(){this.slider.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/slider-hover.png")}});var l={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.maxZoom+1-r)};t=OpenLayers.Util.getImageLocation("navigator/zoombar.png");var p,h=OpenLayers.Util.getImageLocation("navigator/zoombar-1.png");return this.zoombar_1_div=null,OpenLayers.Util.alphaHack()?(i=this.id+"_"+this.map.id,p=OpenLayers.Util.createAlphaImageDiv(i,e.add(0,16),{w:l.w,h:this.zoomStopHeight},t,"absolute",null,"crop"),p.style.height=l.h+"px"):(p=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,e.add(-3,0),l,t),this.zoombar_1_div=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar_1"+this.map.id,e.add(-3,0),{w:l.w,h:l.h-2},h)),p.style.cursor="pointer",p.className="olButton",p.title="CN"===NPMap.CULTURE?"放置到此级别":"Adjust to this level",this.zoombar_1_div.style.overflow="hidden",this.zoombarDiv=p,this.div.appendChild(p),this.div.appendChild(this.zoombar_1_div),this.startTop=e.y-2,this.div.appendChild(o),this.map.events.register("zoomend",this,this.moveZoomBar),e=e.add(0,this.zoomStopHeight*(this.map.maxZoom-r))},_removeZoomBar:function(){for(this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,mouseout:function(e){this.slider.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/slider.png")},mouseover:function(){this.slider.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/slider-hover.png")}}),this.sliderEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider);this.div.hasChildNodes();){var e=this.div.firstChild;this.div.removeChild(e),e=null}this.slider=null,this.panup_event&&(this.panup_event.un({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/north-mini-1.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/north-mini.png")}}),this.panup_event.destroy()),this.pandown_event&&(this.pandown_event.un({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/south-mini-1.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/south-mini.png")}}),this.pandown_event.destroy()),this.panleft_event&&(this.panleft_event.un({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/west-mini-1.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/west-mini.png")}}),this.panleft_event.destroy()),this.panright_event&&(this.panright_event.un({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/east-mini-1.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/east-mini.png")}}),this.panright_event.destroy()),this.zoom_plus_mini_event&&(this.zoom_plus_mini_event.un({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoom-plus-mini-hover.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoom-plus-mini.png")}}),this.zoom_plus_mini_event.destroy()),this.zoom_minus_mini_event&&(this.zoom_minus_mini_event.un({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoom-minus-mini-hover.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoom-minus-mini.png")}}),this.zoom_minus_mini_event.destroy()),this.zoomworld_event&&(this.zoomworld_event.un({mouseover:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoomworld-hover.png")},mouseout:function(){this.childNodes[0].src=OpenLayers.Util.getImageLocation("navigator/zoomworld.png")}}),this.zoomworld_event.destroy()),this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(e){if(OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments),e.buttonElement===this.zoombarDiv){var t=e.buttonXY.y/this.zoomStopHeight;!this.forceFixedZoomLevel&&this.map.fractionalZoom||(t=Math.floor(t));var i=this.map.maxZoom-t;i=Math.min(Math.max(i,0),this.map.maxZoom),this.map.zoomTo(i)}},passEventToSlider:function(e){this.sliderEvents.handleBrowserEvent(e)},mapMouseout:function(e){if(!this.map.div.contains(e.toElement)&&this.mouseDragStart){this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,mouseout:this.mapMouseout,scope:this});var t=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(t+=this.deltaY/this.zoomStopHeight,t=Math.min(Math.max(t,0),this.map.maxZoom)):(t+=this.deltaY/this.zoomStopHeight,t=Math.max(Math.round(t),0)),t>this.map.maxZoom?this.map.zoomTo(this.map.maxZoom):t<this.map.minZoom?this.map.zoomTo(this.map.minZoom):this.map.zoomTo(t),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(e)}},zoomBarDown:function(e){if(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e)){this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,mouseout:this.mapMouseout,scope:this}),this.mouseDragStart=e.xy.clone(),this.zoomStart=e.xy.clone();var t=OpenLayers.Util.getImageLocation("closedhand.cur");this.slider.style.cursor="url("+t+"), move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(e)}},zoomBarDrag:function(e){if(null!=this.mouseDragStart){var t=this.mouseDragStart.y-e.xy.y,i=OpenLayers.Util.pagePosition(this.zoombarDiv);if(e.clientY-i[1]>0&&e.clientY-i[1]<parseInt(this.zoombarDiv.style.height)-2){var r=parseInt(this.slider.style.top)-t;r<this.startTop&&(r=this.startTop);var n=this.map.maxZoom;this.map.minZoom&&(n-=this.map.minZoom);var s=this.startTop+n*this.zoomStopHeight;r>s&&(r=s),this.slider.style.top=r+"px",this.mouseDragStart=e.xy.clone()}this.deltaY=this.zoomStart.y-e.xy.y,OpenLayers.Event.stop(e)}},zoomBarUp:function(e){if((OpenLayers.Event.isLeftClick(e)||"touchend"===e.type)&&this.mouseDragStart){var t=OpenLayers.Util.getImageLocation("openhand.cur");this.slider.style.cursor="url("+t+"), default",this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,mouseout:this.mapMouseout,scope:this});var i=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(i+=this.deltaY/this.zoomStopHeight,i=Math.min(Math.max(i,0),this.map.maxZoom)):(i+=this.deltaY/this.zoomStopHeight,i=Math.max(Math.round(i),0)),
i>this.map.maxZoom?this.map.zoomTo(this.map.maxZoom):i<this.map.minZoom?this.map.zoomTo(this.map.minZoom):this.map.zoomTo(i),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(e)}},moveZoomBar:function(){var e=(this.map.maxZoom-this.map.getZoom())*this.zoomStopHeight+this.startTop;this.map.maxZoom===this.map.getZoom()&&(e=this.startTop),this.slider.style.top=e+"px",this.zoombar_1_div.style.top=e+"px";var t=this.map.maxZoom-this.map.minZoom,i=77+OpenLayers.Control.PanZoom.Y,r=this.zoomStopHeight*t+i-e;r=r>0?r:0,this.zoombar_1_div.style.height=r+"px","CN"===NPMap.CULTURE?this.slider.title="当前"+this.map.getZoom()+"级":this.slider.title="Current Level:"+this.map.getZoom()},CLASS_NAME:"OpenLayers.Control.NPanZoomBar"}),OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.element=OpenLayers.Util.getElement(e)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element)),this.map.events.register("moveend",this,this.updateScale),this.updateScale(),this.div.id="scale",this.div.style.bottom="42px",this.div.style.right="5px",document.getElementById("OpenLayers_Control_minimizeDiv")&&""===document.getElementById("OpenLayers_Control_minimizeDiv").style.display&&(this.div.style.right="200px"),this.div},updateScale:function(){var e;if(this.geodesic===!0){var t=this.map.getUnits();if(!t)return;var i=OpenLayers.INCHES_PER_UNIT;e=(this.map.getGeodesicPixelSize().w||1e-6)*i.km*OpenLayers.DOTS_PER_INCH}else e=this.map.getScale();e&&(e=e>=9500&&e<=95e4?Math.round(e/1e3)+"K":e>=95e4?Math.round(e/1e6)+"M":Math.round(e),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:e}))},CLASS_NAME:"OpenLayers.Control.Scale"}),OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.eTop||(this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top",this.div.appendChild(this.eTop),""===this.topOutUnits||""===this.topInUnits?this.eTop.style.visibility="hidden":this.eTop.style.visibility="visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),""===this.bottomOutUnits||""===this.bottomInUnits?this.eBottom.style.visibility="hidden":this.eBottom.style.visibility="visible"),this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(e){var t,i=parseInt(Math.log(e)/Math.log(10)),r=Math.pow(10,i),n=parseInt(e/r);return t=n>5?5:n>2?2:1,t*r},update:function(){var e=this.map.getResolution();if(e){var t=this.map.getUnits(),i=OpenLayers.INCHES_PER_UNIT,r=this.maxWidth*e*i[t],n=1;if(this.geodesic===!0){var s=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,o=r/i.km;n=s/o,r*=n}var a,l;r>1e5?(a=this.topOutUnits,l=this.bottomOutUnits):(a=this.topInUnits,l=this.bottomInUnits);var p=r/i[a],h=r/i[l],u=this.getBarLen(p),y=this.getBarLen(h);p=u/i[t]*i[a],h=y/i[t]*i[l];var c=p/e/n,d=h/e/n;if("visible"===this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(d)+"px",this.eBottom.innerHTML=y+" "+l),"visible"===this.eTop.style.visibility){this.eTop.style.width=Math.round(c)+"px";var m=a;"CN"===NPMap.CULTURE&&"km"===m&&(m="公里"),"CN"===NPMap.CULTURE&&"m"===m&&(m="米"),this.eTop.innerHTML=u+" "+m}}},CLASS_NAME:"OpenLayers.Control.ScaleLine"}),OpenLayers.Control.SelectFeatureClick=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,mousedown:function(){},mouseup:function(){},dblclick:function(){},mousemove:function(){},onRightSelect:function(){},initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),null===this.scope&&(this.scope=this),this.initLayer(e);var i={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(i.over=this.overFeature,i.out=this.outFeature),i.mousedown=this.mousedown,i.mouseup=this.mouseup,i.dblclick=this.dblclick,i.mousemove=this.mousemove,i.contextmenu=this.onRightSelect,this.callbacks=OpenLayers.Util.extend(i,this.callbacks);var r=new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes});r.EVENTMAP.mouseup["in"]="mouseup",r.EVENTMAP.mousedown["in"]="mousedown",this.handlers={feature:r},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeatureClick"}))},initLayer:function(e){OpenLayers.Util.isArray(e)?(this.layers=e,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:e})):this.layer=e},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(e){var t,i,r,n,s=this.layers||[this.layer];for(r=0;r<s.length;++r)if(t=s[r],n=0,null!=t.selectedFeatures)for(;t.selectedFeatures.length>n;)i=t.selectedFeatures[n],e&&e.except===i?++n:this.unselect(i)},clickFeature:function(e,t){if(!this.hover){var i=OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)>-1;i?this.toggleSelect()?this.unselect(e):this.multipleSelect()||this.unselectAll({except:e}):(this.multipleSelect()||this.unselectAll({except:e}),this.select(e,t))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(e){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(e){var t=e.layer;this.hover&&(this.highlightOnly?this.highlight(e):OpenLayers.Util.indexOf(t.selectedFeatures,e)===-1&&this.select(e))},outFeature:function(e){if(this.hover)if(this.highlightOnly){if(e._lastHighlighter===this.id)if(e._prevHighlighter&&e._prevHighlighter!==this.id){delete e._lastHighlighter;var t=this.map.getControl(e._prevHighlighter);t&&t.highlight(e)}else this.unhighlight(e)}else this.unselect(e)},highlight:function(e){var t=e.layer,i=this.events.triggerEvent("beforefeaturehighlighted",{feature:e});if(i!==!1){e._prevHighlighter=e._lastHighlighter,e._lastHighlighter=this.id;var r=this.selectStyle||this.renderIntent;t.drawFeature(e,r),this.events.triggerEvent("featurehighlighted",{feature:e})}},unhighlight:function(e){var t=e.layer;void 0===e._prevHighlighter?delete e._lastHighlighter:e._prevHighlighter===this.id?delete e._prevHighlighter:(e._lastHighlighter=e._prevHighlighter,delete e._prevHighlighter),t.drawFeature(e,e.style||e.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:e})},select:function(e,t){var i=this.onBeforeSelect.call(this.scope,e),r=e.layer;if(i!==!1&&(i=r.events.triggerEvent("beforefeatureselected",{feature:e}),i!==!1))switch(r.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=r.selectedFeatures[0]),r.events.triggerEvent("featureselected",{feature:e}),t){case"contextmenu":this.onRightSelect.call(this.scope,e);break;case"click":default:this.onSelect.call(this.scope,e)}},unselect:function(e){var t=e.layer;this.unhighlight(e),OpenLayers.Util.removeItem(t.selectedFeatures,e),t.events.triggerEvent("featureunselected",{feature:e}),this.onUnselect.call(this.scope,e)},selectBox:function(e){if(e instanceof OpenLayers.Bounds){var t=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),i=this.map.getLonLatFromPixel({x:e.right,y:e.top}),r=new OpenLayers.Bounds(t.lon,t.lat,i.lon,i.lat);this.multipleSelect()||this.unselectAll();var n=this.multiple;this.multiple=!0;var s=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:s});for(var o,a=0;a<s.length;++a){o=s[a];for(var l=0,p=o.features.length;l<p;++l){var h=o.features[l];h.getVisibility()&&(null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,h.geometry.CLASS_NAME)>-1)&&r.toGeometry().intersects(h.geometry)&&OpenLayers.Util.indexOf(o.selectedFeatures,h)===-1&&this.select(h)}}this.multiple=n,this.events.triggerEvent("boxselectionend",{layers:s})}},setMap:function(e){this.handlers.feature.setMap(e),this.box&&this.handlers.box.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(e){var t=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(e),this.handlers.feature.layer=this.layer,t&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeatureClick"}),OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.options=e||{},this.options.layer&&this.setLayer(this.options.layer);var t=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(t,this.DEFAULTS),this.setTargets(this.options.targets),0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer),this.geoToleranceCache={}},setLayer:function(e){this.active?(this.deactivate(),this.layer=e,this.activate()):this.layer=e},setTargets:function(e){if(this.targets=[],e&&e.length)for(var t,i=0,r=e.length;i<r;++i)t=e[i],t instanceof OpenLayers.Layer.Vector?this.addTargetLayer(t):this.addTarget(t)},addTargetLayer:function(e){this.addTarget({layer:e})},addTarget:function(e){e=OpenLayers.Util.applyDefaults(e,this.defaults),e.nodeTolerance=e.nodeTolerance||e.tolerance,e.vertexTolerance=e.vertexTolerance||e.tolerance,e.edgeTolerance=e.edgeTolerance||e.tolerance,this.targets.push(e)},removeTargetLayer:function(e){for(var t,i=this.targets.length-1;i>=0;--i)t=this.targets[i],t.layer===e&&this.removeTarget(t)},removeTarget:function(e){return OpenLayers.Util.removeItem(this.targets,e)},activate:function(){var e=OpenLayers.Control.prototype.activate.call(this);return e&&this.layer&&this.layer.events&&this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.call(this);return e&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),this.feature=null,this.point=null,e},onSketchModified:function(e){this.feature=e.feature,this.considerSnapping(e.vertex,e.vertex)},onVertexModified:function(e){this.feature=e.feature;var t=this.layer.map.getLonLatFromViewPortPx(e.pixel);this.considerSnapping(e.vertex,new OpenLayers.Geometry.Point(t.lon,t.lat))},considerSnapping:function(e,t){for(var i,r,n={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},s=!1,o=0,a=this.targets.length;o<a;++o)if(r=this.targets[o],i=this.testTarget(r,t)){if(this.greedy){n=i,n.target=r,s=!0;break}(i.rank<n.rank||i.rank===n.rank&&i.dist<n.dist)&&(n=i,n.target=r,s=!0)}if(s){var l=this.events.triggerEvent("beforesnap",{point:e,x:n.x,y:n.y,distance:n.dist,layer:n.target.layer,snapType:this.precedence[n.rank]});l!==!1?(e.x=n.x,e.y=n.y,this.point=e,this.events.triggerEvent("snap",{point:e,snapType:this.precedence[n.rank],layer:n.target.layer,distance:n.dist})):s=!1}this.point&&!s&&(e.x=t.x,e.y=t.y,this.point=null,this.events.triggerEvent("unsnap",{point:e}))},testTarget:function(e,t){var i=this.layer.map.getResolution();if("minResolution"in e&&i<e.minResolution)return null;if("maxResolution"in e&&i>=e.maxResolution)return null;for(var r,n,s,o,a,l,p,h={node:this.getGeoTolerance(e.nodeTolerance,i),vertex:this.getGeoTolerance(e.vertexTolerance,i),edge:this.getGeoTolerance(e.edgeTolerance,i)},u=Math.max(h.node,h.vertex,h.edge),y={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},c=!1,d=e.layer.features,m=this.precedence.length,f=new OpenLayers.LonLat(t.x,t.y),g=0,L=d.length;g<L;++g)if(r=d[g],r!==this.feature&&!r._sketch&&r.state!==OpenLayers.State.DELETE&&(!e.filter||e.filter.evaluate(r))&&r.atPoint(f,u,u))for(var v=0,O=Math.min(y.rank+1,m);v<O;++v)if(n=this.precedence[v],e[n])if("edge"===n){if(a=r.geometry.distanceTo(t,{details:!0}),l=a.distance,l<=h[n]&&l<y.dist){y={rank:v,dist:l,x:a.x0,y:a.y0},c=!0;break}}else{s=r.geometry.getVertices("node"===n),p=!1;for(var P=0,b=s.length;P<b;++P)o=s[P],l=o.distanceTo(t),l<=h[n]&&(v<y.rank||v===y.rank&&l<y.dist)&&(y={rank:v,dist:l,x:o.x,y:o.y},c=!0,p=!0);if(p)break}return c?y:null},getGeoTolerance:function(e,t){t!==this.resolution&&(this.resolution=t,this.geoToleranceCache={});var i=this.geoToleranceCache[e];return void 0===i&&(i=e*t,this.geoToleranceCache[e]=i),i},destroy:function(){this.active&&this.deactivate(),delete this.layer,delete this.targets,OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"}),OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(e,t,i){OpenLayers.Control.prototype.initialize.apply(this,[i]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(e,t){this.layer.events.triggerEvent("sketchmodified",{vertex:e,feature:t})},create:function(e,t){this.layer.events.triggerEvent("sketchstarted",{vertex:e,feature:t})}},this.callbacks),this.layer=e,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:e.renderers,rendererOptions:e.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);var r=this.layer.styleMap&&this.layer.styleMap.styles.temporary;r&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":r})})),this.handler=new t(this,this.callbacks,this.handlerOptions)},drawFeature:function(e){if(!e)return void this.events.triggerEvent("featureadded",{feature:null});var t=new OpenLayers.Feature.Vector(e),i=this.layer.events.triggerEvent("sketchcomplete",{feature:t});i!==!1&&(t.state=OpenLayers.State.INSERT,this.layer.addFeatures([t]),this.featureAdded(t),this.events.triggerEvent("featureadded",{feature:t}))},insertXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertXY(e,t)},insertDeltaXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeltaXY(e,t)},insertDirectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDirectionLength(e,t)},insertDeflectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(e,t)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(e,t){},onDrag:function(e,t){},onComplete:function(e,t){},onEnter:function(e){},onLeave:function(e){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.layer=e,this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(e){this.handlers.feature.touch&&!this.over&&this.overFeature(e)&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(e){this.handlers.feature.touch&&this.over&&(this.outFeature(e),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.handlers.drag.deactivate(),this.handlers.feature.deactivate(),this.feature=null,this.dragging=!1,this.lastPixel=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(e){var t=!1;return this.handlers.drag.dragging?this.feature.id===e.id?this.over=!0:this.over=!1:(this.feature=e,this.handlers.drag.activate(),t=!0,this.over=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(e)),t},downFeature:function(e){this.lastPixel=e,this.onStart(this.feature,e)},moveFeature:function(e){var t=this.map.getResolution();this.feature.geometry.move(t*(e.x-this.lastPixel.x),t*(this.lastPixel.y-e.y)),this.layer.drawFeature(this.feature),this.lastPixel=e,this.onDrag(this.feature,e)},upFeature:function(e){this.over||this.handlers.drag.deactivate()},doneDragging:function(e){this.onComplete(this.feature,e)},outFeature:function(e){this.handlers.drag.dragging?this.feature.id===e.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(e),this.feature=null)},cancel:function(){this.handlers.drag.deactivate(),this.over=!1},setMap:function(e){this.handlers.drag.setMap(e),this.handlers.feature.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,controlActivate:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},defaultStyle:null,initialize:function(e,t){t=t||{},this.layer=e,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,t.vertexRenderIntent)),this.defaultStyle=this.layer.styleMap.styles["default"].defaultStyle,this.defaultStyle.fillColor="red",this.defaultStyle.fillOpacity=.9,this.virtualStyle.fillOpacity=.7,this.virtualStyle.strokeOpacity=.3,this.virtualStyle.graphicZIndex=1e6,this.virtualStyle.fillColor="red",this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[t]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var i={down:function(e){this.vertex=null;var t=this.layer.getFeatureFromEvent(this.handlers.drag.evt);t?this.dragStart(t):this.clickout&&(this._unselect=this.feature)},move:function(e){delete this._unselect,this.vertex&&this.dragVertex(this.vertex,e)},up:function(){this.handlers.drag.stopDown=!1,this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(e){this.vertex&&this.dragComplete(this.vertex)}},r={documentDrag:this.documentDrag,stopDown:!1},n={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,n),drag:new OpenLayers.Handler.Drag(this,i,r)}},destroy:function(){this.map&&this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.controlActivate||(this.moveLayerToTop(),this.controlActivate=!0),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.handlers.keyboard.activate()&&this.handlers.drag.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var e=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.controlActivate&&(this.moveLayerBack(),this.controlActivate=!1),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate();var t=this.feature;t&&t.geometry&&t.layer&&this.unselectFeature(t),e=!0}return e},beforeSelectFeature:function(e){if(!e.data||e.data.isEnableEdit){var t="OpenLayers.Geometry.Point"===e.geometry.CLASS_NAME;return!t||this.layer.events.triggerEvent("beforefeaturemodified",{feature:e})}return!1},selectFeature:function(e){if(!(this.feature===e||this.geometryTypes&&OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)===-1)){this.beforeSelectFeature(e)!==!1&&(this.feature&&this.unselectFeature(this.feature),this.feature=e,this.layer.selectedFeatures.push(e),this.layer.drawFeature(e,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var t=e.modified;!e.geometry||t&&t.geometry||(this._originalGeometry=e.geometry.clone())}},unselectFeature:function(e){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle);var t=!0;e.data&&(e.data._apiObj&&null==e.data._apiObj.layer||null==e.data._apiObj)&&(t=!1),t&&this.layer.drawFeature(e,"select"),this.feature=null,OpenLayers.Util.removeItem(this.layer.selectedFeatures,e),this.onModificationEnd(e),this.layer.events.triggerEvent("afterfeaturemodified",{feature:e,modified:this.modified}),this.modified=!1},dragStart:function(e){if(!e.data||"boolean"!=typeof e.data.isEnableEdit||e.data.isEnableEdit){var t="OpenLayers.Geometry.Point"===e.geometry.CLASS_NAME;this.standalone||(e._sketch||!t)&&e._sketch||(this.toggle&&this.feature===e&&(this._unselect=e),this.selectFeature(e)),(e._sketch||t)&&(this.vertex=e,this.handlers.drag.stopDown=!0,this.layer.events.triggerEvent("beforefeaturemodified",{feature:this.feature}))}},changeRectangleVectexs:function(e){for(var t=this.vertices.length-1;t>=0;t--)this.vertices[t].geometry.clearBounds();switch(e._recIndex){case 1:this.vertices[1].geometry.x=e.geometry.x,this.vertices[3].geometry.y=e.geometry.y,this.layer.drawFeature(this.vertices[1]),this.layer.drawFeature(this.vertices[3]);break;case 2:this.vertices[0].geometry.x=e.geometry.x,this.vertices[2].geometry.y=e.geometry.y,this.layer.drawFeature(this.vertices[0]),this.layer.drawFeature(this.vertices[2]);break;case 3:this.vertices[3].geometry.x=e.geometry.x,this.vertices[1].geometry.y=e.geometry.y,this.layer.drawFeature(this.vertices[3]),this.layer.drawFeature(this.vertices[1]);break;case 4:this.vertices[2].geometry.x=e.geometry.x,this.vertices[0].geometry.y=e.geometry.y,this.layer.drawFeature(this.vertices[2]),this.layer.drawFeature(this.vertices[0])}if(this.dragHandle){var i=this.feature.geometry,r=i.getBounds().getCenterLonLat();this.dragHandle.geometry.x=r.lon,this.dragHandle.geometry.y=r.lat,this.layer.drawFeature(this.dragHandle)}},changeRectangleBounds:function(e){for(var t=this.vertices.length-1;t>=0;t--)this.vertices[t].geometry.clearBounds();for(var i=this.virtualVertices.length-1;i>=0;i--)this.virtualVertices[i].geometry.clearBounds();var r=e._recBoundindex-1,n=e._recBoundindex;4===n&&(n=0);var s=e._recBoundindex-2;s===-1?s=3:s===-2&&(s=2);var o=n;e._recBoundindex%2===1?(this.vertices[r].geometry.x=e.geometry.x,this.vertices[n].geometry.x=e.geometry.x):(this.vertices[r].geometry.y=e.geometry.y,this.vertices[n].geometry.y=e.geometry.y),this.layer.drawFeature(this.vertices[r]),this.layer.drawFeature(this.vertices[n]);var a=this.feature.geometry,l=a.getBounds().getCenterLonLat();this.dragHandle&&(this.dragHandle.geometry.x=l.lon,this.dragHandle.geometry.y=l.lat,this.layer.drawFeature(this.dragHandle)),e._recBoundindex%2===1?(this.virtualVertices[s].geometry.x=l.lon,this.virtualVertices[o].geometry.x=l.lon):(this.virtualVertices[s].geometry.y=l.lat,this.virtualVertices[o].geometry.y=l.lat),this.layer.drawFeature(this.virtualVertices[s]),this.layer.drawFeature(this.virtualVertices[o])},dragVertex:function(e,t){var i=this.map.getLonLatFromViewPortPx(t),r=e.geometry;e._recBoundindex?e._recBoundindex%2===1?r.move(i.lon-r.x,0):r.move(0,i.lat-r.y):r.move(i.lon-r.x,i.lat-r.y),e._recIndex&&this.changeRectangleVectexs(e),this.modified=!0,"OpenLayers.Geometry.Point"===this.feature.geometry.CLASS_NAME?(this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t}),this.layer.events.triggerEvent("draging",{vertex:e,position:i})):(e._index?(e.geometry.parent.addComponent(e.geometry,e._index),delete e._index,OpenLayers.Util.removeItem(this.virtualVertices,e),this.vertices.push(e)):e===this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):e._recBoundindex?this.changeRectangleBounds(e):e!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t}),!e._recBoundindex&&this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:"select")),this.layer.drawFeature(e)},dragComplete:function(e){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature&&this.feature.state&&this.feature.state!==OpenLayers.State.INSERT&&this.feature.state!==OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var e=this.feature;e.modified=OpenLayers.Util.extend(e.modified,{geometry:this._originalGeometry}),delete this._originalGeometry}},resetVertices:function(){this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!==this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESHAPE)&&(this.feature.data&&"NPMapLib.Geometry.Circle"===this.feature.data.CLASS_NAME?this.collectCircleRadiusHandle():this.collectRadiusHandle()),this.mode&OpenLayers.Control.ModifyFeature.RESIZE&&this.feature.data&&"NPMapLib.Geometry.Circle"!==this.feature.data.CLASS_NAME&&"NPMapLib.Geometry.CircleSector"!==this.feature.data.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE||this.collectVertices()))},handleKeypress:function(e){var t=e.keyCode;if(this.feature&&OpenLayers.Util.indexOf(this.deleteCodes,t)!==-1){var i=this.layer.getFeatureFromEvent(this.handlers.drag.evt);i&&OpenLayers.Util.indexOf(this.vertices,i)!==-1&&!this.handlers.drag.dragging&&i.geometry.parent&&(i.geometry.parent.removeComponent(i.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:i.geometry,feature:this.feature,pixel:e.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))}},collectVertices:function(){function e(i){var r,n,s,o;if("OpenLayers.Geometry.Point"===i.CLASS_NAME)n=new OpenLayers.Feature.Vector(i),n._sketch=!0,n.renderIntent=t.vertexRenderIntent,t.vertices.push(n);else{"OpenLayers.Geometry.Polygon"===i.CLASS_NAME&&(i=i.components[0]);var a=i.components.length;"OpenLayers.Geometry.LinearRing"===i.CLASS_NAME&&(a-=1);var l=!1;if("OpenLayers.Geometry.LinearRing"===i.CLASS_NAME&&5===i.components.length){var p=1e-6;"EPSG:900913"===this.map.getProjection()&&(p=2),Math.abs(i.components[0].x-i.components[1].x)<p&&Math.abs(i.components[2].x-i.components[3].x)<p&&Math.abs(i.components[0].y-i.components[3].y)<p&&Math.abs(i.components[1].y-i.components[2].y)<p&&(l=!0)}for(r=0;r<a;++r)s=i.components[r],"OpenLayers.Geometry.Point"===s.CLASS_NAME?(n=new OpenLayers.Feature.Vector(s,null,t.virtualStyle),n._sketch=!0,n.renderIntent=t.vertexRenderIntent,l&&(n._recIndex=r+1),t.vertices.push(n)):e(s);if(t.createVertices&&"OpenLayers.Geometry.MultiPoint"!==i.CLASS_NAME)for(r=0,o=i.components.length;r<o-1;++r){var h=i.components[r],u=i.components[r+1];if("OpenLayers.Geometry.Point"===h.CLASS_NAME&&"OpenLayers.Geometry.Point"===u.CLASS_NAME){var y=(h.x+u.x)/2,c=(h.y+u.y)/2,d=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(y,c),null,t.virtualStyle);d.geometry.parent=i,l?d._recBoundindex=r+1:d._index=r+1,d._sketch=!0,t.virtualVertices.push(d)}}}}this.vertices=[],this.virtualVertices=[];var t=this;e.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var e=this.feature.geometry,t=e.getBounds().getCenterLonLat(),i=new OpenLayers.Geometry.Point(t.lon,t.lat),r=new OpenLayers.Feature.Vector(i);i.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,i),e.move(t,i)},r._sketch=!0,this.dragHandle=r,this.dragHandle.style=this.defaultStyle,this.dragHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var e=this.feature.geometry,t=e.getBounds(),i=t.getCenterLonLat(),r=new OpenLayers.Geometry.Point(i.lon,i.lat),n=new OpenLayers.Geometry.Point(t.right,t.bottom),s=new OpenLayers.Feature.Vector(n,null,this.virtualStyle),o=!0,a=!1,l=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;n.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,i);var n=this.x-r.x,s=this.y-r.y,p=n-t,h=s-i;if(l){var u=Math.atan2(h,p),y=Math.atan2(s,n),c=y-u;c*=180/Math.PI,e.rotate(c,r)}if(o){var d,m;if(a)d=s/h,m=n/p/d;else{var f=Math.sqrt(p*p+h*h),g=Math.sqrt(n*n+s*s);d=g/f}e.resize(d,r,m)}},s._sketch=!0,this.radiusHandle=s,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},collectCircleRadiusHandle:function(){var e=this.feature.geometry,t=e.getBounds(),i=t.getCenterLonLat(),r=(this.map.getProjection(),
new OpenLayers.Geometry.Point(i.lon,i.lat)),n=new OpenLayers.Geometry.Point(t.right,i.lat),s=new OpenLayers.Feature.Vector(n,null,this.virtualStyle),o=!0,a=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE;n.data=s,n.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,0);var n=this.x-r.x,s=n-t;if(o){var l,p;a?(l=n/s,p=n/s/l):l=n/s}e.resize(l,r,p)},s._sketch=!0,this.radiusHandle=s,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(e){this.handlers.drag.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(e){"removelayer"!==e.type&&"order"!==e.property||this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.controls=[],this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var e,t=this.controls.length-1;t>=0;t--)e=this.controls[t],e.events&&e.events.un({activate:this.iconOn,deactivate:this.iconOff}),e.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var e,t=0,i=this.controls.length;t<i;t++)e=this.controls[t],(e===this.defaultControl||this.saveState&&this.activeState[e.id])&&e.activate();return this.saveState===!0&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var e,t=0,i=this.controls.length;t<i;t++)e=this.controls[t],this.activeState[e.id]=e.deactivate();return this.redraw(),!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick),this.addControlsToMap(this.controls),this.div},redraw:function(){for(var e=this.div.childNodes.length,t=e-1;t>=0;t--)this.div.removeChild(this.div.childNodes[t]);if(this.div.innerHTML="",this.active)for(var i=0,r=this.controls.length;i<r;i++)this.div.appendChild(this.controls[i].panel_div)},activateControl:function(e){if(!this.active)return!1;if(e.type===OpenLayers.Control.TYPE_BUTTON)return void e.trigger();if(e.type===OpenLayers.Control.TYPE_TOGGLE)return void(e.active?e.deactivate():e.activate());if(this.allowDepress&&e.active)e.deactivate();else{for(var t,i=0,r=this.controls.length;i<r;i++)t=this.controls[i],t===e||t.type!==OpenLayers.Control.TYPE_TOOL&&null!=t.type||t.deactivate();e.activate()}},addControls:function(e){OpenLayers.Util.isArray(e)||(e=[e]),this.controls=this.controls.concat(e);for(var t=0,i=e.length;t<i;t++){var r=e[t],n=this.createControlMarkup(r);OpenLayers.Element.addClass(n,r.displayClass+"ItemInactive"),OpenLayers.Element.addClass(n,"olButton"),""==r.title||n.title||(n.title=r.title),r.panel_div=n}this.map&&(this.addControlsToMap(e),this.redraw())},createControlMarkup:function(e){return document.createElement("div")},addControlsToMap:function(e){for(var t,i=0,r=e.length;i<r;i++)t=e[i],t.autoActivate===!0?(t.autoActivate=!1,this.map.addControl(t),t.autoActivate=!0):(this.map.addControl(t),t.deactivate()),t.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var e=this.panel_div,t=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");e.className=e.className.replace(t,"$1Active")},iconOff:function(){var e=this.panel_div,t=new RegExp("\\b("+this.displayClass+"Item)Active\\b");e.className=e.className.replace(t,"$1Inactive")},onButtonClick:function(e){for(var t=this.controls,i=e.buttonElement,r=t.length-1;r>=0;--r)if(t[r].panel_div===i){this.activateControl(t[r]);break}},getControlsBy:function(e,t){var i="function"==typeof t.test,r=OpenLayers.Array.filter(this.controls,function(r){return r[e]===t||i&&t.test(r[e])});return r},getControlsByName:function(e){return this.getControlsBy("name",e)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},CLASS_NAME:"OpenLayers.Control.Panel"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onRightSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),null===this.scope&&(this.scope=this),this.initLayer(e);var i={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(i.over=this.overFeature,i.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(e){OpenLayers.Util.isArray(e)?(this.layers=e,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:e})):this.layer=e},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(e){var t,i,r,n,s=this.layers||[this.layer];for(r=0;r<s.length;++r)if(t=s[r],n=0,null!=t.selectedFeatures)for(;t.selectedFeatures.length>n;)i=t.selectedFeatures[n],e&&e.except===i?++n:this.unselect(i)},clickFeature:function(e,t){if(!this.hover){var i=OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)>-1;i?this.toggleSelect()?this.unselect(e):this.multipleSelect()||this.unselectAll({except:e}):(this.multipleSelect()||this.unselectAll({except:e}),this.select(e,t))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(e){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(e){var t=e.layer;this.hover&&(this.highlightOnly?this.highlight(e):OpenLayers.Util.indexOf(t.selectedFeatures,e)===-1&&this.select(e))},outFeature:function(e){if(this.hover)if(this.highlightOnly){if(e._lastHighlighter===this.id)if(e._prevHighlighter&&e._prevHighlighter!==this.id){delete e._lastHighlighter;var t=this.map.getControl(e._prevHighlighter);t&&t.highlight(e)}else this.unhighlight(e)}else this.unselect(e)},highlight:function(e){var t=e.layer,i=this.events.triggerEvent("beforefeaturehighlighted",{feature:e});if(i!==!1){e._prevHighlighter=e._lastHighlighter,e._lastHighlighter=this.id;var r=this.selectStyle||this.renderIntent;t.drawFeature(e,r),this.events.triggerEvent("featurehighlighted",{feature:e})}},unhighlight:function(e){var t=e.layer;void 0===e._prevHighlighter?delete e._lastHighlighter:e._prevHighlighter===this.id?delete e._prevHighlighter:(e._lastHighlighter=e._prevHighlighter,delete e._prevHighlighter),t.drawFeature(e,e.style||e.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:e})},select:function(e,t){var i=this.onBeforeSelect.call(this.scope,e),r=e.layer;if(i!==!1&&(i=r.events.triggerEvent("beforefeatureselected",{feature:e}),i!==!1))switch(r.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=r.selectedFeatures[0]),r.events.triggerEvent("featureselected",{feature:e}),t){case"contextmenu":this.onRightSelect.call(this.scope,e);break;case"click":default:this.onSelect.call(this.scope,e)}},unselect:function(e){var t=e.layer;this.unhighlight(e),OpenLayers.Util.removeItem(t.selectedFeatures,e),t.events.triggerEvent("featureunselected",{feature:e}),this.onUnselect.call(this.scope,e)},selectBox:function(e){if(e instanceof OpenLayers.Bounds){var t=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),i=this.map.getLonLatFromPixel({x:e.right,y:e.top}),r=new OpenLayers.Bounds(t.lon,t.lat,i.lon,i.lat);this.multipleSelect()||this.unselectAll();var n=this.multiple;this.multiple=!0;var s=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:s});for(var o,a=0;a<s.length;++a){o=s[a];for(var l=0,p=o.features.length;l<p;++l){var h=o.features[l];h.getVisibility()&&(null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,h.geometry.CLASS_NAME)>-1)&&r.toGeometry().intersects(h.geometry)&&OpenLayers.Util.indexOf(o.selectedFeatures,h)===-1&&this.select(h)}}this.multiple=n,this.events.triggerEvent("boxselectionend",{layers:s})}},setMap:function(e){this.handlers.feature.setMap(e),this.box&&this.handlers.box.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(e){var t=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(e),this.handlers.feature.layer=this.layer,t&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:30,delayedTrigger:null,persist:!1,immediate:!1,imgPath:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);var i={done:this.measureComplete,point:this.measurePartial,measuremoving:this.measureMoving};this.immediate&&(i.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new e(this,this.callbacks,this.handlerOptions),this.imgPath=OpenLayers.Util.getImageLocation("dis_box_01.gif")},activate:function(){return!this.active&&(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),"OpenLayers.Handler.Path"===this.handler.CLASS_NAME&&(this.context=new OpenLayers.Control.MouseContext,this.context.setContext("<span style='height:25px;line-height:25px;float:left;margin-left:8px'>"+("CN"===NPMap.CULTURE?"单击确定起点":"Click for origin")+"</span>"),this.map.addControl(this.context),"CN"===NPMap.CULTURE?this.context.setContextSize(92,25):this.context.setContextSize(112,25),this.context.setContextStyle({border:"1px solid #cccccc",color:"#999999"}),this.context.activate()),!0)},deactivate:function(){return this.cancelDelay(),this.context&&(this.context.deactivate(),this.map.removeControl(this.context)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.context&&(this.context.deactivate(),this.map.removeControl(this.context)),this.cancelDelay(),this.handler.cancel()},setImmediate:function(e){this.immediate=e,this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(e,t){var i=this.active;i&&(this.context&&(this.context.deactivate(),this.map.removeControl(this.context)),this.deactivate()),this.handler=new e(this,this.callbacks,t),i&&this.activate()},measureComplete:function(e){this.cancelDelay(),this.context&&(this.context.deactivate(),this.map.removeControl(this.context)),this.handler.layer.destroyFeatures();var t=this;window.setTimeout(function(){t.measure(e,"measure")},100),this.deactivate()},measureMoving:function(e,t){if(t.CLASS_NAME.indexOf("LineString")>-1&&(stat=this.getBestLength(t),stat[0]>0&&this.context)){"CN"===NPMap.CULTURE?this.context.setContextSize(160,50):this.context.setContextSize(240,60);var i=stat[0].toFixed(2);this.context.setContext("<div style='font-family:微软雅黑;font-size:12px;height:25px;line-height:25px'><span style='float:left;margin-left:8px'>"+("CN"===NPMap.CULTURE?"总长:":"Total:")+"</span><span style='color:red;font-weight:bolder;float:left;margin-left:12px'>"+i+"</span>"+stat[1]+"</div><div style='font-family:微软雅黑;font-size:12px;color:#999999;float:left;margin-left:8px'>"+("CN"===NPMap.CULTURE?"单击继续，双击或右键结束":"Click to confirm location,Double Click for End Location")+"</div>")}},measurePartial:function(e,t){t=t.clone(),e=e.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(t,"measurepartial",e):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(t,"measurepartial",e),this.measure(t,"measureProcess",e)},this),this.partialDelay)},measureImmediate:function(e,t,i){i&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(t.geometry,"measurepartial",e))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(e,t,i){var r,n;e.CLASS_NAME.indexOf("LineString")>-1?(r=this.getBestLength(e),n=1):(r=this.getBestArea(e),n=2),this.events.triggerEvent(t,{measure:r[0],units:r[1],order:n,geometry:e,point:i})},getBestArea:function(e){for(var t,i,r=this.displaySystemUnits[this.displaySystem],n=0,s=r.length;n<s&&(t=r[n],i=this.getArea(e,t),!(i>1));++n);return[i,t]},getArea:function(e,t){var i,r;this.geodesic?(i=e.getGeodesicArea(this.map.getProjectionObject()),r="m"):(i=e.getArea(),r=this.map.getUnits());var n=OpenLayers.INCHES_PER_UNIT[t];if(n){var s=OpenLayers.INCHES_PER_UNIT[r];i*=Math.pow(s/n,2)}return i},getBestLength:function(e){for(var t,i,r=this.displaySystemUnits[this.displaySystem],n=0,s=r.length;n<s&&(t=r[n],i=this.getLength(e,t),!(i>1));++n);return[i,t]},getLength:function(e,t){var i,r;this.geodesic?(i=e.getGeodesicLength(this.map.getProjectionObject()),r="m"):(i=e.getLength(),r=this.map.getUnits());var n=OpenLayers.INCHES_PER_UNIT[t];if(n){var s=OpenLayers.INCHES_PER_UNIT[r];i*=s/n}return i},CLASS_NAME:"OpenLayers.Control.Measure"}),OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"−",zoomOutId:"olZoomOutLink",draw:function(){var e=OpenLayers.Control.prototype.draw.apply(this),t=this.getOrCreateLinks(e),i=t.zoomIn,r=t.zoomOut,n=this.map.events;return r.parentNode!==e&&(n=this.events,n.attachToElement(r.parentNode)),n.register("buttonclick",this,this.onZoomClick),this.zoomInLink=i,this.zoomOutLink=r,e},getOrCreateLinks:function(e){var t=document.getElementById(this.zoomInId),i=document.getElementById(this.zoomOutId);return t||(t=document.createElement("a"),t.href="#zoomIn",t.appendChild(document.createTextNode(this.zoomInText)),t.className="olControlZoomIn",e.appendChild(t)),OpenLayers.Element.addClass(t,"olButton"),i||(i=document.createElement("a"),i.href="#zoomOut",i.appendChild(document.createTextNode(this.zoomOutText)),i.className="olControlZoomOut",e.appendChild(i)),OpenLayers.Element.addClass(i,"olButton"),{zoomIn:t,zoomOut:i}},onZoomClick:function(e){var t=e.buttonElement;t===this.zoomInLink?this.map.zoomIn():t===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick),delete this.zoomInLink,delete this.zoomOutLink,OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"}),OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(e){var t=this.getBounds();t?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(e,t){},getVertices:function(e){},atPoint:function(e,t,i){var r=!1,n=this.getBounds();if(null!=n&&null!=e){var s=null!=t?t:0,o=null!=i?i:0,a=new OpenLayers.Bounds(this.bounds.left-s,this.bounds.bottom-o,this.bounds.right+s,this.bounds.top+o);r=a.containsLonLat(e)}return r},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var e;return e=OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(e){var t;if(OpenLayers.Format&&OpenLayers.Format.WKT){var i=OpenLayers.Geometry.fromWKT.format;i||(i=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=i);var r=i.read(e);if(r instanceof OpenLayers.Feature.Vector)t=r.geometry;else if(OpenLayers.Util.isArray(r)){for(var n=r.length,s=new Array(n),o=0;o<n;++o)s[o]=r[o].geometry;t=new OpenLayers.Geometry.Collection(s)}}return t},OpenLayers.Geometry.segmentsIntersect=function(e,t,i){var r=i&&i.point,n=i&&i.tolerance,s=!1,o=e.x1-t.x1,a=e.y1-t.y1,l=e.x2-e.x1,p=e.y2-e.y1,h=t.y2-t.y1,u=t.x2-t.x1,y=h*l-u*p,c=u*a-h*o,d=l*a-p*o;if(0==y)0==c&&0==d&&(s=!0);else{var m=c/y,f=d/y;if(m>=0&&m<=1&&f>=0&&f<=1)if(r){var g=e.x1+m*l,L=e.y1+m*p;s=new OpenLayers.Geometry.Point(g,L)}else s=!0}if(n){var v;if(s){if(r){var O,g,L,P=[e,t];e:for(var b=0;b<2;++b){O=P[b];for(var w=1;w<3;++w)if(g=O["x"+w],L=O["y"+w],v=Math.sqrt(Math.pow(g-s.x,2)+Math.pow(L-s.y,2)),v<n){s.x=g,s.y=L;break e}}}}else{var M,_,g,L,x,C,P=[e,t];e:for(var b=0;b<2;++b){M=P[b],_=P[(b+1)%2];for(var w=1;w<3;++w)if(x={x:M["x"+w],y:M["y"+w]},C=OpenLayers.Geometry.distanceToSegment(x,_),C.distance<n){s=!r||new OpenLayers.Geometry.Point(x.x,x.y);break e}}}}return s},OpenLayers.Geometry.distanceToSegment=function(e,t){var i=OpenLayers.Geometry.distanceSquaredToSegment(e,t);return i.distance=Math.sqrt(i.distance),i},OpenLayers.Geometry.distanceSquaredToSegment=function(e,t){var i,r,n=e.x,s=e.y,o=t.x1,a=t.y1,l=t.x2,p=t.y2,h=l-o,u=p-a,y=0==h&&0==u?0:(h*(n-o)+u*(s-a))/(Math.pow(h,2)+Math.pow(u,2));return y<=0?(i=o,r=a):y>=1?(i=l,r=p):(i=o+y*h,r=a+y*u),{distance:Math.pow(i-n,2)+Math.pow(r-s,2),x:i,y:r,along:y}},OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;i<len;i++)geometry.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var e=[],t=0,i=this.components.length;t<i;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,t=this.components;if(t)for(var i=0,r=t.length;i<r;i++)e.extend(t[i].getBounds());null!=e.left&&null!=e.bottom&&null!=e.right&&null!=e.top&&this.setBounds(e)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;t<i;t++)this.addComponent(e[t])},addComponent:function(e,t){var i=!1;if(e&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME)>-1)){if(null!=t&&t<this.components.length){var r=this.components.slice(0,t),n=this.components.slice(t,this.components.length);r.push(e),this.components=r.concat(n)}else this.components.push(e);e.parent=this,this.clearBounds(),i=!0}return i},removeComponents:function(e){var t=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var i=e.length-1;i>=0;--i)t=this.removeComponent(e[i])||t;return t},removeComponent:function(e){return OpenLayers.Util.removeItem(this.components,e),this.clearBounds(),!0},getLength:function(){for(var e=0,t=0,i=this.components.length;t<i;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,i=this.components.length;t<i;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,i=0,r=this.components.length;i<r;i++)t+=this.components[i].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();var t=this.components.length;if(!t)return!1;for(var i,r=[],n=[],s=0,o=Number.MAX_VALUE,a=0;a<t;++a){i=this.components[a];var l=i.getArea(),p=i.getCentroid(!0);isNaN(l)||isNaN(p.x)||isNaN(p.y)||(r.push(l),s+=l,o=l<o&&l>0?l:o,n.push(p))}if(t=r.length,0===s){for(var a=0;a<t;++a)r[a]=1;s=r.length}else{for(var a=0;a<t;++a)r[a]/=o;s/=o}for(var p,l,h=0,u=0,a=0;a<t;++a)p=n[a],l=r[a],h+=p.x*l,u+=p.y*l;return new OpenLayers.Geometry.Point(h/s,u/s)},getGeodesicLength:function(e){for(var t=0,i=0,r=this.components.length;i<r;i++)t+=this.components[i].getGeodesicLength(e);return t},move:function(e,t){for(var i=0,r=this.components.length;i<r;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,r=this.components.length;i<r;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var r=0;r<this.components.length;++r)this.components[r].resize(e,t,i);return this},distanceTo:function(e,t){for(var i,r,n,s=!(t&&t.edge===!1),o=s&&t&&t.details,a=Number.POSITIVE_INFINITY,l=0,p=this.components.length;l<p&&(i=this.components[l].distanceTo(e,t),n=o?i.distance:i,!(n<a&&(a=n,r=i,0==a)));++l);return r},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var i=0,r=this.components.length;i<r;++i)if(!this.components[i].equals(e.components[i])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var i=0,r=this.components.length;i<r;i++){var n=this.components[i];n.transform(e,t)}this.bounds=null}return this},intersects:function(e){for(var t=!1,i=0,r=this.components.length;i<r&&!(t=e.intersects(this.components[i]));++i);return t},getVertices:function(e){for(var t=[],i=0,r=this.components.length;i<r;++i)Array.prototype.push.apply(t,this.components[i].getVertices(e));return t},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(e),this.y=parseFloat(t)},clone:function(e){return null==e&&(e=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(e,this),e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var i,r,n,s,o,a,l=!(t&&t.edge===!1),p=l&&t&&t.details;return e instanceof OpenLayers.Geometry.Point?(r=this.x,n=this.y,s=e.x,o=e.y,i=Math.sqrt(Math.pow(r-s,2)+Math.pow(n-o,2)),a=p?{x0:r,y0:n,x1:s,y1:o,distance:i}:i):(a=e.distanceTo(this,t),p&&(a={x0:a.x1,y0:a.y1,x1:a.x0,y1:a.y0,distance:a.distance})),a},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x=this.x+e,this.y=this.y+t,this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var i=this.distanceTo(t),r=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+i*Math.cos(r),this.y=t.y+i*Math.sin(r),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,i){return i=void 0==i?1:i,this.x=t.x+e*i*(this.x-t.x),this.y=t.y+e*(this.y-t.y),this.clearBounds(),this},intersects:function(e){var t=!1;return t="OpenLayers.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this)},transform:function(e,t){return e&&t&&(OpenLayers.Projection.transform(this,e,t),this.bounds=null),this},getVertices:function(e){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&this.components.length>1)for(var t=1,i=this.components.length;t<i;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:900913");i.equals(e)||(t=this.clone().transform(e,i))}return t.getLength()},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(e){var t=this.components&&this.components.length>1;return t&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),t},intersects:function(e){var t=!1,i=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==i||"OpenLayers.Geometry.LinearRing"==i||"OpenLayers.Geometry.Point"==i){var r,n=this.getSortedSegments();r="OpenLayers.Geometry.Point"==i?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();var s,o,a,l,p,h,u,y;e:for(var c=0,d=n.length;c<d;++c){s=n[c],o=s.x1,a=s.x2,l=s.y1,p=s.y2;for(var m=0,f=r.length;m<f&&(h=r[m],!(h.x1>a));++m)if(!(h.x2<o)&&(u=h.y1,y=h.y2,!(Math.min(u,y)>Math.max(l,p))&&!(Math.max(u,y)<Math.min(l,p))&&OpenLayers.Geometry.segmentsIntersect(s,h))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){function e(e,t){return e.x1-t.x1}for(var t,i,r=this.components.length-1,n=new Array(r),s=0;s<r;++s)t=this.components[s],i=this.components[s+1],t.x<i.x?n[s]={x1:t.x,y1:t.y,x2:i.x,y2:i.y}:n[s]={x1:i.x,y1:i.y,x2:t.x,y2:t.y};return n.sort(e)},splitWithSegment:function(e,t){for(var i,r,n,s,o,a=!(t&&t.edge===!1),l=t&&t.tolerance,p=[],h=this.getVertices(),u=[],y=[],c=!1,d={point:!0,tolerance:l},m=null,f=0,g=h.length-2;f<=g;++f)if(i=h[f],u.push(i.clone()),r=h[f+1],o={x1:i.x,y1:i.y,x2:r.x,y2:r.y},n=OpenLayers.Geometry.segmentsIntersect(e,o,d),n instanceof OpenLayers.Geometry.Point&&(s=!!(n.x===e.x1&&n.y===e.y1||n.x===e.x2&&n.y===e.y2||n.equals(i)||n.equals(r)),s||a)){if(n.equals(y[y.length-1])||y.push(n.clone()),0===f&&n.equals(i))continue;if(n.equals(r))continue;c=!0,n.equals(i)||u.push(n),p.push(new OpenLayers.Geometry.LineString(u)),u=[n.clone()]}if(c&&(u.push(r.clone()),p.push(new OpenLayers.Geometry.LineString(u))),y.length>0){var L=e.x1<e.x2?1:-1,v=e.y1<e.y2?1:-1;m={lines:p,points:y.sort(function(e,t){return L*e.x-L*t.x||v*e.y-v*t.y})}}return m},split:function(e,t){var i,r,n,s,o=null,a=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,p,h,u,y,c,d=this.getVertices(),m=[];n=[];for(var f=0,g=d.length-2;f<=g;++f){l=d[f],p=d[f+1],h={x1:l.x,y1:l.y,x2:p.x,y2:p.y},s=s||[e],a&&m.push(l.clone());for(var L=0;L<s.length;++L)if(u=s[L].splitWithSegment(h,t),u&&(y=u.lines,y.length>0&&(y.unshift(L,1),Array.prototype.splice.apply(s,y),L+=y.length-2),a))for(var v=0,O=u.points.length;v<O;++v)c=u.points[v],c.equals(l)||(m.push(c),n.push(new OpenLayers.Geometry.LineString(m)),m=c.equals(p)?[]:[c.clone()])}a&&n.length>0&&m.length>0&&(m.push(p.clone()),n.push(new OpenLayers.Geometry.LineString(m)))}else o=e.splitWith(this,t);return s&&s.length>1?r=!0:s=[],n&&n.length>1?i=!0:n=[],(r||i)&&(o=a?[n,s]:s),o},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){var t;return t=e===!0?[this.components[0],this.components[this.components.length-1]]:e===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var i,r=!(t&&t.edge===!1),n=r&&t&&t.details,s={},o=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){for(var a,l=this.getSortedSegments(),p=e.x,h=e.y,u=0,y=l.length;u<y;++u)if(a=l[u],i=OpenLayers.Geometry.distanceToSegment(e,a),i.distance<o){if(o=i.distance,s=i,0===o)break}else if(a.x2>p&&(h>a.y1&&h<a.y2||h<a.y1&&h>a.y2))break;s=n?{distance:s.distance,x0:s.x,y0:s.y,x1:p,y1:h}:s.distance}else if(e instanceof OpenLayers.Geometry.LineString){var c,d,m,f,g,L=this.getSortedSegments(),v=e.getSortedSegments(),O=v.length,P={point:!0};e:for(var u=0,y=L.length;u<y;++u){c=L[u],f=c.x1,g=c.y1;for(var b=0;b<O;++b){if(d=v[b],m=OpenLayers.Geometry.segmentsIntersect(c,d,P)){o=0,s={distance:0,x0:m.x,y0:m.y,x1:m.x,y1:m.y};break e}i=OpenLayers.Geometry.distanceToSegment({x:f,y:g},d),i.distance<o&&(o=i.distance,s={distance:o,x0:f,y0:g,x1:i.x,y1:i.y})}}if(n||(s=s.distance),0!==o&&c){i=e.distanceTo(new OpenLayers.Geometry.Point(c.x2,c.y2),t);var w=n?i.distance:i;w<o&&(s=n?{distance:o,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:w)}}else s=e.distanceTo(this,t),n&&(s={distance:s.distance,x0:s.x1,y0:s.y1,x1:s.x0,y1:s.y0});return s},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(t.length<3)return this;var i=function(e,t){return e-t},r=function(e,t,i,s){for(var o,l=0,p=0,h=t;h<i;h++)o=n(e[t],e[i],e[h]),o>l&&(l=o,p=h);l>s&&p!=t&&(a.push(p),r(e,t,p,s),r(e,p,i,s))},n=function(e,t,i){var r=Math.abs(.5*(e.x*t.y+t.x*i.y+i.x*e.y-t.x*e.y-i.x*t.y-e.x*i.y)),n=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),s=r/n*2;return s},s=0,o=t.length-1,a=[];for(a.push(s),a.push(o);t[s].equals(t[o]);)o--,a.push(o);r(t,s,o,e);var l=[];a.sort(i);for(var p=0;p<a.length;p++)l.push(t[a[p]]);return new OpenLayers.Geometry.LineString(l)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,t){var i=!1,r=this.components.pop();null==t&&e.equals(r)||(i=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var n=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[n]),i},removeComponent:function(e){var t=this.components&&this.components.length>3;if(t){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var i=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[i])}return t},move:function(e,t){for(var i=0,r=this.components.length;i<r-1;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,r=this.components.length;i<r-1;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var r=0,n=this.components.length;r<n-1;++r)this.components[r].resize(e,t,i);return this},transform:function(e,t){if(e&&t){for(var i=0,r=this.components.length;i<r-1;i++){var n=this.components[i];n.transform(e,t)}this.bounds=null}return this},getCentroid:function(){if(this.components){var e=this.components.length;if(e>0&&e<=2)return this.components[0].clone();if(e>2){var t=0,i=0,r=this.components[0].x,n=this.components[0].y,s=-1*this.getArea();if(0!=s){for(var o=0;o<e-1;o++){var a=this.components[o],l=this.components[o+1];t+=(a.x+l.x-2*r)*((a.x-r)*(l.y-n)-(l.x-r)*(a.y-n)),
i+=(a.y+l.y-2*n)*((a.x-r)*(l.y-n)-(l.x-r)*(a.y-n))}var p=r+t/(6*s),h=n+i/(6*s)}else{for(var o=0;o<e-1;o++)t+=this.components[o].x,i+=this.components[o].y;var p=t/(e-1),h=i/(e-1)}return new OpenLayers.Geometry.Point(p,h)}return null}},getArea:function(){var e=0;if(this.components&&this.components.length>2){for(var t=0,i=0,r=this.components.length;i<r-1;i++){var n=this.components[i],s=this.components[i+1];t+=(n.x+s.x)*(s.y-n.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var r=0,n=t.components&&t.components.length;if(n>2){for(var s,o,a=0;a<n-1;a++)s=t.components[a],o=t.components[a+1],r+=OpenLayers.Util.rad(o.x-s.x)*(2+Math.sin(OpenLayers.Util.rad(s.y))+Math.sin(OpenLayers.Util.rad(o.y)));r=6378137*r*6378137/2}return r},containsPoint:function(e){function t(e,t,i,r,n){return(e-n)*((r-t)/(n-i))+r}for(var i,r,n,s,o,a,l,p=OpenLayers.Number.limitSigDigs,h=14,u=p(e.x,h),y=p(e.y,h),c=this.components.length-1,d=0,m=0;m<c;++m)if(i=this.components[m],n=p(i.x,h),s=p(i.y,h),r=this.components[m+1],o=p(r.x,h),a=p(r.y,h),s!=a){if(l=p(t(y,n,s,o,a),h),l==u&&(s<a&&y>=s&&y<=a||s>a&&y<=s&&y>=a)){d=-1;break}l<=u||n!=o&&(l<Math.min(n,o)||l>Math.max(n,o))||(s<a&&y>=s&&y<a||s>a&&y<s&&y>=a)&&++d}else if(y==s&&(n<=o&&u>=n&&u<=o||n>=o&&u<=n&&u>=o)){d=-1;break}var f=d==-1?1:!!(1&d);return f},intersects:function(e){var t=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME)t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var i=0,r=e.components.length;i<r&&!(t=e.components[i].intersects(this));++i);return t},getVertices:function(e){return e===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,i=this.components.length;t<i;t++)e-=Math.abs(this.components[t].getArea())}return e},getGeodesicArea:function(e){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getGeodesicArea(e));for(var i=1,r=this.components.length;i<r;i++)t-=Math.abs(this.components[i].getGeodesicArea(e))}return t},containsPoint:function(e){var t=this.components.length,i=!1,r=0;if(t>0)for(var n=0;n<t;n++){var s=this.components[n].containsPoint(e);if(1===s)return 1;s&&r++}return r%2===1&&(i=!0),i},intersects:function(e){var t,i,r=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)r=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,i=this.components.length;t<i&&!(r=e.intersects(this.components[t]));++t);if(!r)for(t=0,i=e.components.length;t<i&&!(r=this.containsPoint(e.components[t]));++t);}else for(t=0,i=e.components.length;t<i&&!(r=this.intersects(e.components[t]));++t);if(!r&&"OpenLayers.Geometry.Polygon"==e.CLASS_NAME){var n=this.components[0];for(t=0,i=n.components.length;t<i&&!(r=e.containsPoint(n.components[t]));++t);}return r},distanceTo:function(e,t){var i,r=!(t&&t.edge===!1);return i=!r&&this.intersects(e)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,i,r){var n=Math.PI*(1/i-.5);r&&(n+=r/180*Math.PI);for(var s,o,a,l=[],p=0;p<i;++p)s=n+2*p*Math.PI/i,o=e.x+t*Math.cos(s),a=e.y+t*Math.sin(s),l.push(new OpenLayers.Geometry.Point(o,a));var h=new OpenLayers.Geometry.LinearRing(l);return new OpenLayers.Geometry.Polygon([h])},OpenLayers.Geometry.Polygon.createEllipsePolygion=function(e,t,i,r,n){var s=this.createRegularPolygon(e,i,r),o=t/i;return s.resize(1,e,o),s.rotate(n,e),s},OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(e,t){for(var i,r,n,s,o,a=null,l=t&&t.mutual,p=[],h=[e],u=0,y=this.components.length;u<y;++u){r=this.components[u],s=!1;for(var c=0;c<h.length;++c)if(i=r.split(h[c],t)){if(l){n=i[0];for(var d=0,m=n.length;d<m;++d)0===d&&p.length?p[p.length-1].addComponent(n[d]):p.push(new OpenLayers.Geometry.MultiLineString([n[d]]));s=!0,i=i[1]}if(i.length){i.unshift(c,1),Array.prototype.splice.apply(h,i);break}}s||(p.length?p[p.length-1].addComponent(r.clone()):p=[new OpenLayers.Geometry.MultiLineString(r.clone())])}return p&&p.length>1?s=!0:p=[],h&&h.length>1?o=!0:h=[],(s||o)&&(a=l?[p,h]:h),a},splitWith:function(e,t){var i,r,n,s,o,a,l,p=null,h=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){l=[],a=[e];for(var u=0,y=this.components.length;u<y;++u){o=!1,r=this.components[u];for(var c=0;c<a.length;++c)if(i=a[c].split(r,t)){h&&(n=i[0],n.length&&(n.unshift(c,1),Array.prototype.splice.apply(a,n),c+=n.length-2),i=i[1],0===i.length&&(i=[r.clone()]));for(var d=0,m=i.length;d<m;++d)0===d&&l.length?l[l.length-1].addComponent(i[d]):l.push(new OpenLayers.Geometry.MultiLineString([i[d]]));o=!0}o||(l.length?l[l.length-1].addComponent(r.clone()):l=[new OpenLayers.Geometry.MultiLineString([r.clone()])])}}else p=e.split(this);return a&&a.length>1?s=!0:a=[],l&&l.length>1?o=!0:l=[],(s||o)&&(p=h?[a,l]:l),p},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e),OpenLayers.Util.extend(this,t)},destroy:function(){this.container=null,this.extent=null,this.size=null,this.resolution=null,this.map=null},supported:function(){return!1},setExtent:function(e,t){if(this.extent=e.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var i=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/i);this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(i)}return t&&(this.resolution=null),!0},setSize:function(e){this.size=e.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(e,t){if(null==t&&(t=e.style),e.geometry){var i=e.geometry.getBounds();if(i){var r;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(r=this.map.getMaxExtent()),i.intersectsBounds(this.extent,{worldBounds:r})?this.calculateFeatureDx(i,r):t={display:"none"};var n=this.drawGeometry(e.geometry,t,e.id);if("none"!=t.display&&t.label&&n!==!1){var s=e.geometry.getCentroid();if(t.labelXOffset||t.labelYOffset){var o=isNaN(t.labelXOffset)?0:t.labelXOffset,a=isNaN(t.labelYOffset)?0:t.labelYOffset,l=this.getResolution();s.move(o*l,a*l)}this.drawText(e.id,t,s,e.geometry.id)}else this.removeText(e.id);return n}}},calculateFeatureDx:function(e,t){if(this.featureDx=0,t){var i=t.getWidth(),r=(this.extent.left+this.extent.right)/2,n=(e.left+e.right)/2,s=Math.round((n-r)/i);this.featureDx=s*i}},drawGeometry:function(e,t,i){},drawText:function(e,t,i){},removeText:function(e){},clear:function(){},getFeatureIdFromEvent:function(e){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;t<i;++t){var r=e[t];this.eraseGeometry(r.geometry,r.id),this.removeText(r.id)}},eraseGeometry:function(e,t){},moveRoot:function(e){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return e.stroke===!1&&(delete t.strokeWidth,delete t.strokeColor),e.fill===!1&&delete t.fillColor,OpenLayers.Util.extend(t,e),t},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var i,r=-1,n=this.order.length;n-r>1;){i=parseInt((r+n)/2);var s=this.compare(this,e,OpenLayers.Util.getElement(this.order[i]));s>0?r=i:n=i}return this.order.splice(n,0,t),this.indices[t]=this.getZIndex(e),this.getNextElement(n)},remove:function(e){var t=e.id,i=OpenLayers.Util.indexOf(this.order,t);if(i>=0)if(this.order.splice(i,1),delete this.indices[t],this.order.length>0){var r=this.order[this.order.length-1];this.maxZIndex=this.indices[r]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;null==t?(t=this.maxZIndex,e._style.graphicZIndex=t):t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){var t=e+1;if(t<this.order.length){var i=OpenLayers.Util.getElement(this.order[t]);return void 0==i&&(i=this.getNextElement(t)),i}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,i){var r=e.getZIndex(t),n=0;if(i){var s=e.getZIndex(i);n=r-s}return n},Z_ORDER_DRAWING_ORDER:function(e,t,i){var r=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);return i&&0==r&&(r=1),r},Z_ORDER_Y_ORDER:function(e,t,i){var r=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);if(i&&0===r){var n=i._boundsBottom-t._boundsBottom;r=0===n?1:n}return r}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.vectorRoot,this.root.appendChild(this.vectorRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);if(t=this.textRoot)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},setExtent:function(e,t){var i=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),r=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var n,s=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/s),o=this.map.getMaxExtent();o.right>e.left&&o.right<e.right?n=!0:o.left>e.left&&o.left<e.right&&(n=!1),(n!==this.rightOfDateLine||t)&&(i=!1,this.xOffset=n===!0?o.getWidth()/r:0),this.rightOfDateLine=n}return i},getNodeType:function(e,t){},drawGeometry:function(e,t,i){var r=e.CLASS_NAME,n=!0;if("OpenLayers.Geometry.Collection"==r||"OpenLayers.Geometry.MultiPoint"==r||"OpenLayers.Geometry.MultiLineString"==r||"OpenLayers.Geometry.MultiPolygon"==r||e.isMultiPlotting){for(var s=0,o=e.components.length;s<o;s++)n=this.drawGeometry(e.components[s],t,i)&&n;return n}n=!1;var a=!1;if("none"!=t.display&&(t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,i):a=!0,e instanceof OpenLayers.Geometry.Point&&(t.strokeDashstyle="solid"),n=this.redrawNode(e.id,e,t,i)),0==n){var l=document.getElementById(e.id);l&&(l._style.backgroundGraphic&&(a=!0),l.parentNode.removeChild(l))}if(a){var l=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX);l&&l.parentNode.removeChild(l)}return n},redrawNode:function(e,t,i,r){i=this.applyDefaultSymbolizer(i);var n=this.nodeFactory(e,this.getNodeType(t,i));n._featureId=r,n._boundsBottom=t.getBounds().bottom,n._geometryClass=t.CLASS_NAME,n._style=i;var s=this.drawGeometryNode(n,t,i);if(s===!1)return!1;if(n=s.node,this.indexer){var o=this.indexer.insert(n);o?this.vectorRoot.insertBefore(n,o):this.vectorRoot.appendChild(n)}else n.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(n);return this.postDraw(n),s.complete},redrawBackgroundNode:function(e,t,i,r){var n=OpenLayers.Util.extend({},i);return n.externalGraphic=n.backgroundGraphic,n.graphicXOffset=n.backgroundXOffset,n.graphicYOffset=n.backgroundYOffset,n.graphicZIndex=n.backgroundGraphicZIndex,n.graphicWidth=n.backgroundWidth||n.graphicWidth,n.graphicHeight=n.backgroundHeight||n.graphicHeight,n.backgroundGraphic=null,n.backgroundXOffset=null,n.backgroundYOffset=null,n.backgroundGraphicZIndex=null,this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,n,null)},drawGeometryNode:function(e,t,i){i=i||e._style;var r,n={isFilled:void 0===i.fill||i.fill,isStroked:void 0===i.stroke?!!i.strokeWidth:i.stroke};return OpenLayers.Geometry.LinearRing&&t instanceof OpenLayers.Geometry.LinearRing?r=this.drawLinearRing(e,t):OpenLayers.REST&&OpenLayers.REST.Route&&t instanceof OpenLayers.REST.Route?(n.isFilled=!1,r=this.drawLineString(e,t)):OpenLayers.Geometry.LineString&&t instanceof OpenLayers.Geometry.LineString?(n.isFilled=!1,r=this.drawLineString(e,t)):OpenLayers.Geometry.Polygon&&t instanceof OpenLayers.Geometry.Polygon?r=this.drawPolygon(e,t):OpenLayers.Geometry.Point&&t instanceof OpenLayers.Geometry.Point?(i.graphic===!1&&(n.isFilled=!1,n.isStroked=!1),r=this.drawPoint(e,t)):OpenLayers.Geometry.Rectangle&&t instanceof OpenLayers.Geometry.Rectangle&&(r=this.drawRectangle(e,t)),e._options=n,0!=r&&{node:this.setStyle(e,i,n,t),complete:r}},postDraw:function(e){},drawPoint:function(e,t){},drawLineString:function(e,t){},drawLinearRing:function(e,t){},drawPolygon:function(e,t){},drawRectangle:function(e,t){},drawCircle:function(e,t){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t);var i=document.getElementById(e+this.LABEL_OUTLINE_SUFFIX);i&&this.textRoot.removeChild(i);var r=document.getElementById(e+this.LABEL_ID_SUFFIX+"_rect");r&&this.textRoot.removeChild(r),r=document.getElementById(e+this.LABEL_ID_SUFFIX+"_polygon"),r&&this.textRoot.removeChild(r)},getFeatureIdFromEvent:function(e){var t=e.target,i=t&&t.correspondingUseElement,r=i?i:t||e.srcElement;return r?r._featureId:e.feature.geometry.id},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var i=0,r=e.components.length;i<r;i++)this.eraseGeometry(e.components[i],t);else{var n=OpenLayers.Util.getElement(e.id);if(n&&n.parentNode&&(n.geometry&&(n.geometry.destroy(),n.geometry=null),n.parentNode.removeChild(n),this.indexer&&this.indexer.remove(n),n._style.backgroundGraphic)){var s=e.id+this.BACKGROUND_ID_SUFFIX,o=OpenLayers.Util.getElement(s);o&&o.parentNode&&o.parentNode.removeChild(o)}}},nodeFactory:function(e,t){var i=OpenLayers.Util.getElement(e);return i?this.nodeTypeCompare(i,t)||(i.parentNode.removeChild(i),i=this.nodeFactory(e,t)):i=this.createNode(t,e),i},nodeTypeCompare:function(e,t){},createNode:function(e,t){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root),t.parentNode.removeChild(t),e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},removeBackground:function(e){var t=document.getElementById(e+this.BACKGROUND_ID_SUFFIX);t&&t.parentNode.removeChild(t)},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e5,translationParameters:null,symbolMetrics:null,initialize:function(e){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var e="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(e+"SVG","1.1")||document.implementation.hasFeature(e+"BasicStructure","1.1"))},inValidRange:function(e,t,i){var r=e+(i?0:this.translationParameters.x),n=t+(i?0:this.translationParameters.y);return r>=-this.MAX_PIXEL&&r<=this.MAX_PIXEL&&n>=-this.MAX_PIXEL&&n<=this.MAX_PIXEL},setExtent:function(e,t){var i=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),r=this.getResolution(),n=-e.left/r,s=e.top/r;if(t){this.left=n,this.top=s;var o="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",o),this.translate(this.xOffset,0),!0}var a=this.translate(n-this.left+this.xOffset,s-this.top);return a||this.setExtent(e,!0),i&&a},translate:function(e,t){if(this.inValidRange(e,t,!0)){var i="";return(e||t)&&(i="translate("+e+","+t+")"),this.root.setAttributeNS(null,"transform",i),this.translationParameters={x:e,y:t},!0}return!1},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var i=null;return OpenLayers.Geometry.LinearRing&&e instanceof OpenLayers.Geometry.LinearRing?i="polygon":OpenLayers.REST&&OpenLayers.REST.Route&&e instanceof OpenLayers.REST.Route?i="polyline":OpenLayers.Geometry.LineString&&e instanceof OpenLayers.Geometry.LineString?i="polyline":OpenLayers.Geometry.Curve&&e instanceof OpenLayers.Geometry.Curve?i="path":OpenLayers.Geometry.Polygon&&e instanceof OpenLayers.Geometry.Polygon?i="path":OpenLayers.Geometry.Point&&e instanceof OpenLayers.Geometry.Point?i=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle":OpenLayers.Geometry.Rectangle&&e instanceof OpenLayers.Geometry.Rectangle&&(i="rect"),i},setStyle:function(e,t,i){t=t||e._style,i=i||e._options;var r=t.title||t.graphicTitle;if(r){e.setAttributeNS(null,"title",r);var n=e.getElementsByTagName("title");if(n.length>0)n[0].firstChild.textContent=r;else{var s=this.nodeFactory(null,"title");s.textContent=r,e.appendChild(s)}}var o,a=parseFloat(e.getAttributeNS(null,"r")),l=1;if("OpenLayers.Geometry.Point"==e._geometryClass&&a){if(e.style.visibility="",t.graphic===!1)e.style.visibility="hidden";else if(t.externalGraphic){o=this.getPosition(e),t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var p=t.graphicWidth||t.graphicHeight,h=t.graphicHeight||t.graphicWidth;p=p?p:2*t.pointRadius,h=h?h:2*t.pointRadius;var u=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*p),y=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*h),c=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(o.x+u).toFixed()),e.setAttributeNS(null,"y",(o.y+y).toFixed()),e.setAttributeNS(null,"width",p),e.setAttributeNS(null,"height",h),e.setAttributeNS(this.xlinkns,"xlink:href",t.externalGraphic),e.setAttributeNS(null,"style","opacity: "+c),e.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var d=3*t.pointRadius,m=2*d,f=this.importSymbol(t.graphicName);o=this.getPosition(e),l=3*this.symbolMetrics[f.id][0]/m;var g=e.parentNode,L=e.nextSibling;g&&g.removeChild(e),e.firstChild&&e.removeChild(e.firstChild),e.appendChild(f.firstChild.cloneNode(!0)),e.setAttributeNS(null,"viewBox",f.getAttributeNS(null,"viewBox")),e.setAttributeNS(null,"width",m),e.setAttributeNS(null,"height",m),e.setAttributeNS(null,"x",o.x-d),e.setAttributeNS(null,"y",o.y-d),L?g.insertBefore(e,L):g&&g.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius);var v=t.rotation;if((void 0!==v||void 0!==e._rotation)&&o)if(e._rotation=v,v|=0,"svg"!==e.nodeName)e.setAttributeNS(null,"transform","rotate("+v+" "+o.x+" "+o.y+")");else{var O=this.symbolMetrics[f.id];e.firstChild.setAttributeNS(null,"transform","rotate("+v+" "+O[1]+" "+O[2]+")")}}return i.isFilled?(e.setAttributeNS(null,"fill",t.fillColor),e.setAttributeNS(null,"fill-opacity",t.fillOpacity)):e.setAttributeNS(null,"fill","none"),i.isStroked?(e.setAttributeNS(null,"stroke",t.strokeColor),e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity),e.setAttributeNS(null,"stroke-width",t.strokeWidth*l),e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round"),e.setAttributeNS(null,"stroke-linejoin","round"),t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,l))):e.setAttributeNS(null,"stroke","none"),t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents),null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor),e},dashStyle:function(e,t){var i=e.strokeWidth*t,r=e.strokeDashstyle;switch(r){case"solid":return"none";case"dot":return[1,4*i].join();case"dash":return[4*i,4*i].join();case"dashdot":return[4*i,4*i,1,4*i].join();case"longdash":return[8*i,4*i].join();case"longdashdot":return[8*i,4*i,1,4*i].join();default:return OpenLayers.String.trim(r).replace(/\s+/g,",")}},createNode:function(e,t){var i=document.createElementNS(this.xmlns,e);return t&&i.setAttributeNS(null,"id",t),i},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){var e=this.nodeFactory(this.container.id+"_svgRoot","svg");return e.style.display="block",e},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(e),e},drawPoint:function(e,t){return this.MAX_PIXEL=15e3,this.drawCircle(e,t,1)},drawCircle:function(e,t,i){this.MAX_PIXEL=15e5;var r=this.getResolution(),n=(t.x-this.featureDx)/r+this.left,s=this.top-t.y/r;return!!this.inValidRange(n,s)&&(e.setAttributeNS(null,"cx",n),e.setAttributeNS(null,"cy",s),e.setAttributeNS(null,"r",i),e)},drawLineString:function(e,t){this.MAX_PIXEL=15e3;var i=this.getComponentsString(t.components);return!!i.path&&(e.setAttributeNS(null,"points",i.path),i.complete?e:null)},drawLinearRing:function(e,t){this.MAX_PIXEL=15e3;var i=this.getComponentsString(t.components);return!!i.path&&(e.setAttributeNS(null,"points",i.path),i.complete?e:null)},drawPolygon:function(e,t){this.MAX_PIXEL=15e5;for(var i,r,n="",s=!0,o=!0,a=0,l=t.components.length;a<l;a++)n+=" M",i=this.getComponentsString(t.components[a].components," "),r=i.path,r?(n+=" "+r,o=i.complete&&o):s=!1;return n+=" z",!!s&&(e.setAttributeNS(null,"d",n),e.setAttributeNS(null,"fill-rule","evenodd"),o?e:null)},drawRectangle:function(e,t){this.MAX_PIXEL=15e5;var i=this.getResolution(),r=(t.x-this.featureDx)/i+this.left,n=this.top-t.y/i;return!!this.inValidRange(r,n)&&(e.setAttributeNS(null,"x",r),e.setAttributeNS(null,"y",n),e.setAttributeNS(null,"width",t.width/i),e.setAttributeNS(null,"height",t.height/i),e)},drawText:function(e,t,i,r){this.MAX_PIXEL=15e3;var n=!!t.labelOutlineWidth;if(n){var s=OpenLayers.Util.extend({},t);s.fontColor=s.labelOutlineColor,s.fontStrokeColor=s.labelOutlineColor,s.fontStrokeWidth=t.labelOutlineWidth,t.labelOutlineOpacity&&(s.fontOpacity=t.labelOutlineOpacity),delete s.labelOutlineWidth,this.drawText(e,s,i)}var o=this.getResolution(),a=(i.x-this.featureDx)/o+this.left,l=i.y/o-this.top,p=n?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,h=this.nodeFactory(e+p,"text");h.setAttributeNS(null,"x",a),h.setAttributeNS(null,"y",-l),t.cursor&&h.setAttributeNS(null,"cursor",t.cursor),t.fontColor&&h.setAttributeNS(null,"fill",t.fontColor),t.fontStrokeColor&&h.setAttributeNS(null,"stroke",t.fontStrokeColor),t.fontStrokeWidth&&h.setAttributeNS(null,"stroke-width",t.fontStrokeWidth),t.fontOpacity&&h.setAttributeNS(null,"opacity",t.fontOpacity),t.fontFamily&&h.setAttributeNS(null,"font-family",t.fontFamily),t.fontSize&&h.setAttributeNS(null,"font-size",t.fontSize),t.fontWeight&&h.setAttributeNS(null,"font-weight",t.fontWeight),t.fontStyle&&h.setAttributeNS(null,"font-style",t.fontStyle),t.labelSelect===!0?(h.setAttributeNS(null,"pointer-events","visible"),h._featureId=e):h.setAttributeNS(null,"pointer-events","none");var u=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;h.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[u[0]]||"middle"),OpenLayers.IS_GECKO===!0&&h.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[u[1]]||"central");for(var y=t.label.split("\n"),c=y.length;h.childNodes.length>c;)h.removeChild(h.lastChild);for(var d=0;d<c;d++){var m=this.nodeFactory(e+p+"_tspan_"+d,"tspan");if(t.labelSelect===!0&&(m._featureId=e,m._geometry=i,m._geometryClass=i.CLASS_NAME),OpenLayers.IS_GECKO===!1&&m.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[u[1]]||"-35%"),m.setAttribute("x",a),0==d){var f=OpenLayers.Renderer.SVG.LABEL_VFACTOR[u[1]];null==f&&(f=-.5),m.setAttribute("dy",f*(c-1)+"em")}else m.setAttribute("dy","1em");m.textContent=""===y[d]?" ":y[d],h.appendChild(m)}if(this.textRoot.appendChild(h),r){var g=document.getElementById(r);h.parentNode&&document.getElementById(r)&&(h.parentNode.removeChild(h),this.insertAfter(h,g))}var L=h,v=L.getBBox();if(t.showArrow){var O=this.nodeFactory(e+p+"_polygon","polygon"),P=document.getElementById(e+p+"_polygon");P&&L.parentNode.removeChild(P);var b=v.x-t.labelBackGroundMargin,w=v.y-3,M=b+v.width+2*t.labelBackGroundMargin,_=w,x=M,C=_+v.height+6,S=b+(v.width/2+t.labelBackGroundMargin)+4,N=C,E=b+(v.width/2+t.labelBackGroundMargin),T=N+6,A=b+(v.width/2+t.labelBackGroundMargin)-4,I=N,G=b,F=C;t.labelBackGroundStroke&&(O.style.stroke=t.labelBackGroundStroke,O.style.strokeWidth=1),O.style.fill=t.labelBackgroundColor,O.setAttribute("points",b+","+w+" "+M+","+_+" "+x+","+C+" "+S+","+N+" "+E+","+T+" "+A+","+I+" "+G+","+F+" "),L.parentNode.insertBefore(O,L)}else{var R=this.nodeFactory(e+p+"_rect","rect"),P=document.getElementById(e+p+"_rect");P&&L.parentNode.removeChild(P),t.labelBackgroundColor&&(R.x.baseVal.value=v.x-t.labelBackGroundMargin,R.y.baseVal.value=v.y,t.labelBackGroundStroke&&(R.style.stroke=t.labelBackGroundStroke,R.style.strokeWidth=1),R.rx.baseVal.value=t.labelBackGroundRXY,R.ry.baseVal.value=t.labelBackGroundRXY,R.width.baseVal.value=v.width+2*t.labelBackGroundMargin,R.height.baseVal.value=v.height,R.style.fill=t.labelBackgroundColor,L.parentNode.insertBefore(R,L))}},insertAfter:function(e,t){var i=t.parentNode;i.lastChild==t?i.appendChild(e):i.insertBefore(e,t.nextSibling)},getComponentsString:function(e,t){for(var i,r,n=[],s=!0,o=e.length,a=[],l=0;l<o;l++)r=e[l],n.push(r),i=this.getShortString(r),i?a.push(i):(l>0&&this.getShortString(e[l-1])&&a.push(this.clipLine(e[l],e[l-1])),l<o-1&&this.getShortString(e[l+1])&&a.push(this.clipLine(e[l],e[l+1])),s=!1);return{path:a.join(t||","),complete:s}},clipLine:function(e,t){if(t.equals(e))return"";var i,r=this.getResolution(),n=this.MAX_PIXEL-this.translationParameters.x,s=this.MAX_PIXEL-this.translationParameters.y,o=(t.x-this.featureDx)/r+this.left,a=this.top-t.y/r,l=(e.x-this.featureDx)/r+this.left,p=this.top-e.y/r;return(l<-n||l>n)&&(i=(p-a)/(l-o),l=l<0?-n:n,p=a+(l-o)*i),(p<-s||p>s)&&(i=(l-o)/(p-a),p=p<0?-s:s,l=o+(p-a)*i),l+","+p},getShortString:function(e){var t=this.getResolution(),i=(e.x-this.featureDx)/t+this.left,r=this.top-e.y/t;return!!this.inValidRange(i,r)&&i+","+r},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,i=document.getElementById(t);if(null!=i)return i;var r=OpenLayers.Renderer.symbol[e];if(!r)throw new Error(e+" is not a valid symbol name");var n=this.nodeFactory(t,"symbol"),s=this.nodeFactory(null,"polygon");n.appendChild(s);for(var o,a,l=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),p=[],h=0;h<r.length;h+=2)o=r[h],a=r[h+1],l.left=Math.min(l.left,o),l.bottom=Math.min(l.bottom,a),l.right=Math.max(l.right,o),l.top=Math.max(l.top,a),p.push(o,",",a);s.setAttributeNS(null,"points",p.join(" "));var u=l.getWidth(),y=l.getHeight(),c=[l.left-u,l.bottom-y,3*u,3*y];return n.setAttributeNS(null,"viewBox",c.join(" ")),this.symbolMetrics[t]=[Math.max(u,y),l.getCenterLonLat().lon,l.getCenterLonLat().lat],this.defs.appendChild(n),n},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!t){var i=e.target;t=i.parentNode&&i!=this.rendererRoot?i.parentNode._featureId:void 0}return t},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(e){this.size=e.clone();var t=this.root;if(t.style.width=e.w+"px",t.style.height=e.h+"px",t.width=e.w,t.height=e.h,this.resolution=null,this.hitDetection){var i=this.hitCanvas;i.style.width=e.w+"px",i.style.height=e.h+"px",i.width=e.w,i.height=e.h}},drawFeature:function(e,t){var i;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style);var r,n=e.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(r=this.map.getMaxExtent());var s=n&&n.intersectsBounds(this.extent,{worldBounds:r});i="none"!==t.display&&!!n&&s,i?this.features[e.id]=[e,t]:delete this.features[e.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),i},drawGeometry:function(e,t,i){var r=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=r&&"OpenLayers.Geometry.MultiPoint"!=r&&"OpenLayers.Geometry.MultiLineString"!=r&&"OpenLayers.Geometry.MultiPolygon"!=r)switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,i);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,i);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,i);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,i)}else for(var n=0;n<e.components.length;n++)this.drawGeometry(e.components[n],t,i)},drawExternalGraphic:function(e,t,i){var r=new Image,n=t.title||t.graphicTitle;n&&(r.title=n);var s=t.graphicWidth||t.graphicHeight,o=t.graphicHeight||t.graphicWidth;s=s?s:2*t.pointRadius,o=o?o:2*t.pointRadius;var a=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*s),l=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*o),p=t.graphicOpacity||t.fillOpacity,h=function(){if(this.features[i]){var t=this.getLocalXY(e),n=t[0],h=t[1];if(!isNaN(n)&&!isNaN(h)){var u=n+a|0,y=h+l|0,c=this.canvas;
c.globalAlpha=p;var d=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);c.drawImage(r,u*d,y*d,s*d,o*d),this.hitDetection&&(this.setHitContextStyle("fill",i),this.hitContext.fillRect(u,y,s,o))}}};r.onload=OpenLayers.Function.bind(h,this),r.src=t.externalGraphic},drawNamedSymbol:function(e,t,i){var r,n,s,o,a,l,p,h,u,y=Math.PI/180,c=OpenLayers.Renderer.symbol[t.graphicName];if(!c)throw new Error(t.graphicName+" is not a valid symbol name");if(c.length&&!(c.length<2)){var d=this.getLocalXY(e),m=d[0],f=d[1];if(!isNaN(m)&&!isNaN(f)){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),t.graphicName in this.cachedSymbolBounds)l=this.cachedSymbolBounds[t.graphicName];else{for(l=new OpenLayers.Bounds,a=0;a<c.length;a+=2)l.extend(new OpenLayers.LonLat(c[a],c[a+1]));this.cachedSymbolBounds[t.graphicName]=l}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(m,f),this.hitDetection&&this.hitContext.translate(m,f),h=y*t.rotation,isNaN(h)||(this.canvas.rotate(h),this.hitDetection&&this.hitContext.rotate(h)),p=2*t.pointRadius/Math.max(l.getWidth(),l.getHeight()),this.canvas.scale(p,p),this.hitDetection&&this.hitContext.scale(p,p),s=l.getCenterLonLat().lon,o=l.getCenterLonLat().lat,this.canvas.translate(-s,-o),this.hitDetection&&this.hitContext.translate(-s,-o),u=t.strokeWidth,t.strokeWidth=u/p,t.fill!==!1){for(this.setCanvasStyle("fill",t),this.canvas.beginPath(),a=0;a<c.length;a+=2)r=c[a],n=c[a+1],0==a&&this.canvas.moveTo(r,n),this.canvas.lineTo(r,n);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),a=0;a<c.length;a+=2)r=c[a],n=c[a+1],0==a&&this.canvas.moveTo(r,n),this.hitContext.lineTo(r,n);this.hitContext.closePath(),this.hitContext.fill()}}if(t.stroke!==!1){for(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),a=0;a<c.length;a+=2)r=c[a],n=c[a+1],0==a&&this.canvas.moveTo(r,n),this.canvas.lineTo(r,n);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",i,t,p),this.hitContext.beginPath(),a=0;a<c.length;a+=2)r=c[a],n=c[a+1],0==a&&this.hitContext.moveTo(r,n),this.hitContext.lineTo(r,n);this.hitContext.closePath(),this.hitContext.stroke()}}t.strokeWidth=u,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}}},setCanvasStyle:function(e,t){"fill"===e?(this.canvas.globalAlpha=t.fillOpacity,this.canvas.fillStyle=t.fillColor):"stroke"===e?(this.canvas.globalAlpha=t.strokeOpacity,this.canvas.strokeStyle=t.strokeColor,this.canvas.lineWidth=t.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(e){var t=Number(e.split("_").pop())+1;t>=16777216&&(this.hitOverflow=t-16777215,t=t%16777216+1);var i="000000"+t.toString(16),r=i.length;return i="#"+i.substring(r-6,r)},setHitContextStyle:function(e,t,i,r){var n=this.featureIdToHex(t);"fill"==e?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=n):"stroke"==e?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=n,"undefined"==typeof r?this.hitContext.lineWidth=i.strokeWidth+2:isNaN(r)||(this.hitContext.lineWidth=i.strokeWidth+2/r)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(e,t,i){if(t.graphic!==!1)if(t.externalGraphic)this.drawExternalGraphic(e,t,i);else if(t.graphicName&&"circle"!=t.graphicName)this.drawNamedSymbol(e,t,i);else{var r=this.getLocalXY(e),n=r[0],s=r[1];if(!isNaN(n)&&!isNaN(s)){var o=2*Math.PI,a=t.pointRadius;t.fill!==!1&&(this.setCanvasStyle("fill",t),this.canvas.beginPath(),this.canvas.arc(n,s,a,0,o,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),this.hitContext.arc(n,s,a,0,o,!0),this.hitContext.fill())),t.stroke!==!1&&(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),this.canvas.arc(n,s,a,0,o,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.hitContext.beginPath(),this.hitContext.arc(n,s,a,0,o,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(e,t,i){t=OpenLayers.Util.applyDefaults({fill:!1},t),this.drawLinearRing(e,t,i)},drawLinearRing:function(e,t,i){t.fill!==!1&&(this.setCanvasStyle("fill",t),this.renderPath(this.canvas,e,t,i,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.renderPath(this.hitContext,e,t,i,"fill"))),t.stroke!==!1&&(this.setCanvasStyle("stroke",t),this.renderPath(this.canvas,e,t,i,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.renderPath(this.hitContext,e,t,i,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(e,t,i,r,n){var s=t.components,o=s.length;e.beginPath();var a=this.getLocalXY(s[0]),l=a[0],p=a[1];if(!isNaN(l)&&!isNaN(p)){e.moveTo(a[0],a[1]);for(var h=1;h<o;++h){var u=this.getLocalXY(s[h]);e.lineTo(u[0],u[1])}"fill"===n?e.fill():e.stroke()}},drawPolygon:function(e,t,i){var r=e.components,n=r.length;this.drawLinearRing(r[0],t,i);for(var s=1;s<n;++s)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(r[s],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},t),i),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(r[s],OpenLayers.Util.applyDefaults({fill:!1},t),i)},drawText:function(e,t){var i=this.getLocalXY(e);this.setCanvasStyle("reset"),this.canvas.fillStyle=t.fontColor,this.canvas.globalAlpha=t.fontOpacity||1;var r=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),n=t.label.split("\n"),s=n.length;if(this.canvas.fillText){this.canvas.font=r,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";var o=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==o&&(o=-.5);var a=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;i[1]+=a*o*(s-1);for(var l=0;l<s;l++)t.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=t.labelOutlineOpacity||t.fontOpacity||1,this.canvas.strokeStyle=t.labelOutlineColor,this.canvas.lineWidth=t.labelOutlineWidth,this.canvas.strokeText(n[l],i[0],i[1]+a*l+1),this.canvas.restore()),this.canvas.fillText(n[l],i[0],i[1]+a*l)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=r;var p=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];null==p&&(p=-.5);var o=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==o&&(o=-.5);var a=this.canvas.mozMeasureText("xx");i[1]+=a*(1+o*s);for(var l=0;l<s;l++){var h=i[0]+p*this.canvas.mozMeasureText(n[l]),u=i[1]+l*a;this.canvas.translate(h,u),this.canvas.mozDrawText(n[l]),this.canvas.translate(-h,-u)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution(),i=this.extent,r=(e.x-this.featureDx)/t+-i.left/t,n=i.top/t-e.y/t;return[r,n]},clear:function(){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,t,e)},getFeatureIdFromEvent:function(e){var t,i;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var r=e.xy,n=0|r.x,s=0|r.y,o=this.hitContext.getImageData(n,s,1,1).data;if(255===o[3]){var a=o[2]+256*(o[1]+256*o[0]);if(a){t="OpenLayers_Feature_Vector_"+(a-1+this.hitOverflow);try{i=this.features[t][0]}catch(l){}}}}return i},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t)delete this.features[e[t].id];this.redraw()},redraw:function(){if(!this.locked){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this.hitDetection&&this.hitContext.clearRect(0,0,t,e);var i,r,n,s=[],o=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var a in this.features)this.features.hasOwnProperty(a)&&(i=this.features[a][0],r=i.geometry,this.calculateFeatureDx(r.getBounds(),o),n=this.features[a][1],this.drawGeometry(r,n,i.id),n.label&&s.push([i,n]));for(var l,p=0,h=s.length;p<h;++p)l=s[p],this.drawText(l[0].geometry.getCentroid(),l[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(e){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var t=document.createStyleSheet(),i=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],r=0,n=i.length;r<n;r++)t.addRule("olv\\:"+i[r],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(e,t){var i=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),r=this.getResolution(),n=e.left/r|0,s=e.top/r-this.size.h|0;t||!this.offset?(this.offset={x:n,y:s},n=0,s=0):(n-=this.offset.x,s-=this.offset.y);var o=n-this.xOffset+" "+s;this.root.coordorigin=o;for(var a,l=[this.root,this.vectorRoot,this.textRoot],p=0,h=l.length;p<h;++p){a=l[p];var u=this.size.w+" "+this.size.h;a.coordsize=u}return this.root.style.flip="y",i},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var t,i=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],r=this.size.w+"px",n=this.size.h+"px",s=0,o=i.length;s<o;++s)t=i[s],t.style.width=r,t.style.height=n},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"olv:rect":this.isComplexSymbol(t.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":i="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":i="olv:shape"}return i},setStyle:function(e,t,i,r){t=t||e._style;for(var n in t)t[n]="undefined"!=t[n]?t[n]:null;i=i||e._options;var s=t.fillColor,o=t.title||t.graphicTitle;if(o&&(e.title=o),"OpenLayers.Geometry.Point"===e._geometryClass)if(t.externalGraphic){i.isFilled=!0;var a=t.graphicWidth||t.graphicHeight,l=t.graphicHeight||t.graphicWidth;a=a?a:2*t.pointRadius,l=l?l:2*t.pointRadius;var p=this.getResolution(),h=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*a),u=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*l);e.style.left=((r.x-this.featureDx)/p-this.offset.x+h|0)+"px",e.style.top=(r.y/p-this.offset.y-(u+l)|0)+"px",e.style.width=a+"px",e.style.height=l+"px",e.style.flip="y",s="none",i.isStroked=!1}else if(this.isComplexSymbol(t.graphicName)){var y=this.importSymbol(t.graphicName);e.path=y.path,e.coordorigin=y.left+","+y.bottom;var c=y.size;e.coordsize=c+","+c,this.drawCircle(e,r,t.pointRadius),e.style.flip="y"}else this.drawCircle(e,r,t.pointRadius);i.isFilled?e.fillcolor=s:e.filled="false";var d=e.getElementsByTagName("fill"),m=0==d.length?null:d[0];i.isFilled?(m||(m=this.createNode("olv:fill",e.id+"_fill")),m.opacity=t.fillOpacity,"OpenLayers.Geometry.Point"===e._geometryClass&&t.externalGraphic&&(t.graphicOpacity&&(m.opacity=t.graphicOpacity),m.src=t.externalGraphic,m.type="frame",t.graphicWidth&&t.graphicHeight||(m.aspect="atmost")),m.parentNode!=e&&e.appendChild(m)):m&&e.removeChild(m);var f=t.rotation;void 0===f&&void 0===e._rotation||(e._rotation=f,t.externalGraphic?(this.graphicRotate(e,h,u,t),m.opacity=0):"OpenLayers.Geometry.Point"===e._geometryClass&&(e.style.rotation=f||0));var g=e.getElementsByTagName("stroke"),L=0==g.length?null:g[0];return i.isStroked?(L||(L=this.createNode("olv:stroke",e.id+"_stroke"),e.appendChild(L)),L.on=!0,L.color=t.strokeColor,L.weight=t.strokeWidth+"px",L.opacity=t.strokeOpacity,L.endcap="butt"==t.strokeLinecap?"flat":t.strokeLinecap||"round",t.strokeDashstyle&&(L.dashstyle=this.dashStyle(t))):(e.stroked=!1,L&&(L.on=!1)),"inherit"!=t.cursor&&null!=t.cursor&&(e.style.cursor=t.cursor),e},graphicRotate:function(e,t,i,r){var n,s,r=r||e._style,o=r.rotation||0;if(!r.graphicWidth||!r.graphicHeight){var a=new Image;return a.onreadystatechange=OpenLayers.Function.bind(function(){"complete"!=a.readyState&&"interactive"!=a.readyState||(n=a.width/a.height,s=Math.max(2*r.pointRadius,r.graphicWidth||0,r.graphicHeight||0),t*=n,r.graphicWidth=s*n,r.graphicHeight=s,this.graphicRotate(e,t,i,r))},this),void(a.src=r.externalGraphic)}s=Math.max(r.graphicWidth,r.graphicHeight),n=r.graphicWidth/r.graphicHeight;var l=Math.round(r.graphicWidth||s*n),p=Math.round(r.graphicHeight||s);e.style.width=l+"px",e.style.height=p+"px";var h=document.getElementById(e.id+"_image");h||(h=this.createNode("olv:imagedata",e.id+"_image"),e.appendChild(h)),h.style.width=l+"px",h.style.height=p+"px",h.src=r.externalGraphic,h.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var u=o*Math.PI/180,y=Math.sin(u),c=Math.cos(u),d="progid:DXImageTransform.Microsoft.Matrix(M11="+c+",M12="+-y+",M21="+y+",M22="+c+",SizingMethod='auto expand')\n",m=r.graphicOpacity||r.fillOpacity;m&&1!=m&&(d+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+m+")\n"),e.style.filter=d;var f=new OpenLayers.Geometry.Point((-t),(-i)),g=new OpenLayers.Bounds(0,0,l,p).toGeometry();r.rotation="undefined"!=r.rotation?r.rotation:0,g.rotate(r.rotation,f);var L=g.getBounds();e.style.left=Math.round(parseInt(e.style.left)+L.left)+"px",e.style.top=Math.round(parseInt(e.style.top)-L.bottom)+"px"},postDraw:function(e){e.style.visibility="visible";var t=e._style.fillColor,i=e._style.strokeColor;"none"==t&&e.fillcolor!=t&&(e.fillcolor=t),"none"==i&&e.strokecolor!=i&&(e.strokecolor=i)},setNodeDimension:function(e,t){var i=t.getBounds();if(i){var r=this.getResolution(),n=new OpenLayers.Bounds((i.left-this.featureDx)/r-this.offset.x|0,i.bottom/r-this.offset.y|0,(i.right-this.featureDx)/r-this.offset.x|0,i.top/r-this.offset.y|0);e.style.left=n.left+"px",e.style.top=n.top+"px",e.style.width=n.getWidth()+"px",e.style.height=n.getHeight()+"px",e.coordorigin=n.left+" "+n.top,e.coordsize=n.getWidth()+" "+n.getHeight()}},dashStyle:function(e){var t=e.strokeDashstyle;switch(t){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return t;default:var i=t.split(/[ ,]/);return 2==i.length?1*i[0]>=2*i[1]?"longdash":1==i[0]||1==i[1]?"dot":"dash":4==i.length?1*i[0]>=2*i[1]?"longdashdot":"dashdot":"solid"}},createNode:function(e,t){var i=document.createElement(e);return t&&(i.id=t),i.unselectable="on",i.onselectstart=OpenLayers.Function.False,i},nodeTypeCompare:function(e,t){var i=t,r=i.indexOf(":");r!=-1&&(i=i.substr(r+1));var n=e.nodeName;return r=n.indexOf(":"),r!=-1&&(n=n.substr(r+1)),i==n},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"olv:group")},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){if(!isNaN(t.x)&&!isNaN(t.y)){var r=this.getResolution();e.style.left=((t.x-this.featureDx)/r-this.offset.x|0)-i+"px",e.style.top=(t.y/r-this.offset.y|0)-i+"px";var n=2*i;return e.style.width=n+"px",e.style.height=n+"px",e}return!1},drawLineString:function(e,t){return this.drawLine(e,t,!1)},drawLinearRing:function(e,t){return this.drawLine(e,t,!0)},drawLine:function(e,t,i){this.setNodeDimension(e,t);for(var r,n,s,o=this.getResolution(),a=t.components.length,l=new Array(a),p=0;p<a;p++)r=t.components[p],n=(r.x-this.featureDx)/o-this.offset.x|0,s=r.y/o-this.offset.y|0,l[p]=" "+n+","+s+" l ";var h=i?" x e":" e";return e.path="m"+l.join("")+h,e},drawPolygon:function(e,t){this.setNodeDimension(e,t);var i,r,n,s,o,a,l,p,h,u,y,c,d=this.getResolution(),m=[];for(i=0,r=t.components.length;i<r;i++){for(m.push("m"),n=t.components[i].components,s=0===i,o=null,a=null,l=0,p=n.length;l<p;l++)h=n[l],y=(h.x-this.featureDx)/d-this.offset.x|0,c=h.y/d-this.offset.y|0,u=" "+y+","+c,m.push(u),0==l&&m.push(" l"),s||(o?o!=u&&(a?a!=u&&(s=!0):a=u):o=u);m.push(s?" x ":" ")}return m.push("e"),e.path=m.join(""),e},drawRectangle:function(e,t){var i=this.getResolution();return e.style.left=((t.x-this.featureDx)/i-this.offset.x|0)+"px",e.style.top=(t.y/i-this.offset.y|0)+"px",e.style.width=(t.width/i|0)+"px",e.style.height=(t.height/i|0)+"px",e},drawText:function(e,t,i){var r=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"olv:rect"),n=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),s=this.getResolution();r.style.left=((i.x-this.featureDx)/s-this.offset.x|0)+"px",r.style.top=(i.y/s-this.offset.y|0)+"px",r.style.flip="y",n.innerText=t.label,"inherit"!=t.cursor&&null!=t.cursor&&(n.style.cursor=t.cursor),t.fontColor&&(n.style.color=t.fontColor),t.fontOpacity&&(n.style.filter="alpha(opacity="+100*t.fontOpacity+")"),t.fontFamily&&(n.style.fontFamily=t.fontFamily),t.fontSize&&"undefined"!=t.fontSize&&(n.style.fontSize=t.fontSize),t.fontWeight&&(n.style.fontWeight=t.fontWeight),t.fontStyle&&(n.style.fontStyle=t.fontStyle),t.labelSelect===!0&&(r._featureId=e,n._featureId=e,n._geometry=i,n._geometryClass=i.CLASS_NAME),n.style.whiteSpace="nowrap",t.labelBackgroundColor&&(n.style.backgroundColor=t.labelBackgroundColor),n.inset="1px,0px,0px,0px",r.appendChild(n),this.textRoot.appendChild(r),r.appendChild(n),this.textRoot.appendChild(r);var o=t.labelAlign||"cm";1==o.length&&(o+="m");var a=n.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[o.substr(0,1)],l=n.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[o.substr(0,1)];r.style.left=parseInt(r.style.left)-a-1+"px",r.style.top=parseInt(r.style.top)+l+"px"},moveRoot:function(e){var t=this.map.getLayer(e.container.id);t instanceof OpenLayers.Layer.Vector.RootContainer&&(t=this.map.getLayer(this.container.id)),t&&t.renderer.clear(),OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments),t&&t.redraw()},importSymbol:function(e){var t=this.container.id+"-"+e,i=this.symbolCache[t];if(i)return i;var r=OpenLayers.Renderer.symbol[e];if(!r)throw new Error(e+" is not a valid symbol name");for(var n=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),s=["m"],o=0;o<r.length;o+=2){var a=r[o],l=r[o+1];n.left=Math.min(n.left,a),n.bottom=Math.min(n.bottom,l),n.right=Math.max(n.right,a),n.top=Math.max(n.top,l),s.push(a),s.push(l),0==o&&s.push("l")}s.push("x e");var p=s.join(" "),h=(n.getWidth()-n.getHeight())/2;return h>0?(n.bottom=n.bottom-h,n.top=n.top+h):(n.left=n.left+h,n.right=n.right-h),i={path:p,size:n.getWidth(),left:n.left,bottom:n.bottom},this.symbolCache[t]=i,i},CLASS_NAME:"OpenLayers.Renderer.VML"}),OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1},OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,clicentData:{tempcluster:[]},showMarker:{},clusterVisable:!0,isClusterLayer:!1,initialize:function(e,t){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var i=0,r=this.strategies.length;i<r;i++)this.strategies[i].setLayer(this)},destroy:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;t<i;t++)e=this.strategies[t],e.autoDestroy&&e.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.features=null,this.selectedFeatures=null,this.unrenderedFeatures=null,this.renderer&&this.renderer.destroy(),this.renderer=null,this.geometryType=null,this.drawn=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.Vector(this.name,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e]);for(var t=this.features,i=t.length,r=new Array(i),n=0;n<i;++n)r[n]=t[n].clone();return e.features=r,e},refresh:function(e){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",e)},assignRenderer:function(){for(var e=0,t=this.renderers.length;e<t;e++){var i=this.renderers[e],r="function"==typeof i?i:OpenLayers.Renderer[i];if(r&&r.prototype.supported()){this.renderer=new r(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(e){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var t=this.map.getSize();t.w=t.w*this.ratio,t.h=t.h*this.ratio,this.renderer.setSize(t)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;t<i;t++)e=this.strategies[t],e.autoActivate&&e.activate()}},removeMap:function(e){if(this.drawn=!1,this.strategies){var t,i,r;for(i=0,r=this.strategies.length;i<r;i++)t=this.strategies[i],t.autoActivate&&t.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var e=this.map.getSize();e.w=e.w*this.ratio,e.h=e.h*this.ratio,this.renderer.setSize(e)},moveTo:function(e,t,i){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var r=!0;if(!i){this.renderer.root.style.visibility="hidden";var n=this.map.getSize(),s=n.w,o=n.h,a=s/2*this.ratio-s/2,l=o/2*this.ratio-o/2;a+=this.map.layerContainerOriginPx.x,a=-Math.round(a),l+=this.map.layerContainerOriginPx.y,l=-Math.round(l),this.div.style.left=a+"px",this.div.style.top=l+"px";var p=this.map.getExtent().scale(this.ratio);if(r=this.renderer.setExtent(p,t),this.renderer.root.style.visibility="visible",OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft),!t&&r)for(var h in this.unrenderedFeatures){var u=this.unrenderedFeatures[h];this.drawFeature(u)}}if(!this.drawn||t||!r){this.drawn=!0;for(var u,h=0,y=this.features.length;h<y;h++)this.renderer.locked=h!==y-1,u=this.features[h],this.drawFeature(u)}},display:function(e){OpenLayers.Layer.prototype.display.apply(this,arguments);var t=this.div.style.display;t!=this.renderer.root.style.display&&(this.renderer.root.style.display=t)},addFeatures:function(e,t){OpenLayers.Util.isArray(e)||(e=[e]);var i=!t||!t.silent;if(i){var r={features:e},n=this.events.triggerEvent("beforefeaturesadded",r);if(n===!1)return;e=r.features}for(var s=[],o=0,a=e.length;o<a;o++){o!=e.length-1?this.renderer.locked=!0:this.renderer.locked=!1;var l=e[o];if(this.geometryType&&!(l.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(l.layer=this,!l.style&&this.style&&(l.style=OpenLayers.Util.extend({},this.style)),i){if(this.events.triggerEvent("beforefeatureadded",{feature:l})===!1)continue;this.preFeatureInsert(l)}s.push(l),this.features.push(l),this.drawFeature(l),i&&(this.events.triggerEvent("featureadded",{feature:l}),this.onFeatureInsert(l))}i&&this.events.triggerEvent("featuresadded",{features:s})},removeFeatures:function(e,t){function i(e,t){if(t){var r=document.getElementById(e+"_clip_"+t);t++}else{var r=document.getElementById(e);t=1}r&&(n.renderer.vectorRoot.removeChild(r),i(e,t))}if(e&&0!==e.length){if(e===this.features)return this.removeAllFeatures(t);OpenLayers.Util.isArray(e)||(e=[e]),e===this.selectedFeatures&&(e=e.slice());var r=!t||!t.silent;r&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var n=this,s=e.length-1;s>=0;s--){0!=s&&e[s-1].geometry?this.renderer.locked=!0:this.renderer.locked=!1;var o=e[s];if(delete this.unrenderedFeatures[o.id],r&&this.events.triggerEvent("beforefeatureremoved",{feature:o}),this.features=OpenLayers.Util.removeItem(this.features,o),o.layer=null,o.geometry){this.renderer.eraseFeatures(o);var a=o.geometry;if("OpenLayers.Geometry.Collection"===a.CLASS_NAME||"OpenLayers.Geometry.MultiPoint"===a.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"===a.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"===a.CLASS_NAME||a.isMultiPlotting)for(var l=0,p=a.components.length;l<p;l++){var h=a.components[l].id;i(h)}else i(a.id)}if(OpenLayers.Util.indexOf(this.selectedFeatures,o)!=-1&&OpenLayers.Util.removeItem(this.selectedFeatures,o),r&&this.events.triggerEvent("featureremoved",{feature:o}),"SVGExtended"===this.renderers[0]&&"NPMapLib.Symbols.Bubble"===o.attributes.CLASS_NAME){var u=o.data;u._stopAnimate()}}r&&this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){var t=!e||!e.silent,i=this.features;t&&this.events.triggerEvent("beforefeaturesremoved",{features:i});for(var r,n=i.length-1;n>=0;n--)r=i[n],t&&this.events.triggerEvent("beforefeatureremoved",{feature:r}),r.layer=null,t&&this.events.triggerEvent("featureremoved",{feature:r});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],t&&this.events.triggerEvent("featuresremoved",{features:i})},destroyFeatures:function(e,t){var i=void 0==e;if(i&&(e=this.features),e){this.removeFeatures(e,t);for(var r=e.length-1;r>=0;r--)e[r].destroy()}},drawFeature:function(e,t){if(this.drawn){if("object"!=typeof t){t||e.state!==OpenLayers.State.DELETE||(t="delete");var i=t||e.renderIntent;t=e.style||this.style,t||(t=this.styleMap.createSymbolizer(e,i))}var r=this.renderer.drawFeature(e,t);e.style=t,r===!1||null===r?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id],this.openBubbleAnimate(e)}},openBubbleAnimate:function(e){if("SVGExtended"===this.renderers[0]&&e.attributes&&"NPMapLib.Symbols.Bubble"===e.attributes.CLASS_NAME){var t=e.data,i=e.geometry.id;t._stopAnimate(),t._animate(i)}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var t=null,i=e.clientX,r=e.clientY;if(target=document.elementFromPoint(i,r),"circle"===target.nodeName||"path"===target.nodeName){var n,s;"circle"===target.nodeName&&(n=target.parentNode.parentNode.parentNode),"path"===target.nodeName&&(n=target.parentNode.parentNode),s=n.getAttributeNS(null,"type"),n&&s&&"bubble"===s&&(target=n)}var o=target?target._featureId:void 0;if(o&&(t="string"==typeof o?this.getFeatureById(o):o),NPMapLib.isAnimat)return t;if(!t&&e.xy){var a=e.xy.x-5,l=e.xy.y-5,p=e.xy.x+5,h=e.xy.y+5,u=new OpenLayers.Pixel(a,l),y=new OpenLayers.Pixel(p,h),c=this.map.getLonLatFromViewPortPx(u),d=this.map.getLonLatFromViewPortPx(y);if(!c||!d)return t;var m=new OpenLayers.Geometry.Point(c.lon,c.lat),f=new OpenLayers.Geometry.Point(c.lon,d.lat),g=new OpenLayers.Geometry.Point(d.lon,d.lat),L=new OpenLayers.Geometry.Point(d.lon,c.lat),v=[m,f,g,L],O=new OpenLayers.Geometry.LinearRing(v),P=new OpenLayers.Geometry.Polygon(O),b=this.getFeaturesByGeometry(P);b.length>0&&(t=b[b.length-1])}return t},getFeatureBy:function(e,t){for(var i=null,r=0,n=this.features.length;r<n;++r)if(this.features[r][e]==t){i=this.features[r];break}return i},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByGeometry:function(e){var t,i,r=this.features.length,n=[];for(t=0;t<r;t++)i=this.features[t],i&&i.geometry&&"OpenLayers.Geometry.LineString"===i.geometry.CLASS_NAME&&i.geometry.intersects(e)&&n.push(i);return n},getFeaturesByAttribute:function(e,t){var i,r,n=this.features.length,s=[];for(i=0;i<n;i++)r=this.features[i],r&&r.attributes&&r.attributes[e]===t&&s.push(r);return s},onFeatureInsert:function(e){},preFeatureInsert:function(e){},getDataExtent:function(){var e=null,t=this.features;if(t&&t.length>0)for(var i=null,r=0,n=t.length;r<n;r++)i=t[r].geometry,i&&(null===e&&(e=new OpenLayers.Bounds),e.extend(i.getBounds()));return e},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(e){for(var t,i=this.layers,r=0;r<i.length;r++)if(t=i[r].getFeatureFromEvent(e))return t},setMap:function(e){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),e.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(e){e.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var e,t=0;t<this.map.layers.length;++t)e=this.map.layers[t],OpenLayers.Util.indexOf(this.layers,e)!=-1&&e.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var e,t=0;t<this.layers.length;++t)e=this.layers[t],this.renderer&&e.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(e.renderer)},handleChangeLayer:function(e){var t=e.layer;"order"==e.property&&OpenLayers.Util.indexOf(this.layers,t)!=-1&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e,this.active=!1},destroy:function(){this.deactivate(),this.layer=null,this.options=null},setLayer:function(e){this.layer=e},activate:function(){return!this.active&&(this.active=!0,!0)},deactivate:function(){return!!this.active&&(this.active=!1,!0)},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,zoomstart:this.clearCluster,scope:this}),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);if(e){this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,zoomstart:this.clearCluster,scope:this});this.layer.map}return e},cacheFeatures:function(e){var t=!0;return this.clustering||(this.clearCache(),this.features=e.features,this.cluster(),t=!1),t},clearCache:function(e){this.clustering||(this.features=null)},clearCluster:function(e){this.layer.removeAllFeatures()},cluster:function(e){if((!e||e.zoomChanged)&&this.features){var t=this.layer.map.getResolution();if(t!=this.resolution||!this.clustersExist()){this.resolution=t;for(var i,r,n,s=[],o=this.layer.map.getExtent(),a=0;a<this.features.length;++a){i=this.features[a];var l=i.geometry.getBounds();if((!o||o.intersectsBounds(l))&&i.geometry){r=!1;for(var p=s.length-1;p>=0;--p)if(n=s[p],this.shouldCluster(n,i)){this.addToCluster(n,i),r=!0;break}r||s.push(this.createCluster(this.features[a]))}}if(this.clustering=!0,this.layer.removeAllFeatures(),this.clustering=!1,s.length>0){if(this.threshold>1){var h=s.slice();s=[];for(var u,a=0,y=h.length;a<y;++a)u=h[a],u.attributes.count<this.threshold?Array.prototype.push.apply(s,u.cluster):s.push(u)}this.clustering=!0,this.layer.addFeatures(s),this.clustering=!1}this.clusters=s}}},clustersExist:function(){var e=!1;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){
e=!0;for(var t=0;t<this.clusters.length;++t)if(this.clusters[t]!=this.layer.features[t]){e=!1;break}}return e},shouldCluster:function(e,t){var i=e.geometry.getBounds().getCenterLonLat(),r=t.geometry.getBounds().getCenterLonLat(),n=Math.sqrt(Math.pow(i.lon-r.lon,2)+Math.pow(i.lat-r.lat,2))/this.resolution;return n<=this.distance},addToCluster:function(e,t){e.cluster.push(t),e.sx||(e.sx=0),e.sy||(e.sy=0),e.sx+=t.geometry.x,e.sy+=t.geometry.y,e.attributes.count+=1},createCluster:function(e){var t=e.geometry.getBounds().getCenterLonLat(),i=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),{count:1});return i.cluster=[e],i},CLASS_NAME:"OpenLayers.Strategy.Cluster"}),OpenLayers.Strategy.AnimatedCluster=OpenLayers.Class(OpenLayers.Strategy.Cluster,{animationMethod:OpenLayers.Easing.Expo.easeOut,animationDuration:20,animationTween:null,previousResolution:null,previousClusters:null,animating:!1,zoomIn:!0,maxZoom:null,minZoom:null,_clusterDataStatus:null,currentZoom:0,clusterClickModel:null,index:0,isAsynchronous:!0,threshold:2,_xData:[],timer:null,oldClusters:[],statistics:[],filterFun:null,minClusterCount:0,callbackFun:null,initialize:function(e){OpenLayers.Strategy.Cluster.prototype.initialize.apply(this,arguments),e.animationMethod&&(this.animationMethod=e.animationMethod)},destroy:function(){this.animationTween&&(this.animationTween.stop(),this.animationTween=null),this._clusterDataStatus=null},binarySearch:function(e,t,i){for(var r=e.length-1,n=0,s=0;n<=r;){var o,a=Math.ceil((n+r)/2);if(o="x"===i?e[a].geometry.x:e[a].geometry.y,o<t){if(n+=1,0!==s&&1!==s)return a;s=1}else{if(!(o>t))return a;if(r-=1,0!==s&&s!=-1)return a;s=-1}}return"x"==i?t<e[0].geometry.x?0:e.length-1:t<e[0].geometry.y?0:e.length-1},cluster:function(e){var t=this.layer.map.getResolution(),i=e&&"moveend"===e.type&&!e.zoomChanged;if(!this.animating||t!==this.resolution){var r=!1;if(e&&"moveend"===e.type&&e.zoomChanged&&this.currentZoom!==this.layer.map.getZoom()){if(this.oldClusters=[],null==this.features)return;r=!0,this._clusterDataStatus=this.features.slice();for(var n=0;n<this._clusterDataStatus.length;n++)this._clusterDataStatus[n]._status=!1,this._clusterDataStatus[n].style=null;this.layer.clicentData.tempcluster=[],this.layer.removeAllFeatures()}if(this.layer.map.getZoom()<this.minZoom){window.clearTimeout(this.timer),this.layer.removeAllFeatures();for(var n=0;n<this.statistics.length;n++)if(this.statistics[n]&&this.statistics[n].x&&this.statistics[n].y&&this.statistics[n].label>0){var s=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(this.statistics[n].x,this.statistics[n].y),{count:this.statistics[n].label,isStatistics:!0});s.attributes.count=this.statistics[n].label,this.layer.addFeatures([s],{silent:!0})}}else{for(var o=this.layer.map.getExtent(),a=[],n=0,l=this.layer.features.length;n<l;n++)if(this.layer.features[n].cluster)for(var p=0;p<this.layer.features[n].cluster.length;p++){var h=this.layer.features[n].cluster[p].geometry;if(!o.contains(h.x,h.y,!0)){a.push(this.layer.features[n]);for(var u=0;u<this.layer.features[n].cluster.length;u++)this.layer.features[n].cluster[u]._status=!1;break}}else{var h=this.layer.features[n].geometry,y=o.contains(h.x,h.y,!0);y||(this.layer.features[n]._status=!1,this.layer.features[n].data._status=!1,this.layer.features[n].style=null,a.push(this.layer.features[n]))}this.layer.removeFeatures(a);for(var c=[],n=0;n<this.oldClusters.length;n++){var h=this.oldClusters[n].geometry;if(o.contains(h)){for(var d=(this.oldClusters[n],[]),p=0;p<this.oldClusters[n].cluster.length;p++){var m=this.oldClusters[n].cluster[p].geometry;o.contains(m)?(this.oldClusters[n].cluster[p]._status=!0,d.push(this.oldClusters[n].cluster[p])):this.oldClusters[n].cluster[p]._status=!1}this.oldClusters[n].cluster=d,this.oldClusters[n].attributes.count=d.length,c.push(this.oldClusters[n])}}if(this.oldClusters=c,this.currentZoom=this.layer.map.getZoom(),this._xData&&!(this._xData.length<=0)){var f=this.layer.map.getExtent(),g=f.left,L=f.right,v=f.bottom,O=f.top,P=this.binarySearch(this._xData,g,"x"),b=this.binarySearch(this._xData,L,"x"),w=[];w=P!=b||P!=this._xData.length-1&&0!=P?this._xData.slice(P,b+1):P==b&&0==P?this._xData.slice(P,b+1):P==b&&P==this._xData.length-1?this._xData.slice(P):[];for(var M=[],p=0;p<w.length;p++)if(w[p].geometry.y>=v&&w[p].geometry.y<=O){var _=w[p].markType;this.layer.showMarker[_]&&(null==this.filterFun||this.filterFun(w[p]))&&M.push(w[p])}this._clusterDataStatus=M.slice();var x=[];if((!e||e.zoomChanged||i)&&this._clusterDataStatus){var C=this.layer.clicentData.tempcluster;if(C)for(var n=0;n<C.length;n++)C[n].data.style?C[n].style=C[n].data.style:r&&(C[n].style=null);if(t!==this.resolution||!this.clustersExist()||i){t!==this.resolution&&(this.zoomIn=!this.resolution||t<=this.resolution),this.previousResolution=this.resolution,this.previousClusters=this.clusters,this.resolution=t;for(var S,s,_,N=[],E=this.maxZoom&&this.layer.map.getZoom()>=this.maxZoom||this.layer.map.getZoom()==this.layer.map.maxZoom,n=0;n<this._clusterDataStatus.length;++n)if(S=this._clusterDataStatus[n],_=S.markType,this.layer.showMarker[_]&&S.getData()._visible&&!S._status)if(this.isAsynchronous||(S._status=!0),oldclustered=!1,newclustered=!1,x.push(S),!E&&S.geometry){for(var p=this.oldClusters.length-1;p>=0;--p)if(s=this.oldClusters[p],this.shouldCluster(s,S)){oldclustered=!0;break}if(!oldclustered)for(var p=N.length-1;p>=0;--p)if(s=N[p],this.shouldCluster(s,S)){newclustered=!0;break}oldclustered||newclustered||N.push(this.createCluster(this._clusterDataStatus[n]))}else if(S.cluster)Array.prototype.push.apply(N,S.cluster);else{var T=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(S.geometry.x,S.geometry.y),{count:0,markType:S.markType});T.data=S,S._apiObj=T,N.push(T)}if(this.clusters=N,this.layer.map.getZoom()<this.maxZoom&&this.layer.map.getZoom()!=this.layer.map.maxZoom){if(0===this.oldClusters.length){for(var n=0;n<this.clusters.length;n++)this.oldClusters.push(this.clusters[n]);for(var p=0;p<x.length;p++){var A=this.searchMinC(x[p],this.clusters);A>=0&&(this.clusters[A].cluster.push(x[p]),this.clusters[A].attributes.count++)}}else{for(var n=0;n<this.clusters.length;n++)this.oldClusters.push(this.clusters[n]);for(var I=[],p=0;p<x.length;p++){var G=!1,A=this.searchMinC(x[p],this.oldClusters);if(!(A<0)){for(var n=0;n<I.length;n++)if(I[n]==A){G=!0;break}G||(I.push(A),1===this.oldClusters[A].cluster.length&&(this.layer.removeFeatures(this.oldClusters[A].cluster[0]._apiObj),this.oldClusters[A].cluster[0]._apiObj.style=null)),this.oldClusters[A].cluster.push(x[p]),this.oldClusters[A].attributes.count++}}this.clusters=[];for(var n=0;n<I.length;n++){var F=I[n];this.oldClusters[F].layer&&(this.layer.removeFeatures([this.oldClusters[F]],{silent:!0}),this.oldClusters[F].style=null),this.clusters.push(this.oldClusters[F])}}for(var R,D=[],n=0,k=this.oldClusters.length;n<k;++n)if(R=this.oldClusters[n],R.attributes.count<this.threshold)for(var u=R.cluster.length-1;u>=0;u--){var B=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(R.cluster[u].geometry.x,R.cluster[u].geometry.y),{count:1,markType:R.cluster[u].markType});B.cluster=[],B.cluster.push(R.cluster[u]),B.data=R.cluster[u],R.cluster[u]._apiObj=B,D.push(B)}else D.push(R);this.oldClusters=D,this.clusters=[];for(var n=0;n<this.oldClusters.length;n++)this.oldClusters[n].layer||this.clusters.push(this.oldClusters[n]);if(r||!e){for(var z=0,n=this.clusters.length-1;n>=0;n--)z+=this.clusters[n].attributes.count||1;if(z<=this.minClusterCount){var D=this.clusters.slice();this.clusters=[];for(var R,n=0,k=D.length;n<k;++n)R=D[n],Array.prototype.push.apply(this.clusters,R.cluster||[R]);for(var n=0;n<this.clusters.length;n++)this.clusters[n]._status=!0,this.clusters[n].style=null;this.oldClusters=[]}}}this.getMeansC(this.clusters),this.clustering=!0,this.isAsynchronous?(this.index=0,this.timer=window.setTimeout(this.startAddFeatures.bind(this),5)):(this.layer.addFeatures(this.clusters,{silent:!0}),this.callbackFun&&(this.callbackFun(),this.callbackFun=null)),this.clustering=!1}}}}}},getMeansC:function(e){for(var t=0;t<e.length;t++)if(e[t].cluster&&e[t].cluster.length>0){for(var i=0,r=0,n=0;n<e[t].cluster.length;n++)i+=e[t].cluster[n].geometry.x,r+=e[t].cluster[n].geometry.y;for(var s=e[t].cluster.length,o=i/s,a=r/s,l=999999999999,p=null,n=0;n<e[t].cluster.length;n++){var h=e[t].cluster[n],u=(o-h.geometry.x)*(o-h.geometry.x)+(a-h.geometry.y)*(a-h.geometry.y);u<l&&(l=u,p=h.geometry)}e[t].geometry.x=p.x,e[t].geometry.y=p.y}},getE:function(e,t){for(var i=0,r=0;r<e.length;r++){var n=e[r];if(n.cluster)for(var s=0;s<n.cluster.length;s++){var o=n.cluster[s];i+=(o.geometry.x-t[r].geometry.x)*(o.geometry.x-t[r].geometry.x)+(o.geometry.y-t[r].geometry.y)*(o.geometry.y-t[r].geometry.y)}}return i},searchMinC:function(e,t){for(var i=-1,r=999999999999,n=0;n<t.length;n++)if(e.markType===t[n].data.markType){var s=(e.geometry.x-t[n].geometry.x)*(e.geometry.x-t[n].geometry.x)+(e.geometry.y-t[n].geometry.y)*(e.geometry.y-t[n].geometry.y);s<r&&(i=n,r=s)}return i},startAddFeatures:function(){if(this.clusters&&this.clusters[this.index]){var e=this.clusters[this.index];if(this.layer.showMarker[e.data.markType])if(this.layer.addFeatures([e],{silent:!0}),e.cluster)for(var t=0;t<e.cluster.length;t++)e.cluster[t]._status=!0;else e.data._status=!0;this.index++,this.timer=window.setTimeout(this.startAddFeatures.bind(this),5)}else this.callbackFun&&(this.callbackFun(),this.callbackFun=null)},cacheFeatures:function(e){var t=!0;return this.clustering||(this.clearCache(),this.features=e.features,this._clusterDataStatus=this.features.slice(),this._xData=this._clusterDataStatus.slice().sort(function(e,t){return e.geometry.x>t.geometry.x?1:-1}),this.cluster(),t=!1),t},clearCache:function(e){this.clustering||(this.features=null,this.oldClusters=[])},findFeaturesInClusters:function(e,t){for(var i=0;i<e.length;i++)for(var r=e[i],n=0;n<t.length;n++){var s=t[n];if(s.attributes.count)for(var o=t[n].cluster,a=0;a<o.length;a++)if(r.id===o[a].id)return s}return null},animate:function(e){for(var t=this.zoomIn?this.clusters:this.previousClusters,i=0;i<t.length;i++)if(t[i]._geometry){var r=(t[i]._geometry.destx-t[i]._geometry.origx)*e.x,n=(t[i]._geometry.desty-t[i]._geometry.origy)*e.y;t[i].geometry.x=t[i]._geometry.origx+r,t[i].geometry.y=t[i]._geometry.origy+n}this.layer.redraw()},shouldCluster:function(e,t,i){var r=e.data.markType,n=t.markType;if(r!==n)return!1;var s=i?this.previousResolution:this.resolution,o=e.geometry.getBounds().getCenterLonLat(),a=t.geometry,l=Math.sqrt(Math.pow(o.lon-a.x,2)+Math.pow(o.lat-a.y,2))/s;return l<=this.distance},createCluster:function(e){var t=e.geometry,i=e.markType,r=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.x,t.y),{count:0,markType:i,feature:e});return r.cluster=[],r.sx=e.geometry.x,r.sy=e.geometry.y,r},afterhidenMarkers:function(e){},setStatistics:function(e){if(this.statistics=e,this.layer.map.getZoom()<this.minZoom){this.layer.removeAllFeatures();for(var t=0;t<this.statistics.length;t++)if(this.statistics[t]&&this.statistics[t].x&&this.statistics[t].y&&this.statistics[t].label>0){var i=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(this.statistics[t].x,this.statistics[t].y),{count:this.statistics[t].label,isStatistics:!0});this.layer.addFeatures([i],{silent:!0})}}},addClusterMarker:function(e){if(window.clearTimeout(this.timer),!(this.layer.map.getZoom()<this.minZoom)){for(var t=this.maxZoom&&this.layer.map.getZoom()>=this.maxZoom,i=[],r=!1,n=null,s=0;s<e.length;s++){var o=e[s].geometry;if(this.layer&&this.layer.map){var a=this.layer.map.getExtent();if(!a.contains(o.x,o.y,!0)||!this.layer.showMarker[e[s].markType])continue}if(e[s]._status=!0,!t&&e[s].geometry){r=!1;for(var l=i.length-1;l>=0;--l)if(n=i[l],this.shouldCluster(n,e[s])){n.attributes.count++,n.cluster.push(e[s]),r=!0;break}if(!r){var p=this.createCluster(e[s]);p.cluster.push(e[s]),p.attributes.count++,i.push(p)}}else{var h=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(o.x,o.y),{count:1,markType:e[s].markType});h.data=e[s],e[s]._apiObj=h,i.push(h)}}this.getMeansC(i);var u=i.slice();i=[];for(var y,s=0,c=u.length;s<c;++s)if(y=u[s],y.attributes.count<this.threshold&&y.cluster)for(var d=0;d<y.cluster.length;d++){var m=y.cluster[d].geometry,f=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(m.x,m.y),{count:1,markType:e[s].markType});f.data=y.cluster[d],y.cluster[d]._apiObj=f,i.push(f)}else i.push(y);this.layer.addFeatures(i,{silent:!0})}},createNewCluster:function(e){var t=e.geometry.getBounds().getCenterLonLat(),i=e.data.markType,r=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),{count:1,markType:i});return r.cluster=[e],r.sx=e.geometry.x,r.sy=e.geometry.y,r},filterClusterMarks:function(e){if(this.layer.map.getZoom()<this.minZoom)return void(this.filterFun=e);var t=[];this.layer.removeFeatures(this.layer.features,{silent:!0});var i=this.layer.map.getExtent(),r=i.left,n=i.right,s=(i.bottom,i.top,this.binarySearch(this._xData,r,"x")),o=this.binarySearch(this._xData,n,"x"),a=this._xData.slice(s,o+1);this._clusterDataStatus=a.slice();for(var l=this._clusterDataStatus.length-1;l>=0;l--){var p=this._clusterDataStatus[l];e(p)&&t.push(p)}this._clusterDataStatus=[],this.addClusterMarker(t),this.filterFun=e},CLASS_NAME:"OpenLayers.Strategy.AnimatedCluster"}),OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return e&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})),e},deactivate:function(){return this.cache=null,this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}),OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(e){if(!this.caching&&this.filter){var t=e.features;e.features=[];for(var i,r=0,n=t.length;r<n;++r)i=t[r],this.filter.evaluate(i)?e.features.push(i):this.cache.push(i)}},handleRemove:function(e){this.caching||(this.cache=[])},setFilter:function(e){this.filter=e;var t=this.cache;if(this.cache=[],this.handleAdd({features:this.layer.features}),this.cache.length>0&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1),t.length>0){var i={features:t};this.handleAdd(i),i.features.length>0&&(this.caching=!0,this.layer.addFeatures(i.features),this.caching=!1)}},CLASS_NAME:"OpenLayers.Strategy.Filter"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return e&&(this.layer.events.on({refresh:this.load,scope:this}),1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),e},load:function(e){var t=this.layer;t.events.triggerEvent("loadstart",{filter:t.filter}),t.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:t.filter,scope:this},e)),t.events.un({visibilitychanged:this.load,scope:this})},merge:function(e){var t=this.layer;t.destroyFeatures();var i=e.features;if(i&&i.length>0){var r=t.projection,n=t.map.getProjectionObject();if(!n.equals(r))for(var s,o=0,a=i.length;o<a;++o)s=i[o].geometry,s&&s.transform(r,n);t.addFeatures(i)}t.events.triggerEvent("loadend",{response:e})},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update()),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),e},update:function(e){var t=this.getMapBounds();null!==t&&(e&&e.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(t))&&(this.calculateBounds(t),this.resolution=this.layer.map.getResolution(),this.triggerRead(e))},getMapBounds:function(){if(null===this.layer.map)return null;var e=this.layer.map.getExtent();return e&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(e=e.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)),e},invalidBounds:function(e){e||(e=this.getMapBounds());var t=!this.bounds||!this.bounds.containsBounds(e);if(!t&&this.resFactor){var i=this.resolution/this.layer.map.getResolution();t=i>=this.resFactor||i<=1/this.resFactor}return t},calculateBounds:function(e){e||(e=this.getMapBounds());var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio,r=e.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(t.lon-i/2,t.lat-r/2,t.lon+i/2,t.lat+r/2)},triggerRead:function(e){!this.response||e&&e.noAbort===!0||(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));var t={filter:this.createFilter()};this.layer.events.triggerEvent("loadstart",t),this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:t.filter,callback:this.merge,scope:this},e))},createFilter:function(){var e=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});return this.layer.filter&&(e=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,e]})),e},merge:function(e){if(this.layer.destroyFeatures(),e.success()){var t=e.features;if(t&&t.length>0){var i=this.layer.projection,r=this.layer.map.getProjectionObject();if(!r.equals(i))for(var n,s=0,o=t.length;s<o;++s)n=t[s].geometry,n&&n.transform(i,r);this.layer.addFeatures(t)}}else this.bounds=null;this.response=null,this.layer.events.triggerEvent("loadend",{response:e})},CLASS_NAME:"OpenLayers.Strategy.BBOX"}),OpenLayers.Filter=OpenLayers.Class({initialize:function(e){OpenLayers.Util.extend(this,e)},destroy:function(){},evaluate:function(e){return!0},clone:function(){return null},toString:function(){var e;return e=OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"}),OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(e){this.fids=[],OpenLayers.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){for(var t=0,i=this.fids.length;t<i;t++){var r=e.fid||e.id;if(r===this.fids[t])return!0}return!1},clone:function(){var e=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(e,this),e.fids=this.fids.slice(),e},CLASS_NAME:"OpenLayers.Filter.FeatureId"}),OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(e){OpenLayers.Filter.prototype.initialize.apply(this,[e]),this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===e.matchCase&&(this.matchCase=null)},evaluate:function(e){e instanceof OpenLayers.Feature.Vector&&(e=e.attributes);var t,i=!1,r=e[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:t=this.value,i=this.matchCase||"string"!=typeof r||"string"!=typeof t?r===t:r.toUpperCase()===t.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:t=this.value,i=this.matchCase||"string"!=typeof r||"string"!=typeof t?r!==t:r.toUpperCase()!==t.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:i=r<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:i=r>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:i=r<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:i=r>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:i=r>=this.lowerBoundary&&r<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:var n=new RegExp(this.value,"gi");i=n.test(r);break;case OpenLayers.Filter.Comparison.IS_NULL:i=null===r}return i},value2regex:function(e,t,i){if("."===e)throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");return e=e?e:"*",t=t?t:".",i=i?i:"!",this.value=this.value.replace(new RegExp("\\"+i+"(.|$)","g"),"\\$1"),this.value=this.value.replace(new RegExp("\\"+t,"g"),"."),this.value=this.value.replace(new RegExp("\\"+e,"g"),".*"),this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+e),this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+t),this.value},regex2value:function(){var e=this.value;return e=e.replace(/!/g,"!!"),e=e.replace(/(\\)?\\\./g,function(e,t){return t?e:"!."}),e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"!*"}),e=e.replace(/\\\\/g,"\\"),e=e.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"}),OpenLayers.Filter.Comparison.EQUAL_TO="==",OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=",OpenLayers.Filter.Comparison.LESS_THAN="<",OpenLayers.Filter.Comparison.GREATER_THAN=">",OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",OpenLayers.Filter.Comparison.BETWEEN="..",OpenLayers.Filter.Comparison.LIKE="~",OpenLayers.Filter.Comparison.IS_NULL="NULL",OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(e){var t=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(e.geometry){var i=this.value;"OpenLayers.Bounds"===this.value.CLASS_NAME&&(i=this.value.toGeometry()),e.geometry.intersects(i)&&(t=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return t},clone:function(){var e=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(e)},CLASS_NAME:"OpenLayers.Filter.Spatial"}),OpenLayers.Filter.Spatial.BBOX="BBOX",OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS",OpenLayers.Filter.Spatial.DWITHIN="DWITHIN",OpenLayers.Filter.Spatial.WITHIN="WITHIN",OpenLayers.Filter.Spatial.CONTAINS="CONTAINS",OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"}),OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{},OpenLayers.Util.extend(this,e),this.options=e},mergeWithDefaultFilter:function(e){var t;return t=e&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0},destroy:function(){this.options=null,this.format=null},read:function(e){e=e||{},e.filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(e){},createCallback:function(e,t,i){return OpenLayers.Function.bind(function(){e.apply(this,[t,i])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){OpenLayers.Util.extend(this,e)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},destroy:function(){this.params=null,this.headers=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=e||{},e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params),e=OpenLayers.Util.applyDefaults(e,this.options),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,i=new OpenLayers.Protocol.Response({requestType:"read"});if(t){var r=e.headers||{};r["Content-Type"]="application/x-www-form-urlencoded",i.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,i,e),data:OpenLayers.Util.getParameterString(e.params),headers:r})}else i.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,i,e),params:e.params,headers:e.headers});return i},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});return i.priv=OpenLayers.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,i,t),headers:t.headers,data:this.format.write(e)}),i},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){t=t||{};var i=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var r=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"update"}),n=this.updateWithPOST?"POST":"PUT";return r.priv=OpenLayers.Request[n]({url:i,callback:this.createCallback(this.handleUpdate,r,t),headers:t.headers,data:this.format.write(e)}),r},handleUpdate:function(e,t){this.handleResponse(e,t)},"delete":function(e,t){t=t||{};var i=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var r=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"delete"}),n=this.deleteWithPOST?"POST":"DELETE",s={url:i,callback:this.createCallback(this.handleDelete,r,t),headers:t.headers};return this.deleteWithPOST&&(s.data=this.format.write(e)),r.priv=OpenLayers.Request[n](s),r},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var i=e.priv;t.callback&&(i.status>=200&&i.status<300?("delete"!=e.requestType&&(e.features=this.parseFeatures(i)),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e))},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||t.length<=0?null:this.format.read(t)},commit:function(e,t){function i(e){for(var t=e.features?e.features.length:0,i=new Array(t),n=0;n<t;++n)i[n]=e.features[n].fid;d.insertIds=i,r.apply(this,[e])}function r(e){this.callUserCallback(e,t),c=c&&e.success(),s++,s>=y&&t.callback&&(d.code=c?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,t.callback.apply(t.scope,[d]))}t=OpenLayers.Util.applyDefaults(t,this.options);var n=[],s=0,o={};o[OpenLayers.State.INSERT]=[],o[OpenLayers.State.UPDATE]=[],o[OpenLayers.State.DELETE]=[];for(var a,l,p=[],h=0,u=e.length;h<u;++h)a=e[h],l=o[a.state],l&&(l.push(a),p.push(a));var y=(o[OpenLayers.State.INSERT].length>0?1:0)+o[OpenLayers.State.UPDATE].length+o[OpenLayers.State.DELETE].length,c=!0,d=new OpenLayers.Protocol.Response({reqFeatures:p}),m=o[OpenLayers.State.INSERT];m.length>0&&n.push(this.create(m,OpenLayers.Util.applyDefaults({callback:i,scope:this},t.create))),m=o[OpenLayers.State.UPDATE];for(var h=m.length-1;h>=0;--h)n.push(this.update(m[h],OpenLayers.Util.applyDefaults({callback:r,scope:this},t.update)));m=o[OpenLayers.State.DELETE];for(var h=m.length-1;h>=0;--h)n.push(this["delete"](m[h],OpenLayers.Util.applyDefaults({callback:r,scope:this},t["delete"])));return n},abort:function(e){e&&e.priv.abort()},callUserCallback:function(e,t){var i=t[e.requestType];i&&i.callback&&i.callback.call(i.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.rules=[],t&&t.rules&&this.addRules(t.rules),this.setDefaultStyle(e||OpenLayers.Feature.Vector.style["default"]),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;e<t;e++)this.rules[e].destroy(),this.rules[e]=null;this.rules=null,this.defaultStyle=null},createSymbolizer:function(e){for(var t,i=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e),r=this.rules,n=[],s=!1,o=0,a=r.length;o<a;o++){t=r[o];var l=t.evaluate(e);l&&(t instanceof OpenLayers.Rule&&t.elseFilter?n.push(t):(s=!0,this.applySymbolizer(t,i,e)))}if(0==s&&n.length>0){s=!0;for(var o=0,a=n.length;o<a;o++)this.applySymbolizer(n[o],i,e)}return r.length>0&&0==s&&(i.display="none"),null!=i.label&&"string"!=typeof i.label&&(i.label=String(i.label)),i},applySymbolizer:function(e,t,i){var r=i.geometry?this.getSymbolizerPrefix(i.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],n=e.symbolizer[r]||e.symbolizer;if(this.defaultsPerSymbolizer===!0){var s=this.defaultStyle;OpenLayers.Util.applyDefaults(n,{pointRadius:s.pointRadius}),n.stroke!==!0&&n.graphic!==!0||OpenLayers.Util.applyDefaults(n,{strokeWidth:s.strokeWidth,strokeColor:s.strokeColor,strokeOpacity:s.strokeOpacity,strokeDashstyle:s.strokeDashstyle,strokeLinecap:s.strokeLinecap}),n.fill!==!0&&n.graphic!==!0||OpenLayers.Util.applyDefaults(n,{fillColor:s.fillColor,fillOpacity:s.fillOpacity}),n.graphic===!0&&OpenLayers.Util.applyDefaults(n,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(t,n),i)},createLiterals:function(e,t){var i=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(i,this.context);for(var r in this.propertyStyles){var n=OpenLayers.Style.createLiteral(e[r],i,t,r);"undefined"!=n?e[r]=n:e[r]=null}return e},findPropertyStyles:function(){var e={},t=this.defaultStyle;this.addPropertyStyles(e,t);for(var i,r,n=this.rules,s=0,o=n.length;s<o;s++){i=n[s].symbolizer;for(var a in i){if(r=i[a],"object"!=typeof r){this.addPropertyStyles(e,i);break}this.addPropertyStyles(e,r)}}return e},addPropertyStyles:function(e,t){var i;for(var r in t)i=t[r],"string"==typeof i&&i.match(/\$\{\w+\}/)&&(e[r]=!0);return e},addRules:function(e){Array.prototype.push.apply(this.rules,e),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var t=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,r=t.length;i<r;i++)if(e.CLASS_NAME.indexOf(t[i])!=-1)return t[i]},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;t<i;++t)e.rules.push(this.rules[t].clone())}e.context=this.context&&OpenLayers.Util.extend({},this.context);var r=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(r,e)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(e,t,i,r){return"string"==typeof e&&e.indexOf("${")!=-1&&(e=OpenLayers.String.format(e,t,[i,r]),"false"===e&&(e=!1),e=isNaN(e)||!e?e:parseFloat(e)),e},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],
OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;e<t;e++)this.rules[e].destroy();delete this.rules},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;t<i;++t)e.rules.push(this.rules[t].clone())}return new OpenLayers.Style2(e)},CLASS_NAME:"OpenLayers.Style2"}),OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,t){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},e instanceof OpenLayers.Style)this.styles["default"]=e,this.styles.select=e,this.styles.temporary=e,this.styles["delete"]=e;else if("object"==typeof e)for(var i in e)if(e[i]instanceof OpenLayers.Style)this.styles[i]=e[i];else{if("object"!=typeof e[i]){this.styles["default"]=new OpenLayers.Style(e),this.styles.select=new OpenLayers.Style(e),this.styles.temporary=new OpenLayers.Style(e),this.styles["delete"]=new OpenLayers.Style(e);break}this.styles[i]=new OpenLayers.Style(e[i])}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles)this.styles[e].destroy();this.styles=null},createSymbolizer:function(e,t){e||(e=new OpenLayers.Feature.Vector),this.styles[t]||(t="default"),e.renderIntent=t;var i={};return this.extendDefault&&"default"!=t&&(i=this.styles["default"].createSymbolizer(e)),OpenLayers.Util.extend(i,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,i,r){var n=[];for(var s in i)n.push(new OpenLayers.Rule({symbolizer:i[s],context:r,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:s})}));this.styles[e].addRules(n)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(e){this.symbolizer={},OpenLayers.Util.extend(this,e),this.symbolizers&&delete this.symbolizer,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e in this.symbolizer)this.symbolizer[e]=null;this.symbolizer=null,delete this.symbolizers},evaluate:function(e){var t=this.getContext(e),i=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var r=e.layer.map.getScale();return this.minScaleDenominator&&(i=r>=OpenLayers.Style.createLiteral(this.minScaleDenominator,t)),i&&this.maxScaleDenominator&&(i=r<OpenLayers.Style.createLiteral(this.maxScaleDenominator,t)),i&&this.filter&&(i="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(e):this.filter.evaluate(t)),i},getContext:function(e){var t=this.context;return t||(t=e.attributes||e.data),"function"==typeof this.context&&(t=this.context(e)),t},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.symbolizers){var t=this.symbolizers.length;e.symbolizers=new Array(t);for(var i=0;i<t;++i)e.symbolizers[i]=this.symbolizers[i].clone()}else{e.symbolizer={};var r,n;for(var s in this.symbolizer)r=this.symbolizer[s],n=typeof r,"object"===n?e.symbolizer[s]=OpenLayers.Util.extend({},r):"string"===n&&(e.symbolizer[s]=r)}return e.filter=this.filter&&this.filter.clone(),e.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(e)},CLASS_NAME:"OpenLayers.Rule"}),OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e},destroy:function(){},read:function(e){throw new Error("Read not implemented.")},write:function(e){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.QueryStringFilter=function(){function e(e){return e=e.replace(/%/g,"\\%"),e=e.replace(/\\\\\.(\*)?/g,function(e,t){return t?e:"\\\\_"}),e=e.replace(/\\\\\.\*/g,"\\\\%"),e=e.replace(/(\\)?\.(\*)?/g,function(e,t,i){return t||i?e:"_"}),e=e.replace(/(\\)?\.\*/g,function(e,t){return t?e:"%"}),e=e.replace(/\\\./g,"."),e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"*"})}var t={};return t[OpenLayers.Filter.Comparison.EQUAL_TO]="eq",t[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne",t[OpenLayers.Filter.Comparison.LESS_THAN]="lt",t[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",t[OpenLayers.Filter.Comparison.GREATER_THAN]="gt",t[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",t[OpenLayers.Filter.Comparison.LIKE]="ilike",OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(i,r){r=r||{};var n=i.CLASS_NAME,s=n.substring(n.lastIndexOf(".")+1);switch(s){case"Spatial":switch(i.type){case OpenLayers.Filter.Spatial.BBOX:r.bbox=i.value.toArray(),this.srsInBBOX&&i.projection&&r.bbox.push(i.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:r.tolerance=i.distance;case OpenLayers.Filter.Spatial.WITHIN:r.lon=i.value.x,r.lat=i.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+i.type)}break;case"Comparison":var o=t[i.type];if(void 0!==o){var a=i.value;i.type==OpenLayers.Filter.Comparison.LIKE&&(a=e(a),this.wildcarded&&(a="%"+a+"%")),r[i.property+"__"+o]=a,r.queryable=r.queryable||[],r.queryable.push(i.property)}else OpenLayers.Console.warn("Unknown comparison filter type "+i.type);break;case"Logical":if(i.type===OpenLayers.Filter.Logical.AND)for(var l=0,p=i.filters.length;l<p;l++)r=this.write(i.filters[l],r);else OpenLayers.Console.warn("Unsupported logical filter type "+i.type);break;default:OpenLayers.Console.warn("Unknown filter type "+s)}return r},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}(),OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[e]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={};for(var t in this.namespaces)this.namespaceAlias[this.namespaces[t]]=t},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t,this.namespaceAlias[t]=e},read:function(e){var t=e.indexOf("<");t>0&&(e=e.substring(t));var i=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var t;return t=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,t.loadXML(e),t},this),function(){return(new DOMParser).parseFromString(e,"text/xml")},function(){var t=new XMLHttpRequest;return t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),t.overrideMimeType&&t.overrideMimeType("text/xml"),t.send(null),t.responseXML});return this.keepData&&(this.data=i),i},write:function(e){var t;if(this.xmldom)t=e.xml;else{var i=new XMLSerializer;if(1==e.nodeType){var r=document.implementation.createDocument("","",null);r.importNode&&(e=r.importNode(e,!0)),r.appendChild(e),t=i.serializeToString(r)}else t=i.serializeToString(e)}return t},createElementNS:function(e,t){var i;return i=this.xmldom?"string"==typeof e?this.xmldom.createNode(1,t,e):this.xmldom.createNode(1,t,""):document.createElementNS(e,t)},createDocumentFragment:function(){var e;return e=this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(e){var t;return"string"!=typeof e&&(e=String(e)),t=this.xmldom?this.xmldom.createTextNode(e):document.createTextNode(e)},getElementsByTagNameNS:function(e,t,i){var r=[];if(e.getElementsByTagNameNS)r=e.getElementsByTagNameNS(t,i);else for(var n,s,o=e.getElementsByTagName("*"),a=0,l=o.length;a<l;++a)n=o[a],s=n.prefix?n.prefix+":"+i:i,"*"!=i&&s!=n.nodeName||"*"!=t&&t!=n.namespaceURI||r.push(n);return r},getAttributeNodeNS:function(e,t,i){var r=null;if(e.getAttributeNodeNS)r=e.getAttributeNodeNS(t,i);else for(var n,s,o=e.attributes,a=0,l=o.length;a<l;++a)if(n=o[a],n.namespaceURI==t&&(s=n.prefix?n.prefix+":"+i:i,s==n.nodeName)){r=n;break}return r},getAttributeNS:function(e,t,i){var r="";if(e.getAttributeNS)r=e.getAttributeNS(t,i)||"";else{var n=this.getAttributeNodeNS(e,t,i);n&&(r=n.nodeValue)}return r},getChildValue:function(e,t){var i=t||"";if(e)for(var r=e.firstChild;r;r=r.nextSibling)switch(r.nodeType){case 3:case 4:i+=r.nodeValue}return i},isSimpleContent:function(e){for(var t=!0,i=e.firstChild;i;i=i.nextSibling)if(1===i.nodeType){t=!1;break}return t},contentType:function(e){for(var t=!1,i=!1,r=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,n=e.firstChild;n;n=n.nextSibling){switch(n.nodeType){case 1:i=!0;break;case 8:break;default:t=!0}if(i&&t)break}if(i&&t)r=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(i)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(t)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return r},hasAttributeNS:function(e,t,i){var r=!1;return r=e.hasAttributeNS?e.hasAttributeNS(t,i):!!this.getAttributeNodeNS(e,t,i)},setAttributeNS:function(e,t,i,r){if(e.setAttributeNS)e.setAttributeNS(t,i,r);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(t){var n=e.ownerDocument.createNode(2,i,t);n.nodeValue=r,e.setAttributeNode(n)}else e.setAttribute(i,r)}},createElementNSPlus:function(e,t){t=t||{};var i=t.uri||this.namespaces[t.prefix];if(!i){var r=e.indexOf(":");i=this.namespaces[e.substring(0,r)]}i||(i=this.namespaces[this.defaultPrefix]);var n=this.createElementNS(i,e);t.attributes&&this.setAttributes(n,t.attributes);var s=t.value;return null!=s&&n.appendChild(this.createTextNode(s)),n},setAttributes:function(e,t){var i,r;for(var n in t)null!=t[n]&&t[n].toString&&(i=t[n].toString(),r=this.namespaces[n.substring(0,n.indexOf(":"))]||null,this.setAttributeNS(e,r,n,i))},readNode:function(e,t){t||(t={});var i=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(i){var r=e.localName||e.nodeName.split(":").pop(),n=i[r]||i["*"];n&&n.apply(this,[e,t])}return t},readChildNodes:function(e,t){t||(t={});for(var i,r=e.childNodes,n=0,s=r.length;n<s;++n)i=r[n],1==i.nodeType&&this.readNode(i,t);return t},writeNode:function(e,t,i){var r,n,s=e.indexOf(":");s>0?(r=e.substring(0,s),n=e.substring(s+1)):(r=i?this.namespaceAlias[i.namespaceURI]:this.defaultPrefix,n=e);var o=this.writers[r][n].apply(this,[t]);return i&&i.appendChild(o),o},getChildEl:function(e,t,i){return e&&this.getThisOrNextEl(e.firstChild,t,i)},getNextEl:function(e,t,i){return e&&this.getThisOrNextEl(e.nextSibling,t,i)},getThisOrNextEl:function(e,t,i){e:for(var r=e;r;r=r.nextSibling)switch(r.nodeType){case 1:if(!(t&&t!==(r.localName||r.nodeName.split(":").pop())||i&&i!==r.namespaceURI))break e;r=null;break e;case 3:if(/^\s*$/.test(r.nodeValue))break;case 4:case 6:case 12:case 10:case 11:r=null;break e}return r||null},lookupNamespaceURI:function(e,t){var i=null;if(e)if(e.lookupNamespaceURI)i=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){i=e.namespaceURI;break e}var r=e.attributes.length;if(r)for(var n,s=0;s<r;++s){if(n=e.attributes[s],"xmlns"===n.prefix&&n.name==="xmlns:"+t){i=n.value||null;break e}if("xmlns"===n.name&&null===t){i=n.value||null;break e}}i=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:i=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:i=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:i=this.lookupNamespaceURI(e.parentNode,t)}return i},getXMLDoc:function(){return OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype),OpenLayers.Format.XML.document=null,OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);var t=this.CLASS_NAME;this.name=t.substring(t.lastIndexOf(".")+1)},getVersion:function(e,t){var i;return e?(i=this.version,i||(i=e.getAttribute("version"),i||(i=this.defaultVersion))):i=t&&t.version||this.version||this.defaultVersion,i},getParser:function(e){e=e||this.defaultVersion;var t=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var i=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+t];if(!i&&(""!==t&&this.allowFallback&&(t="",i=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")]),!i))throw"Can't find a "+this.name+" parser for version "+e+t;this.parser=new i(this.options)}return this.parser},write:function(e,t){var i=this.getVersion(null,t);this.parser=this.getParser(i);var r=this.parser.write(e,t);return this.stringifyOutput===!1?r:OpenLayers.Format.XML.prototype.write.apply(this,[r])},read:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement,r=this.getVersion(i);this.parser=this.getParser(r);var n=this.parser.read(e,t),s=this.parser.errorProperty||null;if(null!==s&&void 0===n[s]){var o=new OpenLayers.Format.OGCExceptionReport;n.error=o.read(e)}return n.version=r,n},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"}),OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName),i=[],r=0;r<t.length;r++){var n=this.parseFeature(t[r]);n&&i.push(n)}return i},parseFeature:function(e){for(var t,i,r,n,s=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],o=0;o<s.length;++o)if(t=s[o],i=this.getElementsByTagNameNS(e,this.gmlns,t),i.length>0){if(n=this.parseGeometry[t.toLowerCase()],!n)throw new TypeError("Unsupported geometry type: "+t);r=n.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&r.transform(this.externalProjection,this.internalProjection);break}var a,l=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(o=0;o<l.length;++o){var p=l[o],h=this.parseGeometry.box.apply(this,[p]),u=p.parentNode,y=u.localName||u.nodeName.split(":").pop();"boundedBy"===y?a=h:r=h.toGeometry()}var c;this.extractAttributes&&(c=this.parseAttributes(e));var d=new OpenLayers.Feature.Vector(r,c);d.bounds=a,d.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,featureNSPrefix:e.firstChild.prefix};for(var m,f=e.firstChild;f&&(1!==f.nodeType||!(m=f.getAttribute("fid")||f.getAttribute("id")));)f=f.nextSibling;return d.fid=m,d},parseGeometry:{point:function(e){var t,i,r=[];if(t=this.getElementsByTagNameNS(e,this.gmlns,"pos"),t.length>0&&(i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.trimSpace,""),r=i.split(this.regExes.splitSpace)),0===r.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),t.length>0&&(i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.removeSpace,""),r=i.split(","))),0===r.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coord"),t.length>0)){var n=this.getElementsByTagNameNS(t[0],this.gmlns,"X"),s=this.getElementsByTagNameNS(t[0],this.gmlns,"Y");n.length>0&&s.length>0&&(r=[n[0].firstChild.nodeValue,s[0].firstChild.nodeValue])}return 2===r.length&&(r[2]=null),this.xy?new OpenLayers.Geometry.Point(r[0],r[1],r[2]):new OpenLayers.Geometry.Point(r[1],r[0],r[2])},multipoint:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Point"),i=[];if(t.length>0)for(var r,n=0;n<t.length;++n)r=this.parseGeometry.point.apply(this,[t[n]]),r&&i.push(r);return new OpenLayers.Geometry.MultiPoint(i)},linestring:function(e,t){var i,r,n=[],s=[];if(i=this.getElementsByTagNameNS(e,this.gmlns,"posList"),i.length>0){r=this.getChildValue(i[0]),r=r.replace(this.regExes.trimSpace,""),n=r.split(this.regExes.splitSpace);for(var o,a,l,p,h=parseInt(i[0].getAttribute("dimension")),u=0;u<n.length/h;++u)o=u*h,a=n[o],l=n[o+1],p=2===h?null:n[o+2],this.xy?s.push(new OpenLayers.Geometry.Point(a,l,p)):s.push(new OpenLayers.Geometry.Point(l,a,p))}if(0===n.length&&(i=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),i.length>0)){r=this.getChildValue(i[0]),r=r.replace(this.regExes.trimSpace,""),r=r.replace(this.regExes.trimComma,",");for(var y=r.split(this.regExes.splitSpace),u=0;u<y.length;++u)n=y[u].split(","),2===n.length&&(n[2]=null),this.xy?s.push(new OpenLayers.Geometry.Point(n[0],n[1],n[2])):s.push(new OpenLayers.Geometry.Point(n[1],n[0],n[2]))}var c=null;return 0!==s.length&&(c=t?new OpenLayers.Geometry.LinearRing(s):new OpenLayers.Geometry.LineString(s)),c},multilinestring:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LineString"),i=[];if(t.length>0)for(var r,n=0;n<t.length;++n)r=this.parseGeometry.linestring.apply(this,[t[n]]),r&&i.push(r);return new OpenLayers.Geometry.MultiLineString(i)},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing"),i=[];if(t.length>0)for(var r,n=0;n<t.length;++n)r=this.parseGeometry.linestring.apply(this,[t[n],!0]),r&&i.push(r);return new OpenLayers.Geometry.Polygon(i)},multipolygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Polygon"),i=[];if(t.length>0)for(var r,n=0;n<t.length;++n)r=this.parseGeometry.polygon.apply(this,[t[n]]),r&&i.push(r);return new OpenLayers.Geometry.MultiPolygon(i)},envelope:function(e){var t,i,r=[],n=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(n.length>0){var s=[];n.length>0&&(t=n[0].firstChild.nodeValue,t=t.replace(this.regExes.trimSpace,""),s=t.split(this.regExes.splitSpace)),2===s.length&&(s[2]=null);var o;o=this.xy?new OpenLayers.Geometry.Point(s[0],s[1],s[2]):new OpenLayers.Geometry.Point(s[1],s[0],s[2])}var a=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner");if(a.length>0){var s=[];a.length>0&&(t=a[0].firstChild.nodeValue,t=t.replace(this.regExes.trimSpace,""),s=t.split(this.regExes.splitSpace)),2===s.length&&(s[2]=null);var l;l=this.xy?new OpenLayers.Geometry.Point(s[0],s[1],s[2]):new OpenLayers.Geometry.Point(s[1],s[0],s[2])}if(o&&l){r.push(new OpenLayers.Geometry.Point(o.x,o.y)),r.push(new OpenLayers.Geometry.Point(l.x,o.y)),r.push(new OpenLayers.Geometry.Point(l.x,l.y)),r.push(new OpenLayers.Geometry.Point(o.x,l.y)),r.push(new OpenLayers.Geometry.Point(o.x,o.y));var p=new OpenLayers.Geometry.LinearRing(r);i=new OpenLayers.Geometry.Polygon([p])}return i},box:function(e){var t,i,r=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),n=null,s=null;if(r.length>0&&(t=r[0].firstChild.nodeValue,i=t.split(" "),2===i.length&&(n=i[0].split(","),s=i[1].split(","))),null!==n&&null!==s)return new OpenLayers.Bounds(parseFloat(n[0]),parseFloat(n[1]),parseFloat(s[0]),parseFloat(s[1]))}},parseAttributes:function(e){for(var t,i,r,n,s,o,a,l={},p=e.firstChild;p;){if(1===p.nodeType){for(t=p.childNodes,i=0;i<t.length;++i)r=t[i],1===r.nodeType&&(n=r.childNodes,1===n.length?(s=n[0],3!==s.nodeType&&4!==s.nodeType||(o=r.prefix?r.nodeName.split(":")[1]:r.nodeName,a=s.nodeValue.replace(this.regExes.trimSpace,""),l[o]=a)):l[r.nodeName.split(":").pop()]=null);break}p=p.nextSibling}return l},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),i=0;i<e.length;i++)t.appendChild(this.createFeatureXML(e[i]));return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=e.geometry,i=this.buildGeometryNode(t),r=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);r.appendChild(i);var n=this.createElementNS(this.gmlns,"gml:"+this.featureName),s=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),o=e.fid||e.id;s.setAttribute("fid",o),s.appendChild(r);for(var a in e.attributes)if(e.attributes.hasOwnProperty(a)){var l=this.createTextNode(e.attributes[a]),p=a.substring(a.lastIndexOf(":")+1),h=this.createElementNS(this.featureNS,this.featurePrefix+":"+p);h.appendChild(l),s.appendChild(h)}return n.appendChild(s),n},buildGeometryNode:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t=e.CLASS_NAME,i=t.substring(t.lastIndexOf(".")+1),r=this.buildGeometry[i.toLowerCase()];return r.apply(this,[e])},buildGeometry:{point:function(e){var t=this.createElementNS(this.gmlns,"gml:Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){for(var t,i,r=this.createElementNS(this.gmlns,"gml:MultiPoint"),n=e.components,s=0;s<n.length;s++)t=this.createElementNS(this.gmlns,"gml:pointMember"),i=this.buildGeometry.point.apply(this,[n[s]]),t.appendChild(i),r.appendChild(t);return r},linestring:function(e){var t=this.createElementNS(this.gmlns,"gml:LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){for(var t,i,r=this.createElementNS(this.gmlns,"gml:MultiLineString"),n=e.components,s=0;s<n.length;++s)t=this.createElementNS(this.gmlns,"gml:lineStringMember"),i=this.buildGeometry.linestring.apply(this,[n[s]]),t.appendChild(i),r.appendChild(t);return r},linearring:function(e){var t=this.createElementNS(this.gmlns,"gml:LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,r,n=this.createElementNS(this.gmlns,"gml:Polygon"),s=e.components,o=0;o<s.length;++o)r=0===o?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.gmlns,"gml:"+r),i=this.buildGeometry.linearring.apply(this,[s[o]]),t.appendChild(i),n.appendChild(t);return n},multipolygon:function(e){for(var t,i,r=this.createElementNS(this.gmlns,"gml:MultiPolygon"),n=e.components,s=0;s<n.length;++s)t=this.createElementNS(this.gmlns,"gml:polygonMember"),i=this.buildGeometry.polygon.apply(this,[n[s]]),t.appendChild(i),r.appendChild(t);return r},bounds:function(e){var t=this.createElementNS(this.gmlns,"gml:Box");return t.appendChild(this.buildCoordinatesNode(e)),t}},buildCoordinatesNode:function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," ");var i=[];if(e instanceof OpenLayers.Bounds)i.push(e.left+","+e.bottom),i.push(e.right+","+e.top);else for(var r=e.components?e.components:[e],n=0;n<r.length;n++)i.push(r[n].x+","+r[n].y);var s=this.createTextNode(i.join(" "));return t.appendChild(s),t},CLASS_NAME:"OpenLayers.Format.GML"}),OpenLayers.Format.GML||(OpenLayers.Format.GML={}),OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.setGeometryTypes(),e&&e.featureNS&&this.setNamespace("feature",e.featureNS),this.singleFeatureType=!e||"string"==typeof e.featureType},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9===e.nodeType&&(e=e.documentElement);var t=[];if(this.readNode(e,{features:t},!0),0===t.length){var i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(i.length)for(var r=0,n=i.length;r<n;++r)this.readNode(i[r],{features:t},!0);else i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers"),i.length&&this.readNode(i[0],{features:t},!0)}return t},readNode:function(e,t,i){return i===!0&&this.autoConfig===!0&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||e.prefix in this.namespaces||e.parentNode.namespaceURI!==this.namespaces.gml||!this.regExes.featureMember.test(e.parentNode.nodeName)||(this.featureType=e.nodeName.split(":").pop(),this.setNamespace("feature",e.namespaceURI),this.featureNS=e.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[e,t])},readers:{gml:{_inherit:function(e,t,i){},featureMember:function(e,t){this.readChildNodes(e,t)},featureMembers:function(e,t){this.readChildNodes(e,t)},name:function(e,t){t.name=this.getChildValue(e)},boundedBy:function(e,t){var i={};this.readChildNodes(e,i),i.components&&i.components.length>0&&(t.bounds=i.components[0])},Point:function(e,t){var i={points:[]};this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(i.points[0])},coordinates:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");for(var r,n=i.split(this.regExes.splitSpace),s=n.length,o=[],a=0;a<s;++a)r=n[a].split(","),this.xy?o.push(new OpenLayers.Geometry.Point(r[0],r[1],r[2])):o.push(new OpenLayers.Geometry.Point(r[1],r[0],r[2]));t.points=o},coord:function(e,t){var i={};this.readChildNodes(e,i),t.points||(t.points=[]),t.points.push(new OpenLayers.Geometry.Point(i.x,i.y,i.z))},X:function(e,t){t.x=this.getChildValue(e)},Y:function(e,t){t.y=this.getChildValue(e)},Z:function(e,t){t.z=this.getChildValue(e)},MultiPoint:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiPoint(i.components)]},pointMember:function(e,t){this.readChildNodes(e,t)},LineString:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.LineString(i.points))},MultiLineString:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiLineString(i.components)]},lineStringMember:function(e,t){this.readChildNodes(e,t)},Polygon:function(e,t){var i={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.inner.unshift(i.outer),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.Polygon(i.inner))},LinearRing:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.LinearRing(i.points)]},MultiPolygon:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)]},polygonMember:function(e,t){this.readChildNodes(e,t)},GeometryCollection:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.Collection(i.components)]},geometryMember:function(e,t){this.readChildNodes(e,t)}},feature:{"*":function(e,t){var i,r=e.localName||e.nodeName.split(":").pop();t.features?this.singleFeatureType||OpenLayers.Util.indexOf(this.featureType,r)===-1?r===this.featureType&&(i="_typeName"):i="_typeName":0===e.childNodes.length||1===e.childNodes.length&&3===e.firstChild.nodeType?this.extractAttributes&&(i="_attribute"):i="_geometry",i&&this.readers.feature[i].apply(this,[e,t])},_typeName:function(e,t){var i={components:[],attributes:{}};this.readChildNodes(e,i),i.name&&(i.attributes.name=i.name);var r=new OpenLayers.Feature.Vector(i.components[0],i.attributes);this.singleFeatureType||(r.type=e.nodeName.split(":").pop(),r.namespace=e.namespaceURI);var n=e.getAttribute("fid")||this.getAttributeNS(e,this.namespaces.gml,"id");n&&(r.fid=n),this.internalProjection&&this.externalProjection&&r.geometry&&r.geometry.transform(this.externalProjection,this.internalProjection),i.bounds&&(r.bounds=i.bounds),t.features.push(r)},_geometry:function(e,t){this.geometryName||(this.geometryName=e.nodeName.split(":").pop()),this.readChildNodes(e,t)},_attribute:function(e,t){var i=e.localName||e.nodeName.split(":").pop(),r=this.getChildValue(e);t.attributes[i]=r}},wfs:{FeatureCollection:function(e,t){this.readChildNodes(e,t)}}},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:{featureMember:function(e){var t=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",e,t),t},MultiPoint:function(e){for(var t=this.createElementNSPlus("gml:MultiPoint"),i=e.components||[e],r=0,n=i.length;r<n;++r)this.writeNode("pointMember",i[r],t);return t},pointMember:function(e){var t=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",e,t),t},MultiLineString:function(e){for(var t=this.createElementNSPlus("gml:MultiLineString"),i=e.components||[e],r=0,n=i.length;r<n;++r)this.writeNode("lineStringMember",i[r],t);return t},lineStringMember:function(e){var t=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",e,t),t},MultiPolygon:function(e){for(var t=this.createElementNSPlus("gml:MultiPolygon"),i=e.components||[e],r=0,n=i.length;r<n;++r)this.writeNode("polygonMember",i[r],t);return t},polygonMember:function(e){var t=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",e,t),t},GeometryCollection:function(e){for(var t=this.createElementNSPlus("gml:GeometryCollection"),i=0,r=e.components.length;i<r;++i)this.writeNode("geometryMember",e.components[i],t);return t},geometryMember:function(e){var t=this.createElementNSPlus("gml:geometryMember"),i=this.writeNode("feature:_geometry",e);return t.appendChild(i.firstChild),t}},feature:{_typeName:function(e){var t=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});e.geometry&&this.writeNode("feature:_geometry",e.geometry,t);for(var i in e.attributes)if(e.attributes.hasOwnProperty(i)){var r=e.attributes[i];null!=r&&this.writeNode("feature:_attribute",{name:i,value:r},t)}return t},_geometry:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone().transform(this.internalProjection,this.externalProjection));var t=this.createElementNSPlus("feature:"+this.geometryName),i=this.geometryTypes[e.CLASS_NAME],r=this.writeNode("gml:"+i,e,t);return this.srsName&&r.setAttribute("srsName",this.srsName),t},_attribute:function(e){return this.createElementNSPlus("feature:"+e.name,{value:e.value})}},wfs:{FeatureCollection:function(e){for(var t=this.createElementNSPlus("wfs:FeatureCollection"),i=0,r=e.length;i<r;++i)this.writeNode("gml:featureMember",e[i],t);return t}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString",
"OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"}),OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},innerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},Box:function(e,t){var i={};this.readChildNodes(e,i),t.components||(t.components=[]);var r=i.points[0],n=i.points[1];t.components.push(new OpenLayers.Bounds(r.x,r.y,n.x,n.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"wfs:FeatureCollection":"gml:featureMember";var i=this.writeNode(t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[e],t),t},coordinates:function(e){for(var t,i=e.length,r=new Array(i),n=0;n<i;++n)t=e[n],this.xy?r[n]=t.x+","+t.y:r[n]=t.y+","+t.x,void 0!=t.z&&(r[n]+=","+t.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==i?r[0]:r.join(" ")})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",e.components,t),t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],t);for(var i=1;i<e.components.length;++i)this.writeNode("innerBoundaryIs",e.components[i],t);return t},outerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",e,t),t},innerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",e.components,t),t},Box:function(e){var t=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:e.left,y:e.bottom},{x:e.right,y:e.top}],t),this.srsName&&t.setAttribute("srsName",this.srsName),t}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"}),OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(e,t,i){var r=parseInt(e.getAttribute("srsDimension"),10)||i&&i.srsDimension;r&&(t.srsDimension=r)},featureMembers:function(e,t){this.readChildNodes(e,t)},Curve:function(e,t){var i={points:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.LineString(i.points))},segments:function(e,t){this.readChildNodes(e,t)},LineStringSegment:function(e,t){var i={};this.readChildNodes(e,i),i.points&&Array.prototype.push.apply(t.points,i.points)},pos:function(e,t){var i,r=this.getChildValue(e).replace(this.regExes.trimSpace,""),n=r.split(this.regExes.splitSpace);i=this.xy?new OpenLayers.Geometry.Point(n[0],n[1],n[2]):new OpenLayers.Geometry.Point(n[1],n[0],n[2]),t.points=[i]},posList:function(e,t){for(var i,r,n,s=this.getChildValue(e).replace(this.regExes.trimSpace,""),o=s.split(this.regExes.splitSpace),a=t.srsDimension||parseInt(e.getAttribute("srsDimension")||e.getAttribute("dimension"),10)||2,l=o.length/a,p=new Array(l),h=0,u=o.length;h<u;h+=a)i=o[h],r=o[h+1],n=2==a?void 0:o[h+2],this.xy?p[h/a]=new OpenLayers.Geometry.Point(i,r,n):p[h/a]=new OpenLayers.Geometry.Point(r,i,n);t.points=p},Surface:function(e,t){this.readChildNodes(e,t)},patches:function(e,t){this.readChildNodes(e,t)},PolygonPatch:function(e,t){this.readers.gml.Polygon.apply(this,[e,t])},exterior:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},interior:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},MultiCurve:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiLineString(i.components)])},curveMember:function(e,t){this.readChildNodes(e,t)},MultiSurface:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)])},surfaceMember:function(e,t){this.readChildNodes(e,t)},surfaceMembers:function(e,t){this.readChildNodes(e,t)},pointMembers:function(e,t){this.readChildNodes(e,t)},lineStringMembers:function(e,t){this.readChildNodes(e,t)},polygonMembers:function(e,t){this.readChildNodes(e,t)},geometryMembers:function(e,t){this.readChildNodes(e,t)},Envelope:function(e,t){var i={points:new Array(2)};this.readChildNodes(e,i),t.components||(t.components=[]);var r=i.points[0],n=i.points[1];t.components.push(new OpenLayers.Bounds(r.x,r.y,n.x,n.y))},lowerCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[0]=i.points[0]},upperCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[1]=i.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(e){for(var t=this.createElementNSPlus("gml:featureMembers"),i=0,r=e.length;i<r;++i)this.writeNode("feature:_typeName",e[i],t);return t},Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("pos",e,t),t},pos:function(e){var t=this.xy?e.x+" "+e.y:e.y+" "+e.x;return this.createElementNSPlus("gml:pos",{value:t})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",e.components,t),t},Curve:function(e){var t=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",e,t),t},segments:function(e){var t=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",e,t),t},LineStringSegment:function(e){var t=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",e.components,t),t},posList:function(e){for(var t,i=e.length,r=new Array(i),n=0;n<i;++n)t=e[n],this.xy?r[n]=t.x+" "+t.y:r[n]=t.y+" "+t.x;return this.createElementNSPlus("gml:posList",{value:r.join(" ")})},Surface:function(e){var t=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",e,t),t},patches:function(e){var t=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",e,t),t},PolygonPatch:function(e){var t=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],t);for(var i=1,r=e.components.length;i<r;++i)this.writeNode("interior",e.components[i],t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],t);for(var i=1,r=e.components.length;i<r;++i)this.writeNode("interior",e.components[i],t);return t},exterior:function(e){var t=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",e,t),t},interior:function(e){var t=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",e.components,t),t},MultiCurve:function(e){for(var t=this.createElementNSPlus("gml:MultiCurve"),i=e.components||[e],r=0,n=i.length;r<n;++r)this.writeNode("curveMember",i[r],t);return t},curveMember:function(e){var t=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",e,t):this.writeNode("LineString",e,t),t},MultiSurface:function(e){for(var t=this.createElementNSPlus("gml:MultiSurface"),i=e.components||[e],r=0,n=i.length;r<n;++r)this.writeNode("surfaceMember",i[r],t);return t},surfaceMember:function(e){var t=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",e,t):this.writeNode("Polygon",e,t),t},Envelope:function(e){var t=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",e,t),this.writeNode("upperCorner",e,t),this.srsName&&t.setAttribute("srsName",this.srsName),t},lowerCorner:function(e){var t=this.xy?e.left+" "+e.bottom:e.bottom+" "+e.left;return this.createElementNSPlus("gml:lowerCorner",{value:t})},upperCorner:function(e){var t=this.xy?e.right+" "+e.top:e.top+" "+e.right;return this.createElementNSPlus("gml:upperCorner",{value:t})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===!0?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===!1?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===!0?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===!1?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"}),OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(e,t){var i=this.version;if(!i){var r=e.getAttribute("xmlns:ows");r&&"1.1"===r.substring(r.lastIndexOf("/")+1)&&(i="1.1.0"),i||(i=this.defaultVersion)}return i},CLASS_NAME:"OpenLayers.Format.OWSCommon"}),OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var i={};return this.readChildNodes(e,i),i},readers:{ows:{Exception:function(e,t){var i={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};t.exceptions.push(i),this.readChildNodes(e,i)},ExceptionText:function(e,t){var i=this.getChildValue(e);t.texts.push(i)},ServiceIdentification:function(e,t){t.serviceIdentification={},this.readChildNodes(e,t.serviceIdentification)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},Keywords:function(e,t){t.keywords={},this.readChildNodes(e,t.keywords)},Keyword:function(e,t){t[this.getChildValue(e)]=!0},ServiceType:function(e,t){t.serviceType={codeSpace:e.getAttribute("codeSpace"),value:this.getChildValue(e)}},ServiceTypeVersion:function(e,t){t.serviceTypeVersion=this.getChildValue(e)},Fees:function(e,t){t.fees=this.getChildValue(e)},AccessConstraints:function(e,t){t.accessConstraints=this.getChildValue(e)},ServiceProvider:function(e,t){t.serviceProvider={},this.readChildNodes(e,t.serviceProvider)},ProviderName:function(e,t){t.providerName=this.getChildValue(e)},ProviderSite:function(e,t){t.providerSite=this.getAttributeNS(e,this.namespaces.xlink,"href")},ServiceContact:function(e,t){t.serviceContact={},this.readChildNodes(e,t.serviceContact)},IndividualName:function(e,t){t.individualName=this.getChildValue(e)},PositionName:function(e,t){t.positionName=this.getChildValue(e)},ContactInfo:function(e,t){t.contactInfo={},this.readChildNodes(e,t.contactInfo)},Phone:function(e,t){t.phone={},this.readChildNodes(e,t.phone)},Voice:function(e,t){t.voice=this.getChildValue(e)},Address:function(e,t){t.address={},this.readChildNodes(e,t.address)},DeliveryPoint:function(e,t){t.deliveryPoint=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},AdministrativeArea:function(e,t){t.administrativeArea=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ElectronicMailAddress:function(e,t){t.electronicMailAddress=this.getChildValue(e)},Role:function(e,t){t.role=this.getChildValue(e)},OperationsMetadata:function(e,t){t.operationsMetadata={},this.readChildNodes(e,t.operationsMetadata)},Operation:function(e,t){var i=e.getAttribute("name");t[i]={},this.readChildNodes(e,t[i])},DCP:function(e,t){t.dcp={},this.readChildNodes(e,t.dcp)},HTTP:function(e,t){t.http={},this.readChildNodes(e,t.http)},Get:function(e,t){t.get||(t.get=[]);var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i),t.get.push(i)},Post:function(e,t){t.post||(t.post=[]);var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i),t.post.push(i)},Parameter:function(e,t){t.parameters||(t.parameters={});var i=e.getAttribute("name");t.parameters[i]={},this.readChildNodes(e,t.parameters[i])},Constraint:function(e,t){t.constraints||(t.constraints={});var i=e.getAttribute("name");t.constraints[i]={},this.readChildNodes(e,t.constraints[i])},Value:function(e,t){t[this.getChildValue(e)]=!0},OutputFormat:function(e,t){t.formats.push({value:this.getChildValue(e)}),this.readChildNodes(e,t)},WGS84BoundingBox:function(e,t){var i={};i.crs=e.getAttribute("crs"),t.BoundingBox?t.BoundingBox.push(i):(t.projection=i.crs,i=t),this.readChildNodes(e,i)},BoundingBox:function(e,t){this.readers.ows.WGS84BoundingBox.apply(this,[e,t])},LowerCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var r=i.split(this.regExes.splitSpace);t.left=r[0],t.bottom=r[1]},UpperCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");var r=i.split(this.regExes.splitSpace);t.right=r[0],t.top=r[1],t.bounds=new OpenLayers.Bounds(t.left,t.bottom,t.right,t.top),delete t.left,delete t.bottom,delete t.right,delete t.top},Language:function(e,t){t.language=this.getChildValue(e)}}},writers:{ows:{BoundingBox:function(e,t){var i=this.createElementNSPlus(t||"ows:BoundingBox",{attributes:{crs:e.projection}});return this.writeNode("ows:LowerCorner",e,i),this.writeNode("ows:UpperCorner",e,i),i},LowerCorner:function(e){var t=this.createElementNSPlus("ows:LowerCorner",{value:e.bounds.left+" "+e.bounds.bottom});return t},UpperCorner:function(e){var t=this.createElementNSPlus("ows:UpperCorner",{value:e.bounds.right+" "+e.bounds.top});return t},Identifier:function(e){var t=this.createElementNSPlus("ows:Identifier",{value:e});return t},Title:function(e){var t=this.createElementNSPlus("ows:Title",{value:e});return t},Abstract:function(e){var t=this.createElementNSPlus("ows:Abstract",{value:e});return t},OutputFormat:function(e){var t=this.createElementNSPlus("ows:OutputFormat",{value:e});return t}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"}),OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.success=!1,t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("language"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"}),OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)},AllowedValues:function(e,t){t.allowedValues={},this.readChildNodes(e,t.allowedValues)},AnyValue:function(e,t){t.anyValue=!0},DataType:function(e,t){t.dataType=this.getChildValue(e)},Range:function(e,t){t.range={},this.readChildNodes(e,t.range)},MinimumValue:function(e,t){t.minValue=this.getChildValue(e)},MaximumValue:function(e,t){t.maxValue=this.getChildValue(e)},Identifier:function(e,t){t.identifier=this.getChildValue(e)},SupportedCRS:function(e,t){t.supportedCRS=this.getChildValue(e)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(e){var t=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":e.closure}});return this.writeNode("ows:MinimumValue",e.minValue,t),this.writeNode("ows:MaximumValue",e.maxValue,t),t},MinimumValue:function(e){var t=this.createElementNSPlus("ows:MinimumValue",{value:e});return t},MaximumValue:function(e){var t=this.createElementNSPlus("ows:MaximumValue",{value:e});return t},Value:function(e){var t=this.createElementNSPlus("ows:Value",{value:e});return t}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"}),OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(e){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},OpenLayers.Format.prototype.initialize.apply(this,[e]),this.extract.point=function(e){return e.x+" "+e.y}},read:function(e){var t,i,r;e=e.replace(/[\n\r]/g," ");var n=this.regExes.typeStr.exec(e);if(n&&(i=n[1].toLowerCase(),r=n[2],this.parse[i]&&(t=this.parse[i].apply(this,[r])),this.internalProjection&&this.externalProjection))if(t&&"OpenLayers.Feature.Vector"==t.CLASS_NAME)t.geometry.transform(this.externalProjection,this.internalProjection);else if(t&&"geometrycollection"!=i&&"object"==typeof t)for(var s=0,o=t.length;s<o;s++){var a=t[s];a.geometry.transform(this.externalProjection,this.internalProjection)}return t},write:function(e){var t,i,r;e.constructor==Array?(t=e,r=!0):(t=[e],r=!1);var n=[];r&&n.push("GEOMETRYCOLLECTION(");for(var s=0,o=t.length;s<o;++s)r&&s>0&&n.push(","),i=t[s].geometry,n.push(this.extractGeometry(i));return r&&n.push(")"),n.join("")},extractGeometry:function(e){var t=e.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[t])return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var i="collection"==t?"GEOMETRYCOLLECTION":t.toUpperCase(),r=i+"("+this.extract[t].apply(this,[e])+")";return r},extract:{point:function(e){return e.x+" "+e.y},multipoint:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push("("+this.extract.point.apply(this,[e.components[i]])+")");return t.join(",")},linestring:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t.join(",")},multilinestring:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},polygon:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},multipolygon:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push("("+this.extract.polygon.apply(this,[e.components[i]])+")");return t.join(",")},collection:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extractGeometry.apply(this,[e.components[i]]));return t.join(",")}},parse:{point:function(e){var t=OpenLayers.String.trim(e).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t[0],t[1]))},multipoint:function(e){for(var t,i=OpenLayers.String.trim(e).split(","),r=[],n=0,s=i.length;n<s;++n)t=i[n].replace(this.regExes.trimParens,"$1"),r.push(this.parse.point.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(r))},linestring:function(e){for(var t=OpenLayers.String.trim(e).split(","),i=[],r=0,n=t.length;r<n;++r)i.push(this.parse.point.apply(this,[t[r]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(i))},multilinestring:function(e){for(var t,i=OpenLayers.String.trim(e).split(this.regExes.parenComma),r=[],n=0,s=i.length;n<s;++n)t=i[n].replace(this.regExes.trimParens,"$1"),r.push(this.parse.linestring.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(r))},polygon:function(e){for(var t,i,r,n=OpenLayers.String.trim(e).split(this.regExes.parenComma),s=[],o=0,a=n.length;o<a;++o)t=n[o].replace(this.regExes.trimParens,"$1"),i=this.parse.linestring.apply(this,[t]).geometry,r=new OpenLayers.Geometry.LinearRing(i.components),s.push(r);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(s))},multipolygon:function(e){for(var t,i=OpenLayers.String.trim(e).split(this.regExes.doubleParenComma),r=[],n=0,s=i.length;n<s;++n)t=i[n].replace(this.regExes.trimParens,"$1"),r.push(this.parse.polygon.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(r))},geometrycollection:function(e){e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var t=OpenLayers.String.trim(e).split("|"),i=[],r=0,n=t.length;r<n;++r)i.push(OpenLayers.Format.WKT.prototype.read.apply(this,[t[r]]));return i}},CLASS_NAME:"OpenLayers.Format.WKT"}),OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"}),OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={};return this.readers.ogc.Filter.apply(this,[e,t]),t.filter},readers:{ogc:{_expression:function(e){for(var t,i="",r=e.firstChild;r;r=r.nextSibling)switch(r.nodeType){case 1:t=this.readNode(r),t.property?i+="${"+t.property+"}":void 0!==t.value&&(i+=t.value);break;case 3:case 4:i+=r.nodeValue}return i},Filter:function(e,t){var i={fids:[],filters:[]};this.readChildNodes(e,i),i.fids.length>0?t.filter=new OpenLayers.Filter.FeatureId({fids:i.fids}):i.filters.length>0&&(t.filter=i.filters[0])},FeatureId:function(e,t){var i=e.getAttribute("fid");i&&t.fids.push(i)},And:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,i),t.filters.push(i)},Or:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,i),t.filters.push(i)},Not:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsBetween:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,i),t.filters.push(i)},Literal:function(e,t){t.value=OpenLayers.String.numericIf(this.getChildValue(e),!0)},PropertyName:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},UpperBoundary:function(e,t){t.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},Intersects:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=parseInt(this.getChildValue(e)),t.distanceUnits=e.getAttribute("units")},Function:function(e,t){},PropertyIsNull:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(e,i),t.filters.push(i)}}},readSpatial:function(e,t,i){var r=new OpenLayers.Filter.Spatial({type:i});this.readChildNodes(e,r),r.value=r.components[0],delete r.components,t.filters.push(r)},encodeLiteral:function(e){return e instanceof Date&&(e=OpenLayers.Date.toISOString(e)),e},writeOgcExpression:function(e,t){return e instanceof OpenLayers.Filter.Function?this.writeNode("Function",e,t):this.writeNode("Literal",e,t),t},write:function(e){return this.writers.ogc.Filter.apply(this,[e])},writers:{ogc:{Filter:function(e){var t=this.createElementNSPlus("ogc:Filter");return this.writeNode(this.getFilterType(e),e,t),t},_featureIds:function(e){for(var t=this.createDocumentFragment(),i=0,r=e.fids.length;i<r;++i)this.writeNode("ogc:FeatureId",e.fids[i],t);return t},FeatureId:function(e){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:e}})},And:function(e){for(var t,i=this.createElementNSPlus("ogc:And"),r=0,n=e.filters.length;r<n;++r)t=e.filters[r],this.writeNode(this.getFilterType(t),t,i);return i},Or:function(e){for(var t,i=this.createElementNSPlus("ogc:Or"),r=0,n=e.filters.length;r<n;++r)t=e.filters[r],this.writeNode(this.getFilterType(t),t,i);return i},Not:function(e){var t=this.createElementNSPlus("ogc:Not"),i=e.filters[0];return this.writeNode(this.getFilterType(i),i,t),t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",e,t),this.writeNode("LowerBoundary",e,t),this.writeNode("UpperBoundary",e,t),t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})},Literal:function(e){var t=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:t(e)})},LowerBoundary:function(e){var t=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(e.lowerBoundary,t),t},UpperBoundary:function(e){var t=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",e.upperBoundary,t),t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");return this.writeNode("Distance",e,t),t},Distance:function(e){return this.createElementNSPlus("ogc:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){for(var t=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}}),i=e.params,r=0,n=i.length;r<n;r++)this.writeOgcExpression(i[r],t);return t},PropertyIsNull:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNull");return this.writeNode("PropertyName",e,t),t}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t)throw"Filter writing not supported for rule type: "+e.type;return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"}),OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsNotEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var r=e.getAttribute("wildCard"),n=e.getAttribute("singleChar"),s=e.getAttribute("escape");i.value2regex(r,n,s),t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Box",e.value,t);return e.projection&&i.setAttribute("srsName",e.projection),t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);if(this.writeNode("PropertyName",e,i),e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,i);else{var r;r=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Box",e.value),e.projection&&r.setAttribute("srsName",e.projection),i.appendChild(r)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"
}),OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=e.getAttribute("matchCase"),r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,r),t.filters.push(r)},PropertyIsNotEqualTo:function(e,t){var i=e.getAttribute("matchCase"),r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,r),t.filters.push(r)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var r=e.getAttribute("wildCard"),n=e.getAttribute("singleChar"),s=e.getAttribute("escapeChar");i.value2regex(r,n,s),t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:e.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Envelope",e.value);return e.projection&&i.setAttribute("srsName",e.projection),t.appendChild(i),t},SortBy:function(e){for(var t=this.createElementNSPlus("ogc:SortBy"),i=0,r=e.length;i<r;i++)this.writeNode("ogc:SortProperty",e[i],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",e,t),this.writeNode("ogc:SortOrder","DESC"===e.order?"DESC":"ASC",t),t},SortOrder:function(e){var t=this.createElementNSPlus("ogc:SortOrder",{value:e});return t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);if(this.writeNode("PropertyName",e,i),e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,i);else{var r;r=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Envelope",e.value),e.projection&&r.setAttribute("srsName",e.projection),i.appendChild(r)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"}),OpenLayers.Format.WFST=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.WFST.DEFAULTS);var t=OpenLayers.Format.WFST["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFST version: "+e.version;return new t(e)},OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(e){this.stateName={},this.stateName[OpenLayers.State.INSERT]="wfs:Insert",this.stateName[OpenLayers.State.UPDATE]="wfs:Update",this.stateName[OpenLayers.State.DELETE]="wfs:Delete",OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},getSrsName:function(e,t){var i=t&&t.srsName;return i||(i=e&&e.layer?e.layer.projection.getCode():this.srsName),i},read:function(e,t){t=t||{},OpenLayers.Util.applyDefaults(t,{output:"features"}),"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var i={};return e&&this.readNode(e,i,!0),i.features&&"features"===t.output&&(i=i.features),i},readers:{wfs:{FeatureCollection:function(e,t){t.features=[],this.readChildNodes(e,t)}}},write:function(e,t){var i=this.writeNode("wfs:Transaction",{features:e,options:t}),r=this.schemaLocationAttr();return r&&this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",r),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{wfs:{GetFeature:function(e){var t=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:e&&e.handle,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if("string"==typeof this.featureType)this.writeNode("Query",e,t);else for(var i=0,r=this.featureType.length;i<r;i++)e.featureType=this.featureType[i],this.writeNode("Query",e,t);return t},Transaction:function(e){e=e||{};var t,i,r=e.options||{},n=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:r.handle}}),s=e.features;if(s){r.multi===!0&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===!0?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===!0?"MultiSurface":"MultiPolygon"});var o,a;for(t=0,i=s.length;t<i;++t)a=s[t],o=this.stateName[a.state],o&&this.writeNode(o,{feature:a,options:r},n);r.multi===!0&&this.setGeometryTypes()}if(r.nativeElements)for(t=0,i=r.nativeElements.length;t<i;++t)this.writeNode("wfs:Native",r.nativeElements[t],n);return n},Native:function(e){var t=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:e.vendorId,safeToIgnore:e.safeToIgnore},value:e.value});return t},Insert:function(e){var t=e.feature,i=e.options,r=this.createElementNSPlus("wfs:Insert",{attributes:{handle:i&&i.handle}});return this.srsName=this.getSrsName(t),this.writeNode("feature:_typeName",t,r),r},Update:function(e){var t=e.feature,i=e.options,r=this.createElementNSPlus("wfs:Update",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var n=t.modified;null===this.geometryName||n&&void 0===n.geometry||(this.srsName=this.getSrsName(t),this.writeNode("Property",{name:this.geometryName,value:t.geometry},r));for(var s in t.attributes)void 0===t.attributes[s]||n&&n.attributes&&(!n.attributes||void 0===n.attributes[s])||this.writeNode("Property",{name:s,value:t.attributes[s]},r);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),r),r},Property:function(e){var t=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",e.name,t),null!==e.value&&this.writeNode("Value",e.value,t),t},Name:function(e){return this.createElementNSPlus("wfs:Name",{value:e})},Value:function(e){var t;if(e instanceof OpenLayers.Geometry){t=this.createElementNSPlus("wfs:Value");var i=this.writeNode("feature:_geometry",e).firstChild;t.appendChild(i)}else t=this.createElementNSPlus("wfs:Value",{value:e});return t},Delete:function(e){var t=e.feature,i=e.options,r=this.createElementNSPlus("wfs:Delete",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),r),r}}},schemaLocationAttr:function(e){e=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e);var t=OpenLayers.Util.extend({},this.schemaLocations);e.schema&&(t[e.featurePrefix]=e.schema);var i,r=[];for(var n in t)i=this.namespaces[n],i&&r.push(i+" "+t[n]);var s=r.join(" ")||void 0;return s},setFilterProperty:function(e){if(e.filters)for(var t=0,i=e.filters.length;t<i;++t)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[t]);else e instanceof OpenLayers.Filter.Spatial&&!e.property&&(e.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"}),OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[e]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,i){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},InsertResult:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds=t.insertIds.concat(i.fids)},TransactionResult:function(e,t){this.readChildNodes(e,t)},Status:function(e,t){this.readChildNodes(e,t)},SUCCESS:function(e,t){t.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},e);var t=e.featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType}});if(e.srsNameInQuery&&e.srsName&&i.setAttribute("srsName",e.srsName),e.featureNS&&i.setAttribute("xmlns:"+t,e.featureNS),e.propertyNames)for(var r=0,n=e.propertyNames.length;r<n;r++)this.writeNode("ogc:PropertyName",{property:e.propertyNames[r]},i);return e.filter&&(this.setFilterProperty(e.filter),this.writeNode("ogc:Filter",e.filter,i)),i}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"}),OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[e]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,i){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){t.numberOfFeatures=parseInt(e.getAttribute("numberOfFeatures")),OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},TransactionSummary:function(e,t){t.success=!0},InsertResults:function(e,t){this.readChildNodes(e,t)},Feature:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds.push(i.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(e){var t=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return e&&this.setAttributes(t,{resultType:e.resultType,startIndex:e.startIndex,count:e.count}),t},Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e);var t=e.featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType,srsName:e.srsName}});if(e.featureNS&&i.setAttribute("xmlns:"+t,e.featureNS),e.propertyNames)for(var r=0,n=e.propertyNames.length;r<n;r++)this.writeNode("wfs:PropertyName",{property:e.propertyNames[r]},i);return e.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,e.filter),this.writeNode("ogc:Filter",e.filter,i)),i},PropertyName:function(e){return this.createElementNSPlus("wfs:PropertyName",{value:e.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"}),OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(e,t){if(t&&"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(t[i]=walk(i,t[i]));return filter(e,t)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter&&(object=walk("",object)))}catch(e){}return this.keepData&&(this.data=object),object},write:function(e,t){this.pretty=!!t;var i=null,r=typeof e;if(this.serialize[r])try{i=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[r].apply(this,[e])}catch(n){OpenLayers.Console.error("Trouble serializing: "+n)}return i},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;t<this.level;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t=["{"];this.level+=1;var i,r,n,s=!1;for(i in e)e.hasOwnProperty(i)&&(r=OpenLayers.Format.JSON.prototype.write.apply(this,[i,this.pretty]),n=OpenLayers.Format.JSON.prototype.write.apply(this,[e[i],this.pretty]),null!=r&&null!=n&&(s&&t.push(","),t.push(this.writeNewline(),this.writeIndent(),r,":",this.writeSpace(),n),s=!0));return this.level-=1,t.push(this.writeNewline(),this.writeIndent(),"}"),t.join("")},array:function(e){var t,i=["["];this.level+=1;for(var r=0,n=e.length;r<n;++r)t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[r],this.pretty]),null!=t&&(r>0&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),t));return this.level-=1,i.push(this.writeNewline(),this.writeIndent(),"]"),i.join("")},string:function(e){var t={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,i){var r=t[i];return r?r:(r=i.charCodeAt(),"\\u00"+Math.floor(r/16).toString(16)+(r%16).toString(16))})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},"boolean":function(e){return String(e)},date:function(e){function t(e){return e<10?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,i){t=t?t:"FeatureCollection";var r=null,n=null;if(n="string"==typeof e?OpenLayers.Format.JSON.prototype.read.apply(this,[e,i]):e){if("string"!=typeof n.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(n,t))switch(t){case"Geometry":try{r=this.parseGeometry(n)}catch(s){OpenLayers.Console.error(s)}break;case"Feature":try{r=this.parseFeature(n),r.type="Feature"}catch(s){OpenLayers.Console.error(s)}break;case"FeatureCollection":switch(r=[],n.type){case"Feature":try{r.push(this.parseFeature(n))}catch(s){r=null,OpenLayers.Console.error(s)}break;case"FeatureCollection":for(var o=0,a=n.features.length;o<a;++o)try{r.push(this.parseFeature(n.features[o]))}catch(s){r=null,OpenLayers.Console.error(s)}break;default:try{var l=this.parseGeometry(n);r.push(new OpenLayers.Feature.Vector(l))}catch(s){r=null,OpenLayers.Console.error(s)}}}}else OpenLayers.Console.error("Bad JSON: "+e);return r},isValidType:function(e,t){var i=!1;switch(t){case"Geometry":OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],e.type)==-1?OpenLayers.Console.error("Unsupported geometry type: "+e.type):i=!0;break;case"FeatureCollection":i=!0;break;default:e.type==t?i=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+t)}return i},parseFeature:function(e){var t,i,r,n;r=e.properties?e.properties:{},n=e.geometry&&e.geometry.bbox||e.bbox;try{i=this.parseGeometry(e.geometry)}catch(s){throw s}return t=new OpenLayers.Feature.Vector(i,r),n&&(t.bounds=OpenLayers.Bounds.fromArray(n)),e.id&&(t.fid=e.id),t},parseGeometry:function(e){if(null==e)return null;var t,i=!1;if("GeometryCollection"==e.type){if(!OpenLayers.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;for(var r=e.geometries.length,n=new Array(r),s=0;s<r;++s)n[s]=this.parseGeometry.apply(this,[e.geometries[s]]);t=new OpenLayers.Geometry.Collection(n),i=!0}else{if(!OpenLayers.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(o){throw o}}return this.internalProjection&&this.externalProjection&&!i&&t.transform(this.externalProjection,this.internalProjection),t},parseCoords:{point:function(e){if(0==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new OpenLayers.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],i=null,r=0,n=e.length;r<n;++r){try{i=this.parseCoords.point.apply(this,[e[r]])}catch(s){throw s}t.push(i)}return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],i=null,r=0,n=e.length;r<n;++r){try{i=this.parseCoords.point.apply(this,[e[r]])}catch(s){throw s}t.push(i)}return new OpenLayers.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],i=null,r=0,n=e.length;r<n;++r){try{i=this.parseCoords.linestring.apply(this,[e[r]])}catch(s){throw s}t.push(i)}return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){for(var t,i,r=[],n=0,s=e.length;n<s;++n){try{i=this.parseCoords.linestring.apply(this,[e[n]])}catch(o){throw o}t=new OpenLayers.Geometry.LinearRing(i.components),r.push(t)}return new OpenLayers.Geometry.Polygon(r)},multipolygon:function(e){for(var t=[],i=null,r=0,n=e.length;r<n;++r){try{i=this.parseCoords.polygon.apply(this,[e[r]])}catch(s){throw s}t.push(i)}return new OpenLayers.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(e[0][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var i={type:null};if(OpenLayers.Util.isArray(e)){i.type="FeatureCollection";var r=e.length;i.features=new Array(r);for(var n=0;n<r;++n){var s=e[n];if(!s instanceof OpenLayers.Feature.Vector){var o="FeatureCollection only supports collections of features: "+s;throw o}i.features[n]=this.extract.feature.apply(this,[s])}}else 0==e.CLASS_NAME.indexOf("OpenLayers.Geometry")?i=this.extract.geometry.apply(this,[e]):e instanceof OpenLayers.Feature.Vector&&(i=this.extract.feature.apply(this,[e]),e.layer&&e.layer.projection&&(i.crs=this.createCRSObject(e)));return OpenLayers.Format.JSON.prototype.write.apply(this,[i,t])},writeTojSON:function(e,t){var i={type:null};if(OpenLayers.Util.isArray(e)){i.type="FeatureCollection";var r=e.length;i.features=new Array(r);for(var n=0;n<r;++n){var s=e[n];if(!s instanceof OpenLayers.Feature.Vector){var o="FeatureCollection only supports collections of features: "+s;throw o}i.features[n]=this.extract.feature.apply(this,[s])}}else 0==e.CLASS_NAME.indexOf("OpenLayers.Geometry")?i=this.extract.geometry.apply(this,[e]):e instanceof OpenLayers.Feature.Vector&&(i=this.extract.feature.apply(this,[e]),e.layer&&e.layer.projection&&(i.crs=this.createCRSObject(e)));return i},createCRSObject:function(e){var t=e.layer.projection.toString(),i={};if(t.match(/epsg:/i)){var r=parseInt(t.substring(t.indexOf(":")+1));i=4326==r?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+r}}}return i},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),i={type:"Feature",properties:e.attributes,geometry:t};return null!=e.fid&&(i.id=e.fid),i},geometry:function(e){if(null==e)return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t=e.CLASS_NAME.split(".")[2];if(e.components&&e.components.length>1&&"polygon"===t.toLowerCase()&&t.indexOf("Multi")===-1){t="Multi"+t,mpy=[];for(var i=e.components.length-1;i>=0;i--){var r=new OpenLayers.Geometry.Polygon(e.components[i]);mpy.push(r)}e=new OpenLayers.Geometry.MultiPolygon(mpy)}var n,s=this.extract[t.toLowerCase()].apply(this,[e]);return n="Collection"==t?{type:"GeometryCollection",geometries:s}:{type:t,coordinates:s}},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},linestring:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},multilinestring:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},polygon:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},multipolygon:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.polygon.apply(this,[e.components[i]]));return t},collection:function(e){for(var t=e.components.length,i=new Array(t),r=0;r<t;++r)i[r]=this.extract.geometry.apply(this,[e.components[r]]);return i}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(e){var t=this.writeNode("wcs:GetCoverage",e);return this.setAttributeNS(t,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[t])},writers:{wcs:{GetCoverage:function(e){var t=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:e.version||this.VERSION,service:"WCS"}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("wcs:DomainSubset",e.domainSubset,t),this.writeNode("wcs:Output",e.output,t),t},DomainSubset:function(e){var t=this.createElementNSPlus("wcs:DomainSubset",{});return this.writeNode("ows:BoundingBox",e.boundingBox,t),e.temporalSubset&&this.writeNode("wcs:TemporalSubset",e.temporalSubset,t),t},TemporalSubset:function(e){for(var t=this.createElementNSPlus("wcs:TemporalSubset",{}),i=0,r=e.timePeriods.length;i<r;++i)this.writeNode("wcs:TimePeriod",e.timePeriods[i],t);return t},TimePeriod:function(e){var t=this.createElementNSPlus("wcs:TimePeriod",{});return this.writeNode("wcs:BeginPosition",e.begin,t),this.writeNode("wcs:EndPosition",e.end,t),e.resolution&&this.writeNode("wcs:TimeResolution",e.resolution,t),t},BeginPosition:function(e){var t=this.createElementNSPlus("wcs:BeginPosition",{value:e});return t},EndPosition:function(e){var t=this.createElementNSPlus("wcs:EndPosition",{value:e});return t},TimeResolution:function(e){var t=this.createElementNSPlus("wcs:TimeResolution",{value:e});return t},Output:function(e){var t=this.createElementNSPlus("wcs:Output",{attributes:{format:e.format,store:e.store}});return e.gridCRS&&this.writeNode("wcs:GridCRS",e.gridCRS,t),t},GridCRS:function(e){var t=this.createElementNSPlus("wcs:GridCRS",{});return this.writeNode("wcs:GridBaseCRS",e.baseCRS,t),e.type&&this.writeNode("wcs:GridType",e.type,t),e.origin&&this.writeNode("wcs:GridOrigin",e.origin,t),this.writeNode("wcs:GridOffsets",e.offsets,t),e.CS&&this.writeNode("wcs:GridCS",e.CS,t),t},GridBaseCRS:function(e){return this.createElementNSPlus("wcs:GridBaseCRS",{value:e})},GridOrigin:function(e){return this.createElementNSPlus("wcs:GridOrigin",{value:e})},GridType:function(e){return this.createElementNSPlus("wcs:GridType",{value:e})},GridOffsets:function(e){return this.createElementNSPlus("wcs:GridOffsets",{value:e})},GridCS:function(e){return this.createElementNSPlus("wcs:GridCS",{value:e})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"}),OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wps:{ProcessDescriptions:function(e,t){t.processDescriptions={},this.readChildNodes(e,t.processDescriptions)},ProcessDescription:function(e,t){var i=this.getAttributeNS(e,this.namespaces.wps,"processVersion"),r={processVersion:i,statusSupported:"true"===e.getAttribute("statusSupported"),storeSupported:"true"===e.getAttribute("storeSupported")};this.readChildNodes(e,r),t[r.identifier]=r},DataInputs:function(e,t){t.dataInputs=[],this.readChildNodes(e,t.dataInputs)},ProcessOutputs:function(e,t){t.processOutputs=[],this.readChildNodes(e,t.processOutputs)},Output:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)},ComplexOutput:function(e,t){t.complexOutput={},this.readChildNodes(e,t.complexOutput)},LiteralOutput:function(e,t){t.literalOutput={},this.readChildNodes(e,t.literalOutput)},Input:function(e,t){var i={maxOccurs:parseInt(e.getAttribute("maxOccurs")),minOccurs:parseInt(e.getAttribute("minOccurs"))};this.readChildNodes(e,i),t.push(i)},BoundingBoxData:function(e,t){t.boundingBoxData={},this.readChildNodes(e,t.boundingBoxData)},CRS:function(e,t){t.CRSs||(t.CRSs={}),t.CRSs[this.getChildValue(e)]=!0},LiteralData:function(e,t){t.literalData={},this.readChildNodes(e,t.literalData)},ComplexData:function(e,t){t.complexData={},this.readChildNodes(e,t.complexData)},Default:function(e,t){t["default"]={},this.readChildNodes(e,t["default"])},Supported:function(e,t){t.supported={},this.readChildNodes(e,t.supported)},Format:function(e,t){var i={};this.readChildNodes(e,i),t.formats||(t.formats={}),t.formats[i.mimeType]=!0},MimeType:function(e,t){t.mimeType=this.getChildValue(e)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"}),OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,OpenLayers.Format.Filter.v1_1_0,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(e){},write:function(e){var t;window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),this.xmldom=t):t=document.implementation.createDocument("","",null);var i=this.writeNode("wps:Execute",e,t);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[i])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},writers:{wps:{Execute:function(e){var t=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("wps:DataInputs",e.dataInputs,t),this.writeNode("wps:ResponseForm",e.responseForm,t),t},ResponseForm:function(e){var t=this.createElementNSPlus("wps:ResponseForm",{});return e.rawDataOutput&&this.writeNode("wps:RawDataOutput",e.rawDataOutput,t),e.responseDocument&&this.writeNode("wps:ResponseDocument",e.responseDocument,t),t},ResponseDocument:function(e){var t=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:e.storeExecuteResponse,lineage:e.lineage,status:e.status}});if(e.outputs)for(var i=0,r=e.outputs.length;i<r;i++)this.writeNode("wps:Output",e.outputs[i],t);return t},Output:function(e){var t=this.createElementNSPlus("wps:Output",{attributes:{asReference:e.asReference,mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("ows:Title",e.title,t),this.writeNode("ows:Abstract",e["abstract"],t),t},RawDataOutput:function(e){var t=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}});return this.writeNode("ows:Identifier",e.identifier,t),t},DataInputs:function(e){for(var t=this.createElementNSPlus("wps:DataInputs",{}),i=0,r=e.length;i<r;++i)this.writeNode("wps:Input",e[i],t);return t},Input:function(e){var t=this.createElementNSPlus("wps:Input",{});return this.writeNode("ows:Identifier",e.identifier,t),e.title&&this.writeNode("ows:Title",e.title,t),e.data&&this.writeNode("wps:Data",e.data,t),e.reference&&this.writeNode("wps:Reference",e.reference,t),e.boundingBoxData&&this.writeNode("wps:BoundingBoxData",e.boundingBoxData,t),t},Data:function(e){var t=this.createElementNSPlus("wps:Data",{});return e.literalData?this.writeNode("wps:LiteralData",e.literalData,t):e.complexData?this.writeNode("wps:ComplexData",e.complexData,t):e.boundingBoxData&&this.writeNode("ows:BoundingBox",e.boundingBoxData,t),t},LiteralData:function(e){var t=this.createElementNSPlus("wps:LiteralData",{attributes:{uom:e.uom},value:e.value});return t},ComplexData:function(e){var t=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}}),i=e.value;return"string"==typeof i?t.appendChild(this.getXMLDoc().createCDATASection(e.value)):t.appendChild(i),t},Reference:function(e){var t=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:e.mimeType,"xlink:href":e.href,method:e.method,
encoding:e.encoding,schema:e.schema}});return e.body&&this.writeNode("wps:Body",e.body,t),t},BoundingBoxData:function(e,t){this.writers.ows.BoundingBox.apply(this,[e,t,"wps:BoundingBoxData"])},Body:function(e){var t=this.createElementNSPlus("wps:Body",{});return e.wcs?this.writeNode("wcs:GetCoverage",e.wcs,t):e.wfs?(this.featureType=e.wfs.featureType,this.version=e.wfs.version,this.writeNode("wfs:GetFeature",e.wfs,t)):this.writeNode("wps:Execute",e,t),t}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(e,t){t.executeResponse={lang:e.getAttribute("lang"),statusLocation:e.getAttribute("statusLocation"),serviceInstance:e.getAttribute("serviceInstance"),service:e.getAttribute("service")},this.readChildNodes(e,t.executeResponse)},Process:function(e,t){t.process={},this.readChildNodes(e,t.process)},Status:function(e,t){t.status={creationTime:e.getAttribute("creationTime")},this.readChildNodes(e,t.status)},ProcessSucceeded:function(e,t){t.processSucceeded=!0},ProcessOutputs:function(e,t){t.processOutputs=[],this.readChildNodes(e,t.processOutputs)},Output:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)},Reference:function(e,t){t.reference={href:e.getAttribute("href"),mimeType:e.getAttribute("mimeType"),encoding:e.getAttribute("encoding"),schema:e.getAttribute("schema")}},Data:function(e,t){t.data={},this.readChildNodes(e,t)},LiteralData:function(e,t){t.literalData={dataType:e.getAttribute("dataType"),uom:e.getAttribute("uom"),value:this.getChildValue(e)}},ComplexData:function(e,t){if(t.complexData={mimeType:e.getAttribute("mimeType"),schema:e.getAttribute("schema"),encoding:e.getAttribute("encoding"),value:""},this.isSimpleContent(e)){var i;for(i=e.firstChild;i;i=i.nextSibling)switch(i.nodeType){case 3:case 4:t.complexData.value+=i.nodeValue}}else for(i=e.firstChild;i;i=i.nextSibling)1==i.nodeType&&(t.complexData.value=i)},BoundingBox:function(e,t){t.boundingBoxData={dimensions:e.getAttribute("dimensions"),crs:e.getAttribute("crs")},this.readChildNodes(e,t.boundingBoxData)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"}),OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(e){e.handlerOptions=e.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[e]),this.features={},this.handlers={},this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})),this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))),this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active)for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&this.handlers[e].activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active)for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&this.handlers[e].deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(e){var t=this.pixelToBounds(e.xy);this.setModifiers(e),this.request(t,{single:this.single})},selectBox:function(e){var t;if(e instanceof OpenLayers.Bounds){var i=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),r=this.map.getLonLatFromPixel({x:e.right,y:e.top});t=new OpenLayers.Bounds(i.lon,i.lat,r.lon,r.lat)}else{if(this.click)return;t=this.pixelToBounds(e)}this.setModifiers(this.handlers.box.dragHandler.evt),this.request(t)},selectHover:function(e){var t=this.pixelToBounds(e.xy);this.request(t,{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(e,t){t=t||{};var i=new OpenLayers.Filter.Spatial({type:this.filterType,value:e});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var r=this.protocol.read({maxFeatures:t.single===!0?this.maxFeatures:void 0,filter:i,callback:function(i){i.success()&&(i.features.length?t.single===!0?this.selectBestFeature(i.features,e.getCenterLonLat(),t):this.select(i.features):t.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll())),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});t.hover===!0&&(this.hoverResponse=r)},selectBestFeature:function(e,t,i){if(i=i||{},e.length){for(var r,n,s,o=new OpenLayers.Geometry.Point(t.lon,t.lat),a=Number.MAX_VALUE,l=0;l<e.length&&(r=e[l],!(r.geometry&&(s=o.distanceTo(r.geometry,{edge:!1}),s<a&&(a=s,n=r,0===a))));++l);i.hover===!0?this.hoverSelect(n):this.select(n||e)}},setModifiers:function(e){this.modifiers={multiple:this.multiple||this.multipleKey&&e[this.multipleKey],toggle:this.toggle||this.toggleKey&&e[this.toggleKey]}},select:function(e){this.modifiers.multiple||this.modifiers.toggle||this.unselectAll(),OpenLayers.Util.isArray(e)||(e=[e]);var t=this.events.triggerEvent("beforefeaturesselected",{features:e});if(t!==!1){for(var i,r=[],n=0,s=e.length;n<s;++n)i=e[n],this.features[i.fid||i.id]?this.modifiers.toggle&&this.unselect(this.features[i.fid||i.id]):(t=this.events.triggerEvent("beforefeatureselected",{feature:i}),t!==!1&&(this.features[i.fid||i.id]=i,r.push(i),this.events.triggerEvent("featureselected",{feature:i})));this.events.triggerEvent("featuresselected",{features:r})}},hoverSelect:function(e){var t=e?e.fid||e.id:null,i=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;i&&i!==t&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null),t&&t!==i&&(this.events.triggerEvent("hoverfeature",{feature:e}),this.hoverFeature=e)},unselect:function(e){delete this.features[e.fid||e.id],this.events.triggerEvent("featureunselected",{feature:e})},unselectAll:function(){for(var e in this.features)this.features.hasOwnProperty(e)&&this.unselect(this.features[e])},setMap:function(e){for(var t in this.handlers)this.handlers.hasOwnProperty(t)&&this.handlers[t].setMap(e);OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(e){var t=e.add(-this.clickTolerance/2,this.clickTolerance/2),i=e.add(this.clickTolerance/2,-this.clickTolerance/2),r=this.map.getLonLatFromPixel(t),n=this.map.getLonLatFromPixel(i);return new OpenLayers.Bounds(r.lon,r.lat,n.lon,n.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"}),OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]),this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var e=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),e},CLASS_NAME:"OpenLayers.Control.NavToolbar"}),OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]);var e={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,e),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,e)])},CLASS_NAME:"OpenLayers.Control.PanPanel"}),OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(e,t){this.direction=e,this.CLASS_NAME+=this.direction,OpenLayers.Control.prototype.initialize.apply(this,[t])},trigger:function(){if(this.map){var e=OpenLayers.Function.bind(function(e){return this.slideRatio?this.map.getSize()[e]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-e("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,e("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-e("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(e("w"),0)}}},CLASS_NAME:"OpenLayers.Control.Pan"}),OpenLayers.Control.Pan.NORTH="North",OpenLayers.Control.Pan.SOUTH="South",OpenLayers.Control.Pan.EAST="East",OpenLayers.Control.Pan.WEST="West",OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"}),OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"}),OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]),this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"}),OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:null,available:"geolocation"in navigator,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.available&&!this.geolocation&&(this.geolocation=navigator.geolocation),this.geolocation?!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){return this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(e){var t=new OpenLayers.LonLat(e.coords.longitude,e.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(t),this.events.triggerEvent("locationupdated",{position:e,point:new OpenLayers.Geometry.Point(t.lon,t.lat)})},getCurrentLocation:function(){return!(!this.active||this.watch)&&(this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions),!0)},failure:function(e){this.events.triggerEvent("locationfailed",{error:e})},CLASS_NAME:"OpenLayers.Control.Geolocate"}),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(e){var t;e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var i=e.split("-");if(i[0]=i[0].toLowerCase(),"object"==typeof OpenLayers.Lang[i[0]]&&(t=i[0]),i[1]){var r=i[0]+"-"+i[1].toUpperCase();"object"==typeof OpenLayers.Lang[r]&&(t=r)}t||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+i.join("-")+" dictionary, falling back to default language"),t=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=t},translate:function(e,t){var i=OpenLayers.Lang[OpenLayers.Lang.getCode()],r=i&&i[e];return r||(r=e),t&&(r=OpenLayers.String.format(r,t)),r}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",Permalink:"Permalink",Overlays:"Overlays","Base Layer":"Base Layer",noFID:"Can't update a feature for which there is no FID.",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>","Scale = 1 : ${scaleDenom}":"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",Graticule:"Graticule",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",end:""},OpenLayers.Spherical=OpenLayers.Spherical||{},OpenLayers.Spherical.DEFAULT_RADIUS=6378137,OpenLayers.Spherical.computeDistanceBetween=function(e,t,i){var r=i||OpenLayers.Spherical.DEFAULT_RADIUS,n=Math.sin(Math.PI*(t.lon-e.lon)/360),s=Math.sin(Math.PI*(t.lat-e.lat)/360),o=s*s+n*n*Math.cos(Math.PI*e.lat/180)*Math.cos(Math.PI*t.lat/180);return 2*r*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))},OpenLayers.Spherical.computeHeading=function(e,t){var i=Math.sin(Math.PI*(e.lon-t.lon)/180)*Math.cos(Math.PI*t.lat/180),r=Math.cos(Math.PI*e.lat/180)*Math.sin(Math.PI*t.lat/180)-Math.sin(Math.PI*e.lat/180)*Math.cos(Math.PI*t.lat/180)*Math.cos(Math.PI*(e.lon-t.lon)/180);return 180*Math.atan2(i,r)/Math.PI},OpenLayers.TileManager=OpenLayers.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.maps=[],this.tileQueueId={},this.tileQueue={},this.tileCache={},this.tileCacheIndex=[]},addMap:function(e){if(!this._destroyed&&OpenLayers.Layer.Grid){this.maps.push(e),this.tileQueue[e.id]=[];for(var t=0,i=e.layers.length;t<i;++t)this.addLayer({layer:e.layers[t]});e.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}},removeMap:function(e){if(!this._destroyed&&OpenLayers.Layer.Grid){if(window.clearTimeout(this.tileQueueId[e.id]),e.layers)for(var t=0,i=e.layers.length;t<i;++t)this.removeLayer({layer:e.layers[t]});e.events&&e.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this}),delete this.tileQueue[e.id],delete this.tileQueueId[e.id],OpenLayers.Util.removeItem(this.maps,e)}},move:function(e){this.updateTimeout(e.object,this.moveDelay,!0)},zoomEnd:function(e){this.updateTimeout(e.object,this.zoomDelay)},changeLayer:function(e){"visibility"!==e.property&&"params"!==e.property||this.updateTimeout(e.object,0)},addLayer:function(e){var t=e.layer;if(t instanceof OpenLayers.Layer.Grid){t.events.on({addtile:this.addTile,refresh:this.handleLayerRefresh,retile:this.clearTileQueue,scope:this});var i,r,n;for(i=t.grid.length-1;i>=0;--i)for(r=t.grid[i].length-1;r>=0;--r)n=t.grid[i][r],this.addTile({tile:n}),n.url&&!n.imgDiv&&this.manageTileCache({object:n})}},removeLayer:function(e){var t=e.layer;if(t instanceof OpenLayers.Layer.Grid&&(this.clearTileQueue({object:t}),t.events&&t.events.un({addtile:this.addTile,refresh:this.handleLayerRefresh,retile:this.clearTileQueue,scope:this}),t.grid)){var i,r,n;for(i=t.grid.length-1;i>=0;--i)for(r=t.grid[i].length-1;r>=0;--r)n=t.grid[i][r],this.unloadTile({object:n}),n.url&&this.manageTileCache({object:n})}},handleLayerRefresh:function(e){var t=e.object;if(t.grid){var i,r,n;for(i=t.grid.length-1;i>=0;--i)for(r=t.grid[i].length-1;r>=0;--r)n=t.grid[i][r],OpenLayers.Util.removeItem(this.tileCacheIndex,n.url),delete this.tileCache[n.url]}},updateTimeout:function(e,t,i){window.clearTimeout(this.tileQueueId[e.id]);var r=this.tileQueue[e.id];i&&!r.length||(this.tileQueueId[e.id]=window.setTimeout(OpenLayers.Function.bind(function(){this.drawTilesFromQueue(e),r.length&&this.updateTimeout(e,this.frameDelay)},this),t))},addTile:function(e){e.tile instanceof OpenLayers.Tile.Image?e.tile.layer.singleTile||e.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}):this.removeLayer({layer:e.tile.layer})},unloadTile:function(e){var t=e.object;t.events.un({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}),OpenLayers.Util.removeItem(this.tileQueue[t.layer.map.id],t)},queueTileDraw:function(e){var t=e.object,i=!1,r=t.layer,n=r.getURL(t.bounds),s=this.tileCache[n];return s&&"olTileImage"!==s.className&&(delete this.tileCache[n],OpenLayers.Util.removeItem(this.tileCacheIndex,n),s=null),!i},drawTilesFromQueue:function(e){for(var t=this.tileQueue[e.id],i=this.tilesPerFrame,r=e.zoomTween&&e.zoomTween.playing;!r&&t.length&&i;)t.shift().draw(!0),--i},manageTileCache:function(e){var t=e.object,i=this.tileCache[t.url];i&&(i.parentNode&&OpenLayers.Element.hasClass(i.parentNode,"olBackBuffer")&&(i.parentNode.removeChild(i),i.id=null),i.parentNode||(i.style.visibility="hidden",i.style.opacity=0,t.setImage(i),OpenLayers.Util.removeItem(this.tileCacheIndex,t.url),this.tileCacheIndex.push(t.url)))},addToCache:function(e){return},clearTileQueue:function(e){for(var t=e.object,i=this.tileQueue[t.map.id],r=i.length-1;r>=0;--r)i[r].layer===t&&i.splice(r,1)},destroy:function(){for(var e=this.maps.length-1;e>=0;--e)this.removeMap(this.maps[e]);this.maps=null,this.tileQueue=null,this.tileQueueId=null,this.tileCache=null,this.tileCacheIndex=null,this._destroyed=!0}}),OpenLayers.WPSClient=OpenLayers.Class({servers:null,version:"1.0.0",lazy:!1,events:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.events=new OpenLayers.Events(this),this.servers={};for(var t in e.servers)this.servers[t]="string"==typeof e.servers[t]?{url:e.servers[t],version:this.version,processDescription:{}}:e.servers[t]},execute:function(e){var t=this.getProcess(e.server,e.process);t.execute({inputs:e.inputs,success:e.success,scope:e.scope})},getProcess:function(e,t,i){var r=new OpenLayers.WPSProcess({client:this,server:e,identifier:t});return this.lazy||r.describe(i),r},describeProcess:function(e,t,i,r){var n=this.servers[e];n.processDescription[t]?window.setTimeout(function(){i.call(r,n.processDescription[t])},0):t in n.processDescription?this.events.register("describeprocess",this,function s(e){e.identifier===t&&(this.events.unregister("describeprocess",this,s),i.call(r,e.raw))}):(n.processDescription[t]=null,OpenLayers.Request.GET({url:n.url,params:{SERVICE:"WPS",VERSION:n.version,REQUEST:"DescribeProcess",IDENTIFIER:t},success:function(e){n.processDescription[t]=e.responseText,this.events.triggerEvent("describeprocess",{identifier:t,raw:e.responseText}),i.call(r,e.responseText)},scope:this}))},destroy:function(){this.events.destroy(),this.events=null,this.servers=null},CLASS_NAME:"OpenLayers.WPSClient"}),OpenLayers.WPSProcess=OpenLayers.Class({client:null,server:null,identifier:null,description:null,localWPS:"http://geoserver/wps",formats:null,chained:0,executeCallbacks:null,initialize:function(e){OpenLayers.Util.extend(this,e),this.executeCallbacks=[],this.formats={"application/wkt":new OpenLayers.Format.WKT,"application/json":new OpenLayers.Format.GeoJSON}},describe:function(e){if(e=e||{},this.description){if(e.callback){var t=this.description;window.setTimeout(function(){e.callback.call(e.scope,t)},0)}}else this.client.describeProcess(this.server,this.identifier,function(t){this.description||this.parseDescription(t),e.callback&&e.callback.call(e.scope,this.description)},this)},configure:function(e){return this.describe({callback:function(){var t,i,r,n=this.description,s=e.inputs;for(i=0,r=n.dataInputs.length;i<r;++i)t=n.dataInputs[i],this.setInputData(t,s[t.identifier]);e.callback&&e.callback.call(e.scope)},scope:this}),this},execute:function(e){this.configure({inputs:e.inputs,callback:function(){var t=this,i=this.getOutputIndex(t.description.processOutputs,e.output);t.setResponseForm({outputIndex:i}),function r(){return OpenLayers.Util.removeItem(t.executeCallbacks,r),0!==t.chained?void t.executeCallbacks.push(r):void OpenLayers.Request.POST({url:t.client.servers[t.server].url,data:(new OpenLayers.Format.WPSExecute).write(t.description),success:function(r){var n,s=t.description.processOutputs[i];if(s.literalOutput)n="boolean"===s.literalOutput.dataType?"true"===OpenLayers.String.trim(r.responseText).toLowerCase():"double"===s.literalOutput.dataType?parseFloat(r.responseText):r.responseText;else if(s.complexOutput){var o=t.findMimeType(s.complexOutput.supported.formats);n=t.formats[o].read(r.responseText),n instanceof OpenLayers.Feature.Vector&&(n=[n])}if(e.success){var a={};a[e.output||"result"]=n,e.success.call(e.scope,a)}},scope:t})}()},scope:this})},output:function(e){return new OpenLayers.WPSProcess.ChainLink({process:this,output:e})},parseDescription:function(e){var t=this.client.servers[this.server];this.description=(new OpenLayers.Format.WPSDescribeProcess).read(t.processDescription[this.identifier]).processDescriptions[this.identifier]},setInputData:function(e,t){if(delete e.data,delete e.reference,t instanceof OpenLayers.WPSProcess.ChainLink)++this.chained,e.reference={method:"POST",href:t.process.server===this.server?this.localWPS:this.client.servers[t.process.server].url},t.process.describe({callback:function(){--this.chained,this.chainProcess(e,t)},scope:this});else{e.data={};var i=e.complexData;if(i){var r=this.findMimeType(i.supported.formats);e.data.complexData={mimeType:r,value:this.formats[r].write(this.toFeatures(t))}}else e.data.literalData={value:t}}},setResponseForm:function(e){e=e||{};var t,i=this.description.processOutputs[e.outputIndex||0];i.complexOutput&&(t=this.findMimeType(i.complexOutput.supported.formats,e.supportedFormats)),this.description.responseForm={rawDataOutput:{identifier:i.identifier,mimeType:t}}},getOutputIndex:function(e,t){var i;if(t){for(var r=e.length-1;r>=0;--r)if(e[r].identifier===t){i=r;break}}else i=0;return i},chainProcess:function(e,t){var i=this.getOutputIndex(t.process.description.processOutputs,t.output);e.reference.mimeType=this.findMimeType(e.complexData.supported.formats,t.process.description.processOutputs[i].complexOutput.supported.formats);var r={};for(r[e.reference.mimeType]=!0,t.process.setResponseForm({outputIndex:i,supportedFormats:r}),e.reference.body=t.process.description;this.executeCallbacks.length>0;)this.executeCallbacks[0]()},toFeatures:function(e){var t=OpenLayers.Util.isArray(e);t||(e=[e]);for(var i,r=new Array(e.length),n=0,s=e.length;n<s;++n)i=e[n],r[n]=i instanceof OpenLayers.Feature.Vector?i:new OpenLayers.Feature.Vector(i);return t?r:r[0]},findMimeType:function(e,t){t=t||this.formats;for(var i in e)if(i in t)return i},CLASS_NAME:"OpenLayers.WPSProcess"}),OpenLayers.WPSProcess.ChainLink=OpenLayers.Class({process:null,output:null,initialize:function(e){OpenLayers.Util.extend(this,e)},CLASS_NAME:"OpenLayers.WPSProcess.ChainLink"}),OpenLayers.Renderer.SVGExtended=OpenLayers.Class(OpenLayers.Renderer.SVG,{eraseGeometry:function(e,t){return this.removeArrows(e),OpenLayers.Renderer.SVG.prototype.eraseGeometry.apply(this,arguments)},drawFeature:function(e,t){return e.geometry&&this.removeArrows(e.geometry),OpenLayers.Renderer.SVG.prototype.drawFeature.apply(this,arguments)},drawLineString:function(e,t){return this.drawArrows(t,e._style),OpenLayers.Renderer.SVG.prototype.drawLineString.apply(this,arguments)},getNodeType:function(e,t){var i;return i=t.bubble?"svg":OpenLayers.Renderer.SVG.prototype.getNodeType.apply(this,arguments)},setStyle:function(e,t,i){if(OpenLayers.Renderer.SVG.prototype.setStyle.apply(this,arguments),"OpenLayers.Geometry.Point"===e._geometryClass&&t.bubble){var r=(e.id,t.offset);pos=this.getPosition(e),e.setAttributeNS(null,"x",pos.x-(12-.4*r.width)),e.setAttributeNS(null,"y",pos.y-(63-.4*r.height));for(var n=t.color,s=e.childNodes[0],o=s.childNodes[0],a=0,l=o.childNodes.length;a<l;a++)o.childNodes[a].setAttributeNS(null,"fill",n);var p=s.childNodes[1];p.setAttributeNS(null,"fill",n),p.setAttributeNS(null,"fill-opacity","0.5");var h=s.childNodes[2];h.setAttributeNS(null,"fill",n);var u=s.childNodes[3];u.setAttributeNS(null,"stroke",n)}return e},drawPoint:function(e,t){var i=e._style.bubble;return this.MAX_PIXEL=15e3,"svg"===e.nodeName&&i?this.drawBubble(e,t):this.drawCircle(e,t,1)},drawBubble:function(e,t){this.MAX_PIXEL=15e5;var i=this.getResolution(),r=(t.x-this.featureDx)/i+this.left,n=this.top-t.y/i;return this.inValidRange(r,n)&&(e.setAttributeNS(null,"cx",r),e.setAttributeNS(null,"cy",n)),e.firstChild&&e.removeChild(e.firstChild),this.drawBubbleSVG(e,t),e},drawBubbleSVG:function(e,t){e.setAttributeNS(null,"type","bubble");var i=this.nodeFactory(null,"g");i.setAttributeNS(null,"transform","translate(2,19) scale(0.4)");var r=this.nodeFactory(null,"g"),n=this.nodeFactory(null,"circle"),s=this.nodeFactory(null,"circle"),o=this.nodeFactory(null,"circle");n.setAttributeNS(null,"cx","27"),n.setAttributeNS(null,"cy","30"),n.setAttributeNS(null,"r","3"),n.setAttributeNS(null,"stroke-width","0"),n.setAttributeNS(null,"opacity","0"),s.setAttributeNS(null,"cx","27"),s.setAttributeNS(null,"cy","40"),s.setAttributeNS(null,"r","4"),s.setAttributeNS(null,"stroke-width","0"),s.setAttributeNS(null,"opacity","0"),o.setAttributeNS(null,"cx","27"),o.setAttributeNS(null,"cy","50"),o.setAttributeNS(null,"r","6"),o.setAttributeNS(null,"stroke-width","0"),o.setAttributeNS(null,"opacity","0"),r.appendChild(n),r.appendChild(s),r.appendChild(o);var a=this.nodeFactory(null,"path"),l=this.nodeFactory(null,"path");a.setAttributeNS(null,"stroke-width","1"),l.setAttributeNS(null,"stroke-width","1");var p=this.nodeFactory(null,"path");p.setAttributeNS(null,"d","M 0,30.832615 C 0.2258843,41.374652 22.6502155,73.827685 26.8593355,84.067826 32.2195965,72.431012 53.3725445,43.176664 53.5570575,30.832615 c -1.062271,-39.9612311 -55.0572777,-35.5688568 -53.5570575,0 z"),p.setAttributeNS(null,"stroke-width","3"),p.setAttributeNS(null,"fill","none"),i.appendChild(r),i.appendChild(a),i.appendChild(l),i.appendChild(p),e.appendChild(i)}}),OpenLayers.Renderer.CanvasExtended=OpenLayers.Class(OpenLayers.Renderer.Canvas,{eraseGeometry:function(e,t){return this.removeArrows(e),OpenLayers.Renderer.Canvas.prototype.eraseGeometry.apply(this,arguments)},drawFeature:function(e,t){return e.geometry&&this.removeArrows(e.geometry),OpenLayers.Renderer.Canvas.prototype.drawFeature.apply(this,arguments)},drawLineString:function(e,t){return this.drawArrows(e,t),OpenLayers.Renderer.Canvas.prototype.drawLineString.apply(this,arguments)}}),OpenLayers.Renderer.VMLExtended=OpenLayers.Class(OpenLayers.Renderer.VML,{eraseGeometry:function(e,t){return this.removeArrows(e),OpenLayers.Renderer.VML.prototype.eraseGeometry.apply(this,arguments)},drawFeature:function(e,t){return e.geometry&&this.removeArrows(e.geometry),OpenLayers.Renderer.VML.prototype.drawFeature.apply(this,arguments)},drawLineString:function(e,t){return this.drawArrows(t,e._style),OpenLayers.Renderer.VML.prototype.drawLineString.apply(this,arguments)}}),OpenLayers.Renderer.prototype.removeArrows=function(e){var t,i=this.vectorRoot.childNodes,r=[];for(t=0;t<i.length;t++){var n=i[t];n.id.indexOf(e.id+"_arrow")!=-1&&r.push(n)}for(t=0;t<r.length;t++)this.vectorRoot.removeChild(r[t])},OpenLayers.Renderer.prototype.drawReverseArrows=function(e,t,i){var r=e[e.length-2],n=e[e.length-1],s=n;s.id=t.id+"_arrow_"+NPMapLib.LINE_ARROW_TYPE_REVERSE,i=OpenLayers.Util.extend({},i),i.graphicName="arrow",i.pointRadius=4,i.rotation=this.getOrientation(r,n),this.drawGeometry(s,i,s.id)},OpenLayers.Renderer.prototype.drawForwordArrows=function(e,t,i){var r=e[0],n=e[1],s=r;s.id=t.id+"_arrow_"+NPMapLib.LINE_ARROW_TYPE_FORWORD,i=OpenLayers.Util.extend({},i),i.graphicName="arrow",i.pointRadius=4,i.rotation=this.getOrientation(r,n)+180,i.rotation>=360&&(i.rotation=i.rotation-360),this.drawGeometry(s,i,s.id)},OpenLayers.Renderer.prototype.drawArrows=function(e,t){if(0!=t.arrowStyle){var i=e.components;switch(t.arrowStyle){case NPMapLib.LINE_ARROW_TYPE_REVERSE:this.drawReverseArrows(i,e,t);break;case NPMapLib.LINE_ARROW_TYPE_FORWORD:this.drawForwordArrows(i,e,t);break;case NPMapLib.LINE_ARROW_TYPE_BOTH:this.drawReverseArrows(i,e,t),this.drawForwordArrows(i,e,t)}}},OpenLayers.Renderer.prototype.getOrientation=function(e,t){if(!t||!e)return 0;var i=t.x-e.x,r=t.y-e.y,n=Math.acos(r/Math.sqrt(i*i+r*r)),s=i>0?1:-1;return Math.round(s*n*180/Math.PI)},OpenLayers.Renderer.symbol.arrow=[0,2,1,0,2,2,1,0,0,2],OpenLayers.Geometry.GeoLinePlotting=OpenLayers.Class(OpenLayers.Geometry.LineString,{plotingExtend:!0,_controlPoints:[],initialize:function(e){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments),this._controlPoints=e,e&&e.length>0&&this.calculateParts()},getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,i=this.components.length;t<i;t++)e-=Math.abs(this.components[t].getArea())}return e},getControlPoints:function(){return this._controlPoints},setControlPoint:function(e){e&&e.length&&e.length>0&&(this._controlPoints=e,this.calculateParts())},clone:function(){for(var e=new OpenLayers.Geometry.GeoLinePlotting,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},toJSON:function(e){if(!this._controlPoints)return null;for(var t=this._controlPoints.length,i=[],r=0;r<t;r++)i.push(this.controlPointToJSON(this._controlPoints[r],e));return'{"controlPoints":['+i.join(",")+'],"CLASS_NAME":"'+this.CLASS_NAME+'"}'},calculateParts:function(){},calculateMidpoint:function(e,t){var i=new OpenLayers.Geometry.Point((e.x+t.x)/2,(e.y+t.y)/2);return i},calculateDistance:function(e,t){var i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));return i},toVector:function(e,t){return new OpenLayers.Geometry.Point(e.x-t.x,e.y-t.y)},calculateVector:function(e,t,i){t||(t=Math.PI/2),i||(i=1);var r,n,s,o,a,l,p=Math.sqrt(e.x*e.x+e.y*e.y);if(0==e.y)r=n=p*i*Math.cos(t)/e.x,e.x>0?(s=Math.sqrt(i*i-r*r),o=-s):e.x<0&&(o=Math.sqrt(i*i-r*r),s=-o),a=new OpenLayers.Geometry.Point(r,s),l=new OpenLayers.Geometry.Point(n,o);else{var h=-e.x/e.y,u=i*p*Math.cos(t)/e.y,t=1+h*h,y=2*h*u,c=u*u-i*i;r=(-y-Math.sqrt(y*y-4*t*c))/(2*t),n=(-y+Math.sqrt(y*y-4*t*c))/(2*t),s=h*r+u,o=h*n+u,e.y>=0?(a=new OpenLayers.Geometry.Point(r,s),
l=new OpenLayers.Geometry.Point(n,o)):e.y<0&&(a=new OpenLayers.Geometry.Point(n,o),l=new OpenLayers.Geometry.Point(r,s))}return[a,l]},calculateIntersection:function(e,t,i,r){var n,s;return e.y*t.x-e.x*t.y==0?e.x*t.x>0||e.y*t.y>0?(n=(i.x+r.x)/2,s=(i.y+r.y)/2):(n=r.x,s=r.y):(n=(e.x*t.x*(r.y-i.y)+i.x*e.y*t.x-r.x*t.y*e.x)/(e.y*t.x-e.x*t.y),s=0!=e.x?(n-i.x)*e.y/e.x+i.y:(n-r.x)*t.y/t.x+r.y),new OpenLayers.Geometry.Point(n,s)},calculateAngularBisector:function(e,t){var i=Math.sqrt(e.x*e.x+e.y*e.y),r=Math.sqrt(t.x*t.x+t.y*t.y);return new OpenLayers.Geometry.Point(e.x/i+t.x/r,e.y/i+t.y/r)},calculateIntersectionFromTwoCorner:function(e,t,i,r){i||(i=Math.PI/4),r||(r=Math.PI/4);var n=new OpenLayers.Geometry.Point(t.x-e.x,t.y-e.y),s=this.calculateVector(n,i,1),o=s[0],a=s[1],l=this.calculateVector(n,Math.PI-i,1),p=l[0],h=l[1],u=this.calculateIntersection(o,p,e,t),y=this.calculateIntersection(a,h,e,t);return[u,y]},cloneControlPoints:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].clone());return t},controlPointToJSON:function(e,t){return t&&(e=NPMap.T.getPoint(t,{lon:e.x,lat:e.y}),e={x:e.lon,y:e.lat}),'{"x":  '+e.x+', "y": '+e.y+',"CLASS_NAME":"'+this.CLASS_NAME+'"}'},CLASS_NAME:"OpenLayers.Geometry.GeoLinePlotting"}),OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON=function(str,map){for(var cps=[],r=/{.*?}/g,arr=str.match(r),i=0,len=arr.length;i<len;i++){var point=eval("("+arr[i]+")");map&&(point=NPMap.T.setPoint(map,{lon:point.x,lat:point.y}),point={x:point.lon,y:point.lat}),cps.push(new OpenLayers.Geometry.Point(point.x,point.y))}return cps},OpenLayers.Geometry.GeoMultiLinePlotting=OpenLayers.Class(OpenLayers.Geometry.MultiLineString,{plotingExtend:!0,_controlPoints:[],isMultiPlotting:!0,initialize:function(e){OpenLayers.Geometry.MultiLineString.prototype.initialize.apply(this,arguments),this._controlPoints=e,e&&e.length>0&&this.calculateParts()},getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,i=this.components.length;t<i;t++)e-=Math.abs(this.components[t].getArea())}return e},getControlPoints:function(){return this._controlPoints},setControlPoint:function(e){e&&e.length&&e.length>0&&(this._controlPoints=e,this.calculateParts())},clone:function(){for(var e=new OpenLayers.Geometry.GeoMultiLinePlotting,t=[],i=[],r=0,n=this._controlPoints.length;r<n;r++)t.push(this._controlPoints[r].clone());e._controlPoints=t;for(var s=0;s<this.components.length;s++)i.push(this.components[s].clone());return e.components=i,e},toJSON:function(e){if(!this._controlPoints)return null;for(var t=this._controlPoints.length,i=[],r=0;r<t;r++)i.push(this.controlPointToJSON(this._controlPoints[r],e));return'{"controlPoints":['+i.join(",")+'],"CLASS_NAME":"'+this.CLASS_NAME+'"}'},calculateParts:function(){},calculateMidpoint:function(e,t){var i=new OpenLayers.Geometry.Point((e.x+t.x)/2,(e.y+t.y)/2);return i},calculateArrowLines:function(e,t,i,r){var n=[];i||(i=10),r||(r=Math.PI/6);var s=this.calculateDistance(e,t),o=this.toVector(e,t),a=this.calculateVector(o,r,s/i),l=new OpenLayers.Geometry.Point(a[0].x+t.x,a[0].y+t.y),p=new OpenLayers.Geometry.Point(a[1].x+t.x,a[1].y+t.y);return n.push(new OpenLayers.Geometry.LineString([t,l])),n.push(new OpenLayers.Geometry.LineString([t,p])),n},calculateDistance:function(e,t){var i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));return i},toVector:function(e,t){return new OpenLayers.Geometry.Point(e.x-t.x,e.y-t.y)},calculateVector:function(e,t,i){t||(t=Math.PI/2),i||(i=1);var r,n,s,o,a,l,p=Math.sqrt(e.x*e.x+e.y*e.y);if(0==e.y)r=n=p*i*Math.cos(t)/e.x,e.x>0?(s=Math.sqrt(i*i-r*r),o=-s):e.x<0&&(o=Math.sqrt(i*i-r*r),s=-o),a=new OpenLayers.Geometry.Point(r,s),l=new OpenLayers.Geometry.Point(n,o);else{var h=-e.x/e.y,u=i*p*Math.cos(t)/e.y,t=1+h*h,y=2*h*u,c=u*u-i*i;r=(-y-Math.sqrt(y*y-4*t*c))/(2*t),n=(-y+Math.sqrt(y*y-4*t*c))/(2*t),s=h*r+u,o=h*n+u,e.y>=0?(a=new OpenLayers.Geometry.Point(r,s),l=new OpenLayers.Geometry.Point(n,o)):e.y<0&&(a=new OpenLayers.Geometry.Point(n,o),l=new OpenLayers.Geometry.Point(r,s))}return[a,l]},calculateIntersection:function(e,t,i,r){var n,s;return e.y*t.x-e.x*t.y==0?e.x*t.x>0||e.y*t.y>0?(n=(i.x+r.x)/2,s=(i.y+r.y)/2):(n=r.x,s=r.y):(n=(e.x*t.x*(r.y-i.y)+i.x*e.y*t.x-r.x*t.y*e.x)/(e.y*t.x-e.x*t.y),s=0!=e.x?(n-i.x)*e.y/e.x+i.y:(n-r.x)*t.y/t.x+r.y),new OpenLayers.Geometry.Point(n,s)},calculateAngularBisector:function(e,t){var i=Math.sqrt(e.x*e.x+e.y*e.y),r=Math.sqrt(t.x*t.x+t.y*t.y);return new OpenLayers.Geometry.Point(e.x/i+t.x/r,e.y/i+t.y/r)},calculateIntersectionFromTwoCorner:function(e,t,i,r){i||(i=Math.PI/4),r||(r=Math.PI/4);var n=new OpenLayers.Geometry.Point(t.x-e.x,t.y-e.y),s=this.calculateVector(n,i,1),o=s[0],a=s[1],l=this.calculateVector(n,Math.PI-i,1),p=l[0],h=l[1],u=this.calculateIntersection(o,p,e,t),y=this.calculateIntersection(a,h,e,t);return[u,y]},cloneControlPoints:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].clone());return t},controlPointToJSON:function(e,t){return t&&(e=NPMap.T.getPoint(t,{lon:e.x,lat:e.y}),e={x:e.lon,y:e.lat}),'{"x":  '+e.x+', "y": '+e.y+"}"},CLASS_NAME:"OpenLayers.Geometry.GeoMultiLinePlotting"}),OpenLayers.Geometry.GeoMultiLinePlotting.getControlPointsFromJSON=function(str,map){for(var cps=[],r=/{.*?}/g,arr=str.match(r),i=0,len=arr.length;i<len;i++){var point=eval("("+arr[i]+")");map&&(point=NPMap.T.setPoint(map,{lon:point.x,lat:point.y}),point={x:point.lon,y:point.lat}),cps.push(new OpenLayers.Geometry.Point(point.x,point.y))}return cps},OpenLayers.Geometry.GeoPlotting=OpenLayers.Class(OpenLayers.Geometry.Polygon,{plotingExtend:!0,_controlPoints:[],initialize:function(e){OpenLayers.Geometry.Polygon.prototype.initialize.apply(this,arguments),this._controlPoints=e,e&&e.length>0&&this.calculateParts()},getControlPoints:function(){return this._controlPoints},setControlPoint:function(e){e&&e.length&&e.length>0&&(this._controlPoints=e,this.calculateParts())},clone:function(){for(var e=new OpenLayers.Geometry.GeoPlotting,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},toJSON:function(e){if(!this._controlPoints)return null;for(var t=this._controlPoints.length,i=[],r=0;r<t;r++)i.push(this.controlPointToJSON(this._controlPoints[r],e));return'{"controlPoints":['+i.join(",")+'],"CLASS_NAME":"'+this.CLASS_NAME+'"}'},calculateMidpoint:function(e,t){var i=new OpenLayers.Geometry.Point((e.x+t.x)/2,(e.y+t.y)/2);return i},calculateParts:function(){},calculateVector:function(e,t,i){t||(t=Math.PI/2),i||(i=1);var r,n,s,o,a,l,p=Math.sqrt(e.x*e.x+e.y*e.y);if(0==e.y)r=n=p*i*Math.cos(t)/e.x,e.x>0?(s=Math.sqrt(i*i-r*r),o=-s):e.x<0&&(o=Math.sqrt(i*i-r*r),s=-o),a=new OpenLayers.Geometry.Point(r,s),l=new OpenLayers.Geometry.Point(n,o);else{var h=-e.x/e.y,u=i*p*Math.cos(t)/e.y,t=1+h*h,y=2*h*u,c=u*u-i*i;r=(-y-Math.sqrt(y*y-4*t*c))/(2*t),n=(-y+Math.sqrt(y*y-4*t*c))/(2*t),s=h*r+u,o=h*n+u,e.y>=0?(a=new OpenLayers.Geometry.Point(r,s),l=new OpenLayers.Geometry.Point(n,o)):e.y<0&&(a=new OpenLayers.Geometry.Point(n,o),l=new OpenLayers.Geometry.Point(r,s))}return[a,l]},calculateIntersection:function(e,t,i,r){var n,s;return e.y*t.x-e.x*t.y==0?e.x*t.x>0||e.y*t.y>0?(n=(i.x+r.x)/2,s=(i.y+r.y)/2):(n=r.x,s=r.y):(n=(e.x*t.x*(r.y-i.y)+i.x*e.y*t.x-r.x*t.y*e.x)/(e.y*t.x-e.x*t.y),s=0!=e.x?(n-i.x)*e.y/e.x+i.y:(n-r.x)*t.y/t.x+r.y),new OpenLayers.Geometry.Point(n,s)},calculateAngularBisector:function(e,t){var i=Math.sqrt(e.x*e.x+e.y*e.y),r=Math.sqrt(t.x*t.x+t.y*t.y);return new OpenLayers.Geometry.Point(e.x/i+t.x/r,e.y/i+t.y/r)},calculateIntersectionFromTwoCorner:function(e,t,i,r){i||(i=Math.PI/4),r||(r=Math.PI/4);var n=new OpenLayers.Geometry.Point(t.x-e.x,t.y-e.y),s=this.calculateVector(n,i,1),o=s[0],a=s[1],l=this.calculateVector(n,Math.PI-i,1),p=l[0],h=l[1],u=this.calculateIntersection(o,p,e,t),y=this.calculateIntersection(a,h,e,t);return[u,y]},calculateDistance:function(e,t){var i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));return i},calculateArc:function(e,t,i,r,n,s){(!n||1!=n&&n!=-1)&&(n=-1),s||(s=360);for(var o=Math.PI/s/2,a=o*n,l=Math.abs(r-i),p=[],h=i,u=0;u<l;u+=o){var y=new OpenLayers.Geometry.Point(Math.cos(h)*t+e.x,Math.sin(h)*t+e.y);p.push(y),h+=a,h=h<0?h+2*Math.PI:h,h=h>2*Math.PI?h-2*Math.PI:h}return p},cloneControlPoints:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].clone());return t},controlPointToJSON:function(e,t){return t&&(e=NPMap.T.getPoint(t,{lon:e.x,lat:e.y}),e={x:e.lon,y:e.lat}),'{"x":  '+e.x+', "y": '+e.y+"}"},CLASS_NAME:"OpenLayers.Geometry.GeoPlotting"}),OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON=function(str,map){for(var cps=[],r=/{.*?}/g,arr=str.match(r),i=0,len=arr.length;i<len;i++){var point=eval("("+arr[i]+")");map&&(point=NPMap.T.setPoint(map,{lon:point.x,lat:point.y}),point={x:point.lon,y:point.lat}),cps.push(new OpenLayers.Geometry.Point(point.x,point.y))}return cps},OpenLayers.Handler.Plotting=OpenLayers.Class(OpenLayers.Handler,{controlPoints:[],plotting:null,isDrawing:!1,layerOptions:null,pixelTolerance:5,point:null,layer:null,multi:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,touch:!1,lastTouchPx:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||this.style||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;this.controlPoints=[],this.plotting=null,this.isDrawing=!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e),this.map.addLayer(this.layer),OpenLayers.Element.addClass(this.map.viewPortDiv,"smDefault"),!0},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.controlPoints=[],this.plotting=null,this.isDrawing=!1,this.cancel(),null!=this.layer.map&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"smDefault"),this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,this.touch=!1,!0)},createFeature:function(e){},modifyFeature:function(e){if(this.lastUp&&this.lastUp.equals(e))return!0;this.point&&this.plotting||this.createFeature(e);var t=this.layer.getLonLatFromViewPortPx(e);if(this.point.geometry.x=t.lon,this.point.geometry.y=t.lat,1==this.isDrawing){var i=new OpenLayers.Geometry.Point(t.lon,t.lat),r=this.controlPoints.concat([i]);this.plotting.geometry._controlPoints=this.cloneControlPoints(r),this.plotting.geometry.calculateParts(),this.plotting.geometry.calculateBounds()}this.callback("modify",[this.point.geometry,this.getSketch(),!1]),this.point.geometry.clearBounds(),this.drawFeature()},up:function(e){},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(e){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy),!0},click:function(e){return OpenLayers.Event.stop(e),!1},dblclick:function(e){return OpenLayers.Event.stop(e),!1},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>1&&this.layer.features[0].destroy()},addControlPoint:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.controlPoints.push(i)},drawFeature:function(){this.layer.renderer.clear(),this.layer.drawFeature(this.plotting,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.plotting},destroyFeature:function(e){!this.layer||!e&&this.persist||this.layer.destroyFeatures(),this.point=null,this.plotting=null},finalize:function(e){var t=e?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(t,[this.geometryClone()]),this.destroyFeature(e)},cancel:function(){this.finalize(!0)},getGeometry:function(){if(this.plotting&&this.plotting.geometry)return this.plotting.geometry},geometryClone:function(){var e=this.getGeometry();if(e&&e._controlPoints){var t=e.clone();return t.calculateParts(),t}},mousedown:function(e){return this.down(e)},touchstart:function(e){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){return this.lastTouchPx=e.xy,this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){return e.xy=this.lastTouchPx,this.up(e)},mouseout:function(e){OpenLayers.Util.mouseLeft(e,this.map.eventsDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(e,t,i){var r=!0;if(null!=i&&e&&t){var n=e.distanceTo(t);n>i&&(r=!1)}return r},cloneControlPoints:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].clone());return t},drawComplete:function(){this.finalize(),this.isDrawing=!1,this.controlPoints=[],1==this.active&&this.layer.removeAllFeatures()},CLASS_NAME:"OpenLayers.Handler.Plotting"}),OpenLayers.Control.PlottingEdit=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforefeaturemodified","featuremodified","afterfeaturemodified"],clickout:!0,controlPointsStyle:null,defaultStyle:{fillColor:"#ee9900",fillOpacity:.4,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,pointRadius:6},controlPoints:[],layer:null,feature:null,selectControl:null,dragControl:null,modified:!1,initialize:function(e,t){t=t||{},this.layer=e,this.controlPoints=[],OpenLayers.Control.prototype.initialize.apply(this,[t]);var i=this,r={clickout:this.clickout,toggle:!1,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};this.selectControl=new OpenLayers.Control.SelectFeature(e,r);var n={onStart:function(e,t){i.dragStart.apply(i,[e,t])},onDrag:function(e,t){i.dragControlPoint.apply(i,[e,t])},onComplete:function(e){i.dragComplete.apply(i,[e])},featureCallbacks:{over:function(e){i.dragControl.overFeature.apply(i.dragControl,[e])}}};this.dragControl=new OpenLayers.Control.DragFeature(e,n)},destroy:function(){this.controlPoints=[],this.layer=null,this.selectControl.destroy(),this.dragControl.destroy(),OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.selectControl.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var e=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.controlPoints,{silent:!0}),this.controlPoints=[],this.dragControl.deactivate();var t=this.feature,i=t&&t.geometry&&t.layer;i&&this.selectControl.unselect.apply(this.selectControl,[t]),this.selectControl.deactivate(),e=!0}return e},isPlottingGeometry:function(e){return e.geometry instanceof OpenLayers.Geometry.GeoPlotting||e.geometry instanceof OpenLayers.Geometry.GeoLinePlotting||e.geometry instanceof OpenLayers.Geometry.GeoMultiLinePlotting||e.geometry instanceof OpenLayers.Geometry.GeoMultiPoint||e.geometry instanceof OpenLayers.Geometry.GeoPoint},deleteSymbol:function(){return!!(this.feature&&this.controlPoints&&this.controlPoints.length>0)&&(this.layer.destroyFeatures(this.feature),this.layer.destroyFeatures(this.controlPoints),this.unselectFeature(this.feature),!0)},selectFeature:function(e){this.beforeSelectFeature(e)!==!1&&this.isPlottingGeometry(e)&&(this.feature=e,this.modified=!1,this.resetControlPoints(),this.dragControl.activate())},unselectFeature:function(e){this.layer.removeFeatures(this.controlPoints,{silent:!0}),this.controlPoints=[],this.feature=null,this.dragControl.deactivate(),this.layer.events.triggerEvent("afterfeaturemodified",{feature:e,modified:this.modified}),this.modified=!1},beforeSelectFeature:function(e){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:e})},dragStart:function(e,t){e!=this.feature&&this.isPlottingGeometry(e)&&this.isPlottingGeometry(this.feature)&&(this.feature&&this.selectControl.clickFeature.apply(this.selectControl,[this.feature]),this.selectControl.clickFeature.apply(this.selectControl,[e]),this.dragControl.overFeature.apply(this.dragControl,[e]),this.dragControl.lastPixel=t,this.dragControl.handlers.drag.started=!0,this.dragControl.handlers.drag.start=t,this.dragControl.handlers.drag.last=t),this._dragPixel=t,OpenLayers.Element.removeClass(this.map.viewPortDiv,"smDragDown"),this.map.viewPortDiv.style.cursor="pointer"},dragControlPoint:function(e,t){if("OpenLayers.Geometry.Point"==e.geometry.CLASS_NAME){this.modified=!0;var i=this.feature.geometry;if(i.isMultiPlotting){for(var r=[],n=0;n<i.components.length;n++)r.push(i.components[n].id);i._controlPoints=this.getCpGeos(),i.calculateParts();for(var n=0;n<i.components.length;n++)i.components[n].id=r[n];this.layer.drawFeature(this.feature),this.layer.drawFeature(e)}else i._controlPoints=this.getCpGeos(),i.calculateParts(),this.layer.drawFeature(this.feature),this.layer.drawFeature(e)}else if(this.isPlottingGeometry(e)){this.modified=!0,this.layer.removeFeatures(this.controlPoints,{silent:!0});for(var s=this.layer.getLonLatFromViewPortPx(t),o=this.layer.getLonLatFromViewPortPx(this._dragPixel),a=this.getCpGeos(),n=0,l=a.length;n<l;n++){var e=a[n];e.x+=s.lon-o.lon,e.y+=s.lat-o.lat}var i=this.feature.geometry;i._controlPoints=a,i.isMultiPlotting&&i.calculateParts(),this._dragPixel=t}},dragComplete:function(){delete this._dragPixel,this.resetControlPoints(),this.setFeatureState(),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE)},resetControlPoints:function(){this.controlPoints.length>0&&(this.layer.removeFeatures(this.controlPoints,{silent:!0}),this.controlPoints=[]),this.collectControlPoints()},collectControlPoints:function(){function e(e){var i,r,n;if(e instanceof OpenLayers.Geometry.GeoPlotting||e instanceof OpenLayers.Geometry.GeoLinePlotting||e instanceof OpenLayers.Geometry.GeoPoint||e instanceof OpenLayers.Geometry.GeoMultiPoint||e instanceof OpenLayers.Geometry.GeoMultiLinePlotting){var s=e._controlPoints.length;for(i=0;i<s;++i)n=e._controlPoints[i],"OpenLayers.Geometry.Point"==n.CLASS_NAME&&(r=new OpenLayers.Feature.Vector(n),r._sketch=!0,r.style=OpenLayers.Util.copyAttributes(r.style,t.defaultStyle),t.controlPointsStyle&&(r.style=OpenLayers.Util.copyAttributes(r.style,t.controlPointsStyle)),t.controlPoints.push(r))}}if(this.feature&&this.feature.geometry){this.controlPoints=[];var t=this;e.call(this,this.feature.geometry),this.layer.addFeatures(this.controlPoints,{silent:!0})}},setMap:function(e){this.selectControl.setMap(e),this.dragControl.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},getCpGeos:function(){for(var e=this.controlPoints,t=[],i=0;i<e.length;i++)t.push(e[i].geometry);return t},cloneControlPoints:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].clone());return t},controlPointstoJSON:function(e){if(this.feature&&this.feature.geometry&&this.isPlottingGeometry(this.feature))return this.feature.geometry.toJSON()},CLASS_NAME:"OpenLayers.Control.PlottingEdit"}),OpenLayers.Geometry.GeoPoint=OpenLayers.Class(OpenLayers.Geometry.Point,{_controlPoints:[],initialize:function(e){OpenLayers.Geometry.Point.prototype.initialize.apply(this,arguments),e&&e instanceof OpenLayers.Geometry.Point&&(this._controlPoints.push(e),this.calculateParts())},setControlPoint:function(e){e&&e instanceof OpenLayers.Geometry.Point&&(this._controlPoints=[e],this.calculateParts())},getControlPoint:function(){return this._controlPoints[0]},toJSON:function(e){if(!this._controlPoints)return null;var t=this._controlPoints[0];return'{"controlPoints":[{"x":  '+t.x+', "y": '+t.y+"}]}"},clone:function(){var e=new OpenLayers.Geometry.GeoPoint,t=[];return t.push(this._controlPoints[0].clone()),e._controlPoints=t,e},calculateParts:function(){if(this._controlPoints.length>0){var e=this._controlPoints[0].clone();this.x=e.x,this.y=e.y}},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.GeoPoint.fromJSON=function(str,map){var GeoPoint=new OpenLayers.Geometry.GeoPoint,s=str.match(/"controlPoints":(\[.*?\])/)[1],r=/{.*?}/g,arr=s.match(r),point=eval("("+arr[0]+")"),cps=[new OpenLayers.Geometry.Point(point.x,point.y)];return GeoPoint._controlPoints=cps,GeoPoint},OpenLayers.Geometry.GeoMultiPoint=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{_controlPoints:[],isMultiPlotting:!0,initialize:function(e){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments),this._controlPoints=e,e&&e.length>0&&this.calculateParts()},toJSON:function(e){if(!this._controlPoints)return null;for(var t=this._controlPoints.length,i=[],r=0;r<t;r++)i.push(this.controlPointToJSON(this._controlPoints[r],e));return'{"controlPoints":['+i.join(",")+"]}"},controlPointToJSON:function(e,t){return t&&(e=NPMap.T.getPoint(t,{lon:e.x,lat:e.y}),e={x:e.lon,y:e.lat}),'{"x":  '+e.x+', "y": '+e.y+"}"},getControlPoints:function(){return this._controlPoints},setControlPoint:function(e){e&&e.length&&e.length>0&&(this._controlPoints=e,this.calculateParts())},clone:function(){for(var e=new OpenLayers.Geometry.GeoMultiPoint,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);this.components=[],this._controlPoints.length>0&&(this.components=e)},cloneControlPoints:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].clone());return t},CLASS_NAME:"OpenLayers.Geometry.GeoMultiPoint"}),OpenLayers.Geometry.GeoMultiPoint.getControlPointsFromJSON=function(str,map){for(var cps=[],r=/{.*?}/g,arr=str.match(r),i=0,len=arr.length;i<len;i++){var point=eval("("+arr[i]+")");map&&(point=NPMap.T.setPoint(map,{lon:point.x,lat:point.y}),point={x:point.lon,y:point.lat}),cps.push(new OpenLayers.Geometry.Point(point.x,point.y))}return cps},OpenLayers.Geometry.GeoMultiPoint.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoMultiPoint,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.MultiPoint.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoArc=OpenLayers.Class(OpenLayers.Geometry.GeoLinePlotting,{sides:720,initialize:function(e){OpenLayers.Geometry.GeoLinePlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoLinePlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoArc,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);if(this.components=[],this._controlPoints.length<3&&(this.components=e),this._controlPoints.length>2){var t=e[0],i=e[1],r=e[2],n=this.calculateMidpoint(t,i),s=this.calculateMidpoint(i,r),o=new OpenLayers.Geometry.Point(i.x-t.x,i.y-t.y),a=new OpenLayers.Geometry.Point(r.x-i.x,r.y-i.y);if(Math.abs(o.x*a.y-a.x*o.y)<1e-5)return void this.components.push(t,r,i);var l,p,h=this.calculateVector(o)[1],u=this.calculateVector(a)[1],y=this.calculateIntersection(h,u,n,s),c=this.calculateDistance(y,t),d=this.calculateAngle(t,y),m=this.calculateAngle(i,y),f=this.calculateAngle(r,y),g=Math.PI,L=1,v=d,O=m;d>m?(v=m,O=d,l=i,p=t):(l=t,p=i);var P=O-v;(f<m&&f<d||f>m&&f>d)&&(L=-1,P=v+(2*g-O));var b=g/this.sides/2,w=b*L;this.components.push(l);for(var M=v,_=0;_<P-b;_+=b){M+=w,M=M<0?M+2*g:M,M=M>2*g?M-2*g:M;var x=new OpenLayers.Geometry.Point(Math.cos(M)*c+y.x,Math.sin(M)*c+y.y);this.components.push(x)}this.components.push(p)}},calculateAngle:function(e,t){var i=Math.atan2(e.y-t.y,e.x-t.x);return i<0&&(i+=2*Math.PI),i},CLASS_NAME:"OpenLayers.Geometry.GeoArc"}),OpenLayers.Geometry.GeoArc.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoArc,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoBezierCurve2=OpenLayers.Class(OpenLayers.Geometry.GeoLinePlotting,{part:50,initialize:function(e){OpenLayers.Geometry.GeoLinePlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoLinePlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoBezierCurve2,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);this.components=[],2==e.length?this.components=e:e.length>2&&(this.components=OpenLayers.Geometry.LineString.calculatePointsFBZ2(e,this.part))},CLASS_NAME:"OpenLayers.Geometry.GeoBezierCurve2"}),OpenLayers.Geometry.GeoBezierCurve2.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoBezierCurve2,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoBezierCurve3=OpenLayers.Class(OpenLayers.Geometry.GeoLinePlotting,{part:50,initialize:function(e){OpenLayers.Geometry.GeoLinePlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoLinePlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoBezierCurve3,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);this.components=[],e.length<4?this.components=e:e.length>3&&(this.components=OpenLayers.Geometry.LineString.calculatePointsFBZ3(e,this.part))},CLASS_NAME:"OpenLayers.Geometry.GeoBezierCurve3"}),OpenLayers.Geometry.GeoBezierCurve3.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoBezierCurve3,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoBezierCurveN=OpenLayers.Class(OpenLayers.Geometry.GeoLinePlotting,{part:null,initialize:function(e){OpenLayers.Geometry.GeoLinePlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoLinePlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoBezierCurveN,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);this.components=[],e.length<4?this.components=e:e.length>3&&(this.part||(this.part=10*e.length),this.components=OpenLayers.Geometry.LineString.calculatePointsFBZN(e,this.part))},CLASS_NAME:"OpenLayers.Geometry.GeoBezierCurveN"}),OpenLayers.Geometry.GeoBezierCurveN.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoBezierCurveN,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoCardinalCurve=OpenLayers.Class(OpenLayers.Geometry.GeoLinePlotting,{part:null,initialize:function(e){OpenLayers.Geometry.GeoLinePlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoLinePlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoCardinalCurve,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);if(this.components=[],e.length<3)this.components=e;else if(e.length>2){var t=OpenLayers.Geometry.LineString.calculateCardinalPoints(e);this.part||(this.part=10*t.length);var i=OpenLayers.Geometry.LineString.calculatePointsFBZ3(t,this.part);this.components=i}},CLASS_NAME:"OpenLayers.Geometry.GeoCardinalCurve"}),OpenLayers.Geometry.GeoCardinalCurve.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoCardinalCurve,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoFreeline=OpenLayers.Class(OpenLayers.Geometry.GeoLinePlotting,{initialize:function(e){OpenLayers.Geometry.GeoLinePlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoLinePlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoFreeline,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);this.components=[],e.length>1&&(this.components=e)},CLASS_NAME:"OpenLayers.Geometry.GeoFreeline"}),OpenLayers.Geometry.GeoFreeline.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoFreeline,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoPolyline=OpenLayers.Class(OpenLayers.Geometry.GeoLinePlotting,{initialize:function(e){OpenLayers.Geometry.GeoLinePlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoLinePlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoPolyline,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);this.components=[],e.length>1&&(this.components=e)},CLASS_NAME:"OpenLayers.Geometry.GeoPolyline"}),OpenLayers.Geometry.GeoPolyline.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoPolyline,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoCircle=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoCircle,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){if(this.components=[],this._controlPoints.length>1){for(var e=this._controlPoints[0],t=this._controlPoints[this._controlPoints.length-1],i=[],r=Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)),n=0;n<360;n++){var s=(n+1)*Math.PI/180,o=new OpenLayers.Geometry.Point(Math.cos(s)*r+e.x,Math.sin(s)*r+e.y);i[n]=o}this.components.push(new OpenLayers.Geometry.LinearRing(i))}},CLASS_NAME:"OpenLayers.Geometry.GeoCircle"}),OpenLayers.Geometry.GeoCircle.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoCircle,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoCloseCurve=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoCloseCurve,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);if(this.components=[],2==e.length&&this.components.push(new OpenLayers.Geometry.LineString(e)),e.length>2){var t=OpenLayers.Geometry.LineString.createCloseCardinal(e);this.components.push(OpenLayers.Geometry.LineString.createBezier3(t,100))}},CLASS_NAME:"OpenLayers.Geometry.GeoCloseCurve"}),OpenLayers.Geometry.GeoCloseCurve.fromJSON=function(e,t){
var i=new OpenLayers.Geometry.GeoCloseCurve,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoEllipse=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{sides:360,initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoEllipse,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){if(this.components=[],this._controlPoints.length>1){var e,t,i,r,n=this._controlPoints[0],s=this._controlPoints[this._controlPoints.length-1],o=[],a=Math.sqrt(2)*Math.abs(s.y-n.y)/2,l=Math.PI*(1/this.sides-.5),p=s.x-n.x,h=s.y-n.y;r=0==h?p/(a*Math.sqrt(2)):p/h;for(var u=0;u<this.sides;++u)e=l+2*u*Math.PI/this.sides,t=n.x+r*(a*Math.cos(e))+p/2,i=n.y+a*Math.sin(e)+h/2,o[u]=new OpenLayers.Geometry.Point(t,i);this.components.push(new OpenLayers.Geometry.LinearRing(o))}},CLASS_NAME:"OpenLayers.Geometry.GeoEllipse"}),OpenLayers.Geometry.GeoEllipse.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoEllipse,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoFreePolygon=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoFreePolygon,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);this.components=[],e.length>1&&this.components.push(new OpenLayers.Geometry.LinearRing(e))},CLASS_NAME:"OpenLayers.Geometry.GeoFreePolygon"}),OpenLayers.Geometry.GeoFreePolygon.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoFreePolygon,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoGatheringPlace=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoGatheringPlace,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){if(this.components=[],this._controlPoints.length>1){var e=this._controlPoints[0],t=this._controlPoints[this._controlPoints.length-1],i=[],r=new OpenLayers.Geometry.Point(t.x-e.x,t.y-e.y),n=Math.sqrt(r.x*r.x+r.y*r.y),s=this.calculateVector(r,Math.PI/3,Math.sqrt(3)/12*n),o=s[0],a=new OpenLayers.Geometry.Point(o.x+e.x,o.y+e.y),l=new OpenLayers.Geometry.Point((e.x+t.x)/2,(e.y+t.y)/2),p=this.calculateVector(r,2*Math.PI/3,Math.sqrt(3)/12*n),h=p[0],u=new OpenLayers.Geometry.Point(h.x+t.x,h.y+t.y),y=this.calculateVector(r,Math.PI/2,.5*n),c=y[1],d=new OpenLayers.Geometry.Point(c.x+l.x,c.y+l.y),m=e.clone(),f=t.clone();i.push(m,a,l,u,f,d);var g=OpenLayers.Geometry.LineString.createCloseCardinal(i);this.components.push(OpenLayers.Geometry.LineString.createBezier3(g,100))}},CLASS_NAME:"OpenLayers.Geometry.GeoGatheringPlace"}),OpenLayers.Geometry.GeoGatheringPlace.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoGatheringPlace,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoLune=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{sides:720,initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoLune,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);if(this.components=[],2==e.length){var t=e[0],i=e[1],r=this.calculateMidpoint(t,i),n=this.calculateDistance(t,i)/2,s=this.calculateAngle(t,r),o=this.calculateArc(r,n,s,s+Math.PI,-1);this.components.push(new OpenLayers.Geometry.LinearRing(o))}if(this._controlPoints.length>2){var t=e[0],i=e[1],a=e[2],o=[],l=this.calculateMidpoint(t,i),p=this.calculateMidpoint(i,a),h=new OpenLayers.Geometry.Point(i.x-t.x,i.y-t.y),u=new OpenLayers.Geometry.Point(a.x-i.x,a.y-i.y);if(Math.abs(h.x*u.y-u.x*h.y)<1e-5)return void o.push(t,a,i);var y,c,d=this.calculateVector(h)[1],m=this.calculateVector(u)[1],f=this.calculateIntersection(d,m,l,p),n=this.calculateDistance(f,t),g=this.calculateAngle(t,f),L=this.calculateAngle(i,f),v=this.calculateAngle(a,f),O=Math.PI,P=1,b=g,w=L;g>L?(b=L,w=g,y=i,c=t):(y=t,c=i);var M=w-b;(v<L&&v<g||v>L&&v>g)&&(P=-1,M=b+(2*O-w));var _=O/this.sides/2,x=_*P;o.push(y);for(var C=b,S=0;S<M-_;S+=_){C+=x,C=C<0?C+2*O:C,C=C>2*O?C-2*O:C;var N=new OpenLayers.Geometry.Point(Math.cos(C)*n+f.x,Math.sin(C)*n+f.y);o.push(N)}o.push(c),this.components.push(new OpenLayers.Geometry.LinearRing(o))}},calculateAngle:function(e,t){var i=Math.atan2(e.y-t.y,e.x-t.x);return i<0&&(i+=2*Math.PI),i},CLASS_NAME:"OpenLayers.Geometry.GeoLune"}),OpenLayers.Geometry.GeoLune.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoLune,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoPolygonEx=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoPolygonEx,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);this.components=[],2==e.length&&this.components.push(new OpenLayers.Geometry.LineString(e)),e.length>2&&this.components.push(new OpenLayers.Geometry.LinearRing(e))},CLASS_NAME:"OpenLayers.Geometry.GeoPolygonEx"}),OpenLayers.Geometry.GeoPolygonEx.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoPolygonEx,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoRectangle=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoRectangle,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){if(this.components=[],this._controlPoints.length>1){var e=this._controlPoints[0],t=this._controlPoints[this._controlPoints.length-1],i=e.clone(),r=new OpenLayers.Geometry.Point(t.x,e.y),n=t.clone(),s=new OpenLayers.Geometry.Point(e.x,t.y);this.components.push(new OpenLayers.Geometry.LinearRing([i,r,n,s]))}},CLASS_NAME:"OpenLayers.Geometry.GeoRectangle"}),OpenLayers.Geometry.GeoRectangle.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoRectangle,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoRoundedRect=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{_ratio:.1,initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoRoundedRect,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){if(this.components=[],this._controlPoints.length>1){var e=this._controlPoints[0],t=this._controlPoints[this._controlPoints.length-1],i=Math.max(e.x,t.x),r=Math.min(e.x,t.x),n=Math.max(e.y,t.y),s=Math.min(e.y,t.y),o=Math.min(Math.abs(e.x-t.x),Math.abs(e.y-t.y))*this._ratio,a=new OpenLayers.Geometry.Point(r+o,n-o),l=new OpenLayers.Geometry.Point(i-o,n-o),p=new OpenLayers.Geometry.Point(i-o,s+o),h=new OpenLayers.Geometry.Point(r+o,s+o),u=this.calculateArc(a,o,Math.PI,Math.PI/2,-1,180),y=this.calculateArc(l,o,Math.PI/2,0,-1,180),c=this.calculateArc(p,o,2*Math.PI,3*Math.PI/2,-1,180),d=this.calculateArc(h,o,3*Math.PI/2,Math.PI,-1,180),m=u.concat(y,c,d);this.components.push(new OpenLayers.Geometry.LinearRing(m))}},CLASS_NAME:"OpenLayers.Geometry.GeoRoundedRect"}),OpenLayers.Geometry.GeoRoundedRect.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoRoundedRect,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoSector=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{direction:-1,initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoSector,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);if(this.components=[],2==e.length){var t=e[0],i=e[1];this.components.push(new OpenLayers.Geometry.LinearRing([t,i]))}if(e.length>2){var r=e[0],n=e[1],s=e[e.length-1],o=this.calculateDistance(r,n),a=this.calculateAngle(n,r),l=this.calculateAngle(s,r);1==this.direction&&l<a&&(l=2*Math.PI+l),this.direction==-1&&l>a&&(l=-(2*Math.PI-l));var p=this.calculateArc(r,o,a,l,this.direction);p.unshift(r),this.components.push(new OpenLayers.Geometry.LinearRing(p))}},calculateAngle:function(e,t){var i=Math.atan2(e.y-t.y,e.x-t.x);return i<0&&(i+=2*Math.PI),i},CLASS_NAME:"OpenLayers.Geometry.GeoSector"}),OpenLayers.Geometry.GeoSector.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoSector,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoBezierCurveArrow=OpenLayers.Class(OpenLayers.Geometry.GeoMultiLinePlotting,{initialize:function(e){OpenLayers.Geometry.GeoMultiLinePlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoMultiLinePlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoBezierCurveArrow,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints),t=[];if(2==e.length){var i=e[0],r=e[1],n=new OpenLayers.Geometry.LineString([i,r]),s=this.calculateArrowLines(i,r,10);t.push(n,s[0],s[1])}else if(3==e.length){var i=e[1],r=e[2],o=OpenLayers.Geometry.LineString.createBezier2(e),s=this.calculateArrowLines(i,r,10);t.push(o,s[0],s[1])}else if(4==e.length){var i=e[2],r=e[3],a=OpenLayers.Geometry.LineString.createBezier3(e),s=this.calculateArrowLines(i,r,10);t.push(a,s[0],s[1])}else if(e.length>4){var i=e[e.length-2],r=e[e.length-1],l=OpenLayers.Geometry.LineString.createBezierN(e),s=this.calculateArrowLines(i,r,10);t.push(l,s[0],s[1])}this.components=t},CLASS_NAME:"OpenLayers.Geometry.GeoBezierCurveArrow"}),OpenLayers.Geometry.GeoBezierCurveArrow.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoBezierCurveArrow,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoCardinalCurveArrow=OpenLayers.Class(OpenLayers.Geometry.GeoMultiLinePlotting,{initialize:function(e){OpenLayers.Geometry.GeoMultiLinePlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoMultiLinePlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoCardinalCurveArrow,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);this.components=[];var t=[];if(2==e.length){var i=e[0],r=e[1],n=new OpenLayers.Geometry.LineString([i,r]),s=this.calculateArrowLines(i,r,10);t.push(n,s[0],s[1]),this.components=t}else if(e.length>2){var o=OpenLayers.Geometry.LineString.calculateCardinalPoints(e),a=OpenLayers.Geometry.LineString.createBezierN(o),i=o[o.length-2],r=o[o.length-1],s=this.calculateArrowLines(i,r,2);t.push(a,s[0],s[1]),this.components=t}},CLASS_NAME:"OpenLayers.Geometry.GeoCardinalCurveArrow"}),OpenLayers.Geometry.GeoCardinalCurveArrow.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoCardinalCurveArrow,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoCurveFlag=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoCurveFlag,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);if(this.components=[],e.length>1){var t=e[0],i=e[e.length-1],r=t,n=new OpenLayers.Geometry.Point((i.x-t.x)/4+t.x,(i.y-t.y)/8+t.y),s=new OpenLayers.Geometry.Point((t.x+i.x)/2,t.y),o=new OpenLayers.Geometry.Point(3*(i.x-t.x)/4+t.x,-(i.y-t.y)/8+t.y),a=new OpenLayers.Geometry.Point(i.x,t.y),l=new OpenLayers.Geometry.Point(i.x,(t.y+i.y)/2),p=new OpenLayers.Geometry.Point(3*(i.x-t.x)/4+t.x,3*(i.y-t.y)/8+t.y),h=new OpenLayers.Geometry.Point((t.x+i.x)/2,(t.y+i.y)/2),u=new OpenLayers.Geometry.Point((i.x-t.x)/4+t.x,5*(i.y-t.y)/8+t.y),y=new OpenLayers.Geometry.Point(t.x,(t.y+i.y)/2),c=new OpenLayers.Geometry.Point(t.x,i.y),d=OpenLayers.Geometry.LineString.createBezier2([r,n,s,o,a]).components,m=OpenLayers.Geometry.LineString.createBezier2([l,p,h,u,y]).components,f=d.concat(m);f.push(c),this.components.push(new OpenLayers.Geometry.LinearRing(f))}},CLASS_NAME:"OpenLayers.Geometry.GeoCurveFlag"}),OpenLayers.Geometry.GeoCurveFlag.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoCurveFlag,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoDiagonalArrow=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{_ratio:6,initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},getRatio:function(){return this._ratio},setRatio:function(e){e&&(this._ratio=e,this.calculateParts())},toJSON:function(e){if(!this._controlPoints)return null;for(var t,i=this._controlPoints.length,r=[],n=0;n<i;n++)r.push(this.controlPointToJSON(this._controlPoints[n],e));return t='{"controlPoints":['+r.join(",")+'],"ratio":'+this._ratio+',"CLASS_NAME":"'+this.CLASS_NAME+'"}'},clone:function(){for(var e=new OpenLayers.Geometry.GeoDiagonalArrow,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._ratio=this._ratio,e._controlPoints=t,e},calculateParts:function(){null==this._controlPoints||this._controlPoints.length<2||2==this._controlPoints.length&&this._controlPoints[0].equals(this._controlPoints[1])||(this.components=[],2==this._controlPoints.length?this.calculateTwoPoints():this.calculateMorePoints())},calculateTwoPoints:function(){var e=this.cloneControlPoints(this._controlPoints),t=e[0],i=e[1],r=Math.sqrt((i.y-t.y)*(i.y-t.y)+(i.x-t.x)*(i.x-t.x)),n=r/this._ratio,s=t.x+(i.x-t.x)*(this._ratio-1)/this._ratio,o=t.y+(i.y-t.y)*(this._ratio-1)/this._ratio,a=(new OpenLayers.Geometry.Point(s,o),this.calculateVector(new OpenLayers.Geometry.Point(i.x-t.x,i.y-t.y),Math.PI/2,n/2)),l=a[0],p=a[1],h=new OpenLayers.Geometry.Point(l.x+t.x,l.y+t.y),u=new OpenLayers.Geometry.Point(p.x+t.x,p.y+t.y),y=new OpenLayers.Geometry.Point(l.x/this._ratio+s,l.y/this._ratio+o),c=new OpenLayers.Geometry.Point(p.x/this._ratio+s,p.y/this._ratio+o),d=new OpenLayers.Geometry.Point(2*y.x-c.x,2*y.y-c.y),m=new OpenLayers.Geometry.Point(2*c.x-y.x,2*c.y-y.y);this.components.push(new OpenLayers.Geometry.LinearRing([h,y,d,i,m,c,u]))},calculateMorePoints:function(){for(var e=this.cloneControlPoints(this._controlPoints),t=0,i=0,r=0;r<e.length-1;r++){var n=e[r],s=e[r+1];t+=Math.sqrt((s.y-n.y)*(s.y-n.y)+(s.x-n.x)*(s.x-n.x))}i=t/this._ratio;for(var o=Math.atan(i/(2*t)),a=[],l=[],p=new OpenLayers.Geometry.Point,h=new OpenLayers.Geometry.Point,u=0;u<e.length-2;u++){var y=e[u],c=e[u+1],d=e[u+2],m=new OpenLayers.Geometry.Point(c.x-y.x,c.y-y.y),f=new OpenLayers.Geometry.Point(d.x-c.x,d.y-c.y),g=new OpenLayers.Geometry.Point,L=new OpenLayers.Geometry.Point;if(0==u){var v=this.calculateVector(m,Math.PI/2,i/2),O=v[0],P=v[1];p=g=new OpenLayers.Geometry.Point(O.x+y.x,O.y+y.y),h=L=new OpenLayers.Geometry.Point(P.x+y.x,P.y+y.y)}else g=a[a.length-1],L=l[l.length-1];var b=this.calculateVector(m,o,1),w=b[1],M=b[0],_=this.calculateAngularBisector(new OpenLayers.Geometry.Point((-m.x),(-m.y)),f),x=this.calculateIntersection(w,_,g,c),C=this.calculateIntersection(M,_,L,c);a.push(new OpenLayers.Geometry.Point((g.x+x.x)/2,(g.y+x.y)/2)),a.push(x),l.push(new OpenLayers.Geometry.Point((L.x+C.x)/2,(L.y+C.y)/2)),l.push(C)}var S=e[e.length-2],N=e[e.length-1],E=Math.sqrt((S.x-N.x)*(S.x-N.x)+(S.y-N.y)*(S.y-N.y)),T=new OpenLayers.Geometry.Point,A=new OpenLayers.Geometry.Point,I=[],G=new OpenLayers.Geometry.Point,F=new OpenLayers.Geometry.Point,R=new OpenLayers.Geometry.Point,D=new OpenLayers.Geometry.Point,k=a[a.length-1],B=l[l.length-1],z=new OpenLayers.Geometry.Point,U=new OpenLayers.Geometry.Point;if(E<=i)I=this.calculateVector(new OpenLayers.Geometry.Point(N.x-S.x,N.y-S.y),Math.PI/2,i/2),z=I[0],U=I[1],T=new OpenLayers.Geometry.Point(z.x/this._ratio+S.x,z.y/this._ratio+S.y),A=new OpenLayers.Geometry.Point(U.x/this._ratio+S.x,U.y/this._ratio+S.y),R=new OpenLayers.Geometry.Point(2*T.x-A.x,2*T.y-A.y),D=new OpenLayers.Geometry.Point(2*A.x-T.x,2*A.y-T.y),G=new OpenLayers.Geometry.Point((k.x+T.x)/2,(k.y+T.y)/2),F=new OpenLayers.Geometry.Point((B.x+A.x)/2,(B.y+A.y)/2),a.push(G),l.push(F);else{var j=new OpenLayers.Geometry.Point(N.x-S.x,N.y-S.y),V=Math.sqrt(j.x*j.x+j.y*j.y),H=new OpenLayers.Geometry.Point(N.x-j.x*i/V,N.y-j.y*i/V);I=this.calculateVector(new OpenLayers.Geometry.Point(N.x-H.x,N.y-H.y),Math.PI/2,i/2),z=I[0],U=I[1],T=new OpenLayers.Geometry.Point(z.x/this._ratio+H.x,z.y/this._ratio+H.y),A=new OpenLayers.Geometry.Point(U.x/this._ratio+H.x,U.y/this._ratio+H.y),R=new OpenLayers.Geometry.Point(2*T.x-A.x,2*T.y-A.y),D=new OpenLayers.Geometry.Point(2*A.x-T.x,2*A.y-T.y),G=new OpenLayers.Geometry.Point((k.x+T.x)/2,(k.y+T.y)/2),F=new OpenLayers.Geometry.Point((B.x+A.x)/2,(B.y+A.y)/2),a.push(G),l.push(F)}var W=OpenLayers.Geometry.LineString.createBezier2(a).components,Z=OpenLayers.Geometry.LineString.createBezier2(l).components,Y=[p];Y=Y.concat(W),Y.push(T),Y.push(R),Y.push(N),Y.push(D),Y.push(A);for(var X=Z.length-1;X>=0;X--)Y.push(Z[X]);Y.push(h),this.components.push(new OpenLayers.Geometry.LinearRing(Y))},CLASS_NAME:"OpenLayers.Geometry.GeoDiagonalArrow"}),OpenLayers.Geometry.GeoDiagonalArrow.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoDiagonalArrow,r=e.match(/"ratio":([0-9]+)/)[1];i._ratio=parseInt(r);var n=e.match(/"controlPoints":(\[.*?\])/)[1],s=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(n,t);return i._controlPoints=s,i},OpenLayers.Geometry.GeoDoubleArrow=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoDoubleArrow,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){if(!(null==this._controlPoints||this._controlPoints.length<4)){var e=this.cloneControlPoints(this._controlPoints),t=e[0],i=e[1],r=e[2],n=e[3],s=new OpenLayers.Geometry.Point((5*(t.x+i.x)+(r.x+n.x))/12,(5*(t.y+i.y)+(r.y+n.y))/12),o=this.calculateIntersectionFromTwoCorner(t,n,Math.PI/8,Math.PI/6)[0],a=this.calculateIntersectionFromTwoCorner(s,n,Math.PI/8,Math.PI/16)[0],l=this.calculateIntersectionFromTwoCorner(i,r,Math.PI/8,Math.PI/6)[1],p=this.calculateIntersectionFromTwoCorner(s,r,Math.PI/8,Math.PI/16)[1],h=new OpenLayers.Geometry.Point(o.x-n.x,o.y-n.y),u=Math.sqrt(h.x*h.x+h.y*h.y),y=new OpenLayers.Geometry.Point(h.x/u,h.y/u),c=new OpenLayers.Geometry.Point(a.x-n.x,a.y-n.y),d=Math.sqrt(c.x*c.x+c.y*c.y),m=new OpenLayers.Geometry.Point(c.x/d,c.y/d),f=.25,g=u<d?u*f:d*f,L=new OpenLayers.Geometry.Point(y.x*g+n.x,y.y*g+n.y),v=new OpenLayers.Geometry.Point(m.x*g+n.x,m.y*g+n.y),O=new OpenLayers.Geometry.Point(1.5*L.x-.5*v.x,1.5*L.y-.5*v.y),P=new OpenLayers.Geometry.Point(1.5*v.x-.5*L.x,1.5*v.y-.5*L.y),b=new OpenLayers.Geometry.Point(l.x-r.x,l.y-r.y),w=Math.sqrt(b.x*b.x+b.y*b.y),M=new OpenLayers.Geometry.Point(b.x/w,b.y/w),_=new OpenLayers.Geometry.Point(p.x-r.x,p.y-r.y),x=Math.sqrt(_.x*_.x+_.y*_.y),C=new OpenLayers.Geometry.Point(_.x/x,_.y/x),S=w<x?w*f:x*f,N=new OpenLayers.Geometry.Point(M.x*S+r.x,M.y*S+r.y),E=new OpenLayers.Geometry.Point(C.x*S+r.x,C.y*S+r.y),T=new OpenLayers.Geometry.Point(1.5*N.x-.5*E.x,1.5*N.y-.5*E.y),A=new OpenLayers.Geometry.Point(1.5*E.x-.5*N.x,1.5*E.y-.5*N.y),I=OpenLayers.Geometry.LineString.createBezier2([t,o,L]).components,G=new OpenLayers.Geometry.Point(r.x-n.x,r.y-n.y),F=new OpenLayers.Geometry.Point(s.x-n.x,s.y-n.y),R=Math.sqrt(F.x*F.x+F.y*F.y),D=new OpenLayers.Geometry.Point(s.x-r.x,s.y-r.y),k=Math.sqrt(D.x*D.x+D.y*D.y),B=.4,z=new OpenLayers.Geometry.Point(G.x*B,G.y*B),U=new OpenLayers.Geometry.Point(z.x*R/(R+k),z.y*R/(R+k)),j=new OpenLayers.Geometry.Point(z.x*k/(R+k),z.y*k/(R+k)),V=new OpenLayers.Geometry.Point(s.x-U.x,s.y-U.y),H=new OpenLayers.Geometry.Point(s.x+j.x,s.y+j.y),W=[v,a,V,s,H,p,E],Z=OpenLayers.Geometry.LineString.createBezier1(W,0,20).components,Y=OpenLayers.Geometry.LineString.createBezier2([N,l,i]).components,X=I;X.push(O),X.push(n),X.push(P),X=X.concat(Z),X.push(A),X.push(r),X.push(T),X=X.concat(Y),this.components=[],this.components.push(new OpenLayers.Geometry.LinearRing(X))}},CLASS_NAME:"OpenLayers.Geometry.GeoDoubleArrow"}),OpenLayers.Geometry.GeoDoubleArrow.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoDoubleArrow,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoDoveTailDiagonalArrow=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{_ratio:6,_tailRatio:5,initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},getRatio:function(){return this._ratio},setRatio:function(e){e&&(this._ratio=e,this.calculateParts())},toJSON:function(e){if(!this._controlPoints)return null;for(var t,i=this._controlPoints.length,r=[],n=0;n<i;n++)r.push(this.controlPointToJSON(this._controlPoints[n],e));return t='{"controlPoints":['+r.join(",")+'],"ratio":'+this._ratio+',"CLASS_NAME":"'+this.CLASS_NAME+'"}'},clone:function(){for(var e=new OpenLayers.Geometry.GeoDoveTailDiagonalArrow,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._ratio=this._ratio,e._controlPoints=t,e},calculateParts:function(){null==this._controlPoints||this._controlPoints.length<2||2==this._controlPoints.length&&this._controlPoints[0].equals(this._controlPoints[1])||(this.components=[],2==this._controlPoints.length?this.calculateTwoPoints():this.calculateMorePoints())},calculateTwoPoints:function(){var e=this.cloneControlPoints(this._controlPoints),t=e[0],i=e[1],r=Math.sqrt((i.y-t.y)*(i.y-t.y)+(i.x-t.x)*(i.x-t.x)),n=r/this._ratio,s=t.x+(i.x-t.x)*(this._ratio-1)/this._ratio,o=t.y+(i.y-t.y)*(this._ratio-1)/this._ratio,a=(new OpenLayers.Geometry.Point(s,o),this.calculateVector(new OpenLayers.Geometry.Point(i.x-t.x,i.y-t.y),Math.PI/2,n/2)),l=a[0],p=a[1],h=new OpenLayers.Geometry.Point(l.x+t.x,l.y+t.y),u=new OpenLayers.Geometry.Point(p.x+t.x,p.y+t.y),y=new OpenLayers.Geometry.Point((i.x-t.x)/this._tailRatio+t.x,(i.y-t.y)/this._tailRatio+t.y),c=new OpenLayers.Geometry.Point(l.x/this._ratio+s,l.y/this._ratio+o),d=new OpenLayers.Geometry.Point(p.x/this._ratio+s,p.y/this._ratio+o),m=new OpenLayers.Geometry.Point(2*c.x-d.x,2*c.y-d.y),f=new OpenLayers.Geometry.Point(2*d.x-c.x,2*d.y-c.y);this.components.push(new OpenLayers.Geometry.LinearRing([y,h,c,m,i,f,d,u]))},calculateMorePoints:function(){for(var e,t=this.cloneControlPoints(this._controlPoints),i=0,r=0,n=0;n<t.length-1;n++){var s=t[n],o=t[n+1];i+=Math.sqrt((o.y-s.y)*(o.y-s.y)+(o.x-s.x)*(o.x-s.x)),0==n&&(e=new OpenLayers.Geometry.Point((o.x-s.x)/this._tailRatio+s.x,(o.y-s.y)/this._tailRatio+s.y))}r=i/this._ratio;for(var a=Math.atan(r/(2*i)),l=[],p=[],h=new OpenLayers.Geometry.Point,u=new OpenLayers.Geometry.Point,y=0;y<t.length-2;y++){var c=t[y],d=t[y+1],m=t[y+2],f=new OpenLayers.Geometry.Point(d.x-c.x,d.y-c.y),g=new OpenLayers.Geometry.Point(m.x-d.x,m.y-d.y),L=new OpenLayers.Geometry.Point,v=new OpenLayers.Geometry.Point;if(0==y){var O=this.calculateVector(f,Math.PI/2,r/2),P=O[0],b=O[1];h=L=new OpenLayers.Geometry.Point(P.x+c.x,P.y+c.y),u=v=new OpenLayers.Geometry.Point(b.x+c.x,b.y+c.y)}else L=l[l.length-1],v=p[p.length-1];var w=this.calculateVector(f,a,1),M=w[1],_=w[0],x=this.calculateAngularBisector(new OpenLayers.Geometry.Point((-f.x),(-f.y)),g),C=this.calculateIntersection(M,x,L,d),S=this.calculateIntersection(_,x,v,d);l.push(new OpenLayers.Geometry.Point((L.x+C.x)/2,(L.y+C.y)/2)),l.push(C),p.push(new OpenLayers.Geometry.Point((v.x+S.x)/2,(v.y+S.y)/2)),p.push(S)}var N=t[t.length-2],E=t[t.length-1],T=Math.sqrt((N.x-E.x)*(N.x-E.x)+(N.y-E.y)*(N.y-E.y)),A=new OpenLayers.Geometry.Point,I=new OpenLayers.Geometry.Point,G=[],F=new OpenLayers.Geometry.Point,R=new OpenLayers.Geometry.Point,D=new OpenLayers.Geometry.Point,k=new OpenLayers.Geometry.Point,B=l[l.length-1],z=p[p.length-1],U=new OpenLayers.Geometry.Point,j=new OpenLayers.Geometry.Point;if(T<=r)G=this.calculateVector(new OpenLayers.Geometry.Point(E.x-N.x,E.y-N.y),Math.PI/2,r/2),U=G[0],j=G[1],A=new OpenLayers.Geometry.Point(U.x/this._ratio+N.x,U.y/this._ratio+N.y),I=new OpenLayers.Geometry.Point(j.x/this._ratio+N.x,j.y/this._ratio+N.y),D=new OpenLayers.Geometry.Point(2*A.x-I.x,2*A.y-I.y),k=new OpenLayers.Geometry.Point(2*I.x-A.x,2*I.y-A.y),F=new OpenLayers.Geometry.Point((B.x+A.x)/2,(B.y+A.y)/2),R=new OpenLayers.Geometry.Point((z.x+I.x)/2,(z.y+I.y)/2),l.push(F),p.push(R);else{var V=new OpenLayers.Geometry.Point(E.x-N.x,E.y-N.y),H=Math.sqrt(V.x*V.x+V.y*V.y),W=new OpenLayers.Geometry.Point(E.x-V.x*r/H,E.y-V.y*r/H);G=this.calculateVector(new OpenLayers.Geometry.Point(E.x-W.x,E.y-W.y),Math.PI/2,r/2),U=G[0],j=G[1],A=new OpenLayers.Geometry.Point(U.x/this._ratio+W.x,U.y/this._ratio+W.y),I=new OpenLayers.Geometry.Point(j.x/this._ratio+W.x,j.y/this._ratio+W.y),D=new OpenLayers.Geometry.Point(2*A.x-I.x,2*A.y-I.y),k=new OpenLayers.Geometry.Point(2*I.x-A.x,2*I.y-A.y),F=new OpenLayers.Geometry.Point((B.x+A.x)/2,(B.y+A.y)/2),R=new OpenLayers.Geometry.Point((z.x+I.x)/2,(z.y+I.y)/2),l.push(F),p.push(R)}var Z=OpenLayers.Geometry.LineString.createBezier2(l).components,Y=OpenLayers.Geometry.LineString.createBezier2(p).components,X=[h];X=X.concat(Z),X.push(A),X.push(D),X.push(E),X.push(k),X.push(I);for(var q=Y.length-1;q>=0;q--)X.push(Y[q]);X.push(u),X.push(e),this.components.push(new OpenLayers.Geometry.LinearRing(X))},CLASS_NAME:"OpenLayers.Geometry.GeoDoveTailDiagonalArrow"}),OpenLayers.Geometry.GeoDoveTailDiagonalArrow.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoDoveTailDiagonalArrow,r=e.match(/"ratio":([0-9]+)/)[1];i._ratio=parseInt(r);var n=e.match(/"controlPoints":(\[.*?\])/)[1],s=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(n,t);return i._controlPoints=s,i},OpenLayers.Geometry.GeoDoveTailStraightArrow=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{_ratio:6,_tailRatio:5,initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},getRatio:function(){return this._ratio},setRatio:function(e){e&&(this._ratio=e,this.calculateParts())},clone:function(){for(var e=new OpenLayers.Geometry.GeoDoveTailStraightArrow,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._ratio=this._ratio,e._controlPoints=t,e},toJSON:function(e){if(!this._controlPoints)return null;for(var t,i=this._controlPoints.length,r=[],n=0;n<i;n++)r.push(this.controlPointToJSON(this._controlPoints[n],e));return t='{"controlPoints":['+r.join(",")+'],"ratio":'+this._ratio+',"CLASS_NAME":"'+this.CLASS_NAME+'"}'},calculateParts:function(){null==this._controlPoints||this._controlPoints.length<2||2==this._controlPoints.length&&this._controlPoints[0].equals(this._controlPoints[1])||(this.components=[],2==this._controlPoints.length?this.calculateTwoPoints():this.calculateMorePoints())},calculateTwoPoints:function(){var e=this.cloneControlPoints(this._controlPoints),t=e[0],i=e[1],r=Math.sqrt((i.y-t.y)*(i.y-t.y)+(i.x-t.x)*(i.x-t.x)),n=r/this._ratio,s=t.x+(i.x-t.x)*(this._ratio-1)/this._ratio,o=t.y+(i.y-t.y)*(this._ratio-1)/this._ratio,a=this.calculateVector(new OpenLayers.Geometry.Point(i.x-t.x,i.y-t.y),Math.PI/2,n/2),l=a[0],p=a[1],h=new OpenLayers.Geometry.Point(t.x+l.x,t.y+l.y),u=new OpenLayers.Geometry.Point(s+h.x-t.x,o+h.y-t.y),y=new OpenLayers.Geometry.Point(2*u.x-s,2*u.y-o),c=new OpenLayers.Geometry.Point(i.x,i.y),d=new OpenLayers.Geometry.Point(t.x+p.x,t.y+p.y),m=new OpenLayers.Geometry.Point(s+d.x-t.x,o+d.y-t.y),f=new OpenLayers.Geometry.Point(2*m.x-s,2*m.y-o),g=new OpenLayers.Geometry.Point((i.x-t.x)/this._tailRatio+t.x,(i.y-t.y)/this._tailRatio+t.y);this.components.push(new OpenLayers.Geometry.LinearRing([g,h,u,y,c,f,m,d]))},calculateMorePoints:function(){for(var e,t=this.cloneControlPoints(this._controlPoints),i=0,r=0,n=0;n<t.length-1;n++){var s=t[n],o=t[n+1];i+=Math.sqrt((o.y-s.y)*(o.y-s.y)+(o.x-s.x)*(o.x-s.x)),0==n&&(e=new OpenLayers.Geometry.Point((o.x-s.x)/this._tailRatio+s.x,(o.y-s.y)/this._tailRatio+s.y))}r=i/this._ratio;for(var a=[],l=[],p=OpenLayers.Geometry.Point(),h=OpenLayers.Geometry.Point(),u=0;u<t.length-2;u++){var y,c,d=t[u],m=t[u+1],f=t[u+2],g=new OpenLayers.Geometry.Point(m.x-d.x,m.y-d.y),L=new OpenLayers.Geometry.Point(f.x-m.x,f.y-m.y),v=this.calculateVector(g,Math.PI/2,r/2),O=v[0],P=v[1],b=this.calculateVector(L,Math.PI/2,r/2),w=b[0],M=b[1],_=new OpenLayers.Geometry.Point(d.x+O.x,d.y+O.y),x=new OpenLayers.Geometry.Point(d.x+P.x,d.y+P.y),C=new OpenLayers.Geometry.Point(m.x+w.x,m.y+w.y),S=new OpenLayers.Geometry.Point(m.x+M.x,m.y+M.y),N=this.calculateIntersection(g,L,_,C),E=this.calculateIntersection(g,L,x,S);if(0==u)p=_,h=x,y=new OpenLayers.Geometry.Point((p.x+N.x)/2,(p.y+N.y)/2),c=new OpenLayers.Geometry.Point((h.x+E.x)/2,(h.y+E.y)/2),a.push(y),l.push(c);else{var T=a[a.length-1],A=l[l.length-1];y=new OpenLayers.Geometry.Point((T.x+N.x)/2,(T.y+N.y)/2),c=new OpenLayers.Geometry.Point((A.x+E.x)/2,(A.y+E.y)/2),
a.push(y),l.push(c)}a.push(N),l.push(E)}var I,G,F=t[t.length-2],R=t[t.length-1],D=new OpenLayers.Geometry.Point(R.x-F.x,R.y-F.y),k=Math.sqrt(D.x*D.x+D.y*D.y),B=[],z=OpenLayers.Geometry.Point(),U=OpenLayers.Geometry.Point(),j=OpenLayers.Geometry.Point(),V=OpenLayers.Geometry.Point(),H=OpenLayers.Geometry.Point(),W=OpenLayers.Geometry.Point(),Z=a[a.length-1],Y=l[l.length-1];if(k<=r)B=this.calculateVector(D,Math.PI/2,r/2),z=B[0],U=B[1],I=new OpenLayers.Geometry.Point(F.x+z.x,F.y+z.y),G=new OpenLayers.Geometry.Point(F.x+U.x,F.y+U.y),j=new OpenLayers.Geometry.Point((Z.x+I.x)/2,(Z.y+I.y)/2),V=new OpenLayers.Geometry.Point((Y.x+G.x)/2,(Y.y+G.y)/2),a.push(j),l.push(V),H=new OpenLayers.Geometry.Point(2*I.x-F.x,2*I.y-F.y),W=new OpenLayers.Geometry.Point(2*G.x-F.x,2*G.y-F.y);else{var X=new OpenLayers.Geometry.Point(R.x-F.x,R.y-F.y),q=Math.sqrt(X.x*X.x+X.y*X.y),J=new OpenLayers.Geometry.Point(R.x-X.x*r/q,R.y-X.y*r/q);B=this.calculateVector(D,Math.PI/2,r/2),z=B[0],U=B[1],I=new OpenLayers.Geometry.Point(J.x+z.x,J.y+z.y),G=new OpenLayers.Geometry.Point(J.x+U.x,J.y+U.y),j=new OpenLayers.Geometry.Point((Z.x+I.x)/2,(Z.y+I.y)/2),V=new OpenLayers.Geometry.Point((Y.x+G.x)/2,(Y.y+G.y)/2),a.push(j),l.push(V),H=new OpenLayers.Geometry.Point(2*I.x-J.x,2*I.y-J.y),W=new OpenLayers.Geometry.Point(2*G.x-J.x,2*G.y-J.y)}var K=OpenLayers.Geometry.LineString.createBezier2(a).components,Q=OpenLayers.Geometry.LineString.createBezier2(l).components,$=[p];$=$.concat(K),$.push(I),$.push(H),$.push(R),$.push(W),$.push(G),$=$.concat(Q.reverse()),$.push(h),$.push(e),this.components.push(new OpenLayers.Geometry.LinearRing($))},CLASS_NAME:"OpenLayers.Geometry.GeoDoveTailStraightArrow"}),OpenLayers.Geometry.GeoDoveTailStraightArrow.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoDoveTailStraightArrow,r=e.match(/"ratio":([0-9]+)/)[1];i._ratio=parseInt(r);var n=e.match(/"controlPoints":(\[.*?\])/)[1],s=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(n,t);return i._controlPoints=s,i},OpenLayers.Geometry.GeoParallelSearch=OpenLayers.Class(OpenLayers.Geometry.GeoMultiLinePlotting,{initialize:function(e){OpenLayers.Geometry.GeoMultiLinePlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoMultiLinePlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoParallelSearch,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);if(this.components=[],e.length>1&&this.components.push(new OpenLayers.Geometry.LineString(e)),e.length>2){var t=e[0],i=e[1],r=this.toVector(t,i),n=this.calculateVector(r)[0],s=!1,o=[];o.push(t);for(var a=[],l=1;l<e.length;l++){s=l%2!==0;var p=e[l];if(s){var h=o[l-1].clone(),u=this.calculateIntersection(n,r,p,h);o.push(u);var y=this.calculateArrowLines(h,u,15);a.push(y[0]),a.push(y[1])}else{var h=o[l-1],u=this.calculateIntersection(r,n,p,h);o.push(u);var y=this.calculateArrowLines(h,u,15);a.push(y[0]),a.push(y[1])}a.unshift(new OpenLayers.Geometry.LineString(o))}this.components=a}},CLASS_NAME:"OpenLayers.Geometry.GeoParallelSearch"}),OpenLayers.Geometry.GeoParallelSearch.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoParallelSearch,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoRectFlag=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoRectFlag,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){if(this.components=[],this._controlPoints.length>1){var e=this._controlPoints[0],t=this._controlPoints[this._controlPoints.length-1],i=e.clone(),r=new OpenLayers.Geometry.Point(t.x,e.y),n=new OpenLayers.Geometry.Point(t.x,(e.y+t.y)/2),s=new OpenLayers.Geometry.Point(e.x,(e.y+t.y)/2),o=new OpenLayers.Geometry.Point(e.x,t.y);this.components.push(new OpenLayers.Geometry.LinearRing([i,r,n,s,o]))}},CLASS_NAME:"OpenLayers.Geometry.GeoRectFlag"}),OpenLayers.Geometry.GeoRectFlag.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoRectFlag,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoSectorSearch=OpenLayers.Class(OpenLayers.Geometry.GeoMultiLinePlotting,{initialize:function(e){OpenLayers.Geometry.GeoMultiLinePlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoMultiLinePlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoSectorSearch,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);if(this.components=[],e.length>1){var t=[],i=e[0],r=2*i.x,n=2*i.y,s=e[e.length-1],o=this.calculateDistance(i,s),a=this.toVector(i,s),l=this.calculateVector(a,4*Math.PI/3,o),p=l[0],h=new OpenLayers.Geometry.Point(p.x+i.x,p.y+i.y),u=new OpenLayers.Geometry.Point(-h.x+r,-h.y+n),y=l[1],c=new OpenLayers.Geometry.Point(y.x+i.x,y.y+i.y),d=new OpenLayers.Geometry.Point(-c.x+r,-c.y+n),m=new OpenLayers.Geometry.Point(-s.x+r,-s.y+n),f=[i,s,h,u,c,d,m,i];t.push(new OpenLayers.Geometry.LineString(f));var g=this.calculateArrowLines(i,s),L=this.calculateArrowLines(s,h),v=this.calculateArrowLines(h,u),O=this.calculateArrowLines(u,c),P=this.calculateArrowLines(c,d),b=this.calculateArrowLines(d,m),w=this.calculateArrowLines(m,i);t.push(g[0],g[1]),t.push(L[0],L[1]),t.push(v[0],v[1]),t.push(O[0],O[1]),t.push(P[0],P[1]),t.push(b[0],b[1]),t.push(w[0],w[1]),this.components=t}},CLASS_NAME:"OpenLayers.Geometry.GeoSectorSearch"}),OpenLayers.Geometry.GeoSectorSearch.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoSectorSearch,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoStraightArrow=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{_ratio:6,initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},getRatio:function(){return this._ratio},setRatio:function(e){e&&(this._ratio=e,this.calculateParts())},clone:function(){for(var e=new OpenLayers.Geometry.GeoStraightArrow,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._ratio=this._ratio,e._controlPoints=t,e},toJSON:function(e){if(!this._controlPoints)return null;for(var t,i=this._controlPoints.length,r=[],n=0;n<i;n++)r.push(this.controlPointToJSON(this._controlPoints[n],e));return t='{"controlPoints":['+r.join(",")+'],"ratio":'+this._ratio+',"CLASS_NAME":"'+this.CLASS_NAME+'"}'},calculateParts:function(){null==this._controlPoints||this._controlPoints.length<2||2==this._controlPoints.length&&this._controlPoints[0].equals(this._controlPoints[1])||(this.components=[],2==this._controlPoints.length?this.calculateTwoPoints():this.calculateMorePoints())},calculateTwoPoints:function(){var e=this.cloneControlPoints(this._controlPoints),t=e[0],i=e[1],r=Math.sqrt((i.y-t.y)*(i.y-t.y)+(i.x-t.x)*(i.x-t.x)),n=r/this._ratio,s=t.x+(i.x-t.x)*(this._ratio-1)/this._ratio,o=t.y+(i.y-t.y)*(this._ratio-1)/this._ratio,a=this.calculateVector(new OpenLayers.Geometry.Point(i.x-t.x,i.y-t.y),Math.PI/2,n/2),l=a[0],p=a[1],h=new OpenLayers.Geometry.Point(t.x+l.x,t.y+l.y),u=new OpenLayers.Geometry.Point(s+h.x-t.x,o+h.y-t.y),y=new OpenLayers.Geometry.Point(2*u.x-s,2*u.y-o),c=new OpenLayers.Geometry.Point(i.x,i.y),d=new OpenLayers.Geometry.Point(t.x+p.x,t.y+p.y),m=new OpenLayers.Geometry.Point(s+d.x-t.x,o+d.y-t.y),f=new OpenLayers.Geometry.Point(2*m.x-s,2*m.y-o);this.components.push(new OpenLayers.Geometry.LinearRing([h,u,y,c,f,m,d]))},calculateMorePoints:function(){for(var e=this.cloneControlPoints(this._controlPoints),t=0,i=0,r=0;r<e.length-1;r++){var n=e[r],s=e[r+1];t+=Math.sqrt((s.y-n.y)*(s.y-n.y)+(s.x-n.x)*(s.x-n.x))}i=t/this._ratio;for(var o=[],a=[],l=OpenLayers.Geometry.Point(),p=OpenLayers.Geometry.Point(),h=0;h<e.length-2;h++){var u,y,c=e[h],d=e[h+1],m=e[h+2],f=new OpenLayers.Geometry.Point(d.x-c.x,d.y-c.y),g=new OpenLayers.Geometry.Point(m.x-d.x,m.y-d.y),L=this.calculateVector(f,Math.PI/2,i/2),v=L[0],O=L[1],P=this.calculateVector(g,Math.PI/2,i/2),b=P[0],w=P[1],M=new OpenLayers.Geometry.Point(c.x+v.x,c.y+v.y),_=new OpenLayers.Geometry.Point(c.x+O.x,c.y+O.y),x=new OpenLayers.Geometry.Point(d.x+b.x,d.y+b.y),C=new OpenLayers.Geometry.Point(d.x+w.x,d.y+w.y),S=this.calculateIntersection(f,g,M,x),N=this.calculateIntersection(f,g,_,C);if(0==h)l=M,p=_,u=new OpenLayers.Geometry.Point((l.x+S.x)/2,(l.y+S.y)/2),y=new OpenLayers.Geometry.Point((p.x+N.x)/2,(p.y+N.y)/2),o.push(u),a.push(y);else{var E=o[o.length-1],T=a[a.length-1];u=new OpenLayers.Geometry.Point((E.x+S.x)/2,(E.y+S.y)/2),y=new OpenLayers.Geometry.Point((T.x+N.x)/2,(T.y+N.y)/2),o.push(u),a.push(y)}o.push(S),a.push(N)}var A,I,G=e[e.length-2],F=e[e.length-1],R=new OpenLayers.Geometry.Point(F.x-G.x,F.y-G.y),D=Math.sqrt(R.x*R.x+R.y*R.y),k=[],B=OpenLayers.Geometry.Point(),z=OpenLayers.Geometry.Point(),U=OpenLayers.Geometry.Point(),j=OpenLayers.Geometry.Point(),V=OpenLayers.Geometry.Point(),H=OpenLayers.Geometry.Point(),W=o[o.length-1],Z=a[a.length-1];if(D<=i)k=this.calculateVector(R,Math.PI/2,i/2),B=k[0],z=k[1],A=new OpenLayers.Geometry.Point(G.x+B.x,G.y+B.y),I=new OpenLayers.Geometry.Point(G.x+z.x,G.y+z.y),U=new OpenLayers.Geometry.Point((W.x+A.x)/2,(W.y+A.y)/2),j=new OpenLayers.Geometry.Point((Z.x+I.x)/2,(Z.y+I.y)/2),o.push(U),a.push(j),V=new OpenLayers.Geometry.Point(2*A.x-G.x,2*A.y-G.y),H=new OpenLayers.Geometry.Point(2*I.x-G.x,2*I.y-G.y);else{var Y=new OpenLayers.Geometry.Point(F.x-G.x,F.y-G.y),X=Math.sqrt(Y.x*Y.x+Y.y*Y.y),q=new OpenLayers.Geometry.Point(F.x-Y.x*i/X,F.y-Y.y*i/X);k=this.calculateVector(R,Math.PI/2,i/2),B=k[0],z=k[1],A=new OpenLayers.Geometry.Point(q.x+B.x,q.y+B.y),I=new OpenLayers.Geometry.Point(q.x+z.x,q.y+z.y),U=new OpenLayers.Geometry.Point((W.x+A.x)/2,(W.y+A.y)/2),j=new OpenLayers.Geometry.Point((Z.x+I.x)/2,(Z.y+I.y)/2),o.push(U),a.push(j),V=new OpenLayers.Geometry.Point(2*A.x-q.x,2*A.y-q.y),H=new OpenLayers.Geometry.Point(2*I.x-q.x,2*I.y-q.y)}var J=OpenLayers.Geometry.LineString.createBezier2(o).components,K=OpenLayers.Geometry.LineString.createBezier2(a).components,Q=[l];Q=Q.concat(J),Q.push(A),Q.push(V),Q.push(F),Q.push(H),Q.push(I),Q=Q.concat(K.reverse()),Q.push(p),this.components.push(new OpenLayers.Geometry.LinearRing(Q))},CLASS_NAME:"OpenLayers.Geometry.GeoStraightArrow"}),OpenLayers.Geometry.GeoStraightArrow.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoStraightArrow,r=e.match(/"ratio":([0-9]+)/)[1];i._ratio=parseInt(r);var n=e.match(/"controlPoints":(\[.*?\])/)[1],s=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(n,t);return i._controlPoints=s,i},OpenLayers.Geometry.GeoPolylineArrow=OpenLayers.Class(OpenLayers.Geometry.GeoMultiLinePlotting,{initialize:function(e){OpenLayers.Geometry.GeoMultiLinePlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoMultiLinePlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoPolylineArrow,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){var e=this.cloneControlPoints(this._controlPoints);if(this.components=[],e.length>1){var t=[],i=e[e.length-2],r=e[e.length-1],n=new OpenLayers.Geometry.LineString(e),s=this.calculateArrowLines(i,r,10);t.push(n,s[0],s[1]),this.components=t}},CLASS_NAME:"OpenLayers.Geometry.GeoPolylineArrow"}),OpenLayers.Geometry.GeoPolylineArrow.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoPolylineArrow,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoLinePlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Geometry.GeoTriangleFlag=OpenLayers.Class(OpenLayers.Geometry.GeoPlotting,{initialize:function(e){OpenLayers.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(e){return OpenLayers.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){for(var e=new OpenLayers.Geometry.GeoTriangleFlag,t=[],i=0,r=this._controlPoints.length;i<r;i++)t.push(this._controlPoints[i].clone());return e._controlPoints=t,e},calculateParts:function(){if(this.components=[],this._controlPoints.length>1){var e=this._controlPoints[0],t=this._controlPoints[this._controlPoints.length-1],i=e.clone(),r=new OpenLayers.Geometry.Point(t.x,(e.y+t.y)/2),n=new OpenLayers.Geometry.Point(e.x,(e.y+t.y)/2),s=new OpenLayers.Geometry.Point(e.x,t.y);this.components.push(new OpenLayers.Geometry.LinearRing([i,r,n,s]))}},CLASS_NAME:"OpenLayers.Geometry.GeoTriangleFlag"}),OpenLayers.Geometry.GeoTriangleFlag.fromJSON=function(e,t){var i=new OpenLayers.Geometry.GeoTriangleFlag,r=e.match(/"controlPoints":(\[.*?\])/)[1],n=OpenLayers.Geometry.GeoPlotting.getControlPointsFromJSON(r,t);return i._controlPoints=n,i},OpenLayers.Handler.PointEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoPoint),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t&&this.drawComplete(),!0}return!0},CLASS_NAME:"OpenLayers.Handler.PointEx"}),OpenLayers.Handler.MultiPointEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoMultiPoint),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},up:function(e){return this.mouseDown=!1,this.stoppedDown=this.stopDown,!(!this.lastUp||!this.lastUp.equals(e.xy))||(!this.lastDown||!this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||(this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy),!0))},dblclick:function(e){return this.drawComplete(),this.isDrawing=!1,!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.MultiPointEx"}),OpenLayers.Handler.ArcEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoArc),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t||2==t?this.isDrawing=!0:3==t&&(this.isDrawing=!1,this.drawComplete()),!0}return!0},CLASS_NAME:"OpenLayers.Handler.ArcEx"}),OpenLayers.Handler.BezierCurve2Ex=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoBezierCurve2),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>0&&t<3?this.isDrawing=!0:3==t&&this.drawComplete(),!0}return!0},CLASS_NAME:"OpenLayers.Handler.BezierCurve2Ex"}),OpenLayers.Handler.BezierCurve3Ex=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoBezierCurve3),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>0&&t<4?this.isDrawing=!0:4==t&&this.drawComplete(),!0}return!0},CLASS_NAME:"OpenLayers.Handler.BezierCurve3Ex"}),OpenLayers.Handler.BezierCurveNEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoBezierCurveN),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>0&&(this.isDrawing=!0),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.BezierCurveNEx"}),OpenLayers.Handler.CardinalCurveEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoCardinalCurve),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.CardinalCurveEx"}),OpenLayers.Handler.FreelineEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoFreeline),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0}return!0},touchstart:function(e){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.map.isIESingleTouch=!1,this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0},touchmove:function(e){return this.lastTouchPx=e.xy,this.modifyFeature(e.xy),!0},modifyFeature:function(e){if(this.lastUp&&this.lastUp.equals(e))return!0;this.point&&this.plotting||this.createFeature(e);var t=this.layer.getLonLatFromViewPortPx(e);if(this.point.geometry.x=t.lon,this.point.geometry.y=t.lat,1==this.isDrawing){this.addControlPoint(e);var i=this.controlPoints;this.plotting.geometry._controlPoints=this.cloneControlPoints(i),this.plotting.geometry.calculateParts()}this.callback("modify",[this.point.geometry,this.getSketch(),!1]),this.point.geometry.clearBounds(),this.drawFeature()},dblclick:function(e){return this.drawComplete(),!1},touchend:function(e){return this.drawComplete(),this.map.isIESingleTouch=!0,!1},CLASS_NAME:"OpenLayers.Handler.FreelineEx"}),OpenLayers.Handler.PolyLineEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoPolyline),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.PolyLineEx"}),OpenLayers.Handler.CircleEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoCircle),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>1&&this.layer.features[0].destroy()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t?this.isDrawing=!0:2==t&&this.drawComplete(),!0}return!0},touchstart:function(e){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.map.isIESingleTouch=!1,this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0},touchend:function(e){return this.drawComplete(),this.map.isIESingleTouch=!0,!1},touchmove:function(e){return this.lastTouchPx=e.xy,this.modifyFeature(e.xy),!0},CLASS_NAME:"OpenLayers.Handler.CircleEx"}),OpenLayers.Handler.CloseCurve=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoCloseCurve),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>1&&this.layer.features[0].destroy()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.CloseCurve"}),OpenLayers.Handler.EllipseEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoEllipse),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t?this.isDrawing=!0:2==t&&this.drawComplete(),!0}return!0},touchstart:function(e){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.map.isIESingleTouch=!1,this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0},touchend:function(e){return this.drawComplete(),this.map.isIESingleTouch=!0,!1},touchmove:function(e){return this.lastTouchPx=e.xy,this.modifyFeature(e.xy),!0},CLASS_NAME:"OpenLayers.Handler.EllipseEx"}),OpenLayers.Handler.FreePolygon=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoFreePolygon),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>0&&(this.isDrawing=!0),!0}return!0},modifyFeature:function(e){if(this.lastUp&&this.lastUp.equals(e))return!0;this.point&&this.plotting||this.createFeature(e);
var t=this.layer.getLonLatFromViewPortPx(e);if(this.point.geometry.x=t.lon,this.point.geometry.y=t.lat,1==this.isDrawing){this.addControlPoint(e);var i=this.controlPoints;this.plotting.geometry._controlPoints=this.cloneControlPoints(i),this.plotting.geometry.calculateParts()}this.callback("modify",[this.point.geometry,this.getSketch(),!1]),this.point.geometry.clearBounds(),this.drawFeature()},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.map.isIESingleTouch=!1,this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0},touchend:function(e){return this.drawComplete(),this.map.isIESingleTouch=!0,!1},touchmove:function(e){return this.lastTouchPx=e.xy,this.modifyFeature(e.xy),!0},CLASS_NAME:"OpenLayers.Handler.FreePolygon"}),OpenLayers.Handler.GatheringPlace=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoGatheringPlace),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t?this.isDrawing=!0:2==t&&this.drawComplete(),!0}return!0},CLASS_NAME:"OpenLayers.Handler.GatheringPlace"}),OpenLayers.Handler.Lune=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoLune),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t||2==t?this.isDrawing=!0:3==t&&(this.isDrawing=!1,this.drawComplete()),!0}return!0},CLASS_NAME:"OpenLayers.Handler.Lune"}),OpenLayers.Handler.PolygonEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoPolygonEx),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>0?this.isDrawing=!0:(this.isDrawing=!1,this.controlPoints=[],this.plotting=null),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.PolygonEx"}),OpenLayers.Handler.Rectangle=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoRectangle),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t?this.isDrawing=!0:2==t?this.drawComplete():(this.isDrawing=!1,this.controlPoints=[],this.plotting=null),!0}return!0},touchstart:function(e){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.map.isIESingleTouch=!1,this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0},touchend:function(e){return this.drawComplete(),this.map.isIESingleTouch=!0,!1},touchmove:function(e){return this.lastTouchPx=e.xy,this.modifyFeature(e.xy),!0},CLASS_NAME:"OpenLayers.Handler.Rectangle"}),OpenLayers.Handler.RoundedRect=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoRoundedRect),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t?this.isDrawing=!0:2==t?this.drawComplete():(this.isDrawing=!1,this.controlPoints=[],this.plotting=null),!0}return!0},touchstart:function(e){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.map.isIESingleTouch=!1,this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0},touchend:function(e){return this.drawComplete(),this.map.isIESingleTouch=!0,!1},touchmove:function(e){return this.lastTouchPx=e.xy,this.modifyFeature(e.xy),!0},CLASS_NAME:"OpenLayers.Handler.RoundedRect"}),OpenLayers.Handler.Sector=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoSector),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t||2==t?this.isDrawing=!0:3==t&&(this.isDrawing=!1,this.drawComplete()),!0}return!0},CLASS_NAME:"OpenLayers.Handler.Sector"}),OpenLayers.Handler.BezierCurveArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoBezierCurveArrow),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>0&&(this.isDrawing=!0),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.BezierCurveArrow"}),OpenLayers.Handler.CardinalCurveArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoCardinalCurveArrow),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>0&&(this.isDrawing=!0),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.CardinalCurveArrow"}),OpenLayers.Handler.CurveFlag=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoCurveFlag),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t?this.isDrawing=!0:2==t?this.drawComplete():(this.isDrawing=!1,this.controlPoints=[],this.plotting=null),!0}return!0},touchstart:function(e){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.map.isIESingleTouch=!1,this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0},touchend:function(e){return this.drawComplete(),this.map.isIESingleTouch=!0,!1},touchmove:function(e){return this.lastTouchPx=e.xy,this.modifyFeature(e.xy),!0},CLASS_NAME:"OpenLayers.Handler.CurveFlag"}),OpenLayers.Handler.DiagonalArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoDiagonalArrow),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch&&(this.modifyFeature(e.xy),OpenLayers.Event.stop(e)),this.stoppedDown=this.stopDown,!this.stopDown},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t&&(this.isDrawing=!0),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.DiagonalArrow"}),OpenLayers.Handler.DoubleArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoDoubleArrow),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},modifyFeature:function(e){if(this.lastUp&&this.lastUp.equals(e))return!0;this.point&&this.plotting||this.createFeature(e);var t=this.layer.getLonLatFromViewPortPx(e);if(this.point.geometry.x=t.lon,this.point.geometry.y=t.lat,1==this.isDrawing){var i=new OpenLayers.Geometry.Point(t.lon,t.lat),r=this.controlPoints.length;if(2==r)var n=this.controlPoints[1].x-this.controlPoints[0].x,s=this.controlPoints[1].y-this.controlPoints[0].y,o=new OpenLayers.Geometry.Point(t.lon-n,t.lat-s),a=this.controlPoints.concat([i,o]);else if(3==r)var a=this.controlPoints.concat([i]);this.plotting.geometry._controlPoints=this.cloneControlPoints(a),this.plotting.geometry.calculateParts()}this.callback("modify",[this.point.geometry,this.getSketch(),!1]),this.point.geometry.clearBounds(),this.drawFeature()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t||(2==t||3==t?this.isDrawing=!0:4==t?this.drawComplete():(this.isDrawing=!1,this.controlPoints=[],this.plotting=null)),!0}return!0},CLASS_NAME:"OpenLayers.Handler.DoubleArrow"}),OpenLayers.Handler.DoveTailDiagonalArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoDoveTailDiagonalArrow),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch&&(this.modifyFeature(e.xy),OpenLayers.Event.stop(e)),this.stoppedDown=this.stopDown,!this.stopDown},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t&&(this.isDrawing=!0),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.DoveTailDiagonalArrow"}),OpenLayers.Handler.DoveTailStraightArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoDoveTailStraightArrow),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch&&(this.modifyFeature(e.xy),OpenLayers.Event.stop(e)),this.stoppedDown=this.stopDown,!this.stopDown},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t&&(this.isDrawing=!0),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.DoveTailStraightArrow"}),OpenLayers.Handler.ParallelSearch=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoParallelSearch),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>0&&(this.isDrawing=!0),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.ParallelSearch"}),OpenLayers.Handler.RectFlag=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoRectFlag),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t?this.isDrawing=!0:2==t?this.drawComplete():(this.isDrawing=!1,this.controlPoints=[],this.plotting=null),!0}return!0},touchstart:function(e){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.map.isIESingleTouch=!1,this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0},touchend:function(e){return this.drawComplete(),this.map.isIESingleTouch=!0,!1},touchmove:function(e){return this.lastTouchPx=e.xy,this.modifyFeature(e.xy),!0},CLASS_NAME:"OpenLayers.Handler.RectFlag"}),OpenLayers.Handler.SectorSearch=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoSectorSearch),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t?this.isDrawing=!0:2==t&&this.drawComplete(),!0}return!0},CLASS_NAME:"OpenLayers.Handler.SectorSearch"}),OpenLayers.Handler.StraightArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoStraightArrow),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch&&(this.modifyFeature(e.xy),OpenLayers.Event.stop(e)),this.stoppedDown=this.stopDown,!this.stopDown},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t&&(this.isDrawing=!0),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.StraightArrow"}),OpenLayers.Handler.PolylineArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoPolylineArrow),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>0&&(this.isDrawing=!0),!0}return!0},dblclick:function(e){return this.drawComplete(),!1},touchstart:function(e){return this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,e.xy,this.pixelTolerance)?(e.preventDefault(),this.drawComplete(),this.isDrawing=!1,!1):(this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e))},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.isDrawing=!0,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},touchend:function(e){if(this.isDrawing)return e.xy=this.lastTouchPx,this.up(e)},CLASS_NAME:"OpenLayers.Handler.PolylineArrow"}),OpenLayers.Handler.TriangleFlag=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(e,t,i){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(i),this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoTriangleFlag),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},up:function(e){if(this.mouseDown=!1,this.stoppedDown=this.stopDown,this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.addControlPoint(e.xy);var t=this.controlPoints.length;return 1==t?this.isDrawing=!0:2==t?this.drawComplete():(this.isDrawing=!1,this.controlPoints=[],this.plotting=null),!0}return!0},touchstart:function(e){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.map.isIESingleTouch=!1,this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.addControlPoint(e.xy);var t=this.controlPoints.length;return t>=1&&(this.isDrawing=!0),!0},touchend:function(e){return this.drawComplete(),this.map.isIESingleTouch=!0,!1},touchmove:function(e){return this.lastTouchPx=e.xy,this.modifyFeature(e.xy),!0},CLASS_NAME:"OpenLayers.Handler.TriangleFlag"}),OpenLayers.Geometry.LineString.createCurve=function(e,t,i,r){var n="lanczos";void 0!=t&&(n=t);var s=10;void 0!=i&&(s=i);for(var o={method:n,clip:"mirror",lanczosFilterSize:s,cubicTension:0},a=[],l=0;l<e.length;l++)a.push([e[l].x,e[l].y]);f=Smooth(a,o);var p=function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},h=80;void 0!=r&&(h=r);var u,y,c,d,m,f,g,L,v,O,P,b,w=[];for(u=p(a[0],a[a.length-1])/h,d=2,L=0,O=1/d;L<1;L+=O)for(P=[f(l+L),f(l+L+1/d)],g=P[0],c=P[1],m=p(g,c),y=u/m,v=0,b=1/d;0<=b?v<b:v>b;v+=y){var M=f(l+L+v);w.push(new OpenLayers.Geometry.Point(M[0],M[1]))}var M=f(l+1);return w.push(new OpenLayers.Geometry.Point(M[0],M[1])),new OpenLayers.Geometry.LineString(w)},OpenLayers.Geometry.LineString.createBspline=function(e,t){if(e.length<2)return null;var i=[],r=10;void 0!=t&&(r=t);var n,s,o,a,l,p,h,u,y,c;p=1/r;var d=Math.sqrt((Math.pow(e[1].x-e[0].x,2)+Math.pow(e[1].y-e[0].y,2))/2),m=new OpenLayers.Geometry.Point(e[0].x-d,e[0].y-d),f=[];
for(f[0]=m,n=0;n<e.length-1;n++){var g=[];g[0]=e[n];var L=new OpenLayers.Geometry.Point(2*e[n].x-f[n].x,2*e[n].y-f[n].y);for(g[1]=L,f[n+1]=L,g[2]=e[n+1],i.push(g[0]),s=0;s<=r;s++)h=s*p,u=h*h,o=(u-2*h+1)/2,a=(2*h-2*u+1)/2,l=u/2,y=o*g[0].x+a*g[1].x+l*g[2].x,c=o*g[0].y+a*g[1].y+l*g[2].y,i.push(new OpenLayers.Geometry.Point(y,c))}return i.push(e[e.length-1]),new OpenLayers.Geometry.LineString(i)},OpenLayers.Geometry.LineString.createBezier1=function(e,t,i){if(i)return OpenLayers.Geometry.LineString.createBezier3(e,i);for(var r=[],n=0;n<e.length;n++)r[n]=e[n];for(var s,o,a,l=0,p=r.length,h=[],u=!0;u;){for(a=!0,s=0;s<p-3;s+=3){if(GetBezierGap(r,s)>t){for(a=!1,InciseBezier(r,s,h),r.splice(s+1,2),o=0;o<5;o++)r.splice(s+1+o,0,h[o+1]);s-=3,p=r.length}if(a)break}for(;l<p-1;)r[l]===r[l+1]&&(r.splice(l+1,1),p--),l++;u=!1}return new OpenLayers.Geometry.LineString(r)},OpenLayers.Geometry.LineString.calculatePointsFBZ2=function(e,t){t||(t=20);var i=[],r=.05;t>0&&(r=1/t);for(var n=0;n<e.length-2;){var s=e[n],o=e[n+1],a=e[n+2];i.push(s);for(var l=0;l<1;){var p=(1-l)*(1-l)*s.x+2*l*(1-l)*o.x+l*l*a.x,h=(1-l)*(1-l)*s.y+2*l*(1-l)*o.y+l*l*a.y,u=new OpenLayers.Geometry.Point(p,h);i.push(u),l+=r}n+=2,n>=e.length&&i.push(s)}var y=i[i.length-1],c=e[e.length-1];return y.equals(c)||i.push(c.clone()),i},OpenLayers.Geometry.LineString.calculatePointsFBZ3=function(e,t){t||(t=20);var i=[],r=.05;t>0&&(r=1/t);for(var n=0;n<e.length-3;){var s=e[n],o=e[n+1],a=e[n+2],l=e[n+3];i.push(s);for(var p=0;p<1;){var h=(1-p)*(1-p)*(1-p)*s.x+3*p*(1-p)*(1-p)*o.x+3*p*p*(1-p)*a.x+p*p*p*l.x,u=(1-p)*(1-p)*(1-p)*s.y+3*p*(1-p)*(1-p)*o.y+3*p*p*(1-p)*a.y+p*p*p*l.y,y=new OpenLayers.Geometry.Point(h,u);i.push(y),p+=r}n+=3,n>=e.length&&i.push(s)}var c=i[i.length-1],d=e[e.length-1];return c.equals(d)||i.push(d.clone()),i},OpenLayers.Geometry.LineString.calculatePointsFBZN=function(e,t){t||(t=8*e.length);var i=[],r=.05;t>0&&(r=1/t);for(var n=0;n<=1;){for(var s=0,o=0,a=e.length,l=0;l<e.length;l++){var p=OpenLayers.Geometry.LineString.BEZ(a-1,l,n);s+=e[l].x*p,o+=e[l].y*p}var h=new OpenLayers.Geometry.Point(s,o);i.push(h),n+=r}var u=i[i.length-1],y=e[e.length-1];return u.equals(y)||i.push(y.clone()),i},OpenLayers.Geometry.LineString.createBezier2=function(e,t){var i=OpenLayers.Geometry.LineString.calculatePointsFBZ2(e,t);return new OpenLayers.Geometry.LineString(i)},OpenLayers.Geometry.LineString.createBezier3=function(e,t){var i=OpenLayers.Geometry.LineString.calculatePointsFBZ3(e,t);return new OpenLayers.Geometry.LineString(i)},OpenLayers.Geometry.LineString.createBezier=function(e,t){for(var i=[],r=0;r<e.length;r++)i[r]=e[r];for(var n,s,o,a=0,l=i.length,p=[];;){for(o=!0,n=0;n<l-3;n+=3){if(GetBezierGap(i,n)>t){for(o=!1,InciseBezier(i,n,p),i.splice(n+1,2),s=0;s<5;s++)i.splice(n+1+s,0,p[s+1]);n-=3,l=i.length}if(o)break}for(;a<l-1;)i[a]===i[a+1]&&(i.splice(a+1,1),l--),a++;return new OpenLayers.Geometry.LineString(i)}},InciseBezier=function(e,t,i){var r=[];r[0]=[],r[1]=[],r[2]=[];var n;for(n=0;n<3;n++)r[0][n]=new OpenLayers.Geometry.Point,r[0][n].x=(e[t+n].x+e[t+n+1].x)/2,r[0][n].y=(e[t+n].y+e[t+n+1].y)/2;for(n=0;n<2;n++)r[1][n]=new OpenLayers.Geometry.Point,r[1][n].x=(r[0][n].x+r[0][n+1].x)/2,r[1][n].y=(r[0][n].y+r[0][n+1].y)/2;return r[2][0]=new OpenLayers.Geometry.Point,r[2][0].x=(r[1][0].x+r[1][1].x)/2,r[2][0].y=(r[1][0].y+r[1][1].y)/2,i[0]=e[t],i[1]=r[0][0],i[2]=r[1][0],i[3]=r[2][0],i[4]=r[1][1],i[5]=r[0][2],i[6]=e[t+3],!0},GetBezierGap=function(e,t){for(var i=0,r=1;r<4;r++)Math.abs(e[t+r].x-e[t+r-1].x)>i&&(i=Math.abs(e[t+r].x-e[t+r-1].x)),Math.abs(e[t+r].y-e[t+r-1].y)>i&&(i=Math.abs(e[t+r].y-e[t+r-1].y));return i},OpenLayers.Geometry.LineString.createBezierN=function(e,t){var i=OpenLayers.Geometry.LineString.calculatePointsFBZN(e,t);return new OpenLayers.Geometry.LineString(i)},OpenLayers.Geometry.LineString.BEZ=function(e,t,i){return OpenLayers.Geometry.LineString.combSort(e,t)*Math.pow(i,t)*Math.pow(1-i,e-t)},OpenLayers.Geometry.LineString.combSort=function(e,t){var i=OpenLayers.Geometry.LineString.factorial(e),r=OpenLayers.Geometry.LineString.factorial(t)*OpenLayers.Geometry.LineString.factorial(e-t);return i/r},OpenLayers.Geometry.LineString.factorial=function(e){for(var t=1,i=1;i<=e;i++)t*=i;return t},OpenLayers.Geometry.LineString.calculateCardinalPoints=function(e){if(null==e||e.length<3)return e;for(var t=e,i=[],r=.4,n=.5,s=.005,o=t.length-1,a=0;a<=o+1-3;a++){var l=t[a],p=t[a+1],h=t[a+2],u=new OpenLayers.Geometry.Point,y=new OpenLayers.Geometry.Point,c=new OpenLayers.Geometry.Point(p.x-l.x,p.y-l.y),d=new OpenLayers.Geometry.Point(h.x-p.x,h.y-p.y),m=Math.sqrt(c.x*c.x+c.y*c.y),f=Math.sqrt(d.x*d.x+d.y*d.y),g=new OpenLayers.Geometry.Point(c.x/m,c.y/m),L=new OpenLayers.Geometry.Point(d.x/f,d.y/f),v=new OpenLayers.Geometry.Point(g.x+L.x,g.y+L.y),O=Math.sqrt(v.x*v.x+v.y*v.y),P=new OpenLayers.Geometry.Point(v.x/O,v.y/O),b=(g.x*L.x+g.y*L.y)/1;if(Math.abs(1-b)<s?(u.x=p.x-L.x*m*r,u.y=p.y-L.y*m*r,y.x=p.x+g.x*f*r,y.y=p.y+g.y*f*r):(u.x=p.x-P.x*m*r,u.y=p.y-P.y*m*r,y.x=p.x+P.x*f*r,y.y=p.y+P.y*f*r),i[3*a+2+0]=u,i[3*a+2+1]=p,i[3*a+2+2]=y,0==a){var w=new OpenLayers.Geometry.Point,M=new OpenLayers.Geometry.Point(u.x-l.x,u.y-l.y),_=Math.sqrt(M.x*M.x+M.y*M.y),x=new OpenLayers.Geometry.Point(M.x/_,M.y/_);w.x=l.x+x.x*m*r*n,w.y=l.y+x.y*m*r*n,i[3*a+0]=l,i[3*a+1]=w}if(a==o+1-3){var C=new OpenLayers.Geometry.Point,S=new OpenLayers.Geometry.Point(y.x-h.x,y.y-h.y),N=Math.sqrt(S.x*S.x+S.y*S.y),E=new OpenLayers.Geometry.Point(S.x/N,S.y/N);C.x=h.x+E.x*f*r*n,C.y=h.y+E.y*f*r*n,i[3*a+2+3]=C,i[3*a+2+4]=h}}return i},OpenLayers.Geometry.LineString.createCloseCardinal=function(e){if(null==e||e.length<3)return e;var t=e[0];e.push(t);for(var i=e,r=[],n=.4,s=.005,o=i.length-1,a=0;a<=o-1;a++){if(a==o-1)var l=i[o-1],p=i[0],h=i[1];else var l=i[a],p=i[a+1],h=i[a+2];var u=new OpenLayers.Geometry.Point,y=new OpenLayers.Geometry.Point,c=new OpenLayers.Geometry.Point(p.x-l.x,p.y-l.y),d=new OpenLayers.Geometry.Point(h.x-p.x,h.y-p.y),m=Math.sqrt(c.x*c.x+c.y*c.y),f=Math.sqrt(d.x*d.x+d.y*d.y),g=new OpenLayers.Geometry.Point(c.x/m,c.y/m),L=new OpenLayers.Geometry.Point(d.x/f,d.y/f),v=new OpenLayers.Geometry.Point(g.x+L.x,g.y+L.y),O=Math.sqrt(v.x*v.x+v.y*v.y),P=new OpenLayers.Geometry.Point(v.x/O,v.y/O),b=(g.x*L.x+g.y*L.y)/1;Math.abs(1-b)<s?(u.x=p.x-L.x*m*n,u.y=p.y-L.y*m*n,y.x=p.x+g.x*f*n,y.y=p.y+g.y*f*n):(u.x=p.x-P.x*m*n,u.y=p.y-P.y*m*n,y.x=p.x+P.x*f*n,y.y=p.y+P.y*f*n),a==o-1?(r[0]=p,r[1]=y,r[3*(o-2)+2+3]=u,r[3*(o-2)+2+4]=i[o]):(r[3*a+2+0]=u,r[3*a+2+1]=p,r[3*a+2+2]=y)}return r},OpenLayers.Geometry.LineString.calculateCircle=function(e){if(e.length<3)return e;var t=(e.length,{}),i=e[0],r=e[1],n=e[2],s=0,o=!0,a=0,l=0,p=0,h=72,t={},u=[],y=(n.y-i.y)/(n.x-i.x),c=n.y-y*n.x;if(n.x!=i.x&&n.y!=i.y&&r.y==y*r.x+c||n.x==i.x&&r.x==i.x||n.y==i.y&&r.y==i.y||n.x==i.x&&n.y==i.y||n.x==r.x&&n.y==r.y||i.x==r.x&&i.y==r.y)u.push(i),u.push(r),u.push(n);else{var d=(r.x*r.x+r.y*r.y-(i.x*i.x+i.y*i.y))*(2*(n.y-i.y))-(n.x*n.x+n.y*n.y-(i.x*i.x+i.y*i.y))*(2*(r.y-i.y)),m=2*(r.x-i.x)*(n.x*n.x+n.y*n.y-(i.x*i.x+i.y*i.y))-2*(n.x-i.x)*(r.x*r.x+r.y*r.y-(i.x*i.x+i.y*i.y)),f=4*((r.x-i.x)*(n.y-i.y)-(n.x-i.x)*(r.y-i.y));t.x=d/f,t.y=m/f,s=Math.sqrt((i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y));var g=(i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y),L=(2*s*s-g)/(2*s*s);L=L>=1?1:L,L=L<=-1?-1:L,p=180*Math.acos(L)/Math.PI,p=n.x==i.x?t.x>i.x&&r.x>i.x||t.x<i.x&&r.x<i.x?360-p:p:t.y>y*t.x+c&&r.y>y*r.x+c||t.y<y*t.x+c&&r.y<y*r.x+c?360-p:p,dStep=p/72,n.y!=i.y?n.x==i.x?n.y>i.y?r.x<i.x&&(o=!1):r.x>i.x&&(o=!1):n.x<i.x?r.y<y*r.x+c&&(o=!1):r.y>y*r.x+c&&(o=!1):n.x>i.x?r.y>i.y&&(o=!1):r.y<i.y&&(o=!1);var v=(i.y-t.y)/(i.x-t.x),O=v>=0?180*Math.atan(v)/Math.PI:Math.abs(180*Math.atan(v)/Math.PI)+90,P=Math.abs(t.y);i.y==P&&P==n.y&&i.x<n.x&&(O+=180);var b=i.y-t.y;u.push(i);for(var w=1;w<h;w++){a=dStep*w,l=O,o?b>=0?v>=0?l+=a:l=180-(l-90)+a:l=v>0?l-180+a:90-l+a:b>=0?v>=0?l-=a:l=180-(l-90)-a:l=v>=0?l-180-a:90-l-a,l=l*Math.PI/180;var M=t.x+s*Math.cos(l),_=t.y+s*Math.sin(l);u.push(new OpenLayers.Geometry.Point(M,_))}u.push(n)}return u},OpenLayers.Geometry.LineString.createLineEPS=function(e){var t=[],i=e.length;if(null==e||i<2)return e;for(var r=0;r<i;){var n=e[r].type;if("LTypeArc"==n){var s=OpenLayers.Geometry.LineString.createLineArc(t,r,i,e);t=s[0],r=s[1]}else t.push(e[r]),r++}return t},OpenLayers.Geometry.LineString.createLineArc=function(e,t,i,r){if(0==t){var n=OpenLayers.Geometry.LineString.addPointEPS(r,t,i,"LTypeArc");Array.prototype.push.apply(e,n[0]),t=n[1]+1}else if(t==i-1){var s=[r[t-1],r[t]],o=OpenLayers.Geometry.LineString.calculateCircle(s);Array.prototype.push.apply(e,o),t++}else{var n=OpenLayers.Geometry.LineString.addPointEPS(r,t,i,"LTypeArc");e.pop(),Array.prototype.push.apply(e,n[0]),t=n[1]+1}return[e,t]},OpenLayers.Geometry.LineString.createLineCurve=function(e,t,i,r){if(0==t){var n=OpenLayers.Geometry.LineString.addPointEPS(r,t,i,"LTypeCurve");Array.prototype.push.apply(e,n[0]),t=n[1]+1}else if(t==i-1){var s=[r[t-1],r[t]],o=OpenLayers.Geometry.LineString.calculatePointsFBZN(s);Array.prototype.push.apply(e,o),t++}else{var n=OpenLayers.Geometry.LineString.addPointEPS(r,t,i,"LTypeCurve");e.pop(),Array.prototype.push.apply(e,n[0]),t=n[1]+1}return[e,t]},OpenLayers.Geometry.LineString.addPointEPS=function(e,t,i,r){var n=[],s=t+1;if(0==t?Array.prototype.push.apply(n,[e[t],e[t+1]]):t==i-1?Array.prototype.push.apply(n,[e[t-1],e[t]]):Array.prototype.push.apply(n,[e[t-1],e[t],e[t+1]]),"LTypeCurve"==r)var o=OpenLayers.Geometry.LineString.calculatePointsFBZN(n);else if("LTypeArc"==r)var o=OpenLayers.Geometry.LineString.calculateCircle(n);return[o,s]},OpenLayers.Util.clipGeometryRect=function(e,t,i,r){if(e){if(i=void 0==i||i,r=void 0!=r&&r,"OpenLayers.Geometry.LineString"!==e.CLASS_NAME&&"OpenLayers.Geometry.LinearRing"!==e.CLASS_NAME||!(e.components.length>1))return"OpenLayers.Geometry.MultiLineString"===e.CLASS_NAME&&e.components.length>0&&e.components[0].components.length>1?OpenLayers.Util.clipMultiLineStringRect(e,t,i,r):"OpenLayers.Geometry.Polygon"===e.CLASS_NAME&&e.components.length>0&&e.components[0].components.length>2?OpenLayers.Util.clipPolygonRect(e,t,r):"OpenLayers.Geometry.MultiPolygon"===e.CLASS_NAME&&e.components.length>0?OpenLayers.Util.clipMultiPolygonRect(e,t,!0):e;var n=OpenLayers.Util.clipLineStringRect(e,t,i,r);if(n)return 1===n.length?n[0]:new OpenLayers.Geometry.MultiLineString(n)}},OpenLayers.Util.clipLineStringRect=function(e,t,i,r){if(i=void 0==i||i,r=void 0!=r&&r,!t.intersectsBounds(e.getBounds()))return null;if(t.containsBounds(e.getBounds()))return[e];for(var n=e.components,s=[],o=0;o<n.length-1;o++){var a,l=new OpenLayers.Geometry.Point(n[o].x,n[o].y),p=new OpenLayers.Geometry.Point(n[o+1].x,n[o+1].y),h=OpenLayers.Util.clipLineRect(l,p,t);if(2===h.length){if((h[0].x-l.x)*(h[0].x-l.x)+(h[0].y-l.y)*(h[0].y-l.y)>(h[1].x-l.x)*(h[1].x-l.x)+(h[1].y-l.y)*(h[1].y-l.y)){var u=h[0];h[0]=h[1],h[1]=u}i?(a=new OpenLayers.Geometry.LineString(h),s.push(a)):s.push(h[0],h[1])}else 1===h.length?t.contains(l.x,l.y,!1)?i?(a=new OpenLayers.Geometry.LineString([l,h[0]]),s.push(a)):s.push(l,h[0]):t.contains(p.x,p.y,!1)&&(i?(a=new OpenLayers.Geometry.LineString([h[0],p]),s.push(a)):s.push(h[0],p)):0==h.length&&t.contains(l.x,l.y)&&t.contains(p.x,p.y)&&(i?(a=new OpenLayers.Geometry.LineString([l,p]),s.push(a)):s.push(l,p))}if(s.length>0){if(!i){var y=new OpenLayers.Geometry.LineString(s);return r&&(y.id=e.id),y}if(r&&(s[0].id=e.id,s.length>1))for(var o=1;o<s.length;o++)s[o].id=e.id+"_clip_"+o;return s}},OpenLayers.Util.clipMultiLineStringRect=function(e,t,i,r){if(i=void 0==i||i,r=void 0!=r&&r,!t.intersectsBounds(e.getBounds()))return null;if(t.containsBounds(e.getBounds()))return e;for(var n=e.components,s=[],o=0;o<n.length;o++){var a=OpenLayers.Util.clipLineStringRect(n[o],t,i,r);a&&(a instanceof Array?s=s.concat(a):s.push(a))}if(s.length>0){var l=new OpenLayers.Geometry.MultiLineString(s);return r?(l.id=e.id,l):l}},OpenLayers.Util.clipPolygonRect=function(e,t,i){if(!t.intersectsBounds(e.getBounds()))return null;if(t.containsBounds(e.getBounds()))return e;i=void 0!=i&&i;for(var r=[],n=e.components,s=0;s<n.length;s++)if(t.containsBounds(n[s].getBounds()))r.push(n[s]);else{for(var o=OpenLayers.Util.getIntersectLineArray(t,n[s].getBounds()),a=n[s].components,l=a,p=0;p<o.length;p++){a=l,l=[];for(var h=o[p],u=0;u<a.length-1;u++){var y=a[u],c=a[u+1],d=h.components[0],m=h.components[1],f=OpenLayers.Util.lineIntersection(y,c,d,m);0==p&&y.x>=t.left?l.push(y):1===p&&y.y<=t.top?l.push(y):2===p&&y.x<=t.right?l.push(y):3===p&&y.y>=t.bottom&&l.push(y),"OpenLayers.Geometry.Point"===f.CLASS_NAME&&l.push(f)}l.length>0&&l.push(l[0])}if(l.length>2){var g=new OpenLayers.Geometry.LinearRing(l);i&&(g.id=n[s].id),r.push(g)}}if(r.length>0){var L=new OpenLayers.Geometry.Polygon(r);return i?(L.id=e.id,L):L}},OpenLayers.Util.getIntersectLineArray=function(e,t){var i=new OpenLayers.Geometry.Point(e.left,e.bottom<t.bottom?e.bottom:t.bottom),r=new OpenLayers.Geometry.Point(e.left,e.top>t.top?e.top:t.top),n=new OpenLayers.Geometry.LineString([i,r]),s=new OpenLayers.Geometry.Point(e.left<t.left?e.left:t.left,e.top),o=new OpenLayers.Geometry.Point(e.right>t.right?e.right:t.right,e.top),a=new OpenLayers.Geometry.LineString([s,o]),l=new OpenLayers.Geometry.Point(e.right,e.top>t.top?e.top:t.top),p=new OpenLayers.Geometry.Point(e.right,e.bottom<t.bottom?e.bottom:t.bottom),h=new OpenLayers.Geometry.LineString([l,p]),u=new OpenLayers.Geometry.Point(e.right>t.right?e.right:t.right,e.bottom),y=new OpenLayers.Geometry.Point(e.left<t.left?e.left:t.left,e.bottom),c=new OpenLayers.Geometry.LineString([u,y]);return[n,a,h,c]},OpenLayers.Util.lineIntersection=function(e,t,i,r){var n,s,o=null,a=(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x),l=(t.x-e.x)*(e.y-i.y)-(t.y-e.y)*(e.x-i.x),p=(r.y-i.y)*(t.x-e.x)-(r.x-i.x)*(t.y-e.y);if(0!=p)n=a/p,s=l/p,o=n>=0&&s<=1&&n<=1&&s>=0?new OpenLayers.Geometry.Point(e.x+n*(t.x-e.x),e.y+n*(t.y-e.y)):"No Intersection";else if(0==a&&0==l){var h=Math.max(e.y,t.y),u=Math.min(e.y,t.y),y=Math.max(e.x,t.x),c=Math.min(e.x,t.x);o=(i.y>=u&&i.y<=h||r.y>=u&&r.y<=h)&&i.x>=c&&i.x<=y||r.x>=c&&r.x<=y?"Coincident":"Parallel"}else o="Parallel";return o},OpenLayers.Util.clipLineRect=function(e,t,i){var r=[],n=new OpenLayers.Geometry.Point(i.left,i.bottom),s=new OpenLayers.Geometry.Point(i.right,i.top),o=new OpenLayers.Geometry.Point(i.right,i.bottom),a=new OpenLayers.Geometry.Point(i.left,i.top),l=[];l.push(OpenLayers.Util.lineIntersection(n,o,e,t)),l.push(OpenLayers.Util.lineIntersection(o,s,e,t)),l.push(OpenLayers.Util.lineIntersection(s,a,e,t)),l.push(OpenLayers.Util.lineIntersection(a,n,e,t));for(var p=0;p<l.length;)"OpenLayers.Geometry.Point"===l[p].CLASS_NAME&&r.push(l[p]),p++;return r},OpenLayers.Geometry.Point.prototype.calculateParts=function(){},OpenLayers.Geometry.Point.prototype.toJSON=function(e){var t={lon:this.x,lat:this.y};e&&(t=NPMap.T.getPoint(e,t));var i='{"x":  '+t.lon+', "y": '+t.lat+"}";return'{"controlPoints":['+i+'],"CLASS_NAME":"'+this.CLASS_NAME+'"}'},OpenLayers.Geometry.Point.fromJSON=function(json,map){var obj=eval("("+json+")"),point={lon:obj.controlPoints[0].x,lat:obj.controlPoints[0].y};return map&&(point=NPMap.T.setPoint(map,point)),new OpenLayers.Geometry.Point(point.lon,point.lat)},OpenLayers.Layer.prototype.drawFeature=function(e,t){function i(e,t){if(t){var r=document.getElementById(e+"_clip_"+t);t++}else{var r=document.getElementById(e);t=1}r&&(s.renderer.vectorRoot.removeChild(r),i(e,t))}if(this.drawn){if("object"!=typeof t){t||e.state!==OpenLayers.State.DELETE||(t="delete");var r=t||e.renderIntent;t=e.style||this.style,t||(t=this.styleMap.createSymbolizer(e,r))}var n,s=this;if("OpenLayers.Renderer.SVG"===this.renderer.CLASS_NAME||"OpenLayers.Renderer.VML"===this.renderer.CLASS_NAME){var o=e.geometry,a=e;if(o)if(this.renderer.removeText(a.id),this.renderer.removeBackground(o.id),"OpenLayers.Geometry.Collection"===o.CLASS_NAME||"OpenLayers.Geometry.MultiPoint"===o.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"===o.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"===o.CLASS_NAME||o.isMultiPlotting)for(var l=0,p=o.components.length;l<p;l++){var h=o.components[l].id;i(h)}else i(o.id);var u=this.getExtent(),y=u.getWidth(),c=u.getHeight(),d=OpenLayers.Util.clipGeometryRect(e.geometry,new OpenLayers.Bounds(u.left-y,u.bottom-c,u.right+y,u.top+c),!0,!0);e.geometry=d,n=this.renderer.drawFeature(e,t),e.geometry=o,this.renderer.vectorRoot.style.cursor="pointer"}else n=this.renderer.drawFeature(e,t);e.style=t,n===!1||null===n?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id],this.openBubbleAnimate(e)}},function(){NPMapLib.Geometry.Point=function(e,t){this.overlayType=NPMapLib.OVERLAY_TYPE_POINT,this.lon=parseFloat(e),this.lat=parseFloat(t),this.CLASS_NAME="NPMapLib.Geometry.Point"},NPMapLib.Geometry.Point.prototype.equals=function(e){return e instanceof NPMapLib.Geometry.Point&&(this.lon===e.lon&&this.lat===e.lat)},NPMapLib.Geometry.Point.prototype.clone=function(){return new NPMapLib.Geometry.Point(this.lon,this.lat)},NPMapLib.Geometry.Point.prototype.transform=function(e,t){var i=new OpenLayers.Geometry.Point(this.lon,this.lat),r=i.transform(e,t);return new NPMapLib.Geometry.Point(r.x,r.y)},NPMapLib.Geometry.Point.prototype.toString=function(){return this.lon+","+this.lat},NPMapLib.Geometry.Point.prototype.toGeoJson=function(){return{type:"Point",coordinates:[this.lon,this.lat]}}}(),function(){NPMapLib.Geometry.Size=function(e,t){this.width=parseFloat(e),this.height=parseFloat(t),this.CLASS_NAME="NPMapLib.Geometry.Size"},NPMapLib.Geometry.Size.prototype.equals=function(e){return e instanceof NPMapLib.Geometry.Size&&(this.width===e.width&&this.height===e.height)}}(),NPMapLib.MAP_EVENT_CLICK="click",NPMapLib.MAP_EVENT_DBLCLICK="dblclick",NPMapLib.MAP_EVENT_RIGHT_CLICK="rightclick",NPMapLib.MAP_EVENT_MOUSE_MOVE="mousemove",NPMapLib.MAP_EVENT_MOUSE_OVER="mouseover",NPMapLib.MAP_EVENT_MOUSE_OUT="mouseout",NPMapLib.MAP_EVENT_ZOOM_START="zoomstart",NPMapLib.MAP_EVENT_ZOOM_END="zoomend",NPMapLib.MAP_EVENT_ADD_OVERLAY="addoverlay",NPMapLib.MAP_EVENT_REMOVE_OVERLAY="removeoverlay",NPMapLib.MAP_EVENT_CLEAR_OVERLAYS="clearoverlays",NPMapLib.MAP_EVENT_ADD_CONTROL="addcontrol",NPMapLib.MAP_EVENT_REMOVE_CONTROL="removecontrol",NPMapLib.MAP_EVENT_DRAG_START="dragstart",NPMapLib.MAP_EVENT_DRAG_END="dragend",NPMapLib.MAP_EVENT_DRAGGING="dragging",NPMapLib.MAP_EVENT_RESIZE="resize",NPMapLib.MAP_EVENT_ZOOMCHANGE="mapzoomchange",NPMapLib.MAP_EVENT_MOVE_END="moveend",NPMapLib.MAP_EVENT_MOVE_START="movestart",function(){NPMapLib.Map=function(e,t,i){if(this.CLASS_NAME="NPMapLib.Map",this.layers={},this.layerId=1,this._container=e,this._defaultLayer=new NPMapLib.Layers.OverlayLayer("featureLayer"),this._defaultLayer.id=this._getNextLayerId(),this.layers[this._defaultLayer.id]=this._defaultLayer,"number"==typeof i&&i>0?this.id=i:this.id=NPMapLib.Managers.MapManager.getMaxId(),this._mapAdapter=NPMapLib.Adapter.AdapterFactory.createMapAdapter(e,t,this.id),null!==this._mapAdapter&&(NPMapLib.Managers.MapManager.addMap(this),t&&null!=t)){var r=t.zoomOffset;if(r||(r=0),NPMapLib.Utils.BaseUtils.isTypeRight(t.minZoom,"int")){var n=t.minZoom<r?r+t.minZoom:t.minZoom;this.setMinZoom(n)}if(NPMapLib.Utils.BaseUtils.isTypeRight(t.maxZoom,"int")){var s=t.minZoom<r?r+t.maxZoom:t.maxZoom;this.setMaxZoom(s)}this._mapAdapter.addDefaultLayer(this._defaultLayer),this._defaultLayer.mapId=this.id,this.destoryed=!1}},NPMapLib.Map.prototype._getNextLayerId=function(){return this.layerId++},NPMapLib.Map.prototype.getDefaultLayer=function(){return this._defaultLayer},NPMapLib.Map.prototype.getMapId=function(){return this.id},NPMapLib.Map.prototype.enableScrollWheelZoom=function(){this._mapAdapter&&this._mapAdapter.enableScrollWheelZoom()},NPMapLib.Map.prototype.disableScrollWheelZoom=function(){this._mapAdapter&&this._mapAdapter.disableScrollWheelZoom()},NPMapLib.Map.prototype.enableDoubleClickZoom=function(){this._mapAdapter&&this._mapAdapter.enableDoubleClickZoom()},NPMapLib.Map.prototype.disableDoubleClickZoom=function(){this._mapAdapter&&this._mapAdapter.disableDoubleClickZoom()},NPMapLib.Map.prototype.enableKeyboard=function(){this._mapAdapter&&this._mapAdapter.enableKeyboard()},NPMapLib.Map.prototype.disableKeyboard=function(){this._mapAdapter&&this._mapAdapter.disableKeyboard()},NPMapLib.Map.prototype.enableInertialDragging=function(){this._mapAdapter&&this._mapAdapter.enableInertialDragging()},NPMapLib.Map.prototype.disableInertialDragging=function(){this._mapAdapter&&this._mapAdapter.disableInertialDragging()},NPMapLib.Map.prototype.enableBoxSelect=function(e){this._mapAdapter&&this._mapAdapter.enableBoxSelect(e)},NPMapLib.Map.prototype.disableBoxSelect=function(){this._mapAdapter&&this._mapAdapter.disableBoxSelect()},NPMapLib.Map.prototype.enableEditing=function(e){this._mapAdapter&&this._mapAdapter.enableEditing(e)},NPMapLib.Map.prototype.disableEditing=function(){this._mapAdapter&&this._mapAdapter.disableEditing()},NPMapLib.Map.prototype.enableMapOperation=function(){this._mapAdapter&&this._mapAdapter.enableMapOperation()},NPMapLib.Map.prototype.disableMapOperation=function(){this._mapAdapter&&this._mapAdapter.disableMapOperation()},NPMapLib.Map.prototype.setCursor=function(e){this._mapAdapter&&this._mapAdapter.setCursor(e)},NPMapLib.Map.prototype.getCursor=function(){if(this._mapAdapter)var e=this._mapAdapter.getCursor();return e},NPMapLib.Map.prototype.setMinZoom=function(e){this._mapAdapter&&this._mapAdapter.setMinZoom(e)},NPMapLib.Map.prototype.setMaxZoom=function(e){this._mapAdapter&&this._mapAdapter.setMaxZoom(e)},NPMapLib.Map.prototype.enableLayerSwitcher=function(){this._mapAdapter&&this._mapAdapter.enableLayerSwitcher()},NPMapLib.Map.prototype.disableLayerSwitcher=function(){this._mapAdapter&&this._mapAdapter.disableLayerSwitcher()},NPMapLib.Map.prototype.getModifyFeature=function(){if(this._mapAdapter)var e=this._mapAdapter._modifyFeature;return e},NPMapLib.Map.prototype.getExtent=function(){if(this._mapAdapter){var e=this._mapAdapter.getExtent();return NPMapLib.T.getExtent(this,e)}},NPMapLib.Map.prototype.getCenter=function(){if(this._mapAdapter)return NPMapLib.T.getPoint(this,this._mapAdapter.getCenter())},NPMapLib.Map.prototype.getDistance=function(e,t){if(this._mapAdapter)return"EPSG:900913"==this.getProjection()&&(e=NPMap.T.setPoint(this,e),t=NPMap.T.setPoint(this,t)),this._mapAdapter.getDistance(e,t,this.getProjection())},NPMapLib.Map.prototype.getSize=function(){if(this._mapAdapter)return this._mapAdapter.getSize()},NPMapLib.Map.prototype.getZoom=function(){if(this._mapAdapter)return this._mapAdapter.getZoom()},NPMapLib.Map.prototype.getMaxZoom=function(){if(this._mapAdapter)return this._mapAdapter.getMaxZoom()},NPMapLib.Map.prototype.getMinZoom=function(){if(this._mapAdapter)return this._mapAdapter.getMinZoom()},NPMapLib.Map.prototype.getProjection=function(){if(this._mapAdapter)return this._mapAdapter.map.getProjection()},NPMapLib.Map.prototype.centerAndZoom=function(e,t){this._mapAdapter&&this._mapAdapter.centerAndZoom(NPMapLib.T.setPoint(this,e),t)},NPMapLib.Map.prototype.pan=function(){this._mapAdapter&&this._mapAdapter.pan()},NPMapLib.Map.prototype.panTo=function(e){this._mapAdapter&&this._mapAdapter.panTo(NPMapLib.T.setPoint(this,e))},NPMapLib.Map.prototype.panByPixel=function(e,t){this._mapAdapter&&this._mapAdapter.panByPixel(e,t)},NPMapLib.Map.prototype.reset=function(){this._mapAdapter&&this._mapAdapter.reset()},NPMapLib.Map.prototype.setCenter=function(e,t){this._mapAdapter&&this._mapAdapter.setCenter(NPMapLib.T.setPoint(this,e),t)},NPMapLib.Map.prototype.switchLayer=function(e){this._mapAdapter&&this._mapAdapter.switchLayer(e)},NPMapLib.Map.prototype.switchLayerByName=function(e){this._mapAdapter&&this._mapAdapter.switchLayerByName(e)},NPMapLib.Map.prototype.setZoom=function(e){this._mapAdapter&&this._mapAdapter.setZoom(e)},NPMapLib.Map.prototype.fullExtent=function(e){this._mapAdapter&&this._mapAdapter.fullExtent(e)},NPMapLib.Map.prototype.zoomIn=function(){this._mapAdapter&&this._mapAdapter.zoomIn()},NPMapLib.Map.prototype.zoomOut=function(){this._mapAdapter&&this._mapAdapter.zoomOut()},NPMapLib.Map.prototype.zoomInOutStop=function(){this._mapAdapter&&this._mapAdapter.zoomInOutStop()},NPMapLib.Map.prototype.zoomInFixed=function(){this._mapAdapter&&this._mapAdapter.zoomInFixed()},NPMapLib.Map.prototype.zoomOutFixed=function(){this._mapAdapter&&this._mapAdapter.zoomOutFixed()},NPMapLib.Map.prototype.zoomToExtent=function(e,t,i){this._mapAdapter&&this._mapAdapter.zoomToExtent(NPMapLib.T.setExtent(this,e),t,i)},NPMapLib.Map.prototype.zoomTo=function(e,t){this._mapAdapter&&this._mapAdapter.zoomTo(NPMapLib.T.setPoint(this,e),t)},NPMapLib.Map.prototype.updateSize=function(){this._mapAdapter&&this._mapAdapter.updateSize()},NPMapLib.Map.prototype.centerAtMouse=function(){this._mapAdapter&&this._mapAdapter.centerAtMouse()},NPMapLib.Map.prototype.addControl=function(e){this._mapAdapter&&e&&e.id&&(NPMapLib.Managers.ControlManager.getControl(e.id)||(e.mapId=this.id,e.visible||e.show(),NPMapLib.Managers.ControlManager.addControl(e)))},NPMapLib.Map.prototype.removeControl=function(e){this._mapAdapter&&e&&e.id&&(e.hide(),e.mapId=-1,NPMapLib.Managers.ControlManager.removeControl(e.id))},NPMapLib.Map.prototype.addHandStyle=function(){this._mapAdapter&&this._mapAdapter.addHandStyleForMap()},NPMapLib.Map.prototype.removeHandStyle=function(){this._mapAdapter&&this._mapAdapter.deleteHandStyleForMap()},NPMapLib.Map.prototype.addJWMousePostion=function(){this._mapAdapter&&this._mapAdapter.addJWMousePosition()},NPMapLib.Map.prototype.removeJWMousePostion=function(){this._mapAdapter&&this._mapAdapter.removeJWMousePostion()},NPMapLib.Map.prototype.activateMouseContext=function(e,t){this._mapAdapter&&(e=e?e:"按住鼠标左键拖选区域<br>释放完成绘制",this._mapAdapter.activateMouseContext(e,t))},NPMapLib.Map.prototype.deactivateMouseContext=function(){this._mapAdapter&&this._mapAdapter.deactivateMouseContext()},NPMapLib.Map.prototype.getMouseContextStyle=function(){if(this._mapAdapter)return this._mapAdapter.getMouseContextStyle()},NPMapLib.Map.prototype.getMouseContextElement=function(){if(this._mapAdapter)return this._mapAdapter.getMouseContextElement()},NPMapLib.Map.prototype.setMouseContextStyle=function(e){this._mapAdapter&&this._mapAdapter.setMouseContextStyle(e)},NPMapLib.Map.prototype.getContainer=function(){if(this._mapAdapter)return this._container},NPMapLib.Map.prototype.addOverlay=function(e){if(this._mapAdapter&&e&&e instanceof NPMapLib.Overlay){if(this._defaultLayer.addOverlay(e),e.isEnableContextMenu&&e.MenuList){var t=this._mapAdapter;t.addEventListener(e,NPMapLib.MAP_EVENT_RIGHT_CLICK,function(){t.showMenu(e)})}return!0}},NPMapLib.Map.prototype.addOverlays=function(e){this._mapAdapter&&NPMapLib.Utils.BaseUtils.isTypeRight(e,"Array")&&this._defaultLayer.addOverlays(e)},NPMapLib.Map.prototype.removeOverlay=function(e){if(this._mapAdapter&&e&&e instanceof NPMapLib.Overlay)return"NPMapLib.Symbols.InfoWindow"===e.CLASS_NAME?void this._mapAdapter.removeOverlay(e):void this._defaultLayer.removeOverlay(e)},NPMapLib.Map.prototype.removeOverlays=function(e){if(this._mapAdapter&&NPMapLib.Utils.BaseUtils.isTypeRight(e,"Array"))for(var t=0;t<e.length;t++)this.removeOverlay(e[t])},NPMapLib.Map.prototype.removeOverlayList=function(e){this._defaultLayer.removeOverlayList(e)},NPMapLib.Map.prototype.getOverlays=function(){if(this._mapAdapter)return this._mapAdapter.getOverlays()},NPMapLib.Map.prototype.clearOverlays=function(){this._mapAdapter&&(this._mapAdapter.clearOverlays(),this._defaultLayer.removeAllOverlays())},NPMapLib.Map.prototype.getInfoWindows=function(){if(this._mapAdapter)return this._mapAdapter.getInfoWindow()},NPMapLib.Map.prototype.closeAllInfoWindows=function(){var e=this.getInfoWindows();if(e)for(var t=e.length-1;t>=0;t--)e[t].close()},NPMapLib.Map.prototype.addContextMenu=function(e){var t=this;this.addEventListener("rightclick",function(i,r){var n=t.pointToPixel(i);t._mapAdapter.showMapMenu(n,e,r)})},NPMapLib.Map.prototype.removeContextMenu=function(e){var t=this;this.removeEventListener("rightclick",function(i,r){var n=t.pointToPixel(i);t._mapAdapter.showMapMenu(n,e,r)})},NPMapLib.Map.prototype.addLayer=function(e){if("NPMapLib.Layers.NPLayer"===e.CLASS_NAME){if(e.opts&&e.opts.layerInfo)this.initMapLayer(e.opts.layerInfo,e);else{var t=this._addNPLayer(e,this.initMapLayer);this.destroyRequest(t)}this.layers[e.id]||(e.id=e.id&&e.id!==-1?e.id:this._getNextLayerId(),this.layers[e.id]=e)}else{if(e instanceof NPMapLib.Layers.ArcgisTileLayer?EzServerClient.GlobeParams.MyMapType=NPMapLib.MAPTYPE_ARCGISTILE:e instanceof NPMapLib.Layers.EzMapTileLayer&&(EzServerClient.GlobeParams.MyMapType=NPMapLib.MAPTYPE_PGIS),!this._mapAdapter)return;if(this.layers[e.id]||(e.id=e.id&&e.id!==-1?e.id:this._getNextLayerId(),this.layers[e.id]=e),"NPMapLib.Layers.ArcgisTileLayer"===e.CLASS_NAME)if(e.opts&&e.opts.layerInfo)this.initArcgisLayer(e.opts.layerInfo,e);else if(e.opts&&e.opts.resolutions)this._mapAdapter.addLayer(e),e.mapId=this.id,e.setMap(this);else{var t=this._addNPLayer(e,this.initArcgisLayer);this.destroyRequest(t)}else this._mapAdapter.addLayer(e),e.mapId=this.id,e.setMap(this)}},NPMapLib.Map.prototype.initArcgisLayer=function(e,t){var i=e.tileInfo;if(i.lods)for(var r=0;r<i.lods.length;r++)t.resolutions.push(i.lods[r].resolution);i.rows&&(t.tilePixels=i.rows),i.origin&&(t.origin=[],t.origin.push(i.origin.x),t.origin.push(i.origin.y)),e.fullExtent&&(t.fullExtent.push(e.fullExtent.xmin),t.fullExtent.push(e.fullExtent.ymin),t.fullExtent.push(e.fullExtent.xmax),t.fullExtent.push(e.fullExtent.ymax)),i.spatialReference&&(t.projection="EPSG:"+i.spatialReference.wkid),i.format&&(t.type="jpg"),t._opts={isBaseLayer:t.isBaseLayer,resolutions:t.resolutions,tilePixels:t.tilePixels,origin:t.origin,fullExtent:t.fullExtent,projection:t.projection,zoomOffset:0},this._mapAdapter.addLayer(t),t.mapId=this.id,t.setMap(this)},NPMapLib.Map.prototype.initMapLayer=function(e,t){if(e.layerType&&(t.layerType=e.layerType),e.fullExtent)for(var i=0;i<e.fullExtent.length;i++)t.fullExtent.push(e.fullExtent[i]);e.type&&(t.type=e.type),e.centerPoint&&(t.centerPoint=e.centerPoint);var r=null,n=t.url+"/getTile?";switch(t.layerType){case"tiandi":case"NPMapLib.Layers.TDMapLayer":t._opts={mapType:t.type,centerPoint:t.centerPoint,fullExtent:t.fullExtent,topLevel:0,bottomLevel:18,isBaseLayer:t.isBaseLayer,zoomOffset:0},t._opts.fullExtent=[-180,-90,180,90],r=new NPMapLib.Layers.TDMapLayer(n,t.name,t._opts);break;case"gaode":case"NPMapLib.Layers.GaoDeLayer":t._opts={centerPoint:t.centerPoint,fullExtent:t.fullExtent,isBaseLayer:t.isBaseLayer},r=new NPMapLib.Layers.GaoDeLayer(n,t.name,t._opts);break;case"google":case"NPMapLib.Layers.GoogleOffLineLayer":t._opts={isOnline:!0,centerPoint:t.centerPoint,fullExtent:t.fullExtent,isBaseLayer:t.isBaseLayer},r=new NPMapLib.Layers.GoogleOffLineLayer(n,t.name,t._opts);break;case"baidu":case"baiduVector":case"NPMapLib.Layers.BaiduTileLayer":t._opts={centerPoint:t.centerPoint,fullExtent:t.fullExtent,isBaseLayer:t.isBaseLayer},"baiduVector"===t.layerType&&(n+="format=jsonp&",t._opts.isVectorLayer=!0),n+="X=${x}&Y=${y}&L=${z}",r=new NPMapLib.Layers.BaiduTileLayer(n,t.name,t._opts);break;case"streetmap":case"NPMapLib.Layers.OSMLayer":n+="X=${x}&Y=${y}&L=${z}",r=new NPMapLib.Layers.OSMLayer(n,t.name,{isChina:!1,centerPoint:t.centerPoint,isBaseLayer:t.isBaseLayer});break;case"pgis":case"NPMapLib.Layers.EzMapTileLayer":n+="X=${x}&Y=${y}&L=${z}",r=new NPMapLib.Layers.EzMapTileLayer(n,"矢量影像地图",{centerPoint:t.centerPoint})}r&&(this._mapAdapter.addLayer(r),r.mapId=this.id,r.setMap(this),t._apiObj=r._apiObj,t.mapId=this.id,t.setMap(this))},NPMapLib.Map.prototype._addNPLayer=function(layer,callback){OpenLayers.Request.GET({url:layer.url+"?f=pjson",async:!1,scope:this,success:function(reply){var layerInfo=eval("("+reply.responseText+")");callback.call(this,layerInfo,layer)}})},NPMapLib.Map.prototype.destroyRequest=function(e){},NPMapLib.Map.prototype.addLayers=function(e){if(this._mapAdapter)for(var t=0;t<e.length;t++)this.addLayer(e[t]);
},NPMapLib.Map.prototype.removeLayer=function(e){this._mapAdapter&&(e.clusterStrategy&&e.clusterStrategy.deactivate(),this._mapAdapter.removeLayer(e))},NPMapLib.Map.prototype.removeLayerByName=function(e){if(this._mapAdapter){var t=this.getLayerByName(e);t&&t.clusterStrategy&&t.clusterStrategy.deactivate(),this._mapAdapter.removeLayerByName(e)}},NPMapLib.Map.prototype.getLayer=function(e){if(this._mapAdapter)return this.layers[e]},NPMapLib.Map.prototype.getLayerByName=function(e){if(this._mapAdapter)for(var t in this.layers)if(this.layers[t]._apiObj.name===e)return this.layers[t]},NPMapLib.Map.prototype.getVisibleLayers=function(){if(this._mapAdapter){var e=[];for(var t in this.layers)this.layers[t]._apiObj.visibility&&e.push(this.layers[t]);return e}},NPMapLib.Map.prototype.setBaseLayer=function(e){this._mapAdapter&&this._mapAdapter.setBaseLayer(e)},NPMapLib.Map.prototype.setVisibilityDefalutLayer=function(e){this._mapAdapter&&this._mapAdapter.setVisibilityDefalutLayer(e)},NPMapLib.Map.prototype.containFeatures=function(e,t,i){return this.layer.containFeatures(e,t,i)},NPMapLib.Map.prototype.pixelToPoint=function(e){if(this._mapAdapter)return NPMapLib.T.getPoint(this,this._mapAdapter.pixelToPoint(e))},NPMapLib.Map.prototype.pointToPixel=function(e){if(this._mapAdapter)return this._mapAdapter.pointToPixel(NPMapLib.T.setPoint(this,e))},NPMapLib.Map.prototype.addEventListener=function(e,t){this._mapAdapter&&this._mapAdapter.addEventListener(this,e,t)},NPMapLib.Map.prototype.removeEventListener=function(e){this._mapAdapter&&this._mapAdapter.removeEventListener(this,e)},NPMapLib.Map.prototype.containsPoint=function(e,t){return this._mapAdapter.containsPoint(e,t)},NPMapLib.Map.prototype.getMapUnits=function(){if(this._mapAdapter)return this._mapAdapter.getMapUnits()},NPMapLib.Map.prototype.setDefaultMapCursor=function(e){if(this._mapAdapter)return this._mapAdapter.setDefaultMapCursor(e)},NPMapLib.Map.prototype.getAllLayers=function(){return this.layers},NPMapLib.Map.prototype.destroyMap=function(){if(!this.destoryed){for(var e in this.layers){var t=this.layers[e];t instanceof NPMapLib.Layers.OverlayLayer&&(t.removeAllOverlays(),this.layers[e]=null)}this.layers=null,NPMapLib.Adapter.AdapterFactory.getAdapters()[this._container.id]=null,this._mapAdapter.map.destroy(),this._mapAdapter=null,this.destoryed=!0}},NPMapLib.Map.prototype.getTitleSize=function(){if(this._mapAdapter){var e=this._mapAdapter.map.tileSize;return new NPMapLib.Geometry.Size(e.w,e.h)}},NPMapLib.Map.prototype.getVersion=function(){return NPMapLib.VERSION_NUMBER},NPMapLib.Map.prototype.setFallThrough=function(e){this._mapAdapter&&(this._mapAdapter.map.events.fallThrough=e)},NPMapLib.Map.prototype.getRestrictedExtent=function(){return NPMapLib.T.getExtent(this,this._mapAdapter.map.restrictedExtent)},NPMapLib.Map.prototype.setMapStyle=function(e,t){this._mapAdapter&&(e instanceof Array&&(e={styleJson:e}),this._mapAdapter.setMapStyle(e,t))},NPMapLib.Map.prototype.getMapTileUrl=function(e){var t=this.pointToPixel(e),i=this.getTitleSize().width,r=t.x-i/3,n=t.y-i/3,s=t.x+i/3,o=t.y+i/3,a=NPMapLib.T.setPoint(this,this.pixelToPoint({x:r,y:n})),l=NPMapLib.T.setPoint(this,this.pixelToPoint({x:s,y:o})),p=new OpenLayers.Bounds(a.lon,l.lat,l.lon,a.lat);return this._mapAdapter.map.baseLayer.getURL(p)},NPMapLib.Map.prototype.setLanguage=function(e){NPMap.CULTURE=e},NPMapLib.Map.prototype.setDistricts=function(e,t,i,r){var n=this._mapAdapter.map.layers,s=e,o=[],a=null;if(o.projection=this.getProjection(),o.minZoom=t||6,o.maxZoom=i||13,r=r||{},s.center){var l=JSON.parse(s.center).coordinates;o.center={lon:l[0],lat:l[1]}}for(var p=n.length-1;p>=0;p--)n[p].isVectorLayer&&(a=n[p]);if(a&&"OpenLayers.Layer.gaode"==a.CLASS_NAME){o.baseLayer="OpenLayers.Layer.gaode",s.districts||(s.districts=[{geometry:s.geometry}]),s.districts.push({geometry:s.geometry,name:"边界",center:s.center,level:s.level});for(var p=s.districts.length-1;p>=0;p--){for(var h=s.districts[p],u=r[h.name]||"rgba("+[(255*Math.random()).toFixed(0),(255*Math.random()).toFixed(0),(255*Math.random()).toFixed(0),.4].join(",")+")",y={fillStyle:u,name:h.name,regions:{},keys:{}},c=h.geometry.coordinates.length-1;c>=0;c--){for(var d=h.geometry.coordinates[c],m=[],f=d.length-1;f>=0;f--)for(var g=d[f].length-1;g>=0;g--)m.push({x:d[f][g][0],y:d[f][g][1]});for(var m=simplify?simplify(m,8e-4,!1):m,g=o.minZoom;g<=o.maxZoom;g++){var L=[];m.map(function(e,t){var i=a.getXY(e,g);y.keys[i.key]=!0,0==L.length?L.push({key:i.key,location:i.location,points:[i.points]}):L[L.length-1].key==i.key?L[L.length-1].points.push(i.points):L.push({key:i.key,location:i.location,points:[i.points]})}),y.regions[g]||(y.regions[g]=[]),y.regions[g].push(L)}}o.push(y)}return window.setTimeout(function(){a.districts=o,a.updateLayer()},50),o}},NPMapLib.Map.prototype.mapToImage=function(e){var t=exports.html2canvas||window.html2canvas;if(!t)throw"html2canvas 方法未找到！";t(this._mapAdapter._container,{logging:!1,foreignObjectRendering:!0}).then(function(t){if(e&&e(t),!e){var i=t.toDataURL("image/png"),r=window.open("about:blank","image from canvas");r.document.write("<img src='"+i+"' alt='from canvas'/>")}})}}(),function(){var e=NPMapLib.Map,t=0;e.registry={},e.register=function(i){var r="c"+ ++t;return e.registry[r]=function(){i.apply(this,arguments)},r},e.unregister=function(t){delete e.registry[t]}}(),function(){NPMapLib.Events=function(e,t){this.CLASS_NAME="NPMapLib.Events",this.obj=e,this.listeners={},this.supportEvents=t||[],this.through=!0},NPMapLib.Events.prototype._internalEvent=["_register","_unregister"]}(),NPMapLib.Events.prototype={setSupportEvent:function(e){this.supportEvents=e||[]},supportEvent:function(e){var t=!1;return this.obj.suppertEvent&&(t=this.obj.suppertEvent(e)),t||this.supportEvents.indexOf(e)>=0||this._internalEvent.indexOf(e)>=0},register:function(e,t,i){if(this.supportEvent(e)){var r=this.listeners[e];r?r.push({f:t,s:i}):(this.triggerEvt("_register",{eventType:e}),this.listeners[e]=[{f:t,s:i}])}},unregister:function(e,t){var i=this.listeners[e];if(i){for(var r=-1,n=0,s=i.length;n<s;++n)if(i[n].f===t){r=n;break}r>=0&&i.pop(t),i.length<=0&&this.triggerEvt("_unregister",{eventType:e})}},triggerEvt:function(e,t){var i=this.listeners[e];if(i&&i.length>0){t=t||{},t.srcObject=this.obj,t.eventType||(t.eventType=e);for(var r=0,n=i.length;r<n&&(i[r].f.call(i[r].s,t)!==!1&&this.through);++r);}}},function(){NPMapLib.Layer=function(){this.CLASS_NAME="NPMapLib.Layer",this.isAddToMap=!0,this.id=-1,this.mapId=null,this.url,this.name="Not Set",this.visible=!0,this.minLevel=0,this.maxLevel=0,this.map=null},NPMapLib.Layer.prototype.getUrl=function(){return this.url},NPMapLib.Layer.prototype.setUrl=function(e){this instanceof NPMapLib.Layers.OverlayLayer||(this.url=e,this._apiObj&&this._apiObj.setUrl(e))},NPMapLib.Layer.prototype.isVisible=function(){return this.visible},NPMapLib.Layer.prototype.setName=function(e){this.name=e},NPMapLib.Layer.prototype.getName=function(){return this.name},NPMapLib.Layer.prototype.setMinLevel=function(e){this.minLevel=e},NPMapLib.Layer.prototype.getMinLevel=function(){return this.minLevel},NPMapLib.Layer.prototype.setMaxLevel=function(e){this.maxLevel=e},NPMapLib.Layer.prototype.getMaxLevel=function(){return this.maxLevel},NPMapLib.Layer.prototype.show=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.showLayer(this)},NPMapLib.Layer.prototype.hide=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.hideLayer(this)},NPMapLib.Layer.prototype.clearTiles=function(){if(!(this instanceof NPMapLib.Layers.OverlayLayer)){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.clearTiles(this)}},NPMapLib.Layer.prototype.getZIndex=function(){if(this._apiObj)return parseInt(this._apiObj.getZIndex())},NPMapLib.Layer.prototype.setZIndex=function(e){this._apiObj&&this._apiObj.setZIndex(e)},NPMapLib.Layer.prototype.setMap=function(e){this.map=e},NPMapLib.Layer.prototype.getVisible=function(){return this._apiObj?this._apiObj.visibility:this.visible},NPMapLib.Layer.prototype.refresh=function(){this instanceof NPMapLib.Layers.OverlayLayer||this._apiObj&&(this._apiObj.clearGrid(),this._apiObj.redraw());var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e&&this._apiObj&&this._apiObj.features)for(var t=this._apiObj.features,i=0;i<t.length;i++)t[i].style=e.getOverlayStyle(t[i].data),this._apiObj.drawFeature(t[i])}}(),function(){NPMapLib.Layers.EzMapOffLineLayer=function(e,t,i){this._opts=i,this.url=e,this.name=t,this.CLASS_NAME="NPMapLib.Layers.EzMapOffLineLayer"},NPMapLib.Layers.EzMapOffLineLayer.prototype=new NPMapLib.Layer}(),function(){var e=NPMapLib.Layers.EzMapTileLayer=function(e,t,i){if(this.url=e,this.name=t,this._opts={units:"Lat-66",type:"png",tileOrigin:[0,0],isBaseLayer:!0},i){i.projection="EPSG:4326";for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];void 0!==n&&(this._opts[r]=n)}}this.CLASS_NAME="NPMapLib.Layers.EzMapTileLayer"};e.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.GoogleMapTileLayer=function(e,t,i){this.url=e,this.name=t,this._opts=i||{},this._opts.projection="EPSG:900913",this._opts.displayProjection="EPSG:4326",this.CLASS_NAME="NPMapLib.Layers.GoogleMapTileLayer",this._opts.fullExtent=[-20037508.34,-20037508.34,20037508.34,20037508.34],this._opts.numZoomLevels=22,NPMap.PROJECT="900913_CHINA"},NPMapLib.Layers.GoogleMapTileLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.GoogleOffLineLayer=function(e,t,i){if(this.url=e,this.name=t,this._opts={type:"png",fullExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],minLevel:0,maxLevel:6,zoomOffset:13,zoomLevelSequence:2,numZoomLevels:22},i)for(var r in i){if(i.hasOwnProperty(r))var n=i[r];void 0!==n&&(this._opts[r]=n)}NPMap.PROJECT="900913_CHINA",this.CLASS_NAME="NPMapLib.Layers.GoogleOffLineLayer"},NPMapLib.Layers.GoogleOffLineLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.ArcgisTileLayer=function(e,t,i){this.url=e,this.name=t,i&&"boolean"==typeof i.isBaseLayer?this.isBaseLayer=i.isBaseLayer:this.isBaseLayer=!0,this.opts=i,this.resolutions=[],this.tilePixels=512,this.origin=[-400,400],this.fullExtent=[],this.projection="EPSG:4326",this.type="jpg",this.CLASS_NAME="NPMapLib.Layers.ArcgisTileLayer"},NPMapLib.Layers.ArcgisTileLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.WMSLayer=function(e,t,i){if(this.name=t,this.url=e,this._opts={projection:"EPSG:4326",tiled:!0,format:"image/png",mapUnitPixels:256,buffer:2,reproject:!0},i)for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];void 0!==n&&(this._opts[r]=n)}this.CLASS_NAME="NPMapLib.Layers.WMSLayer"},NPMapLib.Layers.WMSLayer.prototype=new NPMapLib.Layer}(),function(){var e=NPMapLib.Layers.VectorGMLLayer=function(e,t,i){this.url=e,this.name=t,this._opts=i,this.CLASS_NAME="NPMapLib.Layers.VectorGMLLayer"};e.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.OverlayLayer=function(e,t,i){this.CLASS_NAME="NPMapLib.Layers.OverlayLayer",this.name=e,this._overlays={},this.clusterFeature=[],this.useCluster=!!t&&t,i=i?i:{},this.opts=i,this.onmouseover=i.mouseover?i.mouseover:function(){},this.onmouseout=i.mouseout?i.mouseout:function(){},this.onSelect=i.click?i.click:function(){},this.clusteronmouseover=i.clusteronmouseover?i.clusteronmouseover:function(){},this.maxZoom=null,this.distance=200,this.selectZoom=null,this.isAsynchronous=!0,this.labelYOffset=null,this.minZoom=null,this.statistics=[],this.groups={},this.minClusterCount=0,this.isCommonCluster=!0,this.customLabelOffset=null,this.useCluster&&(this.getUrl=i.getUrl?i.getUrl:function(e){return"/images/Flag_Red.png"},this.getImageSize=i.getImageSize?i.getImageSize:function(e){return{width:20,height:20}},this.getContent=i.getContent?i.getContent:function(){return""},this.getCustomLabelOffset=i.getCustomLabelOffset,this.getRotation=i.getRotation?i.getRotation:function(){},this.getBackGroundColor=i.getBackGroundColor?i.getBackGroundColor:function(){},this.getClusterBGColor=i.getClusterBGColor?i.getClusterBGColor:function(){},this.getClusterBGStroke=i.getClusterBGStroke?i.getClusterBGStroke:function(){},this.getBackGroundStroke=i.getBackGroundStroke?i.getBackGroundStroke:function(){},this.labelBackGroundRXY=i.labelBackGroundRXY?i.labelBackGroundRXY:0,this.labelBackGroundMargin=i.labelBackGroundMargin?i.labelBackGroundMargin:0,this.clusterClickModel=i.clusterClickModel?i.clusterClickModel:"zoom",i.maxZoom&&(this.maxZoom=i.maxZoom),this.showOrHideArrow=i.showOrHideArrow?i.showOrHideArrow:function(){return!1},this.defaultStyle={fontColor:"white"},i.fontColor&&(this.defaultStyle.fontColor=i.fontColor),i.getFontColor&&(this.getFontColor=i.getFontColor),i.getFontSize&&(this.getFontSize=i.getFontSize),i.customLabelFontColor&&(this.defaultStyle.customLabelFontColor=i.customLabelFontColor),i.customFontSize&&(this.defaultStyle.customFontSize=i.customFontSize),i.fontSize&&(this.defaultStyle.fontSize=i.fontSize),i.distance&&(this.distance=i.distance),i.selectZoom&&(this.selectZoom=i.selectZoom),"boolean"==typeof i.isAsynchronous&&(this.isAsynchronous=i.isAsynchronous),i.labelYOffset&&(this.labelYOffset=i.labelYOffset),i.minZoom&&(this.minZoom=i.minZoom),i.statistics&&(this.statistics=i.statistics),i.minClusterCount&&(this.minClusterCount=i.minClusterCount),i.isCommonCluster===!1&&(this.isCommonCluster=i.isCommonCluster),i.customLabelOffset&&(this.customLabelOffset=i.customLabelOffset),i.labelBackgroundColor&&(this.defaultStyle.labelBackgroundColor=i.labelBackgroundColor),i.threshold&&(this.threshold=i.threshold),i.isHideContext&&(this.isHideContext=i.isHideContext),i.getTitle=i.getTitle||function(){})},NPMapLib.Layers.OverlayLayer.prototype=new NPMapLib.Layer,NPMapLib.Layers.OverlayLayer.prototype.addOverlay=function(e,t){if(NPMapLib.Utils.BaseUtils.isTypeRight(e,"NPMapLib.Overlay")){var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&(this.useCluster&&(this.opts.success=t,e.opts=this.opts,this._overlays={}),i.addOverlay(e,this),e.mapId=this.mapId,e._layer=this,this._overlays[e.id]=e,e.isEnableContextMenu&&e.MenuList&&e.addEventListener("rightclick",function(t,r){i.showMenu(e)}))}},NPMapLib.Layers.OverlayLayer.prototype.addOverlays=function(e){if(NPMapLib.Utils.BaseUtils.isTypeRight(e,"Array"))for(var t=0;t<e.length;t++)this.addOverlay(e[t])},NPMapLib.Layers.OverlayLayer.prototype.getOverlays=function(){return this._overlays},NPMapLib.Layers.OverlayLayer.prototype.getOverlaysArry=function(){var e=[];for(var t in this._overlays)this._overlays.hasOwnProperty(t)&&e.push(this._overlays[t]);return e},NPMapLib.Layers.OverlayLayer.prototype._findOverlaysByExtent=function(e,t){t=t?t:function(e){return!0};var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId),r=[];if(!i)return r;e=NPMapLib.T.setExtent(i,e);var n=new OpenLayers.Bounds([e.sw.lon,e.sw.lat,e.ne.lon,e.ne.lat]);for(var s in this._overlays)if(this._overlays.hasOwnProperty(s))if(this._overlays[s]instanceof NPMapLib.Symbols.ClusterPoints)for(var o=this._overlays[s].dataJson.length-1;o>=0;o--){var a=NPMapLib.T.setPoint(i,this._overlays[s].dataJson[o].location);n.contains(a.lon,a.lat)&&t(this._overlays[s].dataJson[o])&&r.push(this._overlays[s].dataJson[o])}else this._overlays[s]._apiObj&&n.intersectsBounds(this._overlays[s]._apiObj.geometry.bounds)&&t(this._overlays[s])&&r.push(this._overlays[s]);return r},NPMapLib.Layers.OverlayLayer.prototype._findOverlaysByGeometry=function(e,t){t=t?t:function(e){return!0};var i=[],r=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId),n=e._apiObj?e._apiObj.geometry:FeatureFacatroy.createOverlay(e,r).geometry;if(n&&r)for(var s in this._overlays)if(this._overlays.hasOwnProperty(s))if(this._overlays[s]instanceof NPMapLib.Symbols.ClusterPoints)for(var o=this._overlays[s].dataJson.length-1;o>=0;o--){var a=NPMapLib.T.setPoint(r,this._overlays[s].dataJson[o].location),l={x:a.lon,y:a.lat};n.containsPoint(l)&&t(this._overlays[s].dataJson[o])&&i.push(this._overlays[s].dataJson[o])}else this._overlays[s]._apiObj&&n.intersects(this._overlays[s]._apiObj.geometry)&&t(this._overlays[s])&&i.push(this._overlays[s]);return i},NPMapLib.Layers.OverlayLayer.prototype.containFeatures=function(e,t){return e instanceof NPMapLib.Geometry.Extent?this._findOverlaysByExtent(e,t):this._findOverlaysByGeometry(e,t)},NPMapLib.Layers.OverlayLayer.prototype.getOverlay=function(e){return this._overlays[e]},NPMapLib.Layers.OverlayLayer.prototype.getOverlaysByProperty=function(e,t){var i=[];for(var r in this._overlays)if(this._overlays[r]instanceof NPMapLib.Symbols.ClusterPoints)for(var n=0;n<this._overlays[r].dataJson.length;n++)this._overlays[r].dataJson[n].getData()[e]===t&&i.push(this._overlays[r].dataJson[n]);else this._overlays[r].getData()&&this._overlays[r].getData()[e]===t&&i.push(this._overlays[r]);return i},NPMapLib.Layers.OverlayLayer.prototype.removeOverlay=function(e){if(e)if(this._overlays[e]){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t.removeOverlay(this._overlays[e]),t.removeOverlayEvent(this._overlays[e]),this._overlays[e].mapId=null,this._overlays[e]._apiObj=null,delete this._overlays[e]}else{var i=e.id;this._overlays[i]&&this.removeOverlay(i)}},NPMapLib.Layers.OverlayLayer.prototype.removeAllOverlays=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e){e.removerAllOverlaysByLayerName(this.name);for(var t in this._overlays){if(this.useCluster&&this._overlays[t]instanceof NPMapLib.Symbols.ClusterPoints)for(var i=this._overlays[t].dataJson,r=0;r<i.length;r++)i[r]._apiObj=null,i[r]=null,delete i[r];e.removeOverlayEvent(this._overlays[t]),"NPMapLib.Symbols.InfoWindow"!==this._overlays[t].CLASS_NAME?(this._overlays[t].mapId=null,this._overlays[t]._apiObj=null,this._overlays[t]=null,delete this._overlays[t]):(this._overlays[t]._isOpen&&this._overlays[t].close(),this._overlays[t]=null,delete this._overlays[t])}this.clusterStrategy&&(this.clusterStrategy.features=null,this.clusterStrategy._clusterDataStatus=[],this.clusterStrategy.clusters=[],this.clusterStrategy.oldClusters=[],this.clusterStrategy.previousClusters=[],this.clusterStrategy._xData=[]),this._overlays={}}},NPMapLib.Layers.OverlayLayer.prototype.show=function(){this.visible=!0;var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.showLayer(this)},NPMapLib.Layers.OverlayLayer.prototype.hide=function(){this.visible=!1;var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.hideLayer(this)},NPMapLib.Layers.OverlayLayer.prototype.refresh=function(){this.useCluster?this.clusterStrategy&&(this.clusterStrategy.currentZoom=-1,this.clusterStrategy.cluster({type:"moveend",zoomChanged:!0})):NPMapLib.Layer.prototype.refresh.apply(this)},NPMapLib.Layers.OverlayLayer.prototype.setMakrerTypeVisiable=function(e,t){if(this.useCluster){"string"==typeof t&&(t="True"==t);var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.setMakrerTypeVisiable(this,e,t)}},NPMapLib.Layers.OverlayLayer.prototype.addClusterPoints=function(e){if(this._apiObj.removeFeatures(this.clusterFeature,{silent:!0}),this.clusterFeature=[],this.useCluster&&e&&e.cluster&&e.cluster instanceof Array){for(var t=0;t<e.cluster.length;t++)e.cluster[t]._apiObj||(e.cluster[t]._apiObj=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e.cluster[t].geometry.x,e.cluster[t].geometry.y),e.cluster[t])),e.cluster[t]._apiObj.style=e.cluster[t].style,this.clusterFeature.push(e.cluster[t]._apiObj);this._apiObj.addFeatures(this.clusterFeature,{silent:!0})}},NPMapLib.Layers.OverlayLayer.prototype.setClusterStatistics=function(e){if(this.statistics=e,this.clusterStrategy){for(var t=[],i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId),r=this.statistics,n=r.length-1;n>=0;n--){var s=NPMapLib.T.setPoint(i,{lon:r[n].x,lat:r[n].y});t.push({x:s.lon,y:s.lat,label:r[n].label})}this.clusterStrategy.setStatistics(t)}},NPMapLib.Layers.OverlayLayer.prototype.removeCluster=function(e){if(this.useCluster){var t=this.getOverlaysArry();if(t.length>0)for(var i=t[0],r=0;r<i.dataJson.length;r++)if(i.dataJson[r]==e){e&&e._apiObj&&e._apiObj.layer&&e._apiObj.layer.removeFeatures([e._apiObj]),i.dataJson.splice(r,1);break}}},NPMapLib.Layers.OverlayLayer.prototype.addCluster=function(e){if(this.useCluster){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(t){var i=this.getOverlaysArry();if(i.length>0){var r=i[0];if(e&&e instanceof NPMapLib.Symbols.ClusterMarker){var n=NPMapLib.T.setPoint(t,{lon:e.location.lon,lat:e.location.lat});e.geometry={x:n.lon,y:n.lat},r.dataJson.push(e),e.container=r;for(var s=-1,o=0;o<this._apiObj.strategies[0]._xData.length;o++)if(this._apiObj.strategies[0]._xData[o].geometry.x>e.geometry.x){s=o;break}s===-1&&(s=this._apiObj.strategies[0]._xData.length),this._apiObj.strategies[0]._xData.splice(s,0,e),"undefined"==typeof this._apiObj.showMarker[e.markType]&&(this._apiObj.showMarker[e.markType]=!0),this._apiObj.strategies[0].addClusterMarker([e])}}}}},NPMapLib.Layers.OverlayLayer.prototype.addClusters=function(e){if(this.useCluster){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(t){var i=this.getOverlaysArry();if(i.length>0)for(var r=i[0],n=0;n<e.length;n++){var s=e[n],o=NPMapLib.T.setPoint(t,{lon:s.location.lon,lat:s.location.lat});s.geometry={x:o.lon,y:o.lat},r.dataJson.push(s),s.container=r,this._apiObj.strategies[0]._xData.push(s),"undefined"==typeof this._apiObj.showMarker[s.markType]&&(this._apiObj.showMarker[s.markType]=!0)}this._apiObj.strategies[0]._xData=this._apiObj.strategies[0]._xData.slice().sort(function(e,t){return e.geometry.x>t.geometry.x?1:-1})}}},NPMapLib.Layers.OverlayLayer.prototype.filterClusterMarks=function(e){if(this.useCluster){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&(null==e&&(e=function(){return!0}),t.filterClusterMarks(this,e))}},NPMapLib.Layers.OverlayLayer.prototype.isShowMarkType=function(e){if(this._apiObj&&this.useCluster)return this._apiObj.showMarker[e]},NPMapLib.Layers.OverlayLayer.prototype.addGroup=function(e){return this.useCluster?null:""===e?null:(this.groups[e]||(this.groups[e]=new NPMapLib.Layers.LayerGroup(e,this)),this.groups[e])},NPMapLib.Layers.OverlayLayer.prototype.removeGroup=function(e){this.useCluster||(this.groups[e]&&this.groups[e].removeAllOverlays(),this.groups[e]=null)},NPMapLib.Layers.OverlayLayer.prototype.removeAllGroups=function(){if(!this.useCluster){for(var e in this.groups)this.groups.hasOwnProperty(e)&&(this.groups[e].removeAllOverlays(),this.groups[e]=null);this.groups={}}},NPMapLib.Layers.OverlayLayer.prototype.getAllGroups=function(){return this.useCluster?{}:this.groups},NPMapLib.Layers.OverlayLayer.prototype.getGroupByName=function(e){return this.groups[e]}}(),function(){NPMapLib.Layers.BaiduTileLayer=function(e,t,i){if(this.url=e,this.name=t,this._opts={isBaseLayer:!0,origin:[0,0],fullExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],sateTiles:!1,maxResolution:262144,maxZoomLevel:23},i)for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];void 0!==n&&(this._opts[r]=n)}NPMap.PROJECT="900913_BAIDU",this.CLASS_NAME="NPMapLib.Layers.BaiduTileLayer"},NPMapLib.Layers.BaiduTileLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.BingTileLayer=function(e,t,i){this.url=e,this.name=t,this._opts=i,this.CLASS_NAME="NPMapLib.Layers.BingTileLayer"},NPMap.PROJECT="900913_CHINA",NPMapLib.Layers.BingTileLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.ImageLayer=function(e,t,i){if(this.url=e,this.name=t,this._opts={isBaseLayer:!0,zoomOffset:0,minLevel:0,maxLevel:8},i)for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];void 0!==n&&(this._opts[r]=n)}this.CLASS_NAME="NPMapLib.Layers.ImageLayer"},NPMapLib.Layers.ImageLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.TDMapLayer=function(e,t,i){if(this.url=e,this.name=t,this._opts={isBaseLayer:!0,mapType:"EMap",fullExtent:[-180,-90,180,90],topLevel:0,bottomLevel:22,isLocalMap:!1},i)for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];void 0!==n&&(this._opts[r]=n)}this.CLASS_NAME="NPMapLib.Layers.TDMapLayer"},NPMapLib.Layers.TDMapLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.QQMapLayer=function(e,t,i){if(this.url=e,this.name=t,this._opts={fullExtent:[-180,-180,180,180],sateTiles:!1,isBaseLayer:!0},i)for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];void 0!==n&&(this._opts[r]=n)}NPMap.PROJECT="900913_CHINA",this.CLASS_NAME="NPMapLib.Layers.QQMapLayer"},NPMapLib.Layers.QQMapLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.GaoDeLayer=function(e,t,i){if(this.url=e,this.name=t,this._opts={fullExtent:[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892],isBaseLayer:!0},i)for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];void 0!==n&&(this._opts[r]=n)}NPMap.PROJECT="900913_CHINA",this.CLASS_NAME="NPMapLib.Layers.GaoDeLayer"},NPMapLib.Layers.GaoDeLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.SuperMapLayer=function(e,t,i){if(this.url=e,this.name=t,this._opts={fullExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],sateTiles:!1,maxResolution:156543.0339280408,isBaseLayer:!0},i)for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];void 0!==n&&(this._opts[r]=n)}NPMap.PROJECT="900913_CHINA",this.CLASS_NAME="NPMapLib.Layers.SuperMapLayer"},NPMapLib.Layers.SuperMapLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.HeatMapLayer=function(e,t){this.CLASS_NAME="NPMapLib.Layers.HeatMapLayer",this.name=e,this.visible=!0,this.radius=10,t.visible!==!0&&t.visible!==!1||(this.visible=t.visible),t.radius&&(this.radius=t.radius),t.projection&&(t.projection=new OpenLayers.Projection(t.projection)),this._opts=t},NPMapLib.Layers.HeatMapLayer.prototype=new NPMapLib.Layer,NPMapLib.Layers.HeatMapLayer.prototype.setDataset=function(e){if(e){for(var t={max:e.max,data:[]},i=e.data,r=i.length,n=[];r--;)n.push({lonlat:new OpenLayers.LonLat(i[r].lon,i[r].lat),count:i[r].count});t.data=n,this._apiObj&&this._apiObj.setDataSet(t)}},NPMapLib.Layers.HeatMapLayer.prototype.addDataPoint=function(e){if(e&&e instanceof NPMapLib.Geometry.Point){var t=new OpenLayers.LonLat(e.lon,e.lat);this._apiObj&&this._apiObj.addDataPoint(t)}},NPMapLib.Layers.HeatMapLayer.prototype.toggle=function(){this._apiObj&&this._apiObj.toggle()}}(),function(){NPMapLib.Layers.LayerGroup=function(e,t){this.CLASS_NAME="NPMapLib.Layers.LayerGroup",this.name=e,this.layer=t,this.data=[]},NPMapLib.Layers.LayerGroup.prototype.hide=function(){for(var e=0;e<this.data.length;e++)this.data[e].hide()},NPMapLib.Layers.LayerGroup.prototype.show=function(){for(var e=0;e<this.data.length;e++)this.data[e].show()},NPMapLib.Layers.LayerGroup.prototype.addOverlay=function(e){e.groupName=this.name,this.data.push(e),this.layer.addOverlay(e)},NPMapLib.Layers.LayerGroup.prototype.addOverlays=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++)this.addOverlay(e[t])},NPMapLib.Layers.LayerGroup.prototype.removeOverlay=function(e){if(this.data.contains(e)){for(var t=this.data.indexOf(e),i=0,r=0;i<this.data.length;i++)this.data[i]!==this.data[t]&&(this.data[r++]=this.data[i]);this.data.length-=1,this.layer.removeOverlay(e)}},NPMapLib.Layers.LayerGroup.prototype.removeOverlays=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++)this.removeOverlay(e[t])},NPMapLib.Layers.LayerGroup.prototype.removeAllOverlays=function(){for(var e=0;e<this.data.length;e++)this.layer.removeOverlay(this.data[e]);this.data=[]},NPMapLib.Layers.LayerGroup.prototype.getAllOverlayers=function(){return this.data},NPMapLib.Layers.LayerGroup.prototype.containFeatures=function(e,t){var i=this.layer.containFeatures(e,t),r=[];if(i instanceof Array)for(var n=0;n<i.length;n++)i[n].groupName===this.name&&r.push(i[n]);return r},NPMapLib.Layers.LayerGroup.prototype.getOverlaysByProperty=function(e,t){var i=this.layer.getOverlaysByProperty(e,t),r=[];if(i instanceof Array)for(var n=0;n<i.length;n++)i[n].groupName===this.name&&r.push(i[n]);return r},NPMapLib.Layers.LayerGroup.prototype.getOverlay=function(e){var t=this.layer.getOverlay(e);if(t&&t.groupName===this.name)return t},NPMapLib.Layers.LayerGroup.prototype.setZIndex=function(e){for(var t=this.getAllOverlayers(),i=0;i<t.length;i++)t[i].setZIndex(e)},NPMapLib.Layers.LayerGroup.prototype.getZIndex=function(){var e=this.getAllOverlayers();if(0!==e.length){var t=e[0].getZIndex();return t}}}(),function(){NPMapLib.Layers.NPLayer=function(e,t,i){this.url=e,i&&"boolean"==typeof i.isBaseLayer?this.isBaseLayer=i.isBaseLayer:this.isBaseLayer=!0,this.opts=i,this.name=t,this.layerType="tiandi",this.fullExtent=[],this.type="png",this.CLASS_NAME="NPMapLib.Layers.NPLayer"},NPMapLib.Layers.NPLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Layers.OSMLayer=function(e,t,i){this.url=e,this.name=t,this.opts=i,i&&"boolean"==typeof i.isBaseLayer?this.isBaseLayer=i.isBaseLayer:this.isBaseLayer=!0,NPMap.PROJECT="900913",this.CLASS_NAME="NPMapLib.Layers.OSMLayer"},NPMapLib.Layers.OSMLayer.prototype=new NPMapLib.Layer}(),function(){NPMapLib.Overlay=function(){this.CLASS_NAME="NPMapLib.Overlay",this.id=-1,this.overlayType=NPMapLib.OVERLAY_TYPE_UNKNOWN,this.mapId=-1,this._visible=!0,this._apiObj=null,this._data={},this.isEnableEdit=!1,this.isEnableContextMenu=!1,this.MenuList="",this._graphicZIndex=0,this._rotation=null,this._layer},NPMapLib.Overlay.prototype.isVisible=function(){return this._visible},NPMapLib.Overlay.prototype.show=function(){if(!(this.mapId<=0||this._visible)){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&this._apiObj&&e.showOverlay(this),this._visible=!0}},NPMapLib.Overlay.prototype.hide=function(){if(!(this.mapId<=0)&&this._visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&this._apiObj&&e.hideOverlay(this),this._visible=!1}},NPMapLib.Overlay.prototype.flash=function(){if(!(this.mapId<=0)&&this._visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.falshOverlay(this)}},NPMapLib.Overlay.prototype.flash2=function(e){if(!(this.mapId<=0)&&this._visible){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.falshOverlay(this,e)}},NPMapLib.Overlay.prototype.flashStop=function(){if(!(this.mapId<=0)&&this._visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&this._apiObj&&this._apiObj.flashStop()}},NPMapLib.Overlay.prototype.getZIndex=function(){return this._graphicZIndex},NPMapLib.Overlay.prototype.setZIndex=function(e){this.mapId<=0||(this._graphicZIndex=e,this.refresh())},NPMapLib.Overlay.prototype.rotate=function(e){if(!(this.mapId<=0)){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&(this._rotation=e,t.rotateOverlay(this,e))}},NPMapLib.Overlay.prototype.resetIcon=function(e){if(!(this.mapId<=0)&&this._visible){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.resetIcon(this,e)}},NPMapLib.Overlay.prototype.setData=function(e){this._data=e},NPMapLib.Overlay.prototype.getData=function(){return this._data},NPMapLib.Overlay.prototype.refresh=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.refresh(this)},NPMapLib.Overlay.prototype.showMenu=function(){if(this.MenuList){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.showMenu(this.MenuList)}},NPMapLib.Overlay.prototype.enableEditing=function(e,t){this.isEnableEdit=!0;var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.enableEditing(e,this,t)},NPMapLib.Overlay.prototype.disableEditing=function(){this.isEnableEdit=!1;var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.cancelEditing(this)},NPMapLib.Overlay.prototype.getTop=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return e?e.getTop(this):null},NPMapLib.Overlay.prototype.getId=function(){return this.id},NPMapLib.Overlay.prototype.getBounds=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e)return e.getBounds(this);if("NPMapLib.Geometry.Polygon"===this.CLASS_NAME){for(var t=this.getPath(),i=t[0].lon,r=t[0].lat,n=t[0].lon,s=t[0].lat,o=1;o<t.length;o++)t[o].lon<i&&(i=t[o].lon),
t[o].lon>n&&(n=t[o].lon),t[o].lat<r&&(r=t[o].lat),t[o].lat<s&&(s=t[o].lat);return new NPMapLib.Geometry.Extent(i,r,n,s)}return null},NPMapLib.Overlay.prototype.getLayer=function(){return this._layer},NPMapLib.Overlay.prototype.getCentroid=function(){if(this._apiObj&&this._apiObj.geometry){var e=this._apiObj.geometry.getCentroid();return NPMapLib.T.getPoint(NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId),{lon:e.x,lat:e.y})}},NPMapLib.Overlay.prototype.setZStyle=function(e){if(this._apiObj&&this._apiObj.geometry&&e){this._apiObj.style;for(var t in e)this._apiObj.style[t]=e[t];this._apiObj.layer.drawFeature(this._apiObj)}},NPMapLib.Overlay.prototype.removeMenu=function(){this._menu&&(this._menu.destroy(),this._menu=null)},NPMapLib.Overlay.prototype.setMenuList=function(e){this.MenuList=e}}(),NPMapLib.CsObjCaster=function(){var factory={};return factory._castArgs=function(p){var args=new Array;if(p)for(var i=2;i<p.length;i++){var temp=p[i];"string"==typeof temp&&temp.indexOf(":")>0&&0!=temp.indexOf("http")?args.push(eval("("+temp+")")):args.push(temp)}return args},factory._castControl=function(e){var t=null;if(!e)return t;var i=e.CLASS_NAME;return t="NPMapLib.Controls.MousePositionControl"==i?new NPMapLib.Controls.MousePositionControl(e.PositionType):new(NPMapLib.Controls[i.split(".")[2]]),t&&(t.id=e.id,t.mapId=e.mapId),t},factory._castSize=function(e){return new NPMapLib.Geometry.Size(e.Width,e.Height)},factory._castOffset=function(e){return new NPMapLib.Geometry.Size(e.X,e.Y)},factory._castPoint=function(e){return new NPMapLib.Geometry.Point(e.Lon,e.Lat)},factory._castPoints=function(e){var t=new Array;if(!e)return t;if("object"==typeof e&&e.length)for(var i=0;i<e.length;i++){var r=new NPMapLib.Geometry.Point(e[i].Lon,e[i].Lat);t.push(r)}return t},factory._castPixel=function(e){return new NPMapLib.Geometry.Pixel(e.X,e.Y)},factory._castIcon=function(e){var t=NPMapLib.Managers.OtherManager._getIcon[e.id];if(t)return t;var i=this._castSize(e.imageSize),r={};e.anchor&&(r.anchor=this._castOffset(e.anchor));var n=new NPMapLib.Symbols.Icon(e.imageUrl,i,r);return n.id=e.id,NPMapLib.Managers.OtherManager._addIcon(n),e.Border&&(n.border=e.Border),n},factory._castInfoWin=function(e){var t=new NPMapLib.Symbols.InfoWindow(e.point,e.title,e.content,{width:e.width,height:e.height,offset:this._castOffset(e.offset),arrow:e.arrow,enableCloseOnClick:e.enableCloseOnClick});return t.id=e.id,t.mapId=e.mapId,t.autoSize=!!e.autoSize,t},factory._castAnimation=function(e){var t=this._castOverlay(e.overlay),i=new NPMapLib.Symbols.Animation(e.mapId,t,{speed:e.opt.Speed,isReturn:e.opt.IsReturn,isRepeat:e.opt.IsRepeat});return i.id=e.id,i},factory._castOverlay=function(e){if(!e)return null;var t=NPMapLib.Managers.OverlayManager.getOverlay(e.id);if(t)return t;var i;switch(e.CLASS_NAME){case"NPMapLib.Geometry.Polyline":i=this._castPoints(e.points),t=new NPMapLib.Geometry.Polyline(i,{color:e.color,weight:e.weight,opacity:e.opacity,lineStyle:e.lineStyle,arrowStyle:e.arrowStyle,enableEditing:e.enableEditing});break;case"NPMapLib.Geometry.Polygon":i=this._castPoints(e.points),t=new NPMapLib.Geometry.Polygon(i,{color:e.color,weight:e.weight,opacity:e.opacity,lineStyle:e.lineStyle,arrowStyle:e.arrowStyle,enableEditing:e.enableEditing,fillColor:e.fillcolor,fillOpacity:e.fillOpacity});break;case"NPMapLib.Geometry.Circle":i=new NPMapLib.Geometry.Point(e.center.Lon,e.center.Lat),t=new NPMapLib.Geometry.Circle(i,e.radius,this._castCircleOption(e));break;case"NPMapLib.Symbols.Label":t=this._castLabel(e);break;case"NPMapLib.Geometry.CircleSector":i=new NPMapLib.Geometry.Point(e.center.Lon,e.center.Lat),t=new NPMapLib.Geometry.CircleSector(i,e.radius,e.sides,e.antBearing,e.lobeAngle,this._castCircleSectorOption(e));break;case"NPMapLib.Symbols.Marker":var r={icon:this._castIcon(e.Icon)};e.Offset&&(r.offset=new NPMapLib.Geometry.Size(e.Offset.X,e.Offset.Y)),t=new NPMapLib.Symbols.Marker(this._castPoint(e.Point),r),e.Label&&t.setLabel(this._castLabel(e.Label));break;case"NPMapLib.Symbols.ClusterPoints":for(var n=[],s=e.Markers.length-1;s>=0;s--){var o=e.Markers[s];n.push(new NPMapLib.Symbols.ClusterMarker({lon:o.Location.Lon,lat:o.Location.Lat,id:o.MarkerId,markType:o.MarkType},{markType:o.MarkType}))}t=new NPMapLib.Symbols.ClusterPoints(n);break;case"NPMapLib.Symbols.PlottingSymbol":t=new NPMapLib.Symbols.PlottingSymbol(NPMap.Managers.MapManager.getMap(e.mapId),(new OpenLayers.Format.JSON).write(e.jsonData),e.style);break;case"NPMapLib.Symbols.Bubble":t=new NPMapLib.Symbols.Bubble(e.point,{offset:e.offset,color:e.color})}return t.id=e.id,"boolean"==typeof e.IsEnableContextMenu&&(t.isEnableContextMenu=e.IsEnableContextMenu),"boolean"==typeof e.IsEnableEdit&&(t.isEnableEdit=e.IsEnableEdit),e.MenuList&&(t.MenuList=e.MenuList),t.mapId=e.mapId,NPMapLib.Managers.OverlayManager.addOverlay(t),t},factory._castCircleOption=function(e){var t={color:e.color,fillColor:e.fillColor,weight:e.weight,opacity:e.opacity,fillOpacity:e.fillOpacity,lineStyle:e.lineStyle,enableEditing:e.enableEditing};return t},factory._castCircleSectorOption=function(e){var t={color:e.color,fillColor:e.fillColor,weight:e.weight,opacity:e.opacity,fillOpacity:e.fillOpacity,lineStyle:e.lineStyle,enableEditing:e.enableEditing};return t},factory._castPolylineOption=function(e){},factory._castPolygonOption=function(e){},factory._castLabelStyle=function(e){var t={FontSize:e.FontSize,FontFamily:e.FontFamily,Color:e.Color,BgColor:e.BgColor,BordColor:e.BordColor,BorderSize:e.BorderSize,Align:e.Align,isBold:e.IsBold};return t},factory._castLabel=function(e){if(NPMapLib.Managers.OverlayManager.getOverlay[e.id])return NPMapLib.Managers.OverlayManager.getOverlay[e.id];var t=new NPMapLib.Symbols.Label(e.content,{offset:this._castOffset(e.offset),position:this._castPoint(e.position)});if(e.labelStyle){var i=this._castLabelStyle(e.labelStyle);t.setStyle(i)}return t.id=e.id,NPMapLib.Managers.OverlayManager.addOverlay(t),t},factory._castLayer=function(params){switch(params.layerType){case NPMapLib.MAP_LAYER_TYPE_ARCGIS_TILE:var opts={centerPoint:[params.CenterPoint.Lon,params.CenterPoint.Lat],fullExtent:[params.FullExtent.SW.Lon,params.FullExtent.NE.Lat,params.FullExtent.NE.Lon,params.FullExtent.SW.Lat],minLevel:params.minLevel,maxLevel:params.maxLevel,zoomOffset:params.ZoomOffset,zoomLevelSequence:params.ZoomLevelSequence,initResolution:params.InitResolution,origin:[params.Origin.Lon,params.Origin.Lat],resolutions:params.Resolutions},layer1=new NPMapLib.Layers.ArcgisTileLayer(params.url,params.name,opts);return layer1.id=params.id,layer1;case NPMapLib.MAP_LAYER_TYPE_OVERLAY:var layer=new NPMapLib.Layers.OverlayLayer(params.name);return layer.id=params.id,layer.mapId=params.MapId,layer;case NPMapLib.MAP_LAYER_TYPE_GOOGLE_OFFLINE:var opts={centerPoint:[params.CenterPoint.Lon,params.CenterPoint.Lat],minLevel:params.minLevel,maxLevel:params.maxLevel,zoomOffset:params.ZoomOffset,zoomLevelSequence:params.ZoomLevelSequence,type:params.Tiletype,fullExtent:[params.FullExtent.SW.Lon,params.FullExtent.NE.Lat,params.FullExtent.NE.Lon,params.FullExtent.SW.Lat],isBaseLayer:params.IsBaseLayer},layer1=new NPMapLib.Layers.GoogleOffLineLayer(params.url,params.name,opts);return layer1.id=params.id,layer1;case NPMapLib.MAP_LAYER_TYPE_TDMAP:var opts={centerPoint:[params.CenterPoint.Lon,params.CenterPoint.Lat],mapType:params.mapType,topLevel:1,bottomLevel:18,isBaseLayer:params.isBaseLayer,mirrorUrls:params.mirrorUrls,fullExtent:[params.FullExtent.SW.Lon,params.FullExtent.NE.Lat,params.FullExtent.NE.Lon,params.FullExtent.SW.Lat]},layer=new NPMapLib.Layers.TDMapLayer(params.url,params.name,opts);return layer.id=params.id,layer.mapId=params.mapId,layer;case 12:var opts=params.option||{};opts.getUrl=function(e,t){return t=t.feature||t,t.getData||(t=null),NPMapLib.callMethod("OnClusterEvent","getUrl",params.id,null==t?-9999:t.getData().id,e)},opts.getImageSize=function(counts,data){data=data.feature||data,data.getData||(data=null);var result=NPMapLib.callMethod("OnClusterEvent","getImageSize",params.id,null==data?-9999:data.getData().id,counts),msg="string"==typeof result?eval("("+result+")"):result;return{width:msg.Width,height:msg.Height}},opts.mouseover=function(e){NPMapLib.callMethod("OnSingleClusterEvent","onmouseover",params.id,e.getData().id)},opts.mouseout=function(e){NPMapLib.callMethod("OnSingleClusterEvent","onmouseout",params.id,e.getData().id)},opts.click=function(e){NPMapLib.callMethod("OnSingleClusterEvent","onSelect",params.id,e.getData().id)},opts.getRotation=function(e,t){return t=t.feature||t,t.getData||(t=null),NPMapLib.callMethod("OnClusterEvent","getRotation",params.id,null==t?-9999:t.getData().id,e)};var layer=new NPMapLib.Layers.OverlayLayer(params.name,(!0),opts);return layer.id=params.id,layer.mapId=params.MapId,layer}},factory._castMesaureTool=function(e){var t=new NPMapLib.Tools.MeasureTool(e.mapId);return t.id=e.id,t},factory._castDrawTool=function(e){var t=new NPMapLib.Tools.DrawingTool(e.mapId);return t.id=e.id,t},factory._castCSharpeToJs=function(e){switch(e.CLASS_NAME){case"NPMapLib.Tools.DrawingToolEx":var t=new NPMapLib.Tools.DrawingToolEx(NPMapLib.Managers.MapManager.getMap(e.mapId))}return t.id=e.id,t},factory}(),NPMapLib.callMethod=function(e,t){var i=Array.prototype.slice.call(arguments).slice(1);return"undefined"!=typeof CSharpe&&"undefined"!=typeof CSharpe[e]?CSharpe[e].apply(this,i):window[e]&&window[e].apply(this,i)},NPMapLib.Managers.MapManager=function(){var factory={},_MAP_ID=0,_maps={};return factory.getMaxId=function(){return++_MAP_ID},factory.addMap=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,NPMapLib.Map)&&(_maps[e.id]||(e.id<=0&&(e.id=this.getMaxId()),_maps[e.id]=e))},factory.removeMap=function(e){_maps[e]&&delete _maps[e]},factory.removeAllMaps=function(){for(var e in _maps)delete _maps[e]},factory.getMap=function(e){return _maps[e]},factory.getAllMaps=function(){return _maps},factory.callFromCS=function(jsonModel,method){NPMapLib.Utils.BaseUtils.isTypeRight(jsonModel,"string")&&(jsonModel=eval("("+jsonModel+")"));var map,args=NPMapLib.CsObjCaster._castArgs(arguments);if(_maps[jsonModel.mapId])map=this.getMap(jsonModel.mapId);else{var mapContainer=document.getElementById("mapId");if(args.length<=0)return;var mapConfig=null;if("boolean"==typeof args[0].IsPointConvert&&(NPMap.ISPOINTCONVERT=args[0].IsPointConvert),11==args[0].layerType){mapConfig=args[0].MapConfig.replace(/_/g,'"'),mapConfig=eval("("+mapConfig+")"),map=new NPMapLib.Map(mapContainer,mapConfig.mapOpts,jsonModel.mapId),_maps[jsonModel.mapId]=map;var vectorBaseLayer=[],baseLayer=[],allLayers=mapConfig.vectorLayer;map._mapJson={vectorLayer:[],map:map,sattilateLayer:[]};for(var i=0,len=mapConfig.vectorLayer.length;i<len;i++)vectorLayerItem=mapConfig.vectorLayer[i],layerType=vectorLayerItem.layerType.split("."),baseLayerItem=new NPMapLib.Layers[layerType[layerType.length-1]](vectorLayerItem.layerOpt.url,vectorLayerItem.layerName,vectorLayerItem.layerOpt),baseLayerItem.id=args[0].LayerId,vectorBaseLayer.push(baseLayerItem),baseLayer.push(baseLayerItem),NPMapLib.Managers.LayerManager.addLayer(baseLayerItem),map._mapJson.vectorLayer.push(baseLayerItem);for(var i=0,len=mapConfig.sattilateLayer.length;i<len;i++)vectorLayerItem=mapConfig.sattilateLayer[i],layerType=vectorLayerItem.layerType.split("."),baseLayerItem=new NPMapLib.Layers[layerType[layerType.length-1]](vectorLayerItem.layerOpt.url,vectorLayerItem.layerName,vectorLayerItem.layerOpt),baseLayerItem.id=args[0].LayerId,vectorBaseLayer.push(baseLayerItem),baseLayer.push(baseLayerItem),NPMapLib.Managers.LayerManager.addLayer(baseLayerItem),map._mapJson.sattilateLayer.push(baseLayerItem);map.addLayers(baseLayer);for(var i=map._mapJson.sattilateLayer.length-1;i>=0;i--)map._mapJson.sattilateLayer[i].hide();return NPMapLib.Utils.BaseUtils.JsonToStr({id:args[0].LayerId,success:!0})}var opt={};opt.fullExtent=[args[0].FullExtent.SW.Lon,args[0].FullExtent.NE.Lat,args[0].FullExtent.NE.Lon,args[0].FullExtent.SW.Lat],"number"==typeof args[0].ZoomOffset&&(opt.zoomOffset=args[0].ZoomOffset),args[0].RestrictedExtent&&(opt.restrictedExtent=args[0].RestrictedExtent),args[0].Projection&&(opt.projection=args[0].Projection),opt.zoomOffset||(opt.zoomOffset=0),opt.minZoom=args[0].minLevel+opt.zoomOffset,opt.maxZoom=args[0].maxLevel+opt.zoomOffset,map=new NPMapLib.Map(mapContainer,opt,jsonModel.mapId),_maps[jsonModel.mapId]=map,NPMapLib.callMethod("OnMapLoadSuccess",!0)}switch(method){case"addLayer":if(args.length<=0)return;var isAdd=!1,l=NPMapLib.Managers.LayerManager.getLayer(args[0].LayerId);return l||(l=NPMapLib.CsObjCaster._castLayer(args[0])),l&&(map.addLayer(l),NPMapLib.Managers.LayerManager.addLayer(l),isAdd=!0),NPMapLib.Utils.BaseUtils.JsonToStr({id:args[0].LayerId,success:isAdd});case"addLayers":var resultList=[];if(args.length>0&&args[0]&&args[0].length>0)for(var count=args[0].length,i=0;i<count;++i){var isAdd=!1,l=NPMapLib.Managers.LayerManager.getLayer(args[0][i].LayerId);if(l)try{isAdd=map.addLayer(l),NPMapLib.Managers.LayerManager.addLayer(l)}catch(ex){isAdd=!1}resultList.push({id:l.id,success:isAdd})}return NPMapLib.Utils.BaseUtils.JsonToStr(resultList);case"removeLayer":if(!args||args.length<=0)return;var isAdd=!1,layerId=parseInt(""+args[0]),l=NPMapLib.Managers.LayerManager.getLayer(layerId);return l&&(map.removeLayer(l),NPMapLib.Managers.LayerManager.removeLayer(layerId),isAdd=!0),NPMapLib.Utils.BaseUtils.JsonToStr({id:layerId,success:isAdd});case"addControl":if(args.length<=0)return;var cs_control=args[0];if(!cs_control)return;var isAdd=!1;cs_control.ControlType==NPMapLib.CONTROL_TYPE_MOUSEPOSITION;var c=NPMapLib.Managers.ControlManager.getControl(args[0].id);return c||(c=NPMapLib.CsObjCaster._castControl(args[0])),c&&(map.addControl(c),isAdd=!0),NPMapLib.Utils.BaseUtils.JsonToStr({id:c.id,success:isAdd});case"removeControl":if(args.length<=0)return;var cs_control=args[0];if(!cs_control)return;var isAdd=!1;if(cs_control.ControlType==NPMapLib.CONTROL_TYPE_MOUSEPOSITION)return void map.removeJWMousePostion();var c=NPMapLib.Managers.ControlManager.getControl(args[0].id);return c&&(map.removeControl(c),isAdd=!1),NPMapLib.Utils.BaseUtils.JsonToStr({id:c.id,success:isAdd});case"addOverlay":var isAdd=!1;if(args.length<=0)return;var o=NPMapLib.Managers.OverlayManager.getOverlay(args[0].id);return o||(o=NPMapLib.CsObjCaster._castOverlay(args[0])),o&&(isAdd=map.addOverlay(o)),NPMapLib.Utils.BaseUtils.JsonToStr({id:args[0].id,success:isAdd});case"addOverlays":var resultList=[];if(args.length>0&&args[0]&&args[0].length>0)for(var count=args[0].length,i=0;i<count;++i){var o=NPMapLib.Managers.OverlayManager.getOverlay(args[0][i].id);o||(o=NPMapLib.CsObjCaster._castOverlay(args[0][i]),o&&map.addOverlay(o))}return;case"removeOverlay":if(args.length<=0)return;var o=NPMapLib.Managers.OverlayManager.getOverlay(args[0].id);return o&&map.removeOverlay(o),NPMapLib.Utils.BaseUtils.JsonToStr({id:args[0].id,success:!0});case"removeOverlays":var resultList=[];if(args.length>0&&args[0]&&args[0].length>0)for(var count=args[0].length,i=0;i<count;++i){var isAdd=!1,o=NPMapLib.Managers.OverlayManager.getOverlay(args[0][i].id);if(o)try{map.removeOverlay(o),isAdd=!0}catch(ex){isAdd=!1}resultList.push({id:args[0][i].id,success:isAdd})}return NPMapLib.Utils.BaseUtils.JsonToStr(resultList);case"addEventListener":var evt=args[0],cbf=args[1];return void map.addEventListener(evt,function(e){"click"===evt?NPMapLib.callMethod("OnMapClickCallBack",e.lon,e.lat,1):"dblclick"===evt?NPMapLib.callMethod("OnMapDbClickCallBack",e.lon,e.lat,1):"mapzoomchange"==evt?NPMapLib.callMethod("OnMapZoomChanged",e):"rightclick"==evt&&NPMapLib.callMethod("OnMapRightClickCallBack")});case"pointToPixel":if(args.length<=0)return;var t=map.pointToPixel(new NPMapLib.Geometry.Point(args[0].Lon,args[0].Lat));return NPMapLib.Utils.BaseUtils.JsonToStr(t);case"pixelToPoint":if(args.length<=0)return;var t=map.pixelToPoint(NPMapLib.CsObjCaster._castPixel(args[0]));return NPMapLib.Utils.BaseUtils.JsonToStr(t);case"setCenter":var p=new NPMapLib.Geometry.Point(args[0].Lon,args[0].Lat);return void map.setCenter(p);case"route":var service=new MapPlatForm.Base.MapService(map)}if(method&&"function"==typeof map[method]){var t=map[method].apply(map,args);return"number"==typeof t||"string"==typeof t?t:NPMapLib.Utils.BaseUtils.JsonToStr(t)}},factory}(),NPMapLib.Managers.OverlayManager=function(){var factory={},_OVERLAY_ID=0,_overlays={};return factory._getMaxId=function(){return++_OVERLAY_ID},factory.addOverlay=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,NPMapLib.Overlay)&&(_overlays[e.id]||(e.id<=0&&(e.id=this._getMaxId()),_overlays[e.id]=e))},factory.removeOverlay=function(e){_overlays[e]&&delete _overlays[e]},factory.removeAllOverlays=function(){for(var e in _overlays)delete _overlays[e]},factory.getOverlay=function(e){return _overlays[e]},factory.getAllOverlays=function(){return _overlays},factory.callFromCS=function(obj,method,params){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(obj,"string")&&(obj=eval("("+obj+")")),!_overlays[obj.id]){var o=NPMapLib.CsObjCaster._castOverlay(obj);_overlays[obj.id]=o}var overlay=_overlays[obj.id],args=NPMapLib.CsObjCaster._castArgs(arguments);switch(method){case"addEventListener":var evt=args[0],cbf=args[1];return void("dragend"==evt?overlay.addEventListener(evt,function(e){if(e.getPosition){var t=e.getPosition();NPMapLib.callMethod("OnOverlayDragend",obj.id,NPMapLib.Utils.BaseUtils.JsonToStr(t))}else{var t=new NPMapLib.Geometry.Point(0,0);NPMapLib.callMethod("OnOverlayDragend",obj.id,NPMapLib.Utils.BaseUtils.JsonToStr(t))}}):overlay.addEventListener(evt,function(e){NPMapLib.callMethod("OnOverlayMouseEvent",obj.id,evt,e.lon,e.lat,0)}));case"setOffset":var s=new NPMapLib.Geometry.Size(args[0].X,args[0].Y);return void overlay.setOffset(s);case"setPosition":var p=new NPMapLib.Geometry.Point(args[0].Lon,args[0].Lat);return void overlay.setPosition(p);case"buffer":var map=NPMap.Managers.MapManager.getMap(obj.mapId),gs=WKT.read(args[0],map);return map.addOverlay(gs),void(overlay.buffer=gs);case"removeBuffer":return void(overlay.buffer&&(NPMap.Managers.MapManager.getMap(obj.mapId).removeOverlay(overlay.buffer),overlay.buffer=null));default:if(method&&overlay&&"function"==typeof overlay[method]){var t=overlay[method].apply(overlay,args);return"number"==typeof t||"string"==typeof t?t:NPMapLib.Utils.BaseUtils.JsonToStr(t)}return}}catch(e){alert("overlay method err_:"+e.message+"method")}},factory}(),NPMapLib.Managers.LayerManager=function(){var factory={},_LAYER_ID=0,_layers={};return factory._getMaxId=function(){return++_LAYER_ID},factory.addLayer=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,NPMapLib.Layer)&&(_layers[e.id]||(e.id<=0&&(e.id=this._getMaxId()),_layers[e.id]=e))},factory.getAllLayerIds=function(){var e=[];for(var t in _layers)e.push(t);return e},factory.removeLayer=function(e){_layers[e]&&delete _layers[e]},factory.removeAllLayers=function(){for(var e in _layers)delete _layers[e]},factory.getLayer=function(e){return _layers[e]},factory.getAllLayers=function(){return _layers},factory.callFromCS=function(jsonModel,method,params){if(NPMapLib.Utils.BaseUtils.isTypeRight(jsonModel,"string")&&(jsonModel=eval("("+jsonModel+")")),!_layers[jsonModel.id]){var temp=NPMapLib.CsObjCaster._castLayer(jsonModel);if(null==temp)return;_layers[jsonModel.id]=temp}var layer=_layers[jsonModel.id],args=NPMapLib.CsObjCaster._castArgs(arguments);switch(method){case"addOverlay":if(args.length<=0)return;var isAdd=!1,o=NPMapLib.CsObjCaster._castOverlay(args[0]);return o&&(layer.addOverlay(o),isAdd=!0),NPMapLib.Utils.BaseUtils.JsonToStr({id:args[0].id,success:isAdd});case"removeOverlay":if(args.length<=0)return;var isAdd=!1,o=NPMapLib.CsObjCaster._castOverlay(args[0]);return o&&(layer.removeOverlay(o.id),isAdd=!0),NPMapLib.Utils.BaseUtils.JsonToStr({id:args[0].id,success:isAdd});case"addOverlays":var resultList=[];if(args.length>0&&args[0]&&args[0].length>0)for(var count=args[0].length,i=0;i<count;++i){var isAdd=!1,o=NPMapLib.CsObjCaster._castOverlay(args[0][i]);if(o)try{isAdd=map.addOverlay(o)}catch(ex){}resultList.push({id:args[0][i].id,success:isAdd})}return NPMapLib.Utils.BaseUtils.JsonToStr(resultList);case"setMarkerLocation":if(args.length<=0)return;var o=_layers[jsonModel.id];if(o)for(var data=o.getOverlaysArry()[0].dataJson,marker=eval("("+params+")"),i=data.length-1;i>=0;i--){var p=data[i];if(p.getData().id===marker.MarkerId){p.setPosition(new NPMapLib.Geometry.Point(marker.Location.Lon,marker.Location.Lat));break}}return;case"changeClusterStyle":if(args.length<=0)return;var o=_layers[jsonModel.id];if(o)for(var data=o.getOverlaysArry()[0].dataJson,marker=eval("("+params[0]+")"),i=data.length-1;i>=0;i--){var p=data[i];if(p.getData().id===marker.MarkerId){p.changeStyle(eval("("+params[1]+")"),!0);break}}return;default:if(layer&&method&&"function"==typeof layer[method]){var t=layer[method].apply(layer,args);if(t)return"number"==typeof t||"string"==typeof t?t:NPMapLib.Utils.BaseUtils.JsonToStr(t)}return}},factory}(),NPMapLib.Managers.ControlManager=function(){var factory={},_CONTROL_ID=0,_controls={};return factory._getMaxId=function(){return++_CONTROL_ID},factory.addControl=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,NPMapLib.Control)&&(_controls[e.id]||(e.id<=0&&(e.id=this._getMaxId()),_controls[e.id]=e))},factory.removeControl=function(e){_controls[e]&&delete _controls[e]},factory.removeAllControls=function(){for(var e in _controls)delete _controls[e]},factory.getControl=function(e){return _controls[e]},factory.getAllControls=function(){return _controls},factory.callFromCS=function(jsonModel,method,params){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(jsonModel,"string")&&(jsonModel=eval("("+jsonModel+")")),!_controls[jsonModel.id]){var c=NPMapLib.CsObjCaster._castControl(jsonModel);if(!control)return;_controls[jsonModel.id]=c}var control=_controls[jsonModel.id];"function"==typeof control[method]&&control[method].call(control,params)}catch(e){alert("ctl method err"+e.toString())}},factory}(),NPMapLib.Managers.ContextMenuManager=function(){var e={},t=0,i={};return e._getMaxId=function(){return++t},e.addContextMenu=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,NPMapLib.ContextMenu)&&(i[e.id]||(e.id<=0&&(e.id=this._getMaxId()),i[e.id]=layer))},e.removeContextMenu=function(e){_layers[e]&&delete _layers[e]},e.removeAllContextMenus=function(){for(var e in i)delete i[e]},e.getContextMenu=function(e){return i[e]},e.getAllContextMenus=function(){return i},e.callFromCS=function(e,t,i){},e}(),NPMapLib.Managers.OtherManager=function(){var factory={},drawObjs={};factory.drawCallFromCS=function(_json,method,param){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")")),NPMapLib.Utils.BaseUtils.isTypeRight(param,"string")&&(param=eval("("+param+")")),!drawObjs[_json.id]){var o=NPMapLib.CsObjCaster._castDrawTool(_json);drawObjs[_json.id]=o}var tool=drawObjs[_json.id];if("setMode"===method){var cbf=function(){};arguments.length>=4;var style=arguments[3]?eval("("+arguments[3]+")"):null;return void tool.setMode(param,function(e,t,i){tool.cancel(),NPMapLib.USING_ADAPTER===NPMapLib.ADAPTER_TYPE_OPENLAYERS?NPMapLib.callMethod("OnDrawComlpeted","drawComplete",_json.id,i):NPMapLib.callMethod("OnDrawComlpeted","drawComplete",_json.id,e)},style)}if(method&&tool&&"function"==typeof tool[method])return tool[method].call(tool,param);"delete"===method&&drawObjs[_json.id]&&delete drawObjs[_json.id]}catch(e){alert("draw method err_:"+e.message)}};var measureObjs={};factory.measureCallFromCS=function(_json,method,params){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")")),NPMapLib.Utils.BaseUtils.isTypeRight(params,"string")&&(params=eval("("+params+")")),!measureObjs[_json.id]){var o=NPMapLib.CsObjCaster._castMesaureTool(_json);measureObjs[_json.id]=o}var tool=measureObjs[_json.id];if(method&&tool&&"function"==typeof tool[method])return tool[method].call(tool,params);"delete"===method&&measureObjs[_json.id]&&delete measureObjs[_json.id]}catch(e){alert("measure method err_:"+e.message)}};var infoWinObjs={};factory.infoWinCallFromCS=function(_json,method){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")")),"close"===method)return void(infoWinObjs[_json.id]&&(infoWinObjs[_json.id].close(),delete infoWinObjs[_json.id]));var args=NPMapLib.CsObjCaster._castArgs(arguments),point=new NPMapLib.Geometry.Point(args[0],args[1]);if(_json.point=point,!infoWinObjs[_json.id]){var o=NPMapLib.CsObjCaster._castInfoWin(_json);infoWinObjs[_json.id]=o}var win=infoWinObjs[_json.id],map=NPMapLib.Managers.MapManager.getMap(_json.mapId);if(map&&map.addOverlay(win),method&&win&&"function"==typeof win[method])return win[method].apply(win,args)}catch(e){alert("infowin method err_:"+e.message)}};var _icons={};factory._getIcon=function(e){return _icons[e]},factory._addIcon=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,NPMapLib.Symbols.Icon)&&(_icons[e.id]||(_icons[e.id]=e))},factory.iconCallFromCS=function(_json,method,p){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")")),!_icons[_json.id]){var icon=NPMapLib.CsObjCaster._castIcon(_json);_icons[_json.id]=icon}var a=_icons[_json.id],arg;"setImageSize"===method?(NPMapLib.Utils.BaseUtils.isTypeRight(p,"string")&&(p=eval("("+p+")")),arg=NPMapLib.CsObjCaster._castSize(p),a.setImageSize(arg)):"setAnchor"===method?(arg=NPMapLib.CsObjCaster._castOffset(p),a.setAnchor(arg)):"setImageUrl"===method?(arg=p,a.setImageUrl(arg)):arg=p}catch(e){alert("icon method err_:"+e.message)}};var _animations={};factory._getAnimation=function(e){if(_animations[e])return _animations[e]},factory._addAnimation=function(e){_animations.id=e},factory.animationCallFromCS=function(_json,method){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")")),!_animations[_json.id]){var o=NPMapLib.CsObjCaster._castAnimation(_json);_animations[_json.id]=o}var a=_animations[_json.id],args=NPMapLib.CsObjCaster._castArgs(arguments);if("setPath"===method&&args.length>0){var p=NPMapLib.Managers.OverlayManager.getOverlay(args[0].id);return p||(p=NPMapLib.CsObjCaster._castOverlay(args[0]),NPMapLib.Managers.OverlayManager.addOverlay(p)),void a.setPath(p)}if(method&&a&&"function"==typeof a[method])return a[method].apply(a,args)}catch(e){alert("animation method err_:"+e.message)}};var _labels={};factory._getLabel=function(e){return _labels[e]},factory._addLabel=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,NPMapLib.Symbols.Label)&&(_labels[e.id]||(_labels[e.id]=e))},factory.labelCallFromCS=function(_json,method,p){try{if(NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")")),!_labels[_json.id]){var o=NPMapLib.CsObjCaster._castLabel(_json);_labels[_json.id]=o}var a=_labels[_json.id],args=NPMapLib.CsObjCaster._castArgs(arguments);if(method&&a&&"function"==typeof a[method])return a[method].apply(a,args)}catch(e){alert("label method err_:"+e.message)}};var drawingToolEx={},jsonTool;return factory.drawingToolExFromCS=function(_json,method){try{NPMapLib.Utils.BaseUtils.isTypeRight(_json,"string")&&(_json=eval("("+_json+")"));var args=NPMapLib.CsObjCaster._castArgs(arguments),win=drawingToolEx[_json.id]||NPMapLib.CsObjCaster._castCSharpeToJs(_json);drawingToolEx[_json.id]=win,jsonTool=jsonTool||new OpenLayers.Format.JSON,"setMode"===method&&win.setMode(args[0],function(e){NPMapLib.callMethod("CallJavasciptMethod",jsonTool.write({Id:_json.StringId,Method:method,Args:e.json}))},args[1])}catch(e){alert("infowin method err_:"+e.message)}},factory}(),NPMapLib.CIRCLE_EVENT_CLICK="click",NPMapLib.CIRCLE_EVENT_DBLCLICK="dblclick",NPMapLib.CIRCLE_EVENT_RIGHT_CLICK="rightclick",NPMapLib.CIRCLE_EVENT_MOUSE_DOWN="mousedown",NPMapLib.CIRCLE_EVENT_MOUSE_UP="mouseup",NPMapLib.CIRCLE_EVENT_MOUSE_OVER="mouseover",NPMapLib.CIRCLE_EVENT_MOUSE_OUT="mouseout",NPMapLib.CIRCLE_EVENT_LINE_UPDATE="lineupdate",NPMapLib.CIRCLE_EVENT_MODIFIED="dragend",NPMapLib.CIRCLE_EVENT_DRAG_START="dragstart",NPMapLib.CIRCLE_EVENT_DRAG_END="dragend",function(){NPMapLib.Geometry.Circle=function(e,t,i){this.overlayType=NPMapLib.OVERLAY_TYPE_CIRCLE,this._center=e,this._radius=t,this._realRadius=t,this._color="#ee9900",this._weight=2,this._opacity=1,this._fillColor="#ee9900",this._fillOpacity=.5,this._lineStyle=NPMapLib.LINE_TYPE_SOLID,this._enableClicking=!0,this.CLASS_NAME="NPMapLib.Geometry.Circle",this.text="",i&&(i.color&&(this._color=i.color),i.fillColor&&(this._fillColor=i.fillColor),i.weight&&(this._weight=i.weight),i.opacity&&(this._opacity=i.opacity),i.fillOpacity&&(this._fillOpacity=i.fillOpacity),i.lineStyle&&(this._lineStyle=i.lineStyle),NPMapLib.Utils.BaseUtils.isTypeRight(i.enableEditing,"boolean")&&(this._enableEditing=i.enableEditing),NPMapLib.Utils.BaseUtils.isTypeRight(i.enableClicking,"boolean")&&(this._enableClicking=i.enableClicking),i.text&&(this.text=i.text),i.strokeColor&&(this._color=i.strokeColor),i.strokeOpacity&&(this._opacity=i.strokeOpacity),i.strokeWidth&&(this._weight=i.strokeWidth))},NPMapLib.Geometry.Circle.prototype=new NPMapLib.Overlay,NPMapLib.Geometry.Circle.prototype.setCenter=function(e){if(NPMapLib.Utils.BaseUtils.isTypeRight(e,"NPMapLib.Geometry.Point")){this._center=e;var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.setOverlayPosition(this,NPMapLib.T.setPoint(t,e))}},NPMapLib.Geometry.Circle.prototype.getCenter=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e){var t=e.getOverlayCenter(this);this._center=t?t:this._center}return this._center},NPMapLib.Geometry.Circle.prototype.setRadius=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,"number")&&(this._radius=e,this._realRadius=e,this.refresh())},NPMapLib.Geometry.Circle.prototype.getRadius=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e){var t=e.getRadius(this);this._radius=t?t:this._radius}return this._radius},NPMapLib.Geometry.Circle.prototype.getRealRadius=function(){return this._realRadius},NPMapLib.Geometry.Circle.prototype.getArea=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(t)return t.getArea(this,e?e:"km")},NPMapLib.Geometry.Circle.prototype.setColor=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,"string")&&(this._color=e)},NPMapLib.Geometry.Circle.prototype.getColor=function(){return this._color},NPMapLib.Geometry.Circle.prototype.setFillColor=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,"string")&&(this._fillColor=e)},NPMapLib.Geometry.Circle.prototype.getFillColor=function(){return this._fillColor},NPMapLib.Geometry.Circle.prototype.setOpacity=function(e){!NPMapLib.Utils.BaseUtils.isTypeRight(e,"number")||e<0||e>1||(this._opacity=e)},NPMapLib.Geometry.Circle.prototype.getOpacity=function(){return this._opacity},NPMapLib.Geometry.Circle.prototype.setFillOpacity=function(e){this._fillOpacity=e},NPMapLib.Geometry.Circle.prototype.getFillOpacity=function(){return this._fillOpacity},NPMapLib.Geometry.Circle.prototype.setWeight=function(e){e&&this._weight!==e&&(this._weight=e)},NPMapLib.Geometry.Circle.prototype.getWeight=function(){return this._weight},NPMapLib.Geometry.Circle.prototype.setLineStyle=function(e){this._lineStyle=e},NPMapLib.Geometry.Circle.prototype.getLineStyle=function(){return this._lineStyle},NPMapLib.Geometry.Circle.prototype.setStyle=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e.color,"string")&&(this._color=e.color),NPMapLib.Utils.BaseUtils.isTypeRight(e.fillColor,"string")&&(this._fillColor=e.fillColor),NPMapLib.Utils.BaseUtils.isTypeRight(e.weight,"number")&&(this._weight=e.weight),NPMapLib.Utils.BaseUtils.isTypeRight(e.opacity,"number")&&e.opacity>=0&&e.opacity<=1&&(this._opacity=e.opacity),NPMapLib.Utils.BaseUtils.isTypeRight(e.fillOpacity,"number")&&e.fillOpacity>=0&&e.fillOpacity<=1&&(this._fillOpacity=e.fillOpacity),NPMapLib.Utils.BaseUtils.isTypeRight(e.lineStyle,"int")&&(this._lineStyle=e.lineStyle),e.text&&(this.text=text),this.refresh();
},NPMapLib.Geometry.Circle.prototype.getExtent=function(){var e=new NPMapLib.Geometry.Extent(0,0,0,0),t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return t&&(e=NPMapLib.T.getExtent(t,t.getOverlayExtent(this))),e},NPMapLib.Geometry.Circle.prototype.addEventListener=function(e,t){var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.addEventListener(this,e,t)},NPMapLib.Geometry.Circle.prototype.removeEventListener=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.removeEventListener(this,e)},NPMapLib.Geometry.Circle.prototype.setFillText=function(e,t){this.text=e;var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.setFillText(this,e,t)},NPMapLib.Geometry.Circle.prototype.getPoints=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e)return NPMapLib.T.getPoints(e,e.getCirclePoints(this))}}(),NPMapLib.CIRCLESECTOR_EVENT_CLICK="click",NPMapLib.CIRCLESECTOR_EVENT_DBLCLICK="dblclick",NPMapLib.CIRCLESECTOR_EVENT_RIGHT_CLICK="rightclick",NPMapLib.CIRCLESECTOR_EVENT_MOUSE_DOWN="mousedown",NPMapLib.CIRCLESECTOR_EVENT_MOUSE_UP="mouseup",NPMapLib.CIRCLESECTOR_EVENT_MOUSE_OVER="mouseover",NPMapLib.CIRCLESECTOR_EVENT_MOUSE_OUT="mouseout",NPMapLib.CIRCLESECTOR_EVENT_LINE_UPDATE="lineupdate",NPMapLib.CIRCLESECTOR_EVENT_MODIFIED="dragend",NPMapLib.CIRCLESECTOR_EVENT_DRAG_START="dragstart",NPMapLib.CIRCLESECTOR_EVENT_DRAG_END="dragend",function(){NPMapLib.Geometry.CircleSector=function(e,t,i,r,n,s){this.overlayType=NPMapLib.OVERLAY_TYPE_CIRCLESECTOR,this._center=e,this._radius=t,this._sides=i,this._antBearing=r,this._lobeAngle=n,this._color="blue",this._fillColor="red",this._opacity=1,this._fillOpacity=.5,this._lineStyle=NPMapLib.LINE_TYPE_SOLID,this._weight=2,this._enableClicking=!0,this.CLASS_NAME="NPMapLib.Geometry.CircleSector",s&&(NPMapLib.Utils.BaseUtils.isTypeRight(s.color,"string")&&(this._color=s.color),NPMapLib.Utils.BaseUtils.isTypeRight(s.fillColor,"string")&&(this._fillColor=s.fillColor),NPMapLib.Utils.BaseUtils.isTypeRight(s.weight,"number")&&(this._weight=s.weight),NPMapLib.Utils.BaseUtils.isTypeRight(s.opacity,"number")&&s.opacity>=0&&s.opacity<=1&&(this._opacity=s.opacity),NPMapLib.Utils.BaseUtils.isTypeRight(s.fillOpacity,"number")&&s.fillOpacity>=0&&s.fillOpacity<=1&&(this._fillOpacity=s.fillOpacity),NPMapLib.Utils.BaseUtils.isTypeRight(s.lineStyle,"int")&&(this._lineStyle=s.lineStyle),NPMapLib.Utils.BaseUtils.isTypeRight(s.enableEditing,"boolean")&&(this._enableEditing=s.enableEditing),NPMapLib.Utils.BaseUtils.isTypeRight(s.enableClicking,"boolean")&&(this._enableClicking=s.enableClicking))},NPMapLib.Geometry.CircleSector.prototype=new NPMapLib.Overlay,NPMapLib.Geometry.CircleSector.prototype.setCenter=function(e){if(NPMapLib.Utils.BaseUtils.isTypeRight(e,"NPMapLib.Geometry.Point")){this._center=e;var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.setOverlayPosition(this,e)}},NPMapLib.Geometry.CircleSector.prototype.getCenter=function(){return this._center},NPMapLib.Geometry.CircleSector.prototype.setRadius=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,"number")&&(this._radius=e)},NPMapLib.Geometry.CircleSector.prototype.getRadius=function(){return this._radius},NPMapLib.Geometry.CircleSector.prototype.setColor=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,"string")&&(this._color=e)},NPMapLib.Geometry.CircleSector.prototype.setSides=function(e){this._sides=e},NPMapLib.Geometry.CircleSector.prototype.getSides=function(){return this._sides},NPMapLib.Geometry.CircleSector.prototype.setAntBearing=function(e){this._antBearing=e},NPMapLib.Geometry.CircleSector.prototype.getAntBearing=function(){return this._antBearing},NPMapLib.Geometry.CircleSector.prototype.getLobeAngle=function(){return this._lobeAngle},NPMapLib.Geometry.CircleSector.prototype.getColor=function(){return this._color},NPMapLib.Geometry.CircleSector.prototype.setFillColor=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,"string")&&(this._fillColor=e)},NPMapLib.Geometry.CircleSector.prototype.getFillColor=function(){return this._fillColor},NPMapLib.Geometry.CircleSector.prototype.setOpacity=function(e){!NPMapLib.Utils.BaseUtils.isTypeRight(e,"number")||e<0||e>1||(this._opacity=e)},NPMapLib.Geometry.CircleSector.prototype.getOpacity=function(){return this._opacity},NPMapLib.Geometry.CircleSector.prototype.setFillOpacity=function(e){this._fillOpacity=e},NPMapLib.Geometry.CircleSector.prototype.getFillOpacity=function(){return this._fillOpacity},NPMapLib.Geometry.CircleSector.prototype.setWeight=function(e){e&&this._weight!==e&&(this._weight=e)},NPMapLib.Geometry.CircleSector.prototype.getWeight=function(){return this._weight},NPMapLib.Geometry.CircleSector.prototype.setLineStyle=function(e){this._lineStyle=e},NPMapLib.Geometry.CircleSector.prototype.getLineStyle=function(){return this._lineStyle},NPMapLib.Geometry.CircleSector.prototype.getExtent=function(){var e=new NPMapLib.Geometry.Extent(0,0,0,0),t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return t&&(e=Netposa.T.getExtent(t,t.getOverlayExtent(this))),e},NPMapLib.Geometry.CircleSector.prototype.addEventListener=function(e,t){var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.addEventListener(this,e,t)},NPMapLib.Geometry.CircleSector.prototype.removeEventListener=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.removeEventListener(this,e)}}(),function(){NPMapLib.Geometry.Extent=function(e,t,i,r){if(this.sw,this.ne,this.top,this.left,this.bottom,this.right,2===arguments.length){if(!(e instanceof NPMapLib.Geometry.Point&&t instanceof NPMapLib.Geometry.Point))return NPMapLib.Utils.BaseUtils("Argument exception");this.sw=e,this.ne=t}else 4===arguments.length&&(this.sw=new NPMapLib.Geometry.Point(e,t),this.ne=new NPMapLib.Geometry.Point(i,r));this.sw&&(this.left=this.sw.lon,this.bottom=this.sw.lat),this.ne&&(this.right=this.ne.lon,this.top=this.ne.lat),this.CLASS_NAME="NPMapLib.Geometry.Extent"},NPMapLib.Geometry.Extent.prototype.equals=function(e){return e instanceof NPMapLib.Geometry.Extent&&(this.sw.lon===e.sw.lon&&this.sw.lat===e.sw.lat&&this.ne.lon===e.ne.lon&&this.ne.lat===e.ne.lat)},NPMapLib.Geometry.Extent.prototype.containsPoint=function(e){return this.sw.lon<=e.lon&&this.ne.lon>=e.lon&&this.sw.lat<=e.lat&&this.ne.lat>=e.lat},NPMapLib.Geometry.Extent.prototype.containsExtent=function(e){return this.left<=e.left&&this.bottom<=e.bottom&&this.right>=e.right&&this.top>=e.top},NPMapLib.Geometry.Extent.prototype.intersects=function(e,t){if("boolean"==typeof t&&(t={inclusive:t}),t=t||{},t.worldBounds){var i=this.wrapDateLine(t.worldBounds);e=e.wrapDateLine(t.worldBounds)}else i=this;null==t.inclusive&&(t.inclusive=!0);var r=!1,n=i.left===e.right||i.right===e.left||i.top===e.bottom||i.bottom===e.top;if(t.inclusive||!n){var s=e.bottom>=i.bottom&&e.bottom<=i.top||i.bottom>=e.bottom&&i.bottom<=e.top,o=e.top>=i.bottom&&e.top<=i.top||i.top>e.bottom&&i.top<e.top,a=e.left>=i.left&&e.left<=i.right||i.left>=e.left&&i.left<=e.right,l=e.right>=i.left&&e.right<=i.right||i.right>=e.left&&i.right<=e.right;r=(s||o)&&(a||l)}if(t.worldBounds&&!r){var p=t.worldBounds,h=p.getWidth(),u=!p.containsBounds(i),y=!p.containsBounds(e);u&&!y?(e=e.add(-h,0),r=i.intersectsBounds(e,{inclusive:t.inclusive})):y&&!u&&(i=i.add(-h,0),r=e.intersectsBounds(i,{inclusive:t.inclusive}))}return r},NPMapLib.Geometry.Extent.prototype.extend=function(e){},NPMapLib.Geometry.Extent.prototype.getCenter=function(){var e=(this.sw.lat+this.ne.lat)/2,t=(this.sw.lon+this.ne.lon)/2;return new NPMapLib.Geometry.Point(t,e)},NPMapLib.Geometry.Extent.prototype.isEmpty=function(){return!1},NPMapLib.Geometry.Extent.prototype.getSouthWest=function(){return this.sw},NPMapLib.Geometry.Extent.prototype.getNorthEast=function(){return this.ne},NPMapLib.Geometry.Extent.prototype.toString=function(){return[this.left,this.bottom,this.right,this.top].join(",")}}(),function(){NPMapLib.Geometry.Pixel=function(e,t){this.x=e,this.y=t,this.CLASS_NAME="NPMapLib.Geometry.Pixel"},NPMapLib.Geometry.Pixel.prototype.equals=function(e){return e instanceof NPMapLib.Geometry.Pixel&&(this.x===e.x&&this.y===e.y)},NPMapLib.Geometry.Pixel.prototype.toString=function(){return this.x+","+this.y}}(),NPMapLib.ELLIPSE_EVENT_CLICK="click",NPMapLib.ELLIPSE_EVENT_DBLCLICK="dblclick",NPMapLib.ELLIPSE_EVENT_RIGHT_CLICK="rightclick",NPMapLib.ELLIPSE_EVENT_MOUSE_DOWN="mousedown",NPMapLib.ELLIPSE_EVENT_MOUSE_UP="mouseup",NPMapLib.ELLIPSE_EVENT_MOUSE_OVER="mouseover",NPMapLib.ELLIPSE_EVENT_MOUSE_OUT="mouseout",NPMapLib.ELLIPSE_EVENT_LINE_UPDATE="lineupdate",NPMapLib.ELLIPSE_EVENT_MODIFIED="dragend",NPMapLib.ELLIPSE_EVENT_DRAG_START="dragstart",NPMapLib.ELLIPSE_EVENT_DRAG_END="dragend",function(){NPMapLib.Geometry.Ellipse=function(e,t,i,r){this.overlayType=NPMapLib.OVERLAY_TYPE_ELLIPSE,this._firstPoint=e,this._secondPoint=t,this._distance=i,this._color="#ee9900",this._weight=2,this._opacity=1,this._fillColor="#ee9900",this._fillOpacity=.5,this._lineStyle=NPMapLib.LINE_TYPE_SOLID,this._enableClicking=!0,this.CLASS_NAME="NPMapLib.Geometry.ellipse",this.text="",r&&(r.color&&(this._color=r.color),r.fillColor&&(this._fillColor=r.fillColor),r.weight&&(this._weight=r.weight),r.opacity&&(this._opacity=r.opacity),r.fillOpacity&&(this._fillOpacity=r.fillOpacity),r.lineStyle&&(this._lineStyle=r.lineStyle),NPMapLib.Utils.BaseUtils.isTypeRight(r.enableEditing,"boolean")&&(this._enableEditing=r.enableEditing),NPMapLib.Utils.BaseUtils.isTypeRight(r.enableClicking,"boolean")&&(this._enableClicking=r.enableClicking),r.text&&(this.text=r.text),r.strokeColor&&(this._color=r.strokeColor),r.strokeOpacity&&(this._opacity=r.strokeOpacity),r.strokeWidth&&(this._weight=r.strokeWidth))},NPMapLib.Geometry.Ellipse.prototype=new NPMapLib.Overlay,NPMapLib.Geometry.Ellipse.prototype.setCenter=function(e){if(NPMapLib.Utils.BaseUtils.isTypeRight(e,"NPMapLib.Geometry.Point")){this._center=e;var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.setOverlayPosition(this,NPMapLib.T.setPoint(t,e))}},NPMapLib.Geometry.Ellipse.prototype.getCenter=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e){var t=e.getOverlayCenter(this);this._center=t?t:this._center}return this._center},NPMapLib.Geometry.Ellipse.prototype.getArea=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(t)return t.getArea(this,e?e:"km")},NPMapLib.Geometry.Ellipse.prototype.setColor=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,"string")&&(this._color=e)},NPMapLib.Geometry.Ellipse.prototype.getColor=function(){return this._color},NPMapLib.Geometry.Ellipse.prototype.setFillColor=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,"string")&&(this._fillColor=e)},NPMapLib.Geometry.Ellipse.prototype.getFillColor=function(){return this._fillColor},NPMapLib.Geometry.Ellipse.prototype.setOpacity=function(e){!NPMapLib.Utils.BaseUtils.isTypeRight(e,"number")||e<0||e>1||(this._opacity=e)},NPMapLib.Geometry.Ellipse.prototype.getOpacity=function(){return this._opacity},NPMapLib.Geometry.Ellipse.prototype.setFillOpacity=function(e){this._fillOpacity=e},NPMapLib.Geometry.Ellipse.prototype.getFillOpacity=function(){return this._fillOpacity},NPMapLib.Geometry.Ellipse.prototype.setWeight=function(e){e&&this._weight!==e&&(this._weight=e)},NPMapLib.Geometry.Ellipse.prototype.getWeight=function(){return this._weight},NPMapLib.Geometry.Ellipse.prototype.setLineStyle=function(e){this._lineStyle=e},NPMapLib.Geometry.Ellipse.prototype.getLineStyle=function(){return this._lineStyle},NPMapLib.Geometry.Ellipse.prototype.setStyle=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e.color,"string")&&(this._color=e.color),NPMapLib.Utils.BaseUtils.isTypeRight(e.fillColor,"string")&&(this._fillColor=e.fillColor),NPMapLib.Utils.BaseUtils.isTypeRight(e.weight,"number")&&(this._weight=e.weight),NPMapLib.Utils.BaseUtils.isTypeRight(e.opacity,"number")&&e.opacity>=0&&e.opacity<=1&&(this._opacity=e.opacity),NPMapLib.Utils.BaseUtils.isTypeRight(e.fillOpacity,"number")&&e.fillOpacity>=0&&e.fillOpacity<=1&&(this._fillOpacity=e.fillOpacity),NPMapLib.Utils.BaseUtils.isTypeRight(e.lineStyle,"int")&&(this._lineStyle=e.lineStyle),e.text&&(this.text=text),this.refresh()},NPMapLib.Geometry.Ellipse.prototype.getExtent=function(){var e=new NPMapLib.Geometry.Extent(0,0,0,0),t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return t&&(e=NPMapLib.T.getExtent(t,t.getOverlayExtent(this))),e},NPMapLib.Geometry.Ellipse.prototype.addEventListener=function(e,t){var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.addEventListener(this,e,t)},NPMapLib.Geometry.Ellipse.prototype.removeEventListener=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.removeEventListener(this,e)},NPMapLib.Geometry.Ellipse.prototype.setFillText=function(e,t){this.text=e;var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.setFillText(this,e,t)},NPMapLib.Geometry.Ellipse.prototype.getPoints=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e)return NPMapLib.T.getPoints(e,e.getCirclePoints(this))}}(),NPMapLib.POLYGON_EVENT_CLICK="click",NPMapLib.POLYGON_EVENT_DBLCLICK="dblclick",NPMapLib.POLYGON_EVENT_RIGHT_CLICK="rightclick",NPMapLib.POLYGON_EVENT_MOUSE_DOWN="mousedown",NPMapLib.POLYGON_EVENT_MOUSE_UP="mouseup",NPMapLib.POLYGON_EVENT_MOUSE_OVER="mouseover",NPMapLib.POLYGON_EVENT_MOUSE_OUT="mouseout",NPMapLib.POLYGON_EVENT_LINE_UPDATE="lineupdate",NPMapLib.POLYGON_EVENT_MODIFIED="dragend",NPMapLib.POLYGON_EVENT_DRAG_START="dragstart",NPMapLib.POLYGON_EVENT_DRAG_END="dragend",function(){NPMapLib.Geometry.Polygon=function(e,t){this.CLASS_NAME="NPMapLib.Geometry.Polygon",this.overlayType=NPMapLib.OVERLAY_TYPE_POLYGON,this._points=e,this._color="#ee9900",this._weight=2,this._opacity=1,this._fillColor="#ee9900",this._fillOpacity=.5,this._pointRadius=5,this._lineStyle=NPMapLib.LINE_TYPE_SOLID,this._enableEditing=!1,this._enableClicking=!0,this.text="",this.fontSize=12,this._graphicZIndex=-1,t&&(t.color&&(this._color=t.color),t.fillColor&&(this._fillColor=t.fillColor),t.weight&&(this._weight=t.weight),t.opacity&&(this._opacity=t.opacity),t.fillOpacity&&(this._fillOpacity=t.fillOpacity),t.lineStyle&&(this._lineStyle=t.lineStyle),t.enableEditing&&(this._enableEditing=t.enableEditing),t.enableClicking&&(this._enableClicking=t.enableClicking),t.text&&(this.text=t.text),t.pointRadius&&(this._pointRadius=t.pointRadius),t.strokeColor&&(this._color=t.strokeColor),t.strokeOpacity&&(this._opacity=t.strokeOpacity),t.strokeWidth&&(this._weight=t.strokeWidth))},NPMapLib.Geometry.Polygon.prototype=new NPMapLib.Overlay,NPMapLib.Geometry.Polygon.prototype.setPath=function(e){this._points=e;var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e[0].lon)e=NPMapLib.T.setPoints(t,e);else for(var i=0;i<e.length;i++)e[i]=NPMapLib.T.setPoints(t,e[i]);if(this._apiObj){if(e[0].lon){this._apiObj.geometry.components[0].components=[];for(var i=0;i<e.length-1;i++){var r=new OpenLayers.Geometry.Point(e[i].lon,e[i].lat);this._apiObj.geometry.components[0].components.push(r),r.parent=this._apiObj.geometry.components[0]}this._apiObj.geometry.components[0].components.push(this._apiObj.geometry.components[0].components[0]),this._apiObj.geometry.components[0].clearBounds()}else for(var n=0;n<e.length;n++){this._apiObj.geometry.components[n].components=[];for(var i=0;i<e[n].length-1;i++){var r=new OpenLayers.Geometry.Point(e[n][i].lon,e[n][i].lat);this._apiObj.geometry.components[n].components.push(r),r.parent=this._apiObj.geometry.components[n]}this._apiObj.geometry.components[n].components.push(this._apiObj.geometry.components[n].components[0]),this._apiObj.geometry.components[n].clearBounds()}this.refresh(),t&&t.resetEditVertices()}},NPMapLib.Geometry.Polygon.prototype.getPath=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e){var t=e.getOverlayPosition(this);t&&(t=NPMapLib.T.getPoints(e,t),this._points=t)}return this._points},NPMapLib.Geometry.Polygon.prototype.setColor=function(e){this._color=e},NPMapLib.Geometry.Polygon.prototype.getColor=function(){return this._color},NPMapLib.Geometry.Polygon.prototype.setFillColor=function(e){this._fillColor=e},NPMapLib.Geometry.Polygon.prototype.getFillColor=function(){return this._fillColor},NPMapLib.Geometry.Polygon.prototype.setOpacity=function(e){this._opacity=e},NPMapLib.Geometry.Polygon.prototype.getOpacity=function(){return this._opacity},NPMapLib.Geometry.Polygon.prototype.setFillOpacity=function(e){this._fillOpacity=e},NPMapLib.Geometry.Polygon.prototype.getFillOpacity=function(){return this._fillOpacity},NPMapLib.Geometry.Polygon.prototype.setWeight=function(e){this._weight=e},NPMapLib.Geometry.Polygon.prototype.getWeight=function(){return this._weight},NPMapLib.Geometry.Polygon.prototype.setLineStyle=function(e){this._lineStyle=e},NPMapLib.Geometry.Polygon.prototype.getLineStyle=function(){return this._lineStyle},NPMapLib.Geometry.Polygon.prototype.getPointRadius=function(){return this._pointRadius},NPMapLib.Geometry.Polygon.prototype.setStyle=function(e){e.color&&(this._color=e.color),e.fillColor&&(this._fillColor=e.fillColor),e.weight&&(this._weight=e.weight),e.opacity&&(this._opacity=e.opacity),e.fillOpacity&&(this._fillOpacity=e.fillOpacity),e.lineStyle&&(this._lineStyle=e.lineStyle),e.text&&(this.text=e.text),this.refresh&&this.refresh()},NPMapLib.Geometry.Polygon.prototype.getExtent=function(){var e=new NPMapLib.Geometry.Extent(0,0,0,0),t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);return t&&(e=NPMapLib.T.getExtent(t,t.getOverlayExtent(this))),e},NPMapLib.Geometry.Polygon.prototype.setPositionAt=function(e,t){!this._points||e>this._points.length-1||e<0||this._points.splice(e,0,t)},NPMapLib.Geometry.Polygon.prototype.addEventListener=function(e,t){var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.addEventListener(this,e,t)},NPMapLib.Geometry.Polygon.prototype.removeEventListener=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.removeEventListener(this,e)},NPMapLib.Geometry.Polygon.prototype.setFillText=function(e,t,i){this.text=e;var r=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);r&&r.setFillText(this,e,t,i)},NPMapLib.Geometry.Polygon.prototype.getArea=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(t)return t.getArea(this,e?e:"km")}}(),NPMapLib.POLYLINE_EVENT_CLICK="click",NPMapLib.POLYLINE_EVENT_DBLCLICK="dblclick",NPMapLib.POLYLINE_EVENT_RIGHT_CLICK="rightclick",NPMapLib.POLYLINE_EVENT_MOUSE_DOWN="mousedown",NPMapLib.POLYLINE_EVENT_MOUSE_UP="mouseup",NPMapLib.POLYLINE_EVENT_MOUSE_OVER="mouseover",NPMapLib.POLYLINE_EVENT_MOUSE_OUT="mouseout",NPMapLib.POLYLINE_EVENT_LINE_UPDATE="lineupdate",NPMapLib.POLYLINE_EVENT_LINE_MODIFIED="dragend",NPMapLib.POLYLINE_EVENT_DRAG_START="dragstart",NPMapLib.POLYLINE_EVENT_DRAG_END="dragend",function(){var e={calculateArrowLines:function(e,t,i,r){var n=[];i||(i=10),r||(r=Math.PI/6);var s=this.calculateDistance(e,t),o=this.toVector(e,t),a=this.calculateVector(o,r,s/i),l=new OpenLayers.Geometry.Point(a[0].x+t.lon,a[0].y+t.lat),p=new OpenLayers.Geometry.Point(a[1].x+t.lon,a[1].y+t.lat);return n.push([t,new NPMapLib.Geometry.Point(l.x,l.y)]),n.push([t,new NPMapLib.Geometry.Point(p.x,p.y)]),n},calculateDistance:function(e,t){var i=Math.sqrt(Math.pow(e.lon-t.lon,2)+Math.pow(e.lat-t.lat,2));return i},toVector:function(e,t){return{lon:e.lon-t.lon,lat:e.lat-t.lat}},calculateVector:function(e,t,i){t||(t=Math.PI/2),i||(i=1);var r,n,s,o,a,l,p=Math.sqrt(e.lon*e.lon+e.lat*e.lat);if(0==e.lat)r=n=p*i*Math.cos(t)/e.lon,e.lon>0?(s=Math.sqrt(i*i-r*r),o=-s):e.lon<0&&(o=Math.sqrt(i*i-r*r),s=-o),a=new OpenLayers.Geometry.Point(r,s),l=new OpenLayers.Geometry.Point(n,o);else{var h=-e.lon/e.lat,u=i*p*Math.cos(t)/e.lat,t=1+h*h,y=2*h*u,c=u*u-i*i;r=(-y-Math.sqrt(y*y-4*t*c))/(2*t),n=(-y+Math.sqrt(y*y-4*t*c))/(2*t),s=h*r+u,o=h*n+u,e.lat>=0?(a=new OpenLayers.Geometry.Point(r,s),l=new OpenLayers.Geometry.Point(n,o)):e.lat<0&&(a=new OpenLayers.Geometry.Point(n,o),l=new OpenLayers.Geometry.Point(r,s))}return[a,l]}};NPMapLib.Geometry.Polyline=function(e,t){this.CLASS_NAME="NPMapLib.Geometry.Polyline",this.overlayType=NPMapLib.OVERLAY_TYPE_POLYLINE,this._points=e,this._color="#ee9900",this._weight=2,this._opacity=1,this._fillColor="#ee9900",this._fillOpacity=.5,this._pointRadius=5,this._lineStyle=NPMapLib.LINE_TYPE_SOLID,this._arrowStyle=NPMapLib.LINE_ARROW_TYPE_NULL,this._enableEditing=!1,this._enableClicking=!0,t&&(t.arrowStyle&&(this._arrowStyle=t.arrowStyle),t.color&&(this._color=t.color),t.fillColor&&(this._fillColor=t.fillColor),t.weight&&(this._weight=t.weight),t.opacity&&(this._opacity=t.opacity),t.fillOpacity&&(this._fillOpacity=t.fillOpacity),t.lineStyle&&(this._lineStyle=t.lineStyle),NPMapLib.Utils.BaseUtils.isTypeRight(t.enableEditing,"boolean")&&(this._enableEditing=t.enableEditing),NPMapLib.Utils.BaseUtils.isTypeRight(t.enableClicking,"boolean")&&(this._enableClicking=t.enableClicking),t.text&&(this.text=t.text),t.pointRadius&&(this._pointRadius=t.pointRadius),t.strokeColor&&(this._color=t.strokeColor),t.strokeOpacity&&(this._opacity=t.strokeOpacity),t.strokeWidth&&(this._weight=t.strokeWidth))},NPMapLib.Geometry.Polyline.prototype=new NPMapLib.Overlay,NPMapLib.Geometry.Polyline.prototype.createArrowLines=function(t,i){var r,n=this.getPath();return r=t?e.calculateArrowLines(n[n.length-1],n[n.length-2]):e.calculateArrowLines(n[0],n[1]),[new NPMapLib.Geometry.Polyline(r[0],i),new NPMapLib.Geometry.Polyline(r[1],i)]},NPMapLib.Geometry.Polyline.prototype.setPath=function(e){if(this._points=e,this._apiObj){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e=NPMapLib.T.setPoints(t,e),this._apiObj.geometry.components=[];for(var i=0;i<e.length;i++){var r=new OpenLayers.Geometry.Point(e[i].lon,e[i].lat);this._apiObj.geometry.components.push(r),r.parent=this._apiObj.geometry}this._apiObj.geometry.clearBounds(),this.refresh(),t&&t.resetEditVertices()}},NPMapLib.Geometry.Polyline.prototype.addPoint=function(e){if(this._points.push(e),this._apiObj){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e=NPMapLib.T.setPoint(t,e);var i=new OpenLayers.Geometry.Point(e.lon,e.lat);this._apiObj.geometry.components.push(i),i.parent=this._apiObj.geometry,this._apiObj.geometry.clearBounds(),this.refresh()}},NPMapLib.Geometry.Polyline.prototype.getPath=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e){var t=e.getOverlayPosition(this);t&&(t=NPMapLib.T.getPoints(e,t),this._points=t)}return this._points},NPMapLib.Geometry.Polyline.prototype.setStyle=function(e){e instanceof Object&&(e.color&&(this._color=e.color),e.opacity&&(this._opacity=e.opacity),e.weight&&(this._weight=e.weight),e.lineStyle&&(this._lineStyle=e.lineStyle),e.arrowStyle&&(this._arrowStyle=e.arrowStyle))},NPMapLib.Geometry.Polyline.prototype.setColor=function(e){this._color=e},NPMapLib.Geometry.Polyline.prototype.getColor=function(){return this._color},NPMapLib.Geometry.Polyline.prototype.setOpacity=function(e){e<0||e>1||(this._opacity=e)},NPMapLib.Geometry.Polyline.prototype.getOpacity=function(){return this._opacity},NPMapLib.Geometry.Polyline.prototype.setWeight=function(e){e<1||(this._weight=e)},NPMapLib.Geometry.Polyline.prototype.getWeight=function(){return this._weight},NPMapLib.Geometry.Polyline.prototype.setLineStyle=function(e){this._lineStyle=e},NPMapLib.Geometry.Polyline.prototype.getLineStyle=function(){return this._lineStyle},NPMapLib.Geometry.Polyline.prototype.setArrowStyle=function(e){this._arrowStyle=e},NPMapLib.Geometry.Polyline.prototype.getArrowStyle=function(){return this._arrowStyle},NPMapLib.Geometry.Polyline.prototype.getExtent=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e)return NPMapLib.T.getExtent(e,e.getOverlayExtent(this));for(var t=this._points[0].lon,i=this._points[0].lat,r=this._points[0].lon,n=this._points[0].lat,s=this._points.length-1;s>=1;s--)this._points[s].lon<t&&(t=this._points[s].lon),this._points[s].lon>r&&(r=this._points[s].lon),this._points[s].lat<i&&(i=this._points[s].lat),this._points[s].lat>n&&(n=this._points[s].lat);return new NPMapLib.Geometry.Extent(t,i,r,n)},NPMapLib.Geometry.Polyline.prototype.getStartPoint=function(){return this.getPath()[0]},NPMapLib.Geometry.Polyline.prototype.getEndPoint=function(){var e=this.getPath(),t=e.length;return e[t-1]},NPMapLib.Geometry.Polyline.prototype.setPositionAt=function(e,t){!this._points||e>this._points.length-1||e<0||this._points.splice(e,0,t)},NPMapLib.Geometry.Polyline.prototype.getLength=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId),t=0;if(e)for(var i=1;i<this._points.length;i++)t+=e.getDistance(this._points[i],this._points[i-1]);return t},NPMapLib.Geometry.Polyline.prototype.addEventListener=function(e,t){var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.addEventListener(this,e,t)},NPMapLib.Geometry.Polyline.prototype.removeEventListener=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.removeEventListener(this,e)}}(),NPMapLib.ANIMATION_EVENT_START="start",NPMapLib.ANIMATION_EVENT_PAUSE="pause",NPMapLib.ANIMATION_EVENT_STOP="stop",NPMapLib.ANIMATION_EVENT_MOVING="moving",NPMapLib.ANIMATION_EVENT_MOVED="moved",function(){NPMapLib.Symbols.Animation=function(e,t,i){this.id=-1,this.CLASS_NAME="NPMapLib.Symbols.Animation",this._points=new Array,NPMapLib.Utils.BaseUtils.isTypeRight(t,"NPMapLib.Overlay")&&(this._overlay=t),this._listeners={},this._initialize(),this.mapAdapter=NPMapLib.Adapter.AdapterFactory.getMapAdapter(e),i&&(NPMapLib.Utils.BaseUtils.isTypeRight(i.speed,"number")&&(this._speed=i.speed),NPMapLib.Utils.BaseUtils.isTypeRight(i.isReturn,"boolean")&&(this._isReturn=i.isReturn),NPMapLib.Utils.BaseUtils.isTypeRight(i.isRepeat,"boolean")&&(this._isRepeat=i.isRepeat))},NPMapLib.Symbols.Animation.prototype.setPath=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,"NPMapLib.Geometry.Polyline")&&(this._path=e,this._points=e.getPath())},NPMapLib.Symbols.Animation.prototype.getPath=function(){return this._path},NPMapLib.Symbols.Animation.prototype.getOverlay=function(){return this._overlay},NPMapLib.Symbols.Animation.prototype.setRepeat=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,"boolean")&&(this._isRepeat=e)},NPMapLib.Symbols.Animation.prototype.setReturn=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,"boolean")&&(this._isReturn=e)},NPMapLib.Symbols.Animation.prototype.setSpeed=function(e){NPMapLib.Utils.BaseUtils.isTypeRight(e,"number")&&(this._speed=e)},NPMapLib.Symbols.Animation.prototype.start=function(){if(this.stop(),NPMapLib.Utils.BaseUtils.isTypeRight(this._overlay,"NPMapLib.Overlay")&&NPMapLib.Utils.BaseUtils.isTypeRight(this._points,"Array")&&!(this._points.length<=1)){this._interval=100,this._isPause=!1,this._curPointIndex=0,this._overlay.setPosition(this._points[0]);var e=this._getAngle(this._points[0],this._points[1]);this._changeAngle(e),this._calculateSegment(this._points[0],this._points[1]),this._triggerEvent(NPMapLib.ANIMATION_EVENT_START,this._points[0]),this._startTimer()}},NPMapLib.Symbols.Animation.prototype.pause=function(){this._isPause=!this._isPause,this._triggerEvent(NPMapLib.ANIMATION_EVENT_PAUSE,this._points[this._curPointIndex])},NPMapLib.Symbols.Animation.prototype.stop=function(){this._timer&&window.clearInterval(this._timer),this._triggerEvent(NPMapLib.ANIMATION_EVENT_STOP,this._points[this._curPointIndex])},NPMapLib.Symbols.Animation.prototype.addEventListener=function(e,t){switch(e){case NPMapLib.ANIMATION_EVENT_START:this._listeners.start||(this._listeners.start=[]),this._listeners.start.push(t);break;case NPMapLib.ANIMATION_EVENT_PAUSE:this._listeners.pause||(this._listeners.pause=[]),this._listeners.pause.push(t);break;case NPMapLib.ANIMATION_EVENT_STOP:this._listeners.stop||(this._listeners.stop=[]),this._listeners.stop.push(t);break;case NPMapLib.ANIMATION_EVENT_MOVING:this._listeners.moving||(this._listeners.moving=[]),this._listeners.moving.push(t);break;case NPMapLib.ANIMATION_EVENT_MOVED:this._listeners.moved||(this._listeners.moved=[]),this._listeners.moved.push(t)}},NPMapLib.Symbols.Animation.prototype.removeEventListener=function(e,t){var i=this._listeners[e];if(i instanceof Array)for(var r=0;r<i.length;++r)if(i[r].toString()===t.toString()){i.pop(t);break}},NPMapLib.Symbols.Animation.prototype._initialize=function(){this._angle=0,this._isIncreaseDirection=!0,this._curPointIndex=0,this._interval=100,this._isReturn=!0,this._isRepeat=!0},NPMapLib.Symbols.Animation.prototype._startTimer=function(){this._timer=setInterval(function(){this._isPause||this._actionStart()}.bind(this),this._interval)},NPMapLib.Symbols.Animation.prototype._actionStart=function(){this._triggerEvent(NPMapLib.ANIMATION_EVENT_MOVING,this._points[this._curPointIndex]);var e=this._getNextPoint();if(this._moveTo(e),this._triggerEvent(NPMapLib.ANIMATION_EVENT_MOVED,e),this._curSegCount>=this._totalSegCount){if(this._points.length-1===this._curPointIndex)if(this._isRepeat&&!this._isReturn)this._curPointIndex=0;else if(this._isRepeat&&this._isReturn);else{if(this._isRepeat||!this._isReturn)return void this.stop();this._isHaveReturn=!0}if(this._isHaveReturn&&0===this._curPointIndex)return void this.stop();this._turningPoint()}else this._curSegCount++},NPMapLib.Symbols.Animation.prototype._getNextPoint=function(){return this._curSegCount>=this._totalSegCount?(this._isIncreaseDirection?++this._curPointIndex:--this._curPointIndex,this._points[this._curPointIndex]):this._isIncreaseDirection?this._getPoint(this._points[this._curPointIndex],this._points[this._curPointIndex+1]):this._getPoint(this._points[this._curPointIndex],this._points[this._curPointIndex-1])},NPMapLib.Symbols.Animation.prototype._getPoint=function(e,t){var i=this.mapAdapter.pointToPixel(NPMap.T.setPoint(this.mapAdapter,e)),r=this.mapAdapter.pointToPixel(NPMap.T.setPoint(this.mapAdapter,t)),n=this._curSegCount/this._totalSegCount,s=(r.x-i.x)*n+i.x,o=(r.y-i.y)*n+i.y;EzServerClient.GlobeParams.VML;var a=new NPMapLib.Geometry.Pixel(s,o);return NPMap.T.getPoint(this.mapAdapter,this.mapAdapter.pixelToPoint(a))},NPMapLib.Symbols.Animation.prototype._turningPoint=function(){var e=this._curPointIndex;if((e>=this._points.length-1||e<=0)&&(this._isIncreaseDirection=this._isReturn?this._isIncreaseDirection:!this._isIncreaseDirection),this._isIncreaseDirection){this._calculateSegment(this._points[e],this._points[e+1]);var t=this._getAngle(this._points[e],this._points[e+1]);this._changeAngle(t)}else{this._calculateSegment(this._points[e],this._points[e-1]);var t=this._getAngle(this._points[e],this._points[e-1]);this._changeAngle(t)}},NPMapLib.Symbols.Animation.prototype._calculateSegment=function(e,t){var i=this._getDistance(e,t),r=i/(this._speed*this._interval/1e3);this._totalSegCount=Math.ceil(r)-1,this._curSegCount=0},NPMapLib.Symbols.Animation.prototype._getDistance=function(e,t){return this.mapAdapter.getDistance(e,t,"EPSG:4326")},NPMapLib.Symbols.Animation.prototype._moveTo=function(e){this.mapAdapter.setOverlayPosition(this._overlay,NPMap.T.setPoint(this.mapAdapter,e))},NPMapLib.Symbols.Animation.prototype._getAngle=function(e,t){var i=180*Math.atan2(t.lat-e.lat,t.lon-e.lon)/Math.PI;return i=i>0?360-i:0-i},NPMapLib.Symbols.Animation.prototype._changeAngle=function(e){this._angle!=e&&this._overlay instanceof NPMapLib.Overlay&&(this._overlay.rotate(e),this._angle=e)},NPMapLib.Symbols.Animation.prototype._triggerEvent=function(e,t){var i=this._listeners[e];if(i instanceof Array)for(var r=0;r<i.length;++r)i[r].apply(this,t)}}(),NPMapLib.Symbols.Animation.Options={speed:100,isReturn:!0,isRepeat:!0},function(){NPMapLib.Symbols.Icon=function(e,t,i){this.CLASS_NAME="NPMapLib.Symbols.Icon",this.id=-1,this.border=0,t instanceof NPMapLib.Geometry.Size&&(this._imageUrl=e,this._imageSize=t,this._anchor=new NPMapLib.Geometry.Size(-t.width/2,(-t.height)),
i&&(i.anchor&&(this._anchor=i.anchor),i.border&&(this.border=i.border)))},NPMapLib.Symbols.Icon.prototype.setImageUrl=function(e){"string"==typeof e&&(this._imageUrl=e)},NPMapLib.Symbols.Icon.prototype.getImageUrl=function(){return this._imageUrl},NPMapLib.Symbols.Icon.prototype.setImageSize=function(e){e instanceof NPMapLib.Geometry.Size&&(this._imageSize=e)},NPMapLib.Symbols.Icon.prototype.getImageSize=function(){return this._imageSize},NPMapLib.Symbols.Icon.prototype.setAnchor=function(e){e instanceof NPMapLib.Geometry.Size&&(this._anchor=e)},NPMapLib.Symbols.Icon.prototype.getAnchor=function(){return this._anchor}}(),NPMapLib.INFOWINDOW_EVENT_CLOSE="close",NPMapLib.INFOWINDOW_EVENT_OPEN="open",NPMapLib.INFOWINDOW_EVENT_HIDE="hide",NPMapLib.INFOWINDOW_EVENT_CLICK_CLOSE="clickclose",function(){NPMapLib.Symbols.InfoWindow=function(e,t,i,r){this.CLASS_NAME="NPMapLib.Symbols.InfoWindow",this.overlayType=NPMapLib.OVERLAY_TYPE_INFOWIN,this.id=-1,this._title=t,this._content="",this._dom=null,"string"==typeof i?this._content=i:this._dom=i,this._position=e,this._isOpen=!1,this._offset=new NPMapLib.Geometry.Size(1,1),this._width=260,this._height=180,this._arrow=!0,this._enableCloseOnClick=!1,this._eventHandle={};var n=this;if(this.autoSize=!0,this.iscommon=!1,this._enableCloseOnClick=!1,this.positionBlock={},this.paddingForPopups=new NPMapLib.Geometry.Extent(70,20,15,15),this._closeCallback=function(){n.close()},this.isAdaptation=!1,this.isAnimationOpen=!0,r){if(r.width&&(this._width=r.width),r.height&&(this._height=r.height),r.offset&&(this._offset=r.offset),(r.iscommon||0==r.iscommon)&&(this.iscommon=r.iscommon),"boolean"==typeof r.arrow&&(this._arrow=r.arrow),"boolean"==typeof r.enableCloseOnClick&&(this._enableCloseOnClick=r.enableCloseOnClick),"boolean"==typeof r.autoSize&&(this.autoSize=r.autoSize),r.paddingForPopups instanceof NPMapLib.Geometry.Extent&&(this.paddingForPopups=r.paddingForPopups),r.isAdaptation&&(this.isAdaptation=r.isAdaptation),(r.isAnimationOpen||0==r.isAnimationOpen)&&(this.isAnimationOpen=r.isAnimationOpen),r.positionBlock&&r.positionBlock.imageSrc){this.positionBlock.imageSrc=r.positionBlock.imageSrc;var s=new Image;s.src=this.positionBlock.imageSrc;var o=r.positionBlock.imageSize?r.positionBlock.imageSize.width:s.width,a=r.positionBlock.imageSize?r.positionBlock.imageSize.height:s.height;this.autoSize&&this._dom&&this._dom.style&&this._dom.style.width&&(this._dom.style.width.indexOf("px")!=-1?this._width=this._dom.style.width.substring(0,this._dom.style.width.indexOf("px")):this._width=this._dom.style.width),r.positionBlock.offset?this.positionBlock.offset=new OpenLayers.Pixel(r.positionBlock.offset.width,r.positionBlock.offset.height):(this.positionBlock.offset=new OpenLayers.Pixel(-(this._width-o)/2,(-a)),r.positionBlock.offsetX||0==r.positionBlock.offsetX?this.positionBlock.offset=new OpenLayers.Pixel(0-r.positionBlock.offsetX,(-a)):this.positionBlock.isCenter=!0),this.positionBlock.padding=new OpenLayers.Bounds(0,a+2,0,0),this.positionBlock.imageSize=new OpenLayers.Size(o,a),this.positionBlock.blocks=[];var l={};l.size=this.positionBlock.imageSize,l.anchor=new OpenLayers.Bounds(0-this.positionBlock.offset.x-parseInt(o/2),3,null,null),l.position=new OpenLayers.Pixel(0,0),this.positionBlock.blocks.push(l)}r.useDomStyle&&(this.useDomStyle=!0)}},NPMapLib.Symbols.InfoWindow.prototype=new NPMapLib.Overlay,NPMapLib.Symbols.InfoWindow.prototype.open=function(e,t,i){if(!this._isOpen){"undefined"==typeof t&&(t=!0);var r=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(r&&r.openInfoWindow(this),e&&e instanceof NPMapLib.Geometry.Size&&r&&t){var n=this.getPositionByInfowindow(this._position,e);this.isAnimationOpen?r.panTo(n,i):(r.setCenter(n),i&&i())}else if(r&&t){var s=r.getInfoWindowSize(this),n=this.getPositionByInfowindow(this._position,s);this.isAnimationOpen?r.panTo(n,i):(r.setCenter(n),i&&i())}this._isOpen=!0,this._actionEventHandle(NPMapLib.INFOWINDOW_EVENT_OPEN)}},NPMapLib.Symbols.InfoWindow.prototype.setPosition=function(e){this._position=e;var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.setOverlayPosition(this,NPMapLib.T.setPoint(t,e))},NPMapLib.Symbols.InfoWindow.prototype.getBaseDiv=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e)return e.getInfoWindowBaseDiv(this)},NPMapLib.Symbols.InfoWindow.prototype.getContentDivStyle=function(){if(this._apiObj)return this._apiObj.getContentDivStyle()},NPMapLib.Symbols.InfoWindow.prototype.getPosition=function(){return this._position},NPMapLib.Symbols.InfoWindow.prototype.setOffset=function(e){this._offset=e},NPMapLib.Symbols.InfoWindow.prototype.getOffset=function(){return this._offset},NPMapLib.Symbols.InfoWindow.prototype.close=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.closeInfoWindow(this),this._isOpen=!1,this._actionEventHandle(NPMapLib.INFOWINDOW_EVENT_CLOSE)},NPMapLib.Symbols.InfoWindow.prototype.destroy=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.destroyInfoWindow(this),this._isOpen=!1,this._actionEventHandle(NPMapLib.INFOWINDOW_EVENT_CLOSE),this._dom=null,this._position=null,this.paddingForPopups=null,this._closeCallback=null,this.positionBlock=null,this._eventHandle=null},NPMapLib.Symbols.InfoWindow.prototype.hide=function(){if(this._isOpen){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.hideInfoWindow(this),this._isOpen=!1,this._actionEventHandle(NPMapLib.INFOWINDOW_EVENT_HIDE)}},NPMapLib.Symbols.InfoWindow.prototype.show=function(){if(!this._isOpen){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&(e.openInfoWindow(this),this._isOpen=!0)}},NPMapLib.Symbols.InfoWindow.prototype.setWidth=function(e){if("number"==typeof e){var t=this.getSize();t&&(this._width=t.width,this._height=t.height),this._width=e;var i=new NPMapLib.Geometry.Size(this._width,this._height);this.setSize(i)}},NPMapLib.Symbols.InfoWindow.prototype.setHeight=function(e){if("number"==typeof e){var t=this.getSize();t&&(this._width=t.width,this._height=t.height),this._height=e;var i=new NPMapLib.Geometry.Size(this._width,this._height);this.setSize(i)}},NPMapLib.Symbols.InfoWindow.prototype.setSize=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.setInfoWindowSize(this,e)},NPMapLib.Symbols.InfoWindow.prototype.updateSize=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.updateInfoWindowSize(this)},NPMapLib.Symbols.InfoWindow.prototype.getSize=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e)return e.getInfoWindowSize(this)},NPMapLib.Symbols.InfoWindow.prototype.setTitle=function(e){this._title=e;var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.setTitle(this)},NPMapLib.Symbols.InfoWindow.prototype.getTitle=function(){return this._title},NPMapLib.Symbols.InfoWindow.prototype.setContent=function(e){this._content=e;var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.setContent(this)},NPMapLib.Symbols.InfoWindow.prototype.setBackgroundColor=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.setBackgroundColor(this,e)},NPMapLib.Symbols.InfoWindow.prototype.getContent=function(){return this._content},NPMapLib.Symbols.InfoWindow.prototype.setContentDom=function(e,t){this._dom=e;var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.setInfoWindow(this),t&&this._apiObj&&this._apiObj.setOpacity(0)},NPMapLib.Symbols.InfoWindow.prototype.getContentDom=function(){return this._dom},NPMapLib.Symbols.InfoWindow.prototype.isOpen=function(){return this._isOpen},NPMapLib.Symbols.InfoWindow.prototype.enableCloseOnClick=function(){this._enableCloseOnClick||(this._enableCloseOnClick=!0)},NPMapLib.Symbols.InfoWindow.prototype.disableCloseOnClick=function(){this._enableCloseOnClick&&(this._enableCloseOnClick=!1)},NPMapLib.Symbols.InfoWindow.prototype.addEventListener=function(e,t){this._eventHandle[e]||e!==NPMapLib.INFOWINDOW_EVENT_CLOSE&&e!==NPMapLib.INFOWINDOW_EVENT_OPEN&&e!==NPMapLib.INFOWINDOW_EVENT_HIDE&&e!==NPMapLib.INFOWINDOW_EVENT_CLICK_CLOSE||(this._eventHandle[e]=t)},NPMapLib.Symbols.InfoWindow.prototype.removeEventListener=function(e){this._eventHandle[e]&&delete this._eventHandle[e]},NPMapLib.Symbols.InfoWindow.prototype._actionEventHandle=function(e){var t=this._eventHandle[e];t&&t()},NPMapLib.Symbols.InfoWindow.prototype.setCloseCallback=function(e){this._closeCallback=e},NPMapLib.Symbols.InfoWindow.prototype.moveTo=function(e){this.setPosition(e)},NPMapLib.Symbols.InfoWindow.prototype.getPositionByInfowindow=function(e,t){var i=t.width,r=t.height;this.iscommon||(r=t.height+31);var n=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e=NPMapLib.T.setPoint(n,e);var s=n.getCenter(),o=n.pointToPixel(s),a=n.getExtent(),l=new NPMapLib.Geometry.Point(a.ne.lon,a.sw.lat),p=n.pointToPixel(l),h=n.pointToPixel(e),u=0,y=0,c=-60;this.iscommon&&(c=0),this.positionBlock&&this.positionBlock.offset&&(c=this.positionBlock.offset.x),h.x<this.paddingForPopups.left-c?u=this.paddingForPopups.left-c-h.x:h.x+c>p.x-i-this.paddingForPopups.right&&(u=p.x-i-h.x-this.paddingForPopups.right-c);var d=-32,m=0;if(this.iscommon&&(d=0,m=r),this.positionBlock&&this.positionBlock.offset&&(d=this.positionBlock.offset.y-this.paddingForPopups.top),h.y<r-d?y=r-d-h.y:h.y+m+this.paddingForPopups.bottom>p.y&&(y=p.y-h.y-m-this.paddingForPopups.bottom),0==u&&0==y)return s;var f=new NPMapLib.Geometry.Pixel(o.x-u,o.y-y),g=n.pixelToPoint(f);return g},NPMapLib.Symbols.InfoWindow.prototype.updatePosition=function(){this._apiObj&&this._apiObj.updatePosition()},NPMapLib.Symbols.InfoWindow.prototype.panMapIfOutOfView=function(e){this._apiObj&&(this._apiObj.panMapIfOutOfView=e)}}(),NPMapLib.LABEL_EVENT_CLICK="click",NPMapLib.LABEL_EVENT_DBLCLICK="dblclick",NPMapLib.LABEL_EVENT_RIGHT_CLICK="rightclick",NPMapLib.LABEL_EVENT_MOUSE_DOWN="mousedown",NPMapLib.LABEL_EVENT_MOUSE_UP="mouseup",NPMapLib.LABEL_EVENT_MOUSE_OVER="mouseover",NPMapLib.LABEL_EVENT_MOUSE_OUT="mouseout",NPMapLib.LABEL_EVENT_DRAG_START="dragstart",NPMapLib.LABEL_EVENT_DRAG_END="dragend",function(){NPMapLib.Symbols.Label=function(e,t){this.CLASS_NAME="NPMapLib.Symbols.Label",this.overlayType=NPMapLib.OVERLAY_TYPE_LABEL,this._content=e,this._offset=new NPMapLib.Geometry.Size(0,0),this._fontSize=12,this._fontFamily="宋体",this._color="red",this._align="m",this._isBold=!1,this._style={},this._bgMargin=0,this._bgRXY=0,t&&(t.offset?this._offset=t.offset:this._offset=new NPMapLib.Geometry.Size(0,0),t.bgStroke&&(this._bgStroke=t.bgStroke),t.bgRXY&&(this._bgRXY=t.bgRXY),t.bgMargin&&(this._bgMargin=t.bgMargin),t.position?this._position=t.position:this._position=new NPMapLib.Geometry.Point(0,0))},NPMapLib.Symbols.Label.prototype=new NPMapLib.Overlay,NPMapLib.Symbols.Label.prototype.setStyle=function(e){e&&(this._style=e||{},e.FontSize&&(this._fontSize=e.FontSize),e.FontFamily&&(this._fontFamily=e.FontFamily),e.Color&&(this._color=e.Color),"boolean"==typeof e.IsBold&&(this._isBold=e.IsBold),e.Align&&(this._align=e.Align),e.Offset&&(this._offset=e.Offset),e.fontSize&&(this._fontSize=e.fontSize),e.fontFamily&&(this._fontFamily=e.fontFamily),e.color&&(this._color=e.color),e.bgColor&&(this._bgColor=e.bgColor),e.bordColor&&(this._bordColor=e.bordColor),e.borderSize&&(this._borderSize=e.borderSize),"boolean"==typeof e.isBold&&(this._isBold=e.isBold),e.align&&(this._align=e.align),e.offset&&(this._offset=e.offset),e.bgStroke&&(this._bgStroke=e.bgStroke),e.bgRXY&&(this._bgRXY=e.bgRXY),e.bgMargin&&(this._bgMargin=e.bgMargin))},NPMapLib.Symbols.Label.prototype.getStyle=function(){return{fontSize:this._fontSize,fontFamily:this._fontFamily,color:this._color,align:this._align,isBold:this._isBold}},NPMapLib.Symbols.Label.prototype.setContent=function(e){this._content=e},NPMapLib.Symbols.Label.prototype.getContent=function(){return this._content},NPMapLib.Symbols.Label.prototype.setPosition=function(e){this._position=e;var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.setOverlayPosition(this,NPMapLib.T.setPoint(t,e))},NPMapLib.Symbols.Label.prototype.getPosition=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e){var t=e.getOverlayPosition(this);t&&(t=NPMapLib.T.getPoint(e,t),this._position=t)}return this._position},NPMapLib.Symbols.Label.prototype.setOffset=function(e){this._offset=e},NPMapLib.Symbols.Label.prototype.getOffset=function(){return this._offset},NPMapLib.Symbols.Label.prototype.setTitle=function(e){this._title=e},NPMapLib.Symbols.Label.prototype.getTitle=function(){return this._title},NPMapLib.Symbols.Label.prototype.addEventListener=function(e,t){var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.addEventListener(this,e,t)},NPMapLib.Symbols.Label.prototype.removeEventListener=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.removeEventListener(this,e)}}(),NPMapLib.MARKER_EVENT_CLICK="click",NPMapLib.MARKER_EVENT_DBLCLICK="dblclick",NPMapLib.MARKER_EVENT_RIGHT_CLICK="rightclick",NPMapLib.MARKER_EVENT_MOUSE_DOWN="mousedown",NPMapLib.MARKER_EVENT_MOUSE_UP="mouseup",NPMapLib.MARKER_EVENT_MOUSE_OVER="mouseover",NPMapLib.MARKER_EVENT_MOUSE_OUT="mouseout",NPMapLib.MARKER_EVENT_DRAG_START="dragstart",NPMapLib.MARKER_EVENT_DRAG_END="dragend",function(){NPMapLib.Symbols.Marker=function(e,t){this.CLASS_NAME="NPMapLib.Symbols.Marker",this.overlayType=NPMapLib.OVERLAY_TYPE_MARKER,this._position=e,this._offset=new NPMapLib.Geometry.Size(0,0),this._icon,this._label,this.title=null,t&&(t.offset?this._offset=t.offset:this._offset=new NPMapLib.Geometry.Size(0,0),t.icon&&(this._icon=t.icon),t.title&&(this.title=t.title),t.rotation&&(this._rotation=t.rotation))},NPMapLib.Symbols.Marker.prototype=new NPMapLib.Overlay,NPMapLib.Symbols.Marker.prototype.setIcon=function(e){e instanceof NPMapLib.Symbols.Icon?this._icon=e:this._icon=new NPMapLib.Symbols.Icon(e.imageUrl,new NPMapLib.Geometry.Size(e.imageSize.Width,e.imageSize.Height),{anchor:new NPMapLib.Geometry.Size(e.anchor.X,e.anchor.Y)}),this.refresh()},NPMapLib.Symbols.Marker.prototype.getIcon=function(){return this._icon},NPMapLib.Symbols.Marker.prototype.setPosition=function(e){this._position=e;var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.setOverlayPosition(this,NPMapLib.T.setPoint(t,e))},NPMapLib.Symbols.Marker.prototype.getPosition=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e){var t=e.getOverlayPosition(this);t&&(t=NPMapLib.T.getPoint(e,t),this._position=t)}return this._position},NPMapLib.Symbols.Marker.prototype.setOffset=function(e){this._offset=e},NPMapLib.Symbols.Marker.prototype.getOffset=function(){return this._offset},NPMapLib.Symbols.Marker.prototype.setLabel=function(e){this._label=e,this._label.setPosition(this._position)},NPMapLib.Symbols.Marker.prototype.getLabel=function(){return this._label},NPMapLib.Symbols.Marker.prototype.showLabel=function(){if(this._label){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.showMarkerLabel(this)}},NPMapLib.Symbols.Marker.prototype.hideLabel=function(){if(this._label){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.hideMarkerLabel(this)}},NPMapLib.Symbols.Marker.prototype.setTitle=function(e){this.title=e},NPMapLib.Symbols.Marker.prototype.getTitle=function(){return this.title},NPMapLib.Symbols.Marker.prototype.moveTo=function(e){this.setPosition(e)},NPMapLib.Symbols.Marker.prototype.addEventListener=function(e,t){var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.addEventListener(this,e,t)},NPMapLib.Symbols.Marker.prototype.removeEventListener=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.removeEventListener(this,e)},NPMapLib.Symbols.Marker.prototype.removeMenu=function(){this._menu&&(this._menu.destroy(),this._menu=null)}}(),function(){NPMapLib.Symbols.ClusterPoints=function(e,t){this.CLASS_NAME="NPMapLib.Symbols.ClusterPoints",this.overlayType=NPMapLib.OVERLAY_TYPE_ClusterPoints,this.id=-1,this.dataJson=e,this.layName="聚合层",this.threshold=2,this.distance=200;for(var i=0;i<this.dataJson.length;i++)this.dataJson[i].container=this;t&&(t.distance&&(this.distance=t.distance),t.threshold&&(this.threshold=t.threshold))},NPMapLib.Symbols.ClusterPoints.prototype=new NPMapLib.Overlay,NPMapLib.Symbols.ClusterPoints.prototype.getMarkersByMarkType=function(e){for(var t=[],i=0;i<this.dataJson.length;i++)this.dataJson[i].markType===e&&t.push(this.dataJson[i]);return t},NPMapLib.Symbols.ClusterPoints.prototype.getClusterPoints=function(){return this.dataJson}}(),function(){NPMapLib.Symbols.ClusterMarker=function(e,t){this.location=e,this.location._visible=!0,this.location.angle=0,this._apiObj=null,this.dragstart=null,this.dragend=null,this.markType=" ",this.isEnableEdit=!1,t&&(this.markType=t.markType?t.markType:""),this.location.markType=this.markType},NPMapLib.Symbols.ClusterMarker.prototype.changeStyle=function(e,t){if(this._apiObj&&this._apiObj.layer){for(var i in e)this._apiObj.style[i]=e[i];t&&this._apiObj.layer.drawFeature(this._apiObj)}},NPMapLib.Symbols.ClusterMarker.prototype.setVisible=function(e){this.location._visible=e,this._apiObj&&this.container&&(this._apiObj.layer=this._apiObj.layer||this.container._layer._apiObj,this._apiObj.style&&(this._apiObj.style.display=e?"":"none"),this._apiObj.layer.drawFeature(this._apiObj))},NPMapLib.Symbols.ClusterMarker.prototype.flash=function(e){this._apiObj&&this._apiObj.getVisibility()&&(e=e||1,this._apiObj.flash(2*e))},NPMapLib.Symbols.ClusterMarker.prototype.flashStop=function(){this._apiObj&&this._apiObj.flashStop()},NPMapLib.Symbols.ClusterMarker.prototype.getData=function(){return this.location},NPMapLib.Symbols.ClusterMarker.prototype.enableEditing=function(e,t){this.isEnableEdit=!0;var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.container.mapId);i&&i.enableEditing(e,this,t)},NPMapLib.Symbols.ClusterMarker.prototype.disableEditing=function(){this.isEnableEdit=!1;var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.container.mapId);e&&e.cancelEditing(this)},NPMapLib.Symbols.ClusterMarker.prototype.getPosition=function(){if(this.location.lon&&this.location.lat)return new NPMapLib.Geometry.Point(this.location.lon,this.location.lat)},NPMapLib.Symbols.ClusterMarker.prototype.setPosition=function(e){if(e&&"NPMapLib.Geometry.Point"==e.CLASS_NAME){this.location.lon=e.lon,this.location.lat=e.lat;var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.container.mapId);if(t){var i=NPMapLib.T.setPoint(t,this.location);this.geometry.x=i.lon,this.geometry.y=i.lat;var r=this.container._layer;r._apiObj.strategies[0]._xData=r._apiObj.strategies[0]._xData.slice().sort(function(e,t){return e.geometry.x>t.geometry.x?1:-1})}this._apiObj&&this._apiObj.layer&&this._apiObj.layer.map&&this._apiObj.move(new OpenLayers.LonLat(i.lon,i.lat))}},NPMapLib.Symbols.ClusterMarker.prototype.setAngle=function(e){this.location.angle=e,this._apiObj&&e&&this._apiObj.layer&&(this._apiObj.style.rotation=e,this._apiObj.layer.drawFeature(this._apiObj,this._apiObj.style))}}(),function(){var e=NPMapLib.Symbols.CurveLine=function(e,t){this.CLASS_NAME="NPMapLib.Symbols.CurveLine";var i=this.getCurvePoints(e);NPMapLib.Geometry.Polyline.call(this,i,t)};e.prototype=new NPMapLib.Geometry.Polyline,e.prototype.getPolyline=function(){return this.polyline},e.prototype.getCurvePoints=function(e){for(var t=[],i=0;i<e.length-1;i++){var r=this.getCurveByTwoPoints(e[i],e[i+1]);r&&r.length>0&&(t=t.concat(r))}return t},e.prototype.getCurveByTwoPoints=function(e,t){if(!(e&&t&&e instanceof NPMapLib.Geometry.Point&&t instanceof NPMapLib.Geometry.Point))return null;var i=function(e){return 1-2*e+e*e},r=function(e){return 2*e-2*e*e},n=function(e){return e*e};curveCoordinates=[];var s,o,a,l,p,h,u,y=30,c=0,d=0;if("undefined"==typeof t)return void("undefined"!=typeof curveCoordinates&&(curveCoordinates=[]));var m=parseFloat(e.lat),f=parseFloat(t.lat),g=parseFloat(e.lon),L=parseFloat(t.lon);for(L>g&&parseFloat(L-g)>180&&g<0&&(g=parseFloat(360+g)),g>L&&parseFloat(g-L)>180&&L<0&&(L=parseFloat(360+L)),h=0,u=0,f==m?(s=0,o=g-L):L==g?(s=Math.PI/2,o=m-f):(s=Math.atan((f-m)/(L-g)),o=(f-m)/Math.sin(s)),0==u&&(u=s+Math.PI/5),a=o/2,p=a*Math.cos(u)+g,l=a*Math.sin(u)+m,c=0;c<y+1;c++)curveCoordinates.push(new NPMapLib.Geometry.Point(g*i(d)+p*r(d)+L*n(d),m*i(d)+l*r(d)+f*n(d))),d+=1/y;return curveCoordinates}}(),function(){NPMapLib.Symbols.DialogOptions={width:260,height:180,arrow:!0}}(),function(){var e=NPMapLib.Symbols.Dialog=function(e,t,i,r){this.overlayType=NPMapLib.OVERLAY_TYPE_DIALOG,this.id=-1,this._title=t,this._content=i,this.map=e,this._isOpen=!1,this._offset=new NPMapLib.Geometry.Size(1,1),this._width=260,this._height=180,this._arrow=!1,this.autoSize=!0,r&&(r.width&&(this._width=r.width),r.height&&(this._height=r.height),"boolean"==typeof r.arrow&&(this._arrow=r.arrow))};e.prototype=new NPMapLib.Overlay,e.prototype.open=function(e,t){if(!this._isOpen){this._popup||(this._popup=new NPMapLib.Utils.Popup({arrow:this._arrow,caption:this._title,content:this._content,width:this._width,height:this._height},this.map));var i=this.map.getSize();e=e?e:i.width/2,t=t?t:i.height/2;var r=this;this._popup.open(t+this._offset.height,e+this._offset.width,function(){r.close()}),this._isOpen=!0}},e.prototype.close=function(){this._isOpen&&this._popup&&this._popup.close()},e.prototype.setWidth=function(e){"number"==typeof e&&(this._width=e,this._popup.getStyle().width=e+"px")},e.prototype.setHeight=function(e){"number"==typeof e&&(this._height=e,this._popup.getStyle().height=e+"px")},e.prototype.setContent=function(e){this._content=e,this._popup.setContent(e)},e.prototype.getContent=function(){return this._content},e.prototype.isOpen=function(){return this._isOpen},e.prototype.setVisible=function(e){e?this._popup.getStyle().display="":this._popup.getStyle().display="none"}}(),function(){var currentMap=null;NPMapLib.Symbols.PlottingSymbol=function(map,json,style){this.CLASS_NAME="NPMapLib.Symbols.PlottingSymbol",this.overlayType="PlottingSymbol";try{var obj=eval("("+json+")"),geometry=OpenLayers.Geometry[obj.CLASS_NAME.split(".")[2]].fromJSON(json,map);geometry.calculateParts(),this._apiObj=new OpenLayers.Feature.Vector(geometry,this,style||{cursor:"pointer",fillColor:"red",fillOpacity:.2,fontColor:"#000000",hoverFillColor:"white",hoverFillOpacity:.8,hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3,pointRadius:6,strokeColor:"#66cccc",strokeDashstyle:"solid",strokeLinecap:"round",strokeOpacity:1,strokeWidth:2})}catch(e){throw console.error(e),"转换军标出差"}currentMap=map},NPMapLib.Symbols.PlottingSymbol.prototype=new NPMapLib.Overlay,NPMapLib.Symbols.PlottingSymbol.prototype.toJSON=function(){return this._apiObj?this._apiObj.geometry.toJSON(currentMap):""},NPMapLib.Symbols.PlottingSymbol.prototype.addEventListener=function(e,t){currentMap._mapAdapter.addEventListener(this,e,t)},NPMapLib.Symbols.PlottingSymbol.prototype.removeEventListener=function(e){currentMap._mapAdapter.removeEventListener(this,e)},NPMapLib.Symbols.PlottingSymbol.prototype.enableEditing=function(){}}(),NPMapLib.BUBBLE_EVENT_CLICK="click",NPMapLib.BUBBLE_EVENT_RIGHT_CLICK="rightclick",NPMapLib.BUBBLE_EVENT_MOUSE_OVER="mouseover",NPMapLib.BUBBLE_EVENT_MOUSE_OUT="mouseout",function(e,t){"use strict";var i=NPMapLib.Symbols.Bubble=function(e,t){this.CLASS_NAME="NPMapLib.Symbols.Bubble",this.overlayType=NPMapLib.OVERLAY_TYPE_BUBBLE,this._position=e,this._offset=new NPMapLib.Geometry.Size(0,0),this._color="#FF0000",this._options={x:0,y:0,width:29,height:58,interval:50,bubbles:[{r:3,s:[27,30],e:[27,-55],p:4.25},{r:4,s:[27,40],e:[27,-35],p:3.75},{r:6,s:[27,50],e:[27,-15],p:3.25}],wave:{a:6,w:6.28,k:.1,width:26.8593355,height:30.832615},dropPath:"M 0,30.832615 C 0.2258843,41.374652 22.6502155,73.827685 26.8593355,84.067826 32.2195965,72.431012 53.3725445,43.176664 53.5570575,30.832615 c -1.062271,-39.9612311 -55.0572777,-35.5688568 -53.5570575,0 z",wavePath:" C 0.2258843,41.374652 22.6502155,73.827685 26.8593355,84.067826 32.2195965,72.431012 53.3725445,43.176664 53.5570575,30.832615 z",shadowPath:"m 54,87.987175 a 27.25,6.375 0 1 1 -54.5,0 27.25,6.375 0 1 1 54.5,0 z"};var i=this._options.bubbles;this._bubbleLength=i.length,this._bubbles=[],this._b=[],this._heat=4,this._speed=4,this._increase=31,this._a=this._options.wave.a,this._w=this._options.wave.w,this._k=this._options.wave.k,this._width=this._options.wave.width,this._height=this._options.wave.height,this._waveTop=30.918412,this._start=0,this._end=Math.floor(2*this._options.wave.width),this._circle=!0,this._t=0;for(var r=0;this._bubbleLength>r;r++)this._bubbles.push({r:i[r].r,sx:i[r].s[0],sy:i[r].s[1],ex:i[r].e[0],ey:i[r].e[1],speed:i[r].p}),this._b.push([i[r].s[0],i[r].s[1]]);this._bubbleST,t&&(t.offset&&(this._offset=t.offset),t.color&&(this._color=t.color))};i.prototype=new NPMapLib.Overlay,i.prototype.setPosition=function(e){this._position=e;var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.setOverlayPosition(this,NPMapLib.T.setPoint(t,e))},i.prototype.getPosition=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(e){var t=e.getOverlayPosition(this);t&&(t=NPMapLib.T.getPoint(e,t),this._position=t)}return this._position},i.prototype.setOffset=function(e){this._offset=e},i.prototype.getOffset=function(){return this._offset},i.prototype.setColor=function(e){this._color=e},i.prototype.getColor=function(){return this._color},i.prototype.addEventListener=function(e,t){var i=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);i&&i.addEventListener(this,e,t)},i.prototype.removeEventListener=function(e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.removeEventListener(this,e)},i.prototype._stopAnimate=function(){this._bubbleST&&clearTimeout(this._bubbleST)},i.prototype._animate=function(e){var t=document.getElementById(e);if(t){if("svg"===t.nodeName){var i=this._drawWave(),r=t.childNodes[0],n=r.childNodes[0],s=r.childNodes[1],o=r.childNodes[2];if(s&&o&&(s.setAttributeNS(null,"d",i[0]),o.setAttributeNS(null,"d",i[1]),this._circle)){var a,l=this._drawBubbleCircle(),p=n.childNodes.length;for(a=0;a<p;a++)n.childNodes[a].setAttributeNS(null,"cy",l[a].y),n.childNodes[a].setAttributeNS(null,"opacity",l[a].opacity)}}var h=this;this._bubbleST=setTimeout(function(){h._animate(e)},this._options.interval)}},i.prototype._drawBubbleCircle=function(){for(var e=[],t=0;this._bubbleLength>t;t++){var i=this._bubbles[t],r=i.sy,n=0;this._b[t][1]-=i.speed,this._b[t][1]<=i.sy&&this._b[t][1]>=i.ey?(r=this._b[t][1],n=Math.abs((i.ey-this._b[t][1])/(i.ey-i.sy))):this._b[t][1]<i.ey&&(this._b[t][1]=i.sy+i.speed*(2*(11-this._heat)-7)),e.push({y:r,opacity:n})}return e},i.prototype._drawWave=function(){for(var e=["M 53.5570575,30.832615 L"],t=["M 53.5570575,30.832615 L"],i=this._end;i>=this._start;i--){var r=.6*Math.sin(this._w*this._t*2*this._speed+.9*this._k*i)*this._a+this._waveTop;e.push(" "),e.push(i),e.push(","),e.push(this._limitLine(i,r).y);var n=Math.sin(this._w*this._t*this._speed-this._k*i)*this._a+this._waveTop;t.push(" "),t.push(i),t.push(","),t.push(this._limitLine(i,n).y)}return e.push(this._options.wavePath),t.push(this._options.wavePath),this._t=(this._t+this._increase)%27644437,[e.join(""),t.join("")]},i.prototype._limitLine=function(e,t){var i,r;return i=this._bezierTop(e),r=e>=this._options.wave.width?this._bezierRight(e):this._bezierLeft(e),t>=i&&r>=t?{y:t,at:0}:i>t?{y:i,at:-1}:t>r?{y:r,at:1}:void 0},i.prototype._bezierTop=function(e){var t=108.4279626,i=-158.7982071,r=-3.186813,n=53.5570575,s=-13.1771229,o=133.0608162,a=-119.8836933,l=30.832615,p=this._getBezierPoint(e,t,i,r,n,s,o,a,l);return p[1]},i.prototype._bezierRight=function(e){var t=-36.761122,i=47.378061,r=16.080783,n=26.8593355,s=34.527833,o=-52.852602,a=-34.910442,l=84.067826,p=this._getBezierPoint(e,t,i,r,n,s,o,a,l);return p[1]},i.prototype._bezierLeft=function(e){var t=-40.4136581,i=66.5953407,r=.6776529,n=0,s=-44.123888,o=65.732988,a=31.626111,l=30.832615;if(0===e)return l;var p=this._getBezierPoint(e,t,i,r,n,s,o,a,l);return p[1]},i.prototype._getBezierPoint=function(e,t,i,r,n,s,o,a,l){for(var p,h=0,u=1,y=.5,c=1/0,d=0;Math.abs(c-d)>.01;)c=t*Math.pow(h,3)+i*h*h+r*h+n-e,d=t*Math.pow(y,3)+i*y*y+r*y+n-e,0>c*d?(u=y,y=.5*(h+y)):(h=y,y=.5*(y+u));return p=Math.round(s*Math.pow(y,3)+o*y*y+a*y+l),new Array(e,p)}}(window),function(){NPMapLib.Control=function(){this.CLASS_NAME="NPMapLib.Control",this.id=-1,this.controlType=NPMapLib.CONTROL_TYPE_UNKNOWN,this.offset=new NPMapLib.Geometry.Size(0,0),this.visible=!1,this.mapId=-1,this.anchor},NPMapLib.Control.prototype={isVisible:function(){return this.visible},getOffset:function(){return this.offset},getAnchor:function(){return this.anchor}}}(),function(){NPMapLib.Controls.CopyRightControl=function(e){this.controlType=NPMapLib.CONTROL_TYPE_COPYRIGHT,this.anchor=NPMapLib.CONTROL_ANCHOR_BOTTOM_LEFT,this.CLASS_NAME="NPMapLib.Controls.CopyRightControl",this._info=e?e:"NetPosa"},NPMapLib.Controls.CopyRightControl.prototype=new NPMapLib.Control,NPMapLib.Controls.CopyRightControl.prototype.setInfo=function(e){this._info=e;var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&t.setCopyRight(this._info)},NPMapLib.Controls.CopyRightControl.prototype.getInfo=function(){return this._info},NPMapLib.Controls.CopyRightControl.prototype.show=function(){if(!this.visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&(e.setCopyRight(this._info),e.showCopyRightControl()),this.visible=!this.visible}},NPMapLib.Controls.CopyRightControl.prototype.hide=function(){if(this.visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.hideCopyRightControl(),this.visible=!this.visible}},NPMapLib.Controls.CopyRightControl.prototype.setOffset=function(e){this.offset=e},NPMapLib.Controls.CopyRightControl.prototype.setAnchor=function(e){e instanceof NPMapLib.Enums.ControlAnchor&&this.anchor!==e&&(this.anchor=e)}}(),function(){NPMapLib.Controls.NavigationControl=function(e){this.controlType=NPMapLib.CONTROL_TYPE_NAVIGATION,this.anchor=NPMapLib.CONTROL_ANCHOR_TOP_LEFT,this.CLASS_NAME="NPMapLib.Controls.NavigationControl",this._levelBarVisible=!1,this.opts=e||{},this.opts.position&&(this.position=this.opts.position),this.navigationType=this.opts.navigationType||"common"},NPMapLib.Controls.NavigationControl.prototype=new NPMapLib.Control,NPMapLib.Controls.NavigationControl.prototype.showLevelBar=function(){this._levelBarVisible||(this._levelBarVisible=!0)},NPMapLib.Controls.NavigationControl.prototype.hideLevelBar=function(){this._levelBarVisible&&(this._levelBarVisible=!1)},NPMapLib.Controls.NavigationControl.prototype.show=function(){if(!this.visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.showNavigationControl(this),this.visible=!this.visible}},NPMapLib.Controls.NavigationControl.prototype.hide=function(){if(this.visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.hideNavigationControl(),this.visible=!this.visible}},NPMapLib.Controls.NavigationControl.prototype.setOffset=function(e){this.offset=e},NPMapLib.Controls.NavigationControl.prototype.setAnchor=function(e){e instanceof NPMapLib.Enums.ControlAnchor&&this.anchor!==e&&(this.anchor=e)}}(),function(){NPMapLib.Controls.OverviewControl=function(e){this.controlType=NPMapLib.CONTROL_TYPE_OVERVIEW,this.anchor=NPMapLib.CONTROL_ANCHOR_BOTTOM_RIGHT,this.options=e,this._isOpen=!1,this.CLASS_NAME="NPMapLib.Controls.OverviewControl"},NPMapLib.Controls.OverviewControl.prototype=new NPMapLib.Control,NPMapLib.Controls.OverviewControl.prototype.changeView=function(e){if(this._isOpen!==e){var t=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);t&&(e?t.showOverviewControl():t.hideOverviewControl(),this._isOpen=e)}},NPMapLib.Controls.OverviewControl.prototype.show=function(){
if(!this.visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.addOverviewControl(this.options),this.visible=!this.visible}},NPMapLib.Controls.OverviewControl.prototype.hide=function(){if(this.visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.removeOverviewControl(),this.visible=!this.visible}},NPMapLib.Controls.OverviewControl.prototype.setOffset=function(e){this.offset=e},NPMapLib.Controls.OverviewControl.prototype.setAnchor=function(e){e instanceof NPMapLib.Enums.ControlAnchor&&this.anchor!==e&&(this.anchor=e)}}(),function(){NPMapLib.Controls.ScaleControl=function(){this.controlType=NPMapLib.CONTROL_TYPE_SCALE,this.anchor=NPMapLib.CONTROL_ANCHOR_BOTTOM_RIGHT,this._unit=NPMapLib.MAP_UNITS_KILOMETERS,this.CLASS_NAME="NPMapLib.Controls.ScaleControl"},NPMapLib.Controls.ScaleControl.prototype=new NPMapLib.Control,NPMapLib.Controls.ScaleControl.prototype.getUnit=function(){return this._unit},NPMapLib.Controls.ScaleControl.prototype.setUnit=function(e){e instanceof NPMapLib.Enums.Units&&this._unit!==e&&(this._unit=e)},NPMapLib.Controls.ScaleControl.prototype.show=function(){if(!this.visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.showScaleControl(),this.visible=!this.visible}},NPMapLib.Controls.ScaleControl.prototype.hide=function(){if(this.visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.hideScaleControl(),this.visible=!this.visible}},NPMapLib.Controls.ScaleControl.prototype.setOffset=function(e){this.offset=e},NPMapLib.Controls.ScaleControl.prototype.setAnchor=function(e){e instanceof NPMapLib.Enums.ControlAnchor&&this.anchor!==e&&(this.anchor=e)}}(),function(){NPMapLib.Controls.NorthControl=function(){this.controlType=NPMapLib.CONTROL_TYPE_NORTH,this.anchor=NPMapLib.CONTROL_ANCHOR_BOTTOM_LEFT,this.CLASS_NAME="NPMapLib.Controls.NorthControl"},NPMapLib.Controls.NorthControl.prototype=new NPMapLib.Control,NPMapLib.Controls.NorthControl.prototype.show=function(){if(!this.visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.showNorthControl(),this.visible=!this.visible}},NPMapLib.Controls.NorthControl.prototype.hide=function(){if(this.visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.hideNorthControl(),this.visible=!this.visible}}}(),function(){NPMapLib.Controls.MousePositionControl=function(e){this.controlType=NPMapLib.CONTROL_TYPE_MOUSEPOSITION,this.anchor=NPMapLib.CONTROL_ANCHOR_BOTTOM_RIGHT,this.type=e,this.CLASS_NAME="NPMapLib.Controls.MousePositionControl"},NPMapLib.Controls.MousePositionControl.prototype=new NPMapLib.Control,NPMapLib.Controls.MousePositionControl.prototype.show=function(){if(!this.visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.showMousePosition(this.type),this.visible=!this.visible}},NPMapLib.Controls.MousePositionControl.prototype.hide=function(){if(this.visible){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.hideMousePosition(),this.visible=!this.visible}}}(),function(){NPMapLib.Controls.zoomAnimationControl=function(){this.controlType=NPMapLib.CONTROL_TYPE_ZOOMANIMATION,this.mapAdapter=null,this.CLASS_NAME="NPMapLib.Controls.zoomAnimationControl"},NPMapLib.Controls.zoomAnimationControl.prototype=new NPMapLib.Control,NPMapLib.Controls.zoomAnimationControl.prototype.timer=-1,NPMapLib.Controls.zoomAnimationControl.prototype.show=function(){if(!this.visible&&(this.mapAdapter=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId),this.mapAdapter)){var e=this.mapAdapter.map.div;this._createContainer(e),this.mapAdapter.addEventListener(this.mapAdapter,"zoomstart",this._action.bind(this)),this.mapAdapter.addEventListener(this.mapAdapter,"zoomend",this._unaction.bind(this)),this.visible=!this.visible}},NPMapLib.Controls.zoomAnimationControl.prototype.hide=function(){this.visible&&(this._removeContainer(),this.mapAdapter.removeEventListener(this.mapAdapter,"zoomstart",this._action),this.mapAdapter.removeEventListener(this.mapAdapter,"zoomend",this._unaction),this.visible=!this.visible)},NPMapLib.Controls.zoomAnimationControl.prototype._createContainer=function(e){var t=document.createElement("div");t.setAttribute("id","zoomer"),t.style.left=285,t.style.top=183.5,t.style.width=120,t.style.height=91,t.style.overflow="hidden",t.style.visibility="hidden",t.style.position="absolute",t.style.zIndex=99999,t.style.pointerEvents="none",e.appendChild(t);var i=document.createElement("div");i.className="BMap_zoomer",i.style.left=0,i.style.top=0,t.appendChild(i);var r=document.createElement("div");r.className="BMap_zoomer",r.style.backgroundPosition="0 0",r.style.top=0,r.style.right=0,t.appendChild(r);var n=document.createElement("div");n.className="BMap_zoomer",n.style.backgroundPosition="0 0",n.style.left=0,n.style.bottom=0,t.appendChild(n);var s=document.createElement("div");s.className="BMap_zoomer",s.style.backgroundPosition="0 0",s.style.right=0,s.style.bottom=0,t.appendChild(s),t.getElementsByClassName||(t.getElementsByClassName=function(e){for(var t=this.getElementsByTagName("*"),i=[],r=0;r<t.length;r++)for(var n=t[r],s=n.className.split(" "),o=0;o<s.length;o++)if(s[o]===e){i.push(n);break}return i});for(var o=t.getElementsByClassName("BMap_zoomer"),a=o.length,l=0;l<a;++l)o[l].style.width="10px",o[l].style.height="10px",o[l].style.overflow="hidden",o[l].style.fontSize=1,o[l].style.position="absolute"},NPMapLib.Controls.zoomAnimationControl.prototype._removeContainer=function(){var e=document.getElementById("zoomer");e.parentNode.removeChild(e)},NPMapLib.Controls.zoomAnimationControl.prototype._action=function(e,t,i){if("wheelChange"===i){window.clearTimeout(this.timer);var r=document.getElementById("zoomer"),n=r.style,s=r.children,o=OpenLayers.Util.getImageLocation("ul.png"),a=OpenLayers.Util.getImageLocation("ur.png"),l=OpenLayers.Util.getImageLocation("bl.png"),p=OpenLayers.Util.getImageLocation("br.png");s[0].style.background="url("+o+") no-repeat",s[1].style.background="url("+a+") no-repeat",s[2].style.background="url("+l+") no-repeat",s[3].style.background="url("+p+") no-repeat",e||(s[0].style.background="url("+p+") no-repeat",s[1].style.background="url("+l+") no-repeat",s[2].style.background="url("+a+") no-repeat",s[3].style.background="url("+o+") no-repeat");var h=60,u=120,y=4/3,c=Math.ceil((e?h:u)/2),d=Math.max(15,c/y),m=t.x-c,f=t.y-d;n.width=2*c+"px",n.height=2*d+"px",n.left=m+"px",n.top=f+"px";var g=Math.ceil((e?u:h)/2),L=Math.max(15,g/y);g-=c,L=Math.ceil(L-d);var v=1/3,O=this,P=function(){var e=Math.ceil(g*v),t=Math.ceil(L*v);n.width=2*(c+e)+"px",n.height=2*(d+t)+"px",n.left=m-e+"px",n.top=f-t+"px",v+=1/3,v<1?O.timer=window.setTimeout(function(){P()},100):O._unaction()};this.timer=window.setTimeout(function(){n.visibility="visible",P()},100)}},NPMapLib.Controls.zoomAnimationControl.prototype._unaction=function(){setTimeout(function(){var e=document.getElementById("zoomer");e&&(e.style.visibility="hidden")},250)}}(),function(){var e=NPMapLib.ContextMenu=function(){this.id=-1,this._items=[],this._separator=[],this._createDOMElement()};e.prototype._createDOMElement=function(){this.DIVElement=document.createElement("div"),this.DIVElement.className="contextMenu",document.body.appendChild(this.DIVElement)},e.prototype.addItem=function(e){e&&this.DIVElement&&e instanceof NPMapLib.ContextMenuItem&&(this.ULElement||(this.ULElement=document.createElement("ul"),this.DIVElement.appendChild(this.ULElement)),this.ULElement.appendChild(e._getDOMElement()),this._items.push(e))},e.prototype.getItem=function(e){if(!(!this.ULElement||e<0||this._items.length-1<e))return this._items[e]},e.prototype.removeItem=function(e){if(!(!this.ULElement||e<0||this._items.length-1<e)){var t=this._items[e];this.ULElement.removeChild(t._getDOMElement()),this._items.splice(e,1)}},e.prototype.addSeparator=function(){if(this.ULElement){this.ULElement||(this.ULElement=document.createElement("ul"),this.DIVElement.appendChild(this.ULElement));var e=document.createElement("li");this.ULElement.appendChild(e),e.className="li-seperate";var t=document.createElement("div");e.appendChild(t),t.className="menu-seperate",this._separator.push(e)}},e.prototype.removeSeparator=function(e){if(!(!this.ULElement||e<0||this._separator.length-1<e)){var t=this._separator[e];this.ULElement.removeChild(t),this._separator.splice(e,1)}},e.prototype.show=function(e){this.DIVElement.style.left=e.x+"px",this.DIVElement.style.top=e.y+"px",this.DIVElement.style.display=""},e.prototype.hide=function(){this.DIVElement.style.display="none"}}(),function(){var e=NPMapLib.ContextMenuItem=function(e,t){this._items=[],this._separator=[],this._createDOMElement(),this.setText(e)};e.prototype._createDOMElement=function(){this.LIElement=document.createElement("li"),this.AElement=document.createElement("a"),this.LIElement.appendChild(this.AElement),this.AElement.className="contextMenu-a";var e=hideTimer=null;this.LIElement.onmouseover=function(){var t=this,i=t.getElementsByTagName("ul");t.className+="active",i[0]&&(clearTimeout(hideTimer),e=setTimeout(function(){for(var e=0;e<t.parentNode.children.length;e++)t.parentNode.children[e].getElementsByTagName("ul")[0]&&(t.parentNode.children[e].getElementsByTagName("ul")[0].style.display="none");i[0].style.display="block",i[0].style.top=t.offsetTop+"px",i[0].style.left=t.offsetWidth+"px";var r=0;for(e=0;e<i[0].children.length;e++){var n=i[0].children[e],s=n.clientWidth-2*parseInt(n.currentStyle?n.currentStyle.paddingLeft:getComputedStyle(n,null).paddingLeft);s>r&&(r=s)}for(e=0;e<i[0].children.length;e++)i[0].children[e].style.width=r+"px"},300))},this.LIElement.onmouseout=function(){var t=this;t.className=t.className.replace(/\s?active/,""),clearTimeout(e),hideTimer=setTimeout(function(){for(i=0;i<t.parentNode.children.length;i++)t.parentNode.children[i].getElementsByTagName("ul")[0]&&(t.parentNode.children[i].getElementsByTagName("ul")[0].style.display="none")},300)}},e.prototype._getDOMElement=function(){return this.LIElement},e.prototype.setText=function(e){this.AElement&&(this.AElement.innerHTML='<font class="contextMenu-text">'+e+"</font>")},e.prototype.addChildItem=function(e){e&&this.LIElement&&e instanceof NPMapLib.ContextMenuItem&&(this.ULElement||(this.ULElement=document.createElement("ul"),this.LIElement.appendChild(this.ULElement),this.LIElement.className="sub",this.SPANElement=document.createElement("span"),this.SPANElement.className="contextMenu-ico",this.AElement.appendChild(this.SPANElement)),this.ULElement.appendChild(e._getDOMElement()),this._items.push(e))},e.prototype.getChildItem=function(e){if(!(!this.ULElement||e<0||this._items.length-1<e))return this._items[e]},e.prototype.addSeparator=function(){if(this.ULElement){this.ULElement||(this.ULElement=document.createElement("ul"),this.LIElement.appendChild(this.ULElement));var e=document.createElement("li");this.ULElement.appendChild(e);var t=document.createElement("hr");e.appendChild(t),this._separator.push(e)}},e.prototype.removeSeparator=function(e){if(!(!this.ULElement||e<0||this._separator.length-1<e)){var t=this._separator[e];this.ULElement.removeChild(t),this._separator.splice(e,1)}},e.prototype.enable=function(){this.LIElement.disabled&&(this.LIElement.disabled=!1)},e.prototype.disable=function(){this.LIElement.disabled||(this.LIElement.disabled=!0)}}(),NPMapLib.Adapter.AdapterFactory=function(){var e={},t={},i={};return e.createMapAdapter=function(e,r,n){if(!("number"!=typeof n||n<=0)){if(!e||!e.id||t[e.id])return null;var s;return r.mapId=n,s=new NPMapLib.Adapter.OpenLayers.MapAdapter(e,r),t[e.id]=s,i[n]=s,s}},e.getMapAdapter=function(e){return i[e]},e.getAdapters=function(){return t},e}(),function(){NPMapLib.Tools.DrawingTool=function(e){this._mode=NPMapLib.DRAW_MODE_POLYLINE,this._isStartUp=!1,this.mapId=e,this.CLASS_NAME="NPMapLib.Tools.DrawingTool"},NPMapLib.Tools.DrawingTool.prototype.setMode=function(e,t,i){if(e!==NPMapLib.DRAW_MODE_NONE&&e!==NPMapLib.DRAW_MODE_RECT&&e!==NPMapLib.DRAW_MODE_CIRCLE&&e!==NPMapLib.DRAW_MODE_POLYLINE&&e!==NPMapLib.DRAW_MODE_POLYLGON&&e!==NPMapLib.DRAW_MODE_CIRCLE_DIAMETER&&e!==NPMapLib.DRAW_MODE_FREEHAND||(this._mode=e),this.startUp(),this._isStartUp){var r=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(r){var n=this,s=function(e,i,r,s){if(n._isStartUp=!1,n._mode===NPMapLib.DRAW_MODE_POLYLINE){var o=i.getPath();if(o.length<2)return void t()}if(n._mode===NPMapLib.DRAW_MODE_POLYLGON){var o=i.getPath();if(o.length<4)return void t()}"function"==typeof t&&t(e,i,r,s)};r.drawing(this,s,i)}}},NPMapLib.Tools.DrawingTool.prototype.getMode=function(){return this._mode},NPMapLib.Tools.DrawingTool.prototype.startUp=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.pan(),this._isStartUp=!0},NPMapLib.Tools.DrawingTool.prototype.cancel=function(){if(this._isStartUp){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.pan(),this._isStartUp=!1}}}(),function(){NPMapLib.Tools.MeasureTool=function(e,t){this.CLASS_NAME="NPMapLib.Tools.MeasureTool",this._lengthUnit=NPMapLib.MAP_UNITS_METERS,this._areaUnit=NPMapLib.MAP_UNITS_SQUARE_KILOMETERS,this._mode=NPMapLib.MEASURE_MODE_DISTANCE,this._isStartUp=!1,this.mapId=e,t&&(t.lengthUnit&&(this._lengthUnit=t.lengthUnit),t.areaUnit&&(this._areaUnit=t.areaUnit))},NPMapLib.Tools.MeasureTool.prototype.getLengthUnit=function(){return this._lengthUnit},NPMapLib.Tools.MeasureTool.prototype.setLengthUnit=function(e){this._lengthUnit=e},NPMapLib.Tools.MeasureTool.prototype.getAreaUnit=function(){return this._areaUnit},NPMapLib.Tools.MeasureTool.prototype.setAreaUnit=function(e){this._areaUnit=e},NPMapLib.Tools.MeasureTool.prototype.setMode=function(e,t,i){if(e!==NPMapLib.MEASURE_MODE_DISTANCE&&e!==NPMapLib.MEASURE_MODE_AREA&&e!==NPMapLib.MEASURE_MODE_LOCATION||(this._mode=e),this.startUp(),this._isStartUp){var r=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);if(r){var n=this;r.measure(this,function(e){if(n._stop(),"function"==typeof t)t(e);else try{OnMeasureComplete(e)}catch(i){}},i)}}},NPMapLib.Tools.MeasureTool.prototype.getMode=function(){return this._mode},NPMapLib.Tools.MeasureTool.prototype.startUp=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.pan(),this._isStartUp=!0},NPMapLib.Tools.MeasureTool.prototype._stop=function(){if(this._isStartUp){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.pan(),this._isStartUp=!1}},NPMapLib.Tools.MeasureTool.prototype.finishGeometry=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e.finishGeometry(),this._isStartUp=!1},NPMapLib.Tools.MeasureTool.prototype.stop=function(){if(this._isStartUp){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&e._measureControl.handler.finishGeometry(),this._stop()}},NPMapLib.Tools.MeasureTool.prototype.cancel=function(){var e=NPMapLib.Adapter.AdapterFactory.getMapAdapter(this.mapId);e&&(e.pan(),e.removeMeasureFeatures()),this._isStartUp=!1}}(),function(){function e(e,i){switch(e){case"PlottingEdit":return new OpenLayers.Control.PlottingEdit(t,{handlerOptions:{style:i||{cursor:"crosshair"}}});case"PointEx":return new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.PointEx,{handlerOptions:{style:i||n}});case"MultiPointEx":return new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.MultiPointEx,{handlerOptions:{style:i||s}});case"CurveFlag":case"RectFlag":case"TriangleFlag":return new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler[e],{handlerOptions:{style:i||o}});default:return OpenLayers.Handler[e]?new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler[e],{handlerOptions:{style:i||{cursor:"crosshair",color:"red",fillColor:"red",weight:2,opacity:1,fillOpacity:.3,strokeColor:"red",strokeDashstyle:"dash",cursor:"crosshair"}}}):null}}var t=null,i=null,r=null,n={fillColor:"#323232",fillOpacity:.4,strokeColor:"#323232",strokeOpacity:.8,strokeWidth:15,cursor:"crosshair",strokeDashstyle:"dash"},s={fillColor:"#323232",fillOpacity:1,strokeColor:"#323232",cursor:"crosshair",strokeOpacity:1,strokeWidth:1,pointRadius:8},o={fillColor:"#EA2D1B",fillOpacity:1,strokeColor:"#EA2D1B",cursor:"crosshair",strokeOpacity:1,strokeWidth:2};NPMapLib.Tools.DrawingToolEx=function(e,r){this._mode=NPMapLib.DRAW_MODE_POLYLINE,this._isStartUp=!1,i=e._mapAdapter.map,this.CLASS_NAME="NPMapLib.Tools.DrawingToolEx",t=r?r._apiObj:e._mapAdapter._featuresLayer,i.addLayers([t]),t.style={fillColor:"#66cccc",fillOpacity:.4,strokeColor:"#66cccc",strokeOpacity:1,strokeWidth:3,pointRadius:6}},NPMapLib.Tools.DrawingToolEx.prototype={setMode:function(n,s,o){if(t.events.listeners.sketchcomplete=[],s&&t.events.register("sketchcomplete",this,function(e){return r.deactivate(),i.removeControl(r),i.div.style.cursor="default",r=null,t.events.listeners.sketchcomplete=[],s&&s({gemotry:[e.feature],model:n,json:e.feature.geometry.toJSON(i)}),this.last=e.feature,!1}),r&&(r.deactivate(),i.removeControl(r)),r=e(n,o),!r)throw"无效的模式类型："+n;i.addControl(r),r.activate(),i.div.style.cursor="crosshair"}}}(),NPNamespace.register("NPMapLib"),function(){NPMapLib.GisToolKit=function(){},NPMapLib.GisToolKit.prototype.getDistanceByProjection=function(e,t){var i="";return t instanceof OpenLayers.Map?i=t.units:t&&(i=t.getMapUnits()),e*OpenLayers.INCHES_PER_UNIT.m/OpenLayers.INCHES_PER_UNIT.degrees},NPMapLib.GisToolKit.prototype.getDistanceByProjection2=function(e,t){var i="";return t instanceof OpenLayers.Map?i=t.units:t&&(i=t.getMapUnits()),"m"==i?e:e*OpenLayers.INCHES_PER_UNIT.m/OpenLayers.INCHES_PER_UNIT.degrees},NPMapLib.GisToolKit.prototype.getPlatDistanceByProjection2=function(e,t){var i="";return i=t instanceof OpenLayers.Map?t.units:t.getMapUnits(),"m"==i?e:e*OpenLayers.INCHES_PER_UNIT.degrees/OpenLayers.INCHES_PER_UNIT.m},NPMapLib.GisToolKit.prototype.getPlatDistanceByProjection=function(e,t){return e*OpenLayers.INCHES_PER_UNIT.degrees/OpenLayers.INCHES_PER_UNIT.m}}(),function(){function t(e){var t,i,r,n="",o="",a="",l=0;if(r=/[^A-Za-z0-9\+\/\=]/g,!e||r.exec(e))return e;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do t=s.indexOf(e.charAt(l++)),i=s.indexOf(e.charAt(l++)),r=s.indexOf(e.charAt(l++)),a=s.indexOf(e.charAt(l++)),t=t<<2|i>>4,i=(15&i)<<4|r>>2,o=(3&r)<<6|a,n+=String.fromCharCode(t),64!=r&&(n+=String.fromCharCode(i)),64!=a&&(n+=String.fromCharCode(o));while(l<e.length);return n}function i(e){return"string"==typeof e}function r(e,r){isNaN(e)&&(e=t(e),e=isNaN(e)?0:e),i(e)&&(e=parseFloat(e)),isNaN(r)&&(r=t(r),r=isNaN(r)?0:r),i(r)&&(r=parseFloat(r)),this.lng=e,this.lat=r}var n=function(){var e=3.141592653589793,t=.006693421622965943,i=52.35987755982988,r=20037508.34,n=6378245,s={};return s.transform=function(i,r){i=parseFloat(i),r=parseFloat(r);var s={};if(this.outofChina(r,i))return s.lon=i,s.lat=r,s;var o=this.transformLat(i-105,r-35),a=this.transformLon(i-105,r-35),l=r/180*e,p=Math.sin(l);p=1-t*p*p;var h=Math.sqrt(p);o=180*o/(n*(1-t)/(p*h)*e),a=180*a/(n/h*Math.cos(l)*e);var u=r+o,y=i+a;return s.lon=y,s.lat=u,s},s.outofChina=function(e,t){return t<72.004||t>137.8347||(e<.8293||e>55.8271)},s.transformLat=function(t,i){var r=-100+2*t+3*i+.2*i*i+.1*t*i+.2*Math.sqrt(Math.abs(t));return r+=2*(20*Math.sin(6*t*e)+20*Math.sin(2*t*e))/3,r+=2*(20*Math.sin(i*e)+40*Math.sin(i/3*e))/3,r+=2*(160*Math.sin(i/12*e)+320*Math.sin(i*e/30))/3},s.transformLon=function(t,i){var r=300+t+2*i+.1*t*t+.1*t*i+.1*Math.sqrt(Math.abs(t));return r+=2*(20*Math.sin(6*t*e)+20*Math.sin(2*t*e))/3,r+=2*(20*Math.sin(t*e)+40*Math.sin(t/3*e))/3,r+=2*(150*Math.sin(t/12*e)+300*Math.sin(t/30*e))/3},s.gcj2wgs=function(e,t){var i={lon:0,lat:0},r=e-(this.transform(e,t).lon-e),n=t-(this.transform(e,t).lat-t);return i.lon=r,i.lat=n,i},s.bd_encrypt=function(e,t){var r=e,n=t,s=Math.sqrt(r*r+n*n)+2e-5*Math.sin(n*i),o=Math.atan2(n,r)+3e-6*Math.cos(r*i),a=s*Math.cos(o)+.0065,l=s*Math.sin(o)+.006;return{lon:a,lat:l}},s.bd_decrypt=function(e,t){var r=e-.0065,n=t-.006,s=Math.sqrt(r*r+n*n)-2e-5*Math.sin(n*i),o=Math.atan2(n,r)-3e-6*Math.cos(r*i),a=s*Math.cos(o),l=s*Math.sin(o);return{lon:a,lat:l}},s.webMoctorJW2PM=function(e,t){var i={lon:0,lat:0};e=parseFloat(e),t=parseFloat(t),i.lon=e/180*20037508.34,t>85.05112&&(t=85.05112),t<-85.05112&&(t=-85.05112),t=Math.PI/180*t;var r=Math.PI/4+t/2;return i.lat=20037508.34*Math.log(Math.tan(r))/Math.PI,i},s.inverseMercator=function(e,t){return e=180*e/r,t=180/Math.PI*(2*Math.atan(Math.exp(t/r*Math.PI))-Math.PI/2),{lon:e,lat:t}},s},s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o={$O:6370996.81,lG:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],Au:[75,60,45,30,15,0],fP:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],iG:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],p:null,JD:function(e,t,i){for(;e>i;)e-=i-t;for(;e<t;)e+=i-t;return e},ND:function(e,t,i){return null!=t&&(e=Math.max(e,t)),null!=i&&(e=Math.min(e,i)),e},Fb:function(e){e.lng=e.lon,e.lat=e.lat;var t,i;e.lng=this.JD(e.lng,-180,180),t=new r(e.lng,e.lat);for(var n=0;n<this.Au.length;n++)if(t.lat>=this.Au[n]){i=this.iG[n];break}if(!i)for(n=this.Au.length-1;0<=n;n--)if(t.lat<=-this.Au[n]){i=this.iG[n];break}return e=this.gK(e,i),e=new r(e.lng,e.lat),new NPMapLib.Geometry.Point(e.lng,e.lat)},gK:function(e,t){if(e&&t){var i=t[0]+t[1]*Math.abs(e.lng),n=Math.abs(e.lat)/t[9],n=t[2]+t[3]*n+t[4]*n*n+t[5]*n*n*n+t[6]*n*n*n*n+t[7]*n*n*n*n*n+t[8]*n*n*n*n*n*n,i=i*(0>e.lng?-1:1),n=n*(0>e.lat?-1:1);return new r(i,n)}},ToLL:function(e){e.lng=e.lon;for(var t,i=new r(Math.abs(e.lng),Math.abs(e.lat)),n=0;n<this.lG.length;n++)if(i.lat>=this.lG[n]){t=this.fP[n];break}return e=this.gK(e,t),new NPMapLib.Geometry.Point(e.lng.toFixed(6),e.lat.toFixed(6))}},a=NPMapLib.T={};a.Baidu=o;var l=new n,p=function(e){var t;return e._mapAdapter&&(t=e._mapAdapter.map.baseLayer),e.map&&(t=e.map.baseLayer),e.baseLayer&&(t=e.baseLayer),t};a.helper=l,a.setPoint=function(t,i){if(!NPMap.ISPOINTCONVERT)return i;if("EPSG:900913"===t.getProjection()){var r=p(t);return r.CLASS_NAME.indexOf("Baidu")!=-1?(NPMap.ISWGS84?e=l.transform(i.lon,i.lat):e=i,e=l.bd_encrypt(e.lon,e.lat),NPMap.T.Baidu.Fb(e)):(NPMap.ISWGS84?e=r.CLASS_NAME.indexOf("OSM")!=-1&&0==r.isChina?i:l.transform(i.lon,i.lat):e=i,e=l.webMoctorJW2PM(e.lon,e.lat),new NPMapLib.Geometry.Point(e.lon,e.lat))}return i},a.setPoints=function(e,t){for(var i=[],r=0;r<t.length;r++)i.push(NPMapLib.T.setPoint(e,t[r]));return i},a.getPoint=function(e,t){if(!NPMap.ISPOINTCONVERT)return t;if(t.lon>-180&&t.lon<180&&"EPSG:900913"!=e.getProjection())return t;if("EPSG:900913"===e.getProjection()){var i=l.inverseMercator(t.lon,t.lat),r=p(e);return r.CLASS_NAME.indexOf("Baidu")!=-1?(i=NPMap.T.Baidu.ToLL(t),i=l.bd_decrypt(i.lon,i.lat),NPMap.ISWGS84&&(i=l.gcj2wgs(i.lon,i.lat)),new NPMapLib.Geometry.Point(i.lon,i.lat)):(NPMap.ISWGS84&&(i=r.CLASS_NAME.indexOf("OSM")!=-1&&0==r.isChina?i:l.gcj2wgs(i.lon,i.lat)),new NPMapLib.Geometry.Point(i.lon,i.lat))}return t},a.getPoints=function(e,t){for(var i=[],r=0;r<t.length;r++)i.push(NPMapLib.T.getPoint(e,t[r]));return i},a.setExtent=function(e,t){if("EPSG:900913"==e.getProjection()){var i=NPMapLib.T.setPoint(e,{lon:t.left,lat:t.top}),r=NPMapLib.T.setPoint(e,{lon:t.right,lat:t.bottom});return new NPMapLib.Geometry.Extent(i.lon,r.lat,r.lon,i.lat)}return t},a.getExtent=function(e,t){if("EPSG:900913"==e.getProjection()){var i=NPMapLib.T.getPoint(e,{lon:t.left,lat:t.top}),r=NPMapLib.T.getPoint(e,{lon:t.right,lat:t.bottom});return new NPMapLib.Geometry.Extent(i.lon,r.lat,r.lon,i.lat)}return t}}(),function(e){window.FeatureFacatroy=function(){},window.FeatureFacatroy.defaults={},window.FeatureFacatroy.createOverlay=function(e,s){var o,a=e.overlayType;switch(a){case NPMapLib.OVERLAY_TYPE_POLYLINE:o=t(e,s);break;case NPMapLib.OVERLAY_TYPE_POLYGON:o=i(e,s);break;case NPMapLib.OVERLAY_TYPE_CIRCLE:o=r(e,s);break;case NPMapLib.OVERLAY_TYPE_POINT:o=n(e,s)}return o},window.FeatureFacatroy.isGeometryIntersects=function(e,t,i){var r,n,s=!1;return e&&t?(r=e._apiObj?e._apiObj:window.FeatureFacatroy.createOverlay(e,i),n=t._apiObj?t._apiObj:window.FeatureFacatroy.createOverlay(t,i),r.geometry&&(s=r.geometry.intersects(n.geometry)),s):s};var t=function(e,t){if(e instanceof NPMapLib.Geometry.Polyline){var i=e.getPath();if(i&&!(i.length<=0)){var r=new OpenLayers.Geometry.LineString(s(i,t)),n=new OpenLayers.Feature.Vector(r,e);return n}}},i=function(e,t){if(e instanceof NPMapLib.Geometry.Polygon){var i=e.getPath();if(i&&!(i.length<=0)){if(i[0]instanceof NPMapLib.Geometry.Point){var r=new OpenLayers.Geometry.LinearRing(s(i,t)),n=new OpenLayers.Geometry.Polygon(r),o=new OpenLayers.Feature.Vector(n,e);return o}for(var a=[],l=0;l<i.length;l++)a.push(new OpenLayers.Geometry.LinearRing(s(i[l],t)));var n=new OpenLayers.Geometry.Polygon(a),o=new OpenLayers.Feature.Vector(n,e);return o}}},r=function(e,t){if(e instanceof NPMapLib.Geometry.Circle){var i=e.getCenter();t&&(i=NPMap.T.setPoint(t,i));var r=e.getRadius();if(i&&r){if(i.lon<180&&i.lon>-180){var n=new NPMapLib.GisToolKit;r=n.getDistanceByProjection(r)}var s=new OpenLayers.Geometry.Point(i.lon,i.lat),o=OpenLayers.Geometry.Polygon.createRegularPolygon(s,r,60,10),a=new OpenLayers.Feature.Vector(o,e);return a}}},n=function(e,t){if(e instanceof NPMapLib.Geometry.Point){t&&(e=NPMap.T.setPoint(t,e));var i=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e.lon,e.lat),e);return i}},s=function(e,t){if(!e)return[];t&&(e=NPMap.T.setPoints(t,e));for(var i=[],r=0;r<e.length;++r)i.push(new OpenLayers.Geometry.Point(e[r].lon,e[r].lat));return i}}(window.FeatureFacatroy={}),function(e){window.GeoJSON=function(){},window.GeoJSON.defaults={},window.GeoJSON.write=function(e,t){var i=new OpenLayers.Format.GeoJSON;i.createCRSObject=function(){return{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}},i.extract.point=function(e){if(t){var i=NPMap.T.getPoint(t,{lon:e.x,lat:e.y});return[i.lon,i.lat]}return[e.x,e.y]};var r=new OpenLayers.Format.JSON;if(!OpenLayers.Util.isArray(e)){var n=e._apiObj;e._apiObj||(n=FeatureFacatroy.createOverlay(e,t));var s=i.writeTojSON(n);return e.getData instanceof Function&&(s.properties=e.getData()),r.write(s)}for(var o=[],a=0;a<e.length;a++){var n=e[a]._apiObj;e[a]._apiObj||(n=FeatureFacatroy.createOverlay(e[a],t)),o.push(n)}for(var l=i.writeTojSON(o),a=0;a<o.length;a++)l.features[a].properties=e[a].getData();return r.write(l)},window.GeoJSON.read=function(e,l){l=l?l:"FeatureCollection";var p=null;if(p="string"==typeof e?OpenLayers.Format.JSON.prototype.read.apply(this,[e,null]):e,p&&a(p,l))switch(p.type){case"MultiLineString":return r(p);case"LineString":return n(p);case"Point":return o(p);case"MultiPoint":return i(p);case"Polygon":return s(p);case"MultiPolygon":return t(p);case"Feature":return window.GeoJSON.read(p.geometry);case"Polyline":p.type="MultiLineString";var h=r(p);if(h.length>0)return h[0];case"FeatureCollection":for(var h=[],u=0;u<p.features.length;u++)h.push(window.GeoJSON.read(p.features[u].geometry));return h}};var t=function(e){for(var t=[],i=0;i<e.coordinates.length;i++){ps=[];for(var r=0;r<e.coordinates[i][0].length;r++){var n=e.coordinates[i][0][r];ps.push(new NPMapLib.Geometry.Point(n[0],n[1]))}t.push(ps)}return new NPMapLib.Geometry.Polygon(t)},i=function(e){for(var t=[],i=0;i<e.coordinates.length;i++)t.push(new NPMapLib.Geometry.Point(e.coordinates[i][0],e.coordinates[i][1]));return t},r=function(e){for(var t=[],i=[],r=0;r<e.coordinates.length;r++){t=[];for(var n=0;n<e.coordinates[r].length;n++){var s=e.coordinates[r][n];t.push(new NPMapLib.Geometry.Point(s[0],s[1]))}i.push(new NPMapLib.Geometry.Polyline(t))}return i},n=function(e){for(var t=[],i=0;i<e.coordinates.length;i++){var r=e.coordinates[i];t.push(new NPMapLib.Geometry.Point(r[0],r[1]))}return new NPMapLib.Geometry.Polyline(t)},s=function(e){for(var t=[],i=0;i<e.coordinates[0].length;i++){var r=e.coordinates[0][i];t.push(new NPMapLib.Geometry.Point(r[0],r[1]))}return new NPMapLib.Geometry.Polygon(t)},o=function(e){return new NPMapLib.Geometry.Point(e.coordinates[0],e.coordinates[1])},a=function(e,t){var i=!1;switch(t){case"Geometry":OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],e.type)==-1||(i=!0);break;case"FeatureCollection":i=!0;break;default:e.type==t&&(i=!0)}return i}}(window.GeoJSON={}),function(e){window.WKT=function(){},window.WKT.defaults={},window.WKT.write=function(e,t){var i=new OpenLayers.Format.WKT;if(i.extract.point=function(e){if(t){var i=NPMap.T.getPoint(t,{lon:e.x,lat:e.y});return i.lon+" "+i.lat}return e.x+" "+e.y},!OpenLayers.Util.isArray(e)){var r=e._apiObj;e._apiObj||(r=FeatureFacatroy.createOverlay(e,t));var n=i.write(r);return n}for(var s=[],o=0;o<e.length;o++){var r=e[o]._apiObj;e[o]._apiObj||(r=FeatureFacatroy.createOverlay(e[o],t)),s.push(r)}var a=i.write(s);return a},window.WKT.read=function(a){var l,p,h=new OpenLayers.Format.WKT;a=a.replace(/[\n\r]/g," ");var u=h.regExes.typeStr.exec(a);if(u)switch(l=u[1].toLowerCase(),p=u[2],l){case"multilinestring":return t(p);case"linestring":return i(p);case"point":return r(p);case"multipoint":return n(p);case"polygon":return s(p);case"multipolygon":return o(p);case"geometrycollection":var y=[];p=p.replace(/,\s*([A-Za-z])/g,"|$1");for(var c=OpenLayers.String.trim(p).split("|"),d=0;d<c.length;d++)y.push(e.read(c[d]));return y}};var t=function(e){for(var t,i=new OpenLayers.Format.WKT,r=[],n=[],s=OpenLayers.String.trim(e).split(i.regExes.parenComma),o=0,a=s.length;o<a;++o){t=s[o].replace(i.regExes.trimParens,"$1");for(var l=OpenLayers.String.trim(t).split(","),p=0,h=l.length;p<h;++p){var u=OpenLayers.String.trim(l[p]).split(i.regExes.spaces),y=new NPMapLib.Geometry.Point(u[0],u[1]);r.push(y)}n.push(new NPMapLib.Geometry.Polyline(r))}return n},i=function(e){for(var t=new OpenLayers.Format.WKT,i=e.replace(t.regExes.trimParens,"$1"),r=OpenLayers.String.trim(i).split(","),n=[],s=0,o=r.length;s<o;++s){var a=OpenLayers.String.trim(r[s]).split(t.regExes.spaces),l=new NPMapLib.Geometry.Point(a[0],a[1]);n.push(l)}return new NPMapLib.Geometry.Polyline(n)},r=function(e){var t=new OpenLayers.Format.WKT,i=OpenLayers.String.trim(e).split(t.regExes.spaces);
return new NPMapLib.Geometry.Point(i[0],i[1])},n=function(e){for(var t=new OpenLayers.Format.WKT,i=OpenLayers.String.trim(str).split(","),n=[],s=0,o=i.length;s<o;++s){point=i[s].replace(t.regExes.trimParens,"$1");var a=r(point);n.push(a)}return n},s=function(e){for(var t=new OpenLayers.Format.WKT,i=[],n=OpenLayers.String.trim(e).split(t.regExes.parenComma),s=0,o=n.length;s<o;++s){var a=[];ring=n[s].replace(t.regExes.trimParens,"$1");for(var l=OpenLayers.String.trim(ring).split(","),p=0,h=l.length;p<h;++p){point=l[p].replace(t.regExes.trimParens,"$1");var u=r(point);a.push(u)}i.push(a)}return new NPMapLib.Geometry.Polygon(i)},o=function(e){for(var t=new OpenLayers.Format.WKT,i=OpenLayers.String.trim(e).split(t.regExes.parenComma),r=[],n=i.length-1;n>=0;n--)r.push(s(i[n]));return r}}(window.WKT={}),function(){NPMapLib.Services.BufferService=function(e,t){this.serviceType=t?t:EzServerClient.GlobeParams.MyMapType,this.url="",this.map=e,this.CLASS_NAME="NPMapLib.Services.BufferService"},NPMapLib.Services.BufferService.prototype.buffer=function(e,t,i,r){switch(r=r?r:function(e){return alert(NPMapLib.Utils.BaseUtils.toJson(e)),!1},this.serviceType){case NPMapLib.MAPTYPE_ARCGISTILE:return this._bufferArcGIS(e,t,i,r);case NPMapLib.MAPTYPE_PGIS:return this._bufferPgis(e,t,i,r);case NPMapLib.MAPTYPE_NPGIS:return this._queryNPGIS(e,t,i,r);default:return this._bufferGeoserver(e,t,i,r)}},NPMapLib.Services.BufferService.prototype._queryNPGIS=function(e,t,i,r){this._dataConfig(e,t,i,r);var n="&geometry="+this.geometry.toLocaleString()+"&distance="+this.distance+"&srid="+this.map.getProjection().split(":")[1];return OpenLayers.Request.POST({url:e,headers:{"Content-Type":"application/x-www-form-urlencoded"},scope:this,data:n,success:function(e){e.responseText&&"POLYGON EMPTY"!=e.responseText&&(e=WKT.read(e.responseText),this._callback(e,i))}})},NPMapLib.Services.BufferService.prototype._bufferArcGIS=function(url,params,successCallback,errorCallback){var unionResults=!0,geodesic=!1;if(url&&(this.url=url),params.geometry){var projection=this.map.getProjection();switch(projection){case"EPSG:4326":projection=4326;break;case"EPSG:900913":case"EPSG:3857":projection=3857}if(params.geometry instanceof NPMapLib.Geometry.Point){this.geometryType="esriGeometryPoint";var points=params.geometry,point={x:points.lon,y:points.lat,spatialReference:{wkid:projection}},points=[];points.push(point);var geometries={geometryType:this.geometryType,geometries:points}}else if(params.geometry instanceof NPMapLib.Geometry.Polyline){this.geometryType="esriGeometryPolyline";for(var points=params.geometry.getPath(),paths=[],path=[],i=0;i<points.length;i++)path.push([points[i].lon,points[i].lat]);paths.push(path);var polylines=[],polyline={paths:paths,spatialReference:{wkid:projection}};polylines.push(polyline);var geometries={geometryType:this.geometryType,geometries:polylines}}else if(params.geometry instanceof NPMapLib.Geometry.Polygon){this.geometryType="esriGeometryPolygon";for(var points=params.geometry.getPath(),rings=[],ring=[],i=0;i<points.length;i++)ring.push([points[i].lon,points[i].lat]);rings.push(ring);var polygons=[],polygon={rings:rings,spatialReference:{wkid:projection}};polygons.push(polygon);var geometries={geometryType:this.geometryType,geometries:polygons}}else params.geometry instanceof NPMapLib.Geometry.Multipoint&&(this.geometryType="esriGeometryMultipoint");geometries=NPMapLib.Utils.BaseUtils.toJson(geometries);var tool=new NPMapLib.GisToolKit;distance=tool.getDistanceByProjection(params.distance,this.map),params.geometry instanceof NPMapLib.Geometry.Point&&(distance=[distance,10]);var self=this}return OpenLayers.Request.GET({url:this.url,params:{f:params.format,unionResults:unionResults,geodesic:geodesic,geometries:geometries,inSR:projection,distances:distance,outSR:projection,bufferSR:projection,AK:window.NPGIS_AUTHKEY},success:function(reply){var projection=self.map.getProjection(),reply=eval("("+reply.responseText+")"),rings=[];if(!reply.error)for(var temp=[],i=0;i<reply.geometries[0].rings.length;i++){temp=[],ring=reply.geometries[0].rings[i];for(var j=0;j<ring.length;j++){var point=new NPMapLib.Geometry.Point(ring[j][0],ring[j][1]);temp.push(point)}rings.push(temp)}var out={rings:rings,spatialReference:projection};"function"==typeof successCallback&&successCallback(out)},failure:function(e){"function"==typeof errorCallback&&errorCallback(e.responseText)}})},NPMapLib.Services.BufferService.prototype._dataConfig=function(e,t,i,r){e&&(this.url=e);var n=new NPMapLib.GisToolKit;this.distance=n.getDistanceByProjection(t.distance,this.map),t.geometry&&(this.geometry=WKT.write(t.geometry,this.map))},NPMapLib.Services.BufferService.prototype._callback=function(e,t){var i=[],r=this.map.getProjection();e&&(i=e instanceof Array?1===e.length?e[0].getPath():e:e.getPath());var n={rings:i,spatialReference:r};"function"==typeof t&&t(n)},NPMapLib.Services.BufferService.prototype._bufferGeoserver=function(e,t,i,r){this._dataConfig(e,t,i,r);var n=new OpenLayers.WPSClient({servers:{opengeo:this.url}}),s=n.getProcess("opengeo","JTS:buffer");return s.execute({inputs:{geom:this.geometry,distance:this.distance},scope:this,success:function(e){var t=e.result;this._callback(t,i)},failure:function(e){"function"==typeof r?r(e):alert("failed")}})}}(),function(){NPMapLib.Services.bufferParams=function(){this.distance=0,this.unit="m",this.quadrantSegments="",this.capStyle="",this.format="json"}}(),function(){NPMapLib.Services.QueryService=function(e){this.serviceType=e?e:EzServerClient.GlobeParams.MyMapType,this.filter=null,this.CLASS_NAME="NPMapLib.Services.QueryService"},NPMapLib.Services.QueryService.prototype.query=function(e,t,i,r){switch(r=r?r:function(e){return alert(NPMapLib.Utils.BaseUtils.toJson(e)),!1},this.serviceType){case NPMapLib.MAPTYPE_ARCGISTILE:return this._queryArcGIS(e,t,i,r);case NPMapLib.MAPTYPE_PGIS:return this._queryPgis(e,t,i,r);case NPMapLib.MAPTYPE_NPGIS:return this._queryNPGIS(e,t,i,r);case NPMapLib.MAPTYPE_GAODE:return this._queryGaode(e,t,i,r);default:return this._queryGeoserver(e,t,i,r)}},NPMapLib.Services.QueryService.prototype._queryGaode=function(e,t,i,r){},NPMapLib.Services.QueryService.prototype._queryNPGIS=function(url,params,successCallback,errorCallback){return OpenLayers.Request.GET({url:url,headers:{"Content-Type":"text/xml; charset=utf-8"},scope:this,params:params,success:function(reply){if("function"==typeof successCallback){var result=eval("("+reply.responseText+")");successCallback(result)}},failure:function(reply){"function"==typeof errorCallback?errorCallback(eval("("+reply.responseText+")")):alert("failed")}})},NPMapLib.Services.QueryService.prototype.updata=function(url,params,successCallback,errorCallback){return errorCallback=errorCallback?errorCallback:function(e){return alert(NPMapLib.Utils.BaseUtils.toJson(e)),!1},OpenLayers.Request.POST({url:url,headers:{"Content-Type":"text/xml; charset=utf-8"},scope:this,params:params,success:function(reply){if("function"==typeof successCallback){var result=eval("("+reply.responseText+")");successCallback(result)}},failure:function(reply){"function"==typeof errorCallback?errorCallback(eval("("+reply.responseText+")")):alert("failed")}})},NPMapLib.Services.QueryService.prototype._queryGeoserver=function(url,params,successCallback,errorCallback){return url&&(this.url=url),params.searchText&&(this.filter='<Filter xmlns:ogc="http://www.opengis.net/ogc">',this.filter+="<PropertyIsEqualTo><PropertyName>",this.filter+=params.workSpace+":"+params.searchFields,this.filter+="</PropertyName><Literal>",this.filter+=params.searchText,this.filter+="</Literal></PropertyIsEqualTo></Filter>"),OpenLayers.Request.GET({url:this.url,scope:this,params:{typeName:params.layers.join(","),service:params.service,version:params.serviceVersion,outputFormat:params.outputFormat,request:params.request,filter:this.filter,AK:window.NPGIS_AUTHKEY},success:function(reply){if("function"==typeof successCallback){var result=eval("("+reply.responseText+")");successCallback(this.arrangeGeoserverData(result.features))}},failure:function(reply){"function"==typeof errorCallback?errorCallback(eval("("+reply.responseText+")")):alert("failed")}})},NPMapLib.Services.QueryService.prototype._formartGeometryType=function(e){if(e){if("MultiLineString"==e||"esriGeometryPolyline"==e)return"NPMapLib.Geometry.Polyline";if("point"==e||"Point"==e||"esriGeometryPoint"==e)return"NPMapLib.Geometry.Point"}return""},NPMapLib.Services.QueryService.prototype._queryArcGIS=function(url,params,successCallback,errorCallback){url&&(this.url=url);var me=this;return OpenLayers.Request.GET({url:this.url,scope:this,params:{f:params.outputFormat,searchText:params.searchText,contains:params.contains,returnGeometry:params.returnGeometry,layers:params.layers.join(","),searchFields:params.searchFields},success:function(reply){if("function"==typeof successCallback){var result=eval("("+reply.responseText+")");successCallback(this.arrangeArcgisData(result.results))}},failure:function(e){"function"==typeof errorCallback&&errorCallback(e.responseText)}})},NPMapLib.Services.QueryService.prototype.arrangeArcgisData=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],n=this._formartGeometryType(r.geometryType);t.push({displayFieldName:r.displayFieldName,foundFieldName:r.foundFieldName,geometryType:n,layerId:r.layerId,layerName:r.layerName,value:r.value,feature:{attributes:r.attributes,geometry:"NPMapLib.Geometry.Polyline"==n?r.geometry.paths:{x:r.geometry.x,y:r.geometry.y},featureType:n}})}return t},NPMapLib.Services.QueryService.prototype.arrangeGeoserverData=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push({displayFieldName:"",foundFieldName:"",geometryType:this._formartGeometryType(r.geometry.type),layerId:r.id,layerName:r.id,value:r.properties.NAME,feature:{attributes:r.properties,geometry:r.geometry.coordinates,featureType:this._formartGeometryType(r.geometry.type)}})}return t},NPMapLib.Services.QueryService.prototype.arrangeNpGISData=function(data){for(var result=[],i=0;i<data.length;i++){var item=data[i],geometry=eval("("+item.geometry+")");result.push({attributes:item,feature:{geometry:geometry,featureType:this._formartGeometryType(geometry.type)}})}return result},NPMapLib.Services.QueryService.prototype._queryPgis=function(e,t,i,r){}}(),function(){NPMapLib.Services.queryParams=function(){this.returnGeometry=!0,this.searchFields="NAME",this.layers="",this.searchText="",this.contains=!0,this.service="WFS",this.serviceVersion="1.0.0",this.outputFormat="json",this.request="GetFeature"}}(),function(){NPMapLib.Services.RouteService=function(e,t){this.map=e,this.serviceType=t?t:EzServerClient.GlobeParams.MyMapType,this.url="",this.CLASS_NAME="NPMapLib.Services.RouteService"},NPMapLib.Services.RouteService.prototype.route=function(e,t,i,r){switch(r=r?r:function(e){return alert(NPMapLib.Utils.BaseUtils.toJson(e)),!1},this.serviceType){case NPMapLib.MAPTYPE_ARCGISTILE:return this._routeArcGIS(e,t,i,r);case NPMapLib.MAPTYPE_PGIS:return this._routePgis(e,t,i,r);default:return this._routeGeoserver(e,t,i,r)}},NPMapLib.Services.RouteService.prototype._routeGeoserver=function(url,params,successCallback,errorCallback){if(params.startStop instanceof NPMapLib.Geometry.Point&&params.endStop instanceof NPMapLib.Geometry.Point){var out_options={internalProjection:this.map.getProjection(),externalProjection:this.map.getProjection()};writer=new OpenLayers.Format.WKT(out_options);var in_options={internalProjection:this.map.getProjection(),externalProjection:this.map.getProjection()};reader=new OpenLayers.Format.WKT(in_options);var stops="",startStop=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(params.startStop.lon,params.startStop.lat));stops+=writer.write(startStop)+"|";var endStop=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(params.endStop.lon,params.endStop.lat));stops+=writer.write(endStop);var lang="CN"===NPMapLib.CULTURE?"zh_CN":"en_US";lang=params.lang?params.lang:lang;for(var barries="",i=0;i<params.geoBarriers.length;i++){if(params.geoBarriers[i]instanceof NPMapLib.Geometry.Polygon&&params.geoBarriers[i].getPath().length>3){var feaure=this._createPolygon(params.geoBarriers[i]);barries+=""===barries?writer.write(feaure):"|"+writer.write(feaure)}if(params.geoBarriers[i]instanceof NPMapLib.Geometry.Circle&&params.geoBarriers[i].getPoints().length>3){var feaure=this._createPolygon(params.geoBarriers[i]);barries+=""===barries?writer.write(feaure):"|"+writer.write(feaure)}if(params.geoBarriers[i]instanceof NPMapLib.Geometry.Polyline){var feaure=this._createPolyline(params.geoBarriers[i]);barries+=""===barries?writer.write(feaure):"|"+writer.write(feaure)}}return url&&(this.url=url),OpenLayers.Request.GET({url:url,scope:this,params:{service:params.service,version:params.version?params.version:"1.0.0",outputFormat:params.outputFormat?params.outputFormat:"json",request:params.request,graph:params.networkName,algorithm:params.algorithm||"Dijkstra",weighter:params.weighter||"length",stops:stops,restrictField:params.trafficModel||"car",planroadtype:params.planRoadType||"1",geoms:barries,lang:lang,AK:window.NPGIS_AUTHKEY},success:function(reply){if(!(reply.status<2)){var infos={};if(infos=eval("("+reply.responseText+")"),infos!={}){var strs=infos.routelatlon;if(""!==strs){var messages=infos.routes||{segments:[]},features=[];""!=strs&&(features=GeoJSON.read(strs));for(var allPoints=features.length>0?features[0].getPath():[],k=0;k<messages.segments.length;k++){var tempfeatures=GeoJSON.read(messages.segments[k].routelatlon);messages.segments[k].features=tempfeatures}messages.endPoint=GeoJSON.read(messages.endPoint),messages.startPoint=GeoJSON.read(messages.startPoint),"function"==typeof successCallback&&successCallback({features:features,params:params,messages:messages,points:allPoints,routelatlon:strs})}}}},failure:function(reply){"function"==typeof errorCallback?errorCallback(eval("("+reply.responseText+")")):alert("failed")}})}},NPMapLib.Services.RouteService.prototype.routeByMultPoints=function(url,param,successCallback,errorCallback){return OpenLayers.Request.POST({url:url,scope:this,data:{stops:param.stops},success:function(reply){if(!(reply.status<2)){var infos=eval("("+reply.responseText+")");"function"==typeof successCallback&&successCallback(infos)}},failure:function(reply){"function"==typeof errorCallback&&errorCallback(eval("("+reply.responseText+")"))}})},NPMapLib.Services.RouteService.prototype._routeArcGIS=function(url,params,successCallback,errorCallback){var stops,barriers,polylineBarriers,polygonBarriers,outSR="",ignoreInvalidLocations=!0,accumulateAttributeNames="",impedanceAttributeName="Length",restrictionAttributeNames="",attributeParameterValues="",restrictUTurns="esriNFSBAllowBacktrack",useHierarchy=!1,returnDirections=!0,returnRoutes=!0,returnStops=!1,returnBarriers=!1,returnPolylineBarriers=!1,returnPolygonBarriers=!1,directionsLanguage="en-US",directionsStyleName="",outputLines="esriNAOutputLineTrueShapeWithMeasure",findBestSequence=!1,preserveFirstStop=!1,preserveLastStop=!1,useTimeWindows=!1,startTime=0,outputGeometryPrecision="",outputGeometryPrecisionUnits="esriDecimalDegrees",directionsOutputType="esriDOTComplete",directionsTimeAttributeName="",directionsLengthUnits="esriNAUMiles",returnZ=!1,f="json",projection=this.map.getProjection();switch(projection){case"EPSG:4326":projection=4326;break;case"EPSG:900913":projection=3857}if(url&&(this.url=url),params&&params.startStop&&params.endStop){var features=[],feature1={geometry:{x:params.startStop.lon,y:params.startStop.lat,spatialReference:{wkid:projection}}},feature2={geometry:{x:params.endStop.lon,y:params.endStop.lat,spatialReference:{wkid:projection}}};features.push(feature1),features.push(feature2);var stops={type:"features",features:features,doNotLocateOnRestrictedElements:!0}}if(stops=NPMapLib.Utils.BaseUtils.toJson(stops),params.geoBarriers){for(var points=[],polylines=[],polygons=[],i=0;i<params.geoBarriers.length;i++)params.geoBarriers[i]instanceof NPMapLib.Geometry.Point?points.push(params.geoBarriers[i]):params.geoBarriers[i]instanceof NPMapLib.Geometry.Polyline?polylines.push(params.geoBarriers[i]):(params.geoBarriers[i]instanceof NPMapLib.Geometry.Polygon||params.geoBarriers[i]instanceof NPMapLib.Geometry.Circle)&&polygons.push(params.geoBarriers[i]);for(var paths=[],i=0;i<polylines.length;i++){for(var _points=polylines[i]._points,path=[],j=0;j<_points.length;j++){var point=[_points[j].lon,_points[j].lat];path.push(point)}paths.push(path)}for(var polylineBarriers={features:[{geometry:{paths:paths,spatialReference:{wkid:projection}}}]},rings=[],i=0;i<polygons.length;i++){var _points;_points=polygons[i]instanceof NPMapLib.Geometry.Circle?polygons[i].getPoints():polygons[i]._points;for(var ring=[],j=0;j<_points.length;j++){var point=[_points[j].lon,_points[j].lat];ring.push(point)}rings.push(ring)}var polygonBarriers={features:[{geometry:{rings:rings,spatialReference:{wkid:projection}}}]};polylineBarriers=NPMapLib.Utils.BaseUtils.toJson(polylineBarriers),polygonBarriers=NPMapLib.Utils.BaseUtils.toJson(polygonBarriers)}OpenLayers.Request.GET({url:this.url,params:{stops:stops,barriers:barriers,polylineBarriers:polylineBarriers,polygonBarriers:polygonBarriers,outSR:outSR,ignoreInvalidLocations:ignoreInvalidLocations,accumulateAttributeNames:accumulateAttributeNames,impedanceAttributeName:impedanceAttributeName,restrictionAttributeNames:restrictionAttributeNames,attributeParameterValues:attributeParameterValues,restrictUTurns:restrictUTurns,useHierarchy:useHierarchy,returnDirections:returnDirections,returnRoutes:returnRoutes,returnStops:returnStops,returnBarriers:returnBarriers,returnPolylineBarriers:returnPolylineBarriers,returnPolygonBarriers:returnPolygonBarriers,directionsLanguage:directionsLanguage,directionsStyleName:directionsStyleName,outputLines:outputLines,findBestSequence:findBestSequence,preserveFirstStop:preserveFirstStop,preserveLastStop:preserveLastStop,useTimeWindows:useTimeWindows,startTime:startTime,outputGeometryPrecision:outputGeometryPrecision,outputGeometryPrecisionUnits:outputGeometryPrecisionUnits,directionsOutputType:directionsOutputType,directionsTimeAttributeName:directionsTimeAttributeName,directionsLengthUnits:directionsLengthUnits,returnZ:returnZ,f:f},success:function(reply){if("function"==typeof successCallback){var reply=eval("("+reply.responseText+")");if(!reply.routes)return void errorCallback(reply.error);var routes=reply.routes.features[0].geometry.paths[0],polyline=new NPMapLib.Geometry.Polyline(routes);this.map.addOverlay(polyline);for(var dirs=reply.directions[0].features,dirInfos=[],i=0;i<dirs.length;i++){var len=dirs[i].attributes.length,tool=new NPMapLib.GisToolKit;len=tool.getDistanceByProjection(length,this.map);var text=dirs[i].attributes.text,dirInfo={len:len,text:text};dirInfos.push(dirInfo)}var result={routes:routes,geometry:polyline,dirInfos:dirInfos};successCallback(result)}},failure:function(e){"function"==typeof errorCallback&&errorCallback(e.responseText)}})},NPMapLib.Services.RouteService.prototype._routePgis=function(e,t,i,r){},NPMapLib.Services.RouteService.prototype._castPoint=function(e){return new OpenLayers.Geometry.Point(e.lon,e.lat)},NPMapLib.Services.RouteService.prototype._castPoints=function(e){if(!e)return[];for(var t=[],i=0;i<e.length;++i)t.push(this._castPoint(e[i]));return t},NPMapLib.Services.RouteService.prototype._createPolygon=function(e){if(e instanceof NPMapLib.Geometry.Polygon||e instanceof NPMapLib.Geometry.Circle){var t=[];if(e instanceof NPMapLib.Geometry.Polygon&&(t=e.getPath()),e instanceof NPMapLib.Geometry.Circle&&(t=e.getPoints()),t&&!(t.length<=0)){var i=new OpenLayers.Geometry.LinearRing(this._castPoints(t)),r=new OpenLayers.Geometry.Polygon(i),n=new OpenLayers.Feature.Vector(r,e);return n}}},NPMapLib.Services.RouteService.prototype._createPolyline=function(e){if(e instanceof NPMapLib.Geometry.Polyline){var t=e.getPath();if(t&&!(t.length<=0)){var i=new OpenLayers.Geometry.LineString(this._castPoints(t)),r=new OpenLayers.Feature.Vector(i,e);return r}}};var each=function(e,t){for(var i=0;i<e.length;i++)t(i,e[i])},arraryContains=function(e,t){for(var i=0;i<e.length;i++)if(e[i].lon==t.lon&&e[i].lon==t.lon)return!0;return!1}}(),function(){NPMapLib.Services.routeParams=function(){this.service="na",this.request="getroute",this.networkName="",this.weighter="length",this.startStop,this.endStop,this.trafficModel,this.geoBarriers}}(),function(){NPMapLib.Symbols.AnimationLine=function(e,t,i){this.CLASS_NAME="NPMapLib.Symbols.AnimationLine",this.points,this.op_line,this.op_feature,this._layer,this.drawIndex=0,this.drawSpeed,this.isWait=!1,this.isAddPoint=!1,this.segArray,this.segIndex=0,this.panWay=-1,this.status,this.interval=10,this.newStart=!0,this.events=new NPMapLib.Events(this,["preDraw","afterDraw","afterStep"]),this.headerMarker=null,this.isHeaderRotate=!0,this.timer=null,this.lineStyle={color:"green"},i&&(i.color&&(this.lineStyle.color=i.color),i.opacity&&(this.lineStyle.opacity=i.opacity),i.weight&&(this.lineStyle.weight=i.weight)),this.id=-1,this._points=new Array,this._listeners={},this.mapId=e,this.layerName="动画线",this.mapAdapter=NPMapLib.Adapter.AdapterFactory.getMapAdapter(e),this.points=t,this.points instanceof Array||(this.points=[]),this.drawSpeed=15,this.status=0,i&&(this.headerMarker=i.headerMarker,this.isHeaderRotate=i.isHeaderRotate!==!1),this._init()},NPMapLib.Symbols.AnimationLine.prototype.restart=function(){this.op_line&&this._layer.getOverlay(this.op_line.id)&&this._layer.removeOverlay(this.op_line),this._init(),this.start()},NPMapLib.Symbols.AnimationLine.prototype.start=function(){NPMapLib.isAnimat=!0,this.status>0||(this._triggerEvent(NPMapLib.ANIMATION_EVENT_START),this.status=1,this._layer||(this._layer=new NPMapLib.Layers.OverlayLayer(this.layerName,(!1)),this._layer.mapId=this.mapId,this.mapAdapter.addLayer(this._layer)),this._layer.getOverlay(this.op_line.id)||this._layer.addOverlay(this.op_line),this.panWay>=0&&this._suitView(this.points),this.newStart&&0==this.drawIndex&&this.points.length>0&&(this.headerMarker&&(this._rotateHeaderMarker(),this.headerMarker.moveTo(this.points[this.drawIndex])),this.events.triggerEvt("afterDraw",{point:this.points[this.drawIndex],index:this.drawIndex})),this.timer=window.setTimeout(this._startDraw.bind(this),this.interval))},NPMapLib.Symbols.AnimationLine.prototype.pause=function(){NPMapLib.isAnimat=!1,this.status=-1},NPMapLib.Symbols.AnimationLine.prototype.stop=function(){NPMapLib.isAnimat=!1,this.status==-1&&this._triggerEvent(NPMapLib.ANIMATION_EVENT_STOP),this.status=0,window.clearTimeout(this.timer)},NPMapLib.Symbols.AnimationLine.prototype.setSpeed=function(e){0==e?(this.isWait=!0,this.isAddPoint=!1,this.drawSpeed=0):(this.isWait=!1,this._rotateHeaderMarker(),this.drawSpeed=e)},NPMapLib.Symbols.AnimationLine.prototype.appendPoints=function(e){e instanceof Array&&!(e.length<=0)&&(this.points=this.points.concat(e),this.op_line||this._init(),this.panWay>=0&&this._suitView(e))},NPMapLib.Symbols.AnimationLine.prototype.setStyle=function(e){this.lineStyle=this._overwriteObj(this.lineStyle,e),this.op_line&&this._layer&&(this.op_line.setStyle(this.lineStyle),this._redraw())},NPMapLib.Symbols.AnimationLine.prototype._overwriteObj=function(e,t){if(!e||!t)return e;for(var i in t)i in e&&(e[i]=t[i]);return e},NPMapLib.Symbols.AnimationLine.prototype._startDraw=function(){if(0==this.status)return void this._triggerEvent(NPMapLib.ANIMATION_EVENT_STOP);if(this.status==-1)return void this._triggerEvent(NPMapLib.ANIMATION_EVENT_PAUSE);if(!this.op_line)return void(this.status=0);var e=this._preDraw();return e?this.isWait?(this.isAddPoint||(this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex]),this.isAddPoint=!0,this.events.triggerEvt("afterDraw",{point:this.points[this.drawIndex],index:this.drawIndex})),void window.setTimeout(this._startDraw.bind(this),this.interval)):(this._addPoint(),void this._afterDraw()):void(this.status=0)},NPMapLib.Symbols.AnimationLine.prototype.continus=function(){this.isAddPoint=!1,this.drawIndex++},NPMapLib.Symbols.AnimationLine.prototype._preDraw=function(){0==this.drawIndex&&(this.segArray=this._calculateSeg(this.drawIndex));var e=0==this.drawIndex&&0==this.segIndex,t=this.segArray.length;return this.segIndex=this.segIndex+1,e&&this.events.triggerEvt("preDraw",{point:this.points[this.drawIndex],index:this.drawIndex}),(e||this.segIndex>=t-1)&&this._rotateHeaderMarker(),!(this.drawIndex>=this.points.length-1)&&(this.segIndex>=t&&(this.segIndex=0,this.segArray=this._calculateSeg(this.drawIndex)),this.panWay<=0||(!this._inView(this.segArray[this.segIndex])&&this.panWay>0&&this._setCenter(this.segArray[this.segIndex]),!0))},NPMapLib.Symbols.AnimationLine.prototype._addPoint=function(){this._moveHeaderMarker();var e=NPMapLib.T.setPoint(this.mapAdapter,this.segArray[this.segIndex]);if(this.op_line._apiObj){if(this.segIndex<=1||this.op_line._apiObj.geometry.components.length<2){if(this.drawIndex>0){var t=NPMapLib.T.setPoint(this.mapAdapter,this.points[this.drawIndex]),i=new OpenLayers.Geometry.Point(t.lon,t.lat);this.op_line._apiObj.geometry.components.push(i),i.parent=this.op_line._apiObj.geometry}var r=new OpenLayers.Geometry.Point(e.lon,e.lat);this.op_line._apiObj.geometry.components.push(r),r.parent=this.op_line._apiObj.geometry}else{var n=this.op_line._apiObj.geometry.components.length,r=new OpenLayers.Geometry.Point(e.lon,e.lat);this.op_line._apiObj.geometry.components[n-1]=r,r.parent=this.op_line._apiObj.geometry}this.op_line._apiObj.geometry.clearBounds(),this._redraw()}},NPMapLib.Symbols.AnimationLine.prototype._afterDraw=function(){var e=(0==this.drawIndex&&(1==this.segIndex||0==this.segIndex),this.segIndex>=this.segArray.length-1);e&&(this.drawIndex++,this.events.triggerEvt("preDraw",{point:this.points[this.drawIndex],index:this.drawIndex})),this.drawIndex>0&&e&&(this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex]),this.events.triggerEvt("afterDraw",{point:this.points[this.drawIndex],index:this.drawIndex}));var t=this.segIndex;this.segIndex>this.segArray.length-2&&(t=0),this.events.triggerEvt("afterStep",{stepIndex:t,pointIndex:this.drawIndex,point:this.segArray[this.segIndex]}),this.segIndex>this.segArray.length-2&&this.drawIndex>this.points.length-2&&(this.status=0,NPMapLib.isAnimat=!1),this.timer=window.setTimeout(this._startDraw.bind(this),this.interval)},NPMapLib.Symbols.AnimationLine.prototype.nextPosition=function(){this.newStart=!1,this.drawIndex>0&&this.drawIndex--,this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex]),this._rotateHeaderMarker(),this.segIndex=0,this.segArray=this._calculateSeg(this.drawIndex),this._setLine(this.drawIndex),this.events.triggerEvt("afterStep",{stepIndex:0,pointIndex:this.drawIndex,point:this.segArray[this.segIndex]})},NPMapLib.Symbols.AnimationLine.prototype.afterPosition=function(){this.drawIndex<this.points.length-1&&(this.drawIndex++,this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex]),this._rotateHeaderMarker(),this.segIndex=0,this.segArray=this._calculateSeg(this.drawIndex),this._setLine(this.drawIndex),this.events.triggerEvt("afterStep",{stepIndex:0,pointIndex:this.drawIndex,point:this.segArray[this.segIndex]}))},NPMapLib.Symbols.AnimationLine.prototype.slicePoints=function(e){this.points=this.points.slice(0,e+1)},NPMapLib.Symbols.AnimationLine.prototype._setLine=function(e,t){if(this.op_line._apiObj){this.op_line._apiObj.geometry.components=[];for(var i=0;i<e+1;i++){var r=NPMapLib.T.setPoint(this.mapAdapter,this.points[i]),n=new OpenLayers.Geometry.Point(r.lon,r.lat);this.op_line._apiObj.geometry.components.push(n),n.parent=this.op_line._apiObj.geometry}if(t>0){var s=NPMapLib.T.setPoint(this.mapAdapter,this.segArray[t]),o=new OpenLayers.Geometry.Point(s.lon,s.lat);this.op_line._apiObj.geometry.components.push(o),o.parent=this.op_line._apiObj.geometry}this.op_line._apiObj.geometry.clearBounds(),this._redraw()}},NPMapLib.Symbols.AnimationLine.prototype.setLayer=function(e){this._layer=e},NPMapLib.Symbols.AnimationLine.prototype._init=function(){this.segArray=[],this.drawIndex=0;var e=[];this.points.length>0&&e.push(this.points[0]),this.op_line=new NPMapLib.Geometry.Polyline(e,this.lineStyle)},NPMapLib.Symbols.AnimationLine.prototype._redraw=function(){this.op_line&&this._layer&&this.op_line.refresh()},NPMapLib.Symbols.AnimationLine.prototype._calculateSeg=function(e){var t=[];if(e+1>=this.points.length)return t.push(0),t;var i=this.points[e],r=this.points[e+1],n=this._getDistance(i,r),s=0;this.drawSpeed>0&&(s=Math.round(n/this.drawSpeed));for(var o,a,l=1;l<s;l++)o=l/s,x=parseFloat((r.lon-i.lon)*o)+parseFloat(i.lon),y=parseFloat((r.lat-i.lat)*o)+parseFloat(i.lat),a=new NPMapLib.Geometry.Point(x,y),t.push(a);return t.push(this.points[e+1]),t},NPMapLib.Symbols.AnimationLine.prototype._getDistance=function(e,t){return this.mapAdapter.getDistance(e,t,"EPSG:4326")},NPMapLib.Symbols.AnimationLine.prototype._inView=function(e){var t=this.mapAdapter.getExtent(),i=this.mapAdapter.containsPoint(t,NPMapLib.T.setPoint(this.mapAdapter,e));return i},NPMapLib.Symbols.AnimationLine.prototype._setCenter=function(e){this.mapAdapter.setCenter(NPMap.T.setPoint(this.mapAdapter,e))},NPMapLib.Symbols.AnimationLine.prototype._pointToPixel=function(e){return this.mapAdapter.pointToPixel(NPMap.T.setPoint(this.mapAdapter,e))},NPMapLib.Symbols.AnimationLine.prototype._pixelToPoint=function(e){return NPMap.T.getPoint(this.mapAdapter,this.mapAdapter.pixelToPoint(e))},NPMapLib.Symbols.AnimationLine.prototype._setLayer=function(e){if(e&&e._useCluster)throw"can not use cluster layer";this._layer=e},NPMapLib.Symbols.AnimationLine.prototype._suitView=function(e){e.length>1&&this._layer&&this._layer.map},NPMapLib.Symbols.AnimationLine.prototype._rotateHeaderMarker=function(){if(this.headerMarker&&this.isHeaderRotate){var e=this._calculateAngle();e>=0&&this.headerMarker.rotate(e)}},NPMapLib.Symbols.AnimationLine.prototype.setPosition=function(e,t){if(e>-1&&e<this.points.length){this.drawIndex=e;var i=this._calculateSeg(this.drawIndex);t>-1&&t<i.length?(this.segArray=i,this.segIndex=t):t<0?(this.segArray=i,this.segIndex=0):t>i.length-1&&(this.segArray=i,this.segIndex=i.length-2),1==i.length&&0==i[0]&&this.headerMarker&&this.headerMarker.moveTo(this.points[this.drawIndex]),this._rotateHeaderMarker(),0==this.segIndex?this.headerMarker.moveTo(this.points[this.drawIndex]):this._moveHeaderMarker(),this._setLine(this.drawIndex,this.segIndex)}},NPMapLib.Symbols.AnimationLine.prototype._calculateAngle=function(){if(this.drawIndex>=this.points.length-1)return-1;var e=this.points[this.drawIndex],t=this.points[this.drawIndex+1],i=180*Math.atan2(t.lat-e.lat,t.lon-e.lon)/Math.PI;return i=i>0?360-i:0-i},NPMapLib.Symbols.AnimationLine.prototype._moveHeaderMarker=function(){if(this.headerMarker){var e=this.segArray[this.segIndex];if(e.lon&&e.lat){var t=new NPMapLib.Geometry.Point(e.lon,e.lat);this.headerMarker.moveTo(t)}}},NPMapLib.Symbols.AnimationLine.prototype.addEventListener=function(e,t){switch(e){case NPMapLib.ANIMATION_EVENT_START:this._listeners.start||(this._listeners.start=[]),this._listeners.start.push(t);break;case NPMapLib.ANIMATION_EVENT_PAUSE:this._listeners.pause||(this._listeners.pause=[]),this._listeners.pause.push(t);break;case NPMapLib.ANIMATION_EVENT_STOP:this._listeners.stop||(this._listeners.stop=[]),this._listeners.stop.push(t);break;case NPMapLib.ANIMATION_EVENT_MOVING:this._listeners.moving||(this._listeners.moving=[]),this._listeners.moving.push(t);break;case NPMapLib.ANIMATION_EVENT_MOVED:this._listeners.moved||(this._listeners.moved=[]),this._listeners.moved.push(t);break;case"preDraw":case"afterDraw":case"afterStep":this.events.register(e,t)}},NPMapLib.Symbols.AnimationLine.prototype.removeEventListener=function(e,t){if("preDraw"===e||"afterDraw"===e||"afterStep"===e)return void this.events.unregiste(e);var i=this._listeners[e];if(i instanceof Array)for(var r=0;r<i.length;++r)if(i[r].toString()==t.toString()){
i.pop(t);break}},NPMapLib.Symbols.AnimationLine.prototype._triggerEvent=function(e,t){var i=this._listeners[e];if(i instanceof Array)for(var r=0;r<i.length;++r)i[r].apply(this,t)},NPMapLib.Symbols.AnimationLine.prototype.remove=function(){this.stop(),this.op_line&&this._layer.getOverlay(this.op_line.id)&&this._layer.removeOverlay(this.op_line),this._layer&&"动画线"===this._layer.name&&this.mapAdapter.removeLayer(this._layer)}}(),function(){var e=ClusterUtil=function(e,t){this.clusters,this._map=e,this._createcluster(t),this._initFeature(t)};e.prototype._initFeature=function(e){var t=e.dataJson.length;this.clusters.strategies[0]&&(this.clusters.strategies[0].callbackFun=e.opts.success);for(var i,r=0;r<t;r++)i={lon:e.dataJson[r].location.lon,lat:e.dataJson[r].location.lat},i=NPMapLib.T.setPoint(this._map,i),e.dataJson[r].geometry={x:i.lon,y:i.lat},this.clusters.showMarker[e.dataJson[r].markType]||(this.clusters.showMarker[e.dataJson[r].markType]=!0);this.clusters.removeFeatures(this.clusters.features),this.clusters.events.triggerEvent("beforefeaturesadded",{features:e.dataJson})},e.prototype._createcluster=function(e){var t=this._map.getLayersByName(e.layName);return t.length>0?(this.clusters=t[0],void this._map.addLayers([this.clusters])):void alert("无效的图层")}}(),NPNamespace.register("NPMapLib.Adapter.OpenLayers"),function(){function e(e){var t=this.map.getResolution(),i=this.map.getMaxExtent().top,r=this.map.getMaxExtent().left,n=Math.round((e.left-r)/(t*this.tileSize.w)),s=Math.round((i-e.top)/(t*this.tileSize.h)),o=this.map.getZoom(),a=""+o+"/"+n+"/"+s+"."+this.type;this.isOnline&&(a="L="+o+"&X="+n+"&Y="+s);var l=this.url;return l instanceof Array&&(l=this.selectUrl(a,l)),l+a}function t(e,t){this.name=e,this.func=t}function i(e){if(e.indexOf("#")==-1)return e;var t=e.substring(1).toLowerCase(),i=new Array;for(x=0;x<3;x++)i[0]=t.substr(2*x,2),i[3]="0123456789abcdef",i[1]=i[0].substr(0,1),i[2]=i[0].substr(1,1),i[20+x]=16*i[3].indexOf(i[1])+i[3].indexOf(i[2]);return i[20]+","+i[21]+","+i[22]+",1"}function r(e,t){for(var r,n,s=null,o=e.styleJson.length-1;o>=0;o--){var a=e.styleJson[o];if(!(a.featureType!=t||"labels"!=a.elementType&&"all"!=a.elementType&&"geometry"!=a.elementType||r&&n)){!r&&(r=a.stylers.color),!n&&(n=a.stylers.color),a.stylers.visibility&&!s&&(s="off"!=a.stylers.visibility);break}a.featureType==t&&("labels.text.fill"!=a.elementType||r||(r=a.stylers.color),"labels.text.stroke"!=a.elementType||n||(n=a.stylers.color),"geometry.stroke"!=a.elementType||n||(n=a.stylers.color),"geometry.fill"!=a.elementType||r||(r=a.stylers.color),a.stylers.visibility&&!s&&(s="off"!=a.stylers.visibility))}return{labels_text_fill:r?i(r):null,labels_text_stroke:n?i(n):null,visibility:null==s||s}}var n={0:"solid",1:"dash",2:"dot",4:"dashdot",10:"longdashdot",9:"longdash"},s={"-1":"butt",0:"round",1:"square"},o=NPMapLib.Adapter.OpenLayers.MapAdapter=function(e,t){this.map=null,this._indexNum=0,this._container=e,this._featuresLayer=null,this._zoomBar=null,this._navigator=null,this._keyBord=null,this._overView=null,this._CopyRight=null,this._MousePosition=null,this._scale=null,this._drawControls=null,this._drawControl=null,this._measureControls=null,this._measureControl=null,this._mapClickControl=null,this._mouseContext=null,this._currentZoomControl=null,this._events=[],this._clicks=[],this._overlayEvents=[],this._boxSelectControl=null,this._modifyFeature=null,this._openLayersEvents=null,this._popupList=[],this.opts=t||{},this._selfLayers=[],this.currentDrawMode=null;var i=t.fullExtent;this._LayerSwitcher=null,this._measureFeatures=[],this._units={m:"米",km:"千米"},this.mapId=t.mapId,this.defaultMapCursor="",this.featureCursor="pointer",this.fractionalZoom=!0,this.cache=null,this.activeFeature=null,this.activMarkers=[],i&&(t.fullExtent=new OpenLayers.Bounds(i[0],i[1],i[2],i[3])),t.displayProjection=new OpenLayers.Projection(t.displayProjection),this._opts=t,this._initialize(),this._openLayersEvents=new OpenLayers.Events(this,null,["addoverlay","removeoverlay","clearoverlays"],(!1)),this.map.events.fallThrough=!0};o.prototype._initialize=function(){var e=this._navigator=new OpenLayers.Control.Navigation;this._opts.controls=[];var t=OpenLayers.Function.bind(this.destroyMap,this);OpenLayers.Event.observe(window,"unload",t),this.map=new OpenLayers.Map(this._container.id,this._opts),this.setMapfractionalZoom(this.fractionalZoom),this.map.addControl(this._navigator),this.map.disableDoubleClickZoom=function(){e.handlers.click.deactivate()},this.map.enableDoubleClickZoom=function(){e.handlers.click.activate()};var i=this;this.map.events.on({zoomstart:function(){for(var e=0;e<this.layers.length;e++)this.layers[e].isBaseLayer||((this.layers[e]instanceof OpenLayers.Layer.TDTLayer||this.layers[e]instanceof OpenLayers.Layer.Baidu||this.layers[e]instanceof OpenLayers.Layer.gaode||this.layers[e]instanceof OpenLayers.Layer.OSM)&&this.layers[e].clearGrid(),this.layers[e].visibility&&(this.layers[e].setVisibility(!1),this.layers[e].clusterVisable=!1))},zoomend:function(){for(var e=0;e<this.layers.length;e++)this.layers[e].isBaseLayer||this.layers[e].clusterVisable===!1&&(this.layers[e].setVisibility(!0),this.layers[e].clusterVisable=!0)},scope:this.map}),this.map.div.oncontextmenu=function(){return!1};var r=new OpenLayers.Control.ClickControl({eventMethods:{click:function(e){var t=i._clicks.click;if(t){var r=this.map.getLonLatFromPixel(e.xy),n=new NPMapLib.Geometry.Point(r.lon,r.lat);t(NPMapLib.T.getPoint(i,n),e)}},rightclick:function(e){e.cancelBubble=!1,e.returnValue=!1;var t=this.map.events.getMousePosition(e),r=this.map.getLonLatFromPixel(t),n=new NPMapLib.Geometry.Point(r.lon,r.lat),s=i._clicks.rightclick,o=this.map.getFeatures(e,!1),a=NPMapLib.T.getPoint(i,n);if(!s||o&&0!=o.length){if(o&&0!=o.length){var l=o[0],s=i._overlayEvents[l.data.id+"_rightclick"];"function"==typeof s&&s.apply(this,[a,l.data,"rightclick"])}}else s(a,e)}}});this.map.addControl(r),r.activate(),this._mapClickControl=r,this.registerLayerFeatureclick()},o.prototype.addHandStyleForMap=function(){if(this._navigator){var e=OpenLayers.Util.getImageLocation("openhand.cur");this.defaultMapCursor="url("+e+"), default",this.featureCursor="pointer",this._setMouseCursor(this.defaultMapCursor);var t=this;this._navigator.dragPan.startFun=function(){if(!(t._measureControl&&t._measureControl.active||t._drawControl&&t._drawControl.active)){var e=OpenLayers.Util.getImageLocation("closedhand.cur");t._setMouseCursor("url("+e+"), move")}},this._navigator.dragPan.endFun=function(){t._measureControl&&t._measureControl.active||t._drawControl&&t._drawControl.active||t._setMouseCursor(t.defaultMapCursor)}}},o.prototype.deleteHandStyleForMap=function(){this._navigator&&(this.defaultMapCursor="default",this.featureCursor="pointer",this._setMouseCursor(this.defaultMapCursor),this._navigator.dragPan.startFun=null,this._navigator.dragPan.endFun=null)},o.prototype.setMapfractionalZoom=function(e){this.fractionalZoom=e,this.map.fractionalZoom=this.fractionalZoom},o.prototype.destroyMap=function(){},o.prototype.addDefaultLayer=function(e){this._featuresLayer=new OpenLayers.Layer.Vector(e.name,{hover:!0,highlightOnly:!0,rendererOptions:{zIndexing:!0},renderers:["SVGExtended","VMLExtended","CanvasExtended"]}),e._apiObj=this._featuresLayer;var t=this._featuresLayer;this._drawControls={point:new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.Point),rect:new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0,style:{strokeColor:"#ee9900",strokeWidth:2,strokeOpacity:1,fillColor:"#ee9900",fillOpacity:.4,pointRadius:5}}}),circle:new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:60,irregular:!1,style:{strokeColor:"#ee9900",strokeWidth:2,strokeOpacity:1,fillColor:"#ee9900",fillOpacity:.4,pointRadius:5}}}),circle2:new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.RegularPolygonExtend,{handlerOptions:{sides:60,irregular:!1,style:{strokeColor:"#ee9900",strokeWidth:2,strokeOpacity:1,fillColor:"#ee9900",fillOpacity:.4,pointRadius:5}}}),line:new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.Path,{handlerOptions:{style:{strokeColor:"#ee9900",strokeWidth:2,strokeOpacity:1,fillColor:"#ee9900",fillOpacity:.4,pointRadius:5}}}),polygon:new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.Polygon,{handlerOptions:{style:{strokeColor:"#ee9900",strokeWidth:2,strokeOpacity:1,fillColor:"#ee9900",fillOpacity:.4,pointRadius:5}}}),freehand:new OpenLayers.Control.DrawFeature(t,OpenLayers.Handler.Polygon,{handlerOptions:{freehand:!0,style:{strokeColor:"#ee9900",strokeWidth:2,strokeOpacity:1,fillColor:"#ee9900",fillOpacity:.4,pointRadius:5}}})},this._featuresLayer.displayInLayerSwitcher=!1,this._featuresLayer.isDefaultLayer=!0,this.map.addLayers([this._featuresLayer]),this._registerLayerEvent(this._featuresLayer,!1),this._selfLayers[e.name]=this._featuresLayer,this._initMeasureControl(),this.map.registerMousePosition()},o.prototype._registerLayerEvent=function(e,t){var i=this;e.events.register("beforefeaturemodified",this,this._beforefeaturemodified),e.events.register("featuremodified",this,this._featuremodified),e.events.register("draging",this,this._featuresLayerDrag),e.events.register("featureclick",this,function(e){if(!(i._measureControl&&i._measureControl.active||i._drawControl&&i._drawControl.active||i._currentZoomControl&&i._currentZoomControl.active||i._navigator.isDrag)){var t=this._overlayEvents[e.feature.data.id+"_click"];if(t&&t instanceof Function)i.triggerEvent("featureclick",{feature:e.feature,xy:e.xy});else{var r=i._clicks.click;if(r&&r instanceof Function){var n=this._mapClickControl.handler.evt.xy,s=this.map.getLonLatFromPixel(n);r(NPMapLib.T.getPoint(i,s))}}}}),this.dblclickFunction||(this.dblclickFunction=function(e){this.events.fallThrough=!0;var t=this.getFeatureFromEvent(e);if(t){var r=i._overlayEvents[t.data.id+"_dblclick"];if("function"==typeof r){t.data.timer&&clearTimeout(t.data.timer);var n=this.map.getLonLatFromPixel({x:e.x,y:e.y});n=NPMapLib.T.getPoint(i,n),r.apply(this,[new NPMapLib.Geometry.Point(n.lon,n.lat),t.data,"dblclick"])}}return!0}),NPMapLib.MapMeasure_CloseMarkDispaly||this.registerdblclick(e)},o.prototype.registerdblclick=function(e){e||(e=this._featuresLayer),e.events.register("dblclick",e,this.dblclickFunction)},o.prototype._unregisterdblclick=function(){this._featuresLayer.events.unregister("dblclick",this._featuresLayer,this.dblclickFunction)},o.prototype._featuresLayerClick=function(e){var t=e.feature,i=e.xy,r=null;if(i&&(r=this.pixelToPoint(i)),t.data&&t.data.id){var n=this._overlayEvents[t.data.id+"_click"];"function"==typeof n&&(t.data.timer&&clearTimeout(t.data.timer),n.apply(this,[t.data,NPMap.T.getPoint(this,r)]))}return!1},o.prototype._mouseout=function(e){var t=e.xy,i=null;t&&(i=this.pixelToPoint(t));var r=e.feature;if(r.data&&r.data.id){if(this._measureControl&&this._measureControl.active||this._drawControl&&this._drawControl.active||this._currentZoomControl&&this._currentZoomControl.active)return;this._setMouseCursor(this.defaultMapCursor);var n=this._overlayEvents[r.data.id+"_mouseout"];"function"==typeof n&&n.apply(this,[r.data,NPMap.T.getPoint(this,i)])}return!1},o.prototype._beforefeaturemodified=function(e){if(!(this._measureControl&&this._measureControl.active||this._drawControl&&this._drawControl.active)){var t=e.feature,i=this._overlayEvents[t.data.id+"_dragstart"];return"function"==typeof i&&i.apply(this,[t.data,"dragstart"]),!0}},o.prototype._featuremodified=function(e){if(!(this._measureControl&&this._measureControl.active||this._drawControl&&this._drawControl.active)){if(e&&e.feature&&e.feature.data){var t=e.feature,i=this._overlayEvents[t.data.id+"_dragend"];"function"==typeof i&&i.apply(this,[t.data,"dragend"])}return!1}},o.prototype._featuresLayerDrag=function(e){if(!(this._measureControl&&this._measureControl.active||this._drawControl&&this._drawControl.active)){var t=e.vertex,i=e.position,r=this._overlayEvents[t.data.id+"_draging"];return"function"==typeof r&&(t.data._position.lon=i.lon,t.data._position.lat=i.lat,r.apply(this,[t.data,"draging"])),!1}},o.prototype._overFeature=function(e){var t=e.xy;e=e.feature?e.feature:e;var i=null;if(t&&(i=this.pixelToPoint(t)),e.data&&e.data.id){if(this._measureControl&&this._measureControl.active||this._drawControl&&this._drawControl.active||this._currentZoomControl&&this._currentZoomControl.active)return;this._setMouseCursor("pointer");var r=this._overlayEvents[e.data.id+"_mouseover"];"function"==typeof r&&r.apply(this,[e.data,NPMap.T.getPoint(this,i)])}return!1},o.prototype._featureClick=function(e){var t=this._overlayEvents[e.data.id+"_click"];if("function"==typeof t){var i=this.map.getLonLatFromPixel(this.handlers.feature.evt.xy);t.apply(this,[new NPMapLib.Geometry.Point(i.lon,i.lat),e.data,"click"])}return!1},o.prototype.enableLayerSwitcher=function(){this._LayerSwitcher=new OpenLayers.Control.LayerSwitcher,this.map.addControl(this._LayerSwitcher),this._LayerSwitcher.activate()},o.prototype.disableLayerSwitcher=function(){this._LayerSwitcher&&(this._LayerSwitcher.deactivate(),this.map.removeControl(this._LayerSwitcher),delete this._LayerSwitcher)},o.prototype.enableScrollWheelZoom=function(){this._navigator&&this._navigator.enableZoomWheel()},o.prototype.disableScrollWheelZoom=function(){this._navigator&&this._navigator.disableZoomWheel()},o.prototype.enableDoubleClickZoom=function(){this._navigator&&this._navigator.handlers.click.activate()},o.prototype.disableDoubleClickZoom=function(){this._navigator&&this._navigator.handlers.click.deactivate()},o.prototype.enableMapOperation=function(){this._navigator&&this._navigator.activate()},o.prototype.disableMapOperation=function(){this._navigator&&this._navigator.deactivate()},o.prototype.enableKeyboard=function(){this._keyBord||(this._keyBord=new OpenLayers.Control.KeyboardDefaults,this.map.addControl(this._keyBord),this._keyBord.activate())},o.prototype.disableKeyboard=function(){this._keyBord&&(this._keyBord.deactivate(),this.map.removeControl(this._keyBord),delete this._keyBord)},o.prototype.enableInertialDragging=function(){},o.prototype.disableInertialDragging=function(){},o.prototype.enableBoxSelect=function(e){null!=this._boxSelectControl&&this.disableBoxSelect(),this._boxSelectControl=new OpenLayers.Control.SelectFeature([this._featuresLayer],{clickout:!1,toggle:!1,multiple:!1,hover:!1,toggleKey:"ctrlKey",multipleKey:"shiftKey",box:!0}),e&&this._boxSelectControl.events.register("boxselectionend",this._boxSelectControl,function(t){for(var i=[],r=0;r<t.layers.length;r++)for(var n=t.layers[r].selectedFeatures,s=0;s<n.length;s++)n[s].data?i.push(n[s].data):i.push(n[s].geometry);e(i)}),this.map.addControl(this._boxSelectControl),this._boxSelectControl.active||this._boxSelectControl.activate()},o.prototype.disableBoxSelect=function(){this._boxSelectControl&&(this._boxSelectControl.deactivate(),this.map.removeControl(this._boxSelectControl),delete this._boxSelectControl)},o.prototype.enableEditing=function(e,t,i){if(this._modifyFeature&&this.disableEditing(),this._modifyFeature)this._modifyFeature.mode=e?e:OpenLayers.Control.ModifyFeature.DRAG|OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE|OpenLayers.Control.ModifyFeature.RESHAPE;else{var r=t&&t._apiObj&&t._apiObj.layer?t._apiObj.layer:this._featuresLayer,n={};i&&i.virtualStyle&&(n.virtualStyle=OpenLayers.Util.extend(r.style||r.styleMap.createSymbolizer(null,null),i.virtualStyle)),this._modifyFeature=new OpenLayers.Control.ModifyFeature(r,n),this._modifyFeature.createVertices=!0,this._modifyFeature.mode=e?e:OpenLayers.Control.ModifyFeature.DRAG|OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE|OpenLayers.Control.ModifyFeature.RESHAPE,this.map.addControl(this._modifyFeature)}this._modifyFeature.activate(),i&&i.isActive&&t&&t._apiObj&&this._modifyFeature.dragStart(t._apiObj)},o.prototype.resetEditVertices=function(){this._modifyFeature&&this._modifyFeature.resetVertices()},o.prototype.cancelEditing=function(e){this._modifyFeature&&e._apiObj&&e._apiObj.layer===this._modifyFeature.layer&&this._modifyFeature.unselectFeature(e._apiObj)},o.prototype.disableEditing=function(){this._modifyFeature&&(this._modifyFeature.deactivate(),this.map.removeControl(this._modifyFeature),delete this._modifyFeature,this._modifyFeature=null)},o.prototype.getMaxZoom=function(){return this.map.maxZoom},o.prototype.setMinZoom=function(e){return this.map.minZoom=e},o.prototype.setMaxZoom=function(e){return this.map.maxZoom=e},o.prototype.getExtent=function(){var e=this.map.getExtent();return new NPMapLib.Geometry.Extent(e.left,e.bottom,e.right,e.top)},o.prototype.getCenter=function(){var e=this.map.getCenter();return new NPMapLib.Geometry.Point(e.lon,e.lat)},o.prototype.getDistance=function(e,t,i){var r,n,s="m";!i&&e.lon>-180&&e.lon<180&&(i="EPSG:4326");var o=new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(e.lon,e.lat),new OpenLayers.Geometry.Point(t.lon,t.lat)]);i?(i=new OpenLayers.Projection(i),r=o.getGeodesicLength(i),n="m"):(r=o.getGeodesicLength(this.map.getProjectionObject()),n="m");var a=OpenLayers.INCHES_PER_UNIT[s];if(a){var l=OpenLayers.INCHES_PER_UNIT[n];r*=l/a}return r},o.prototype.getSize=function(){var e=this.map.getSize();return new NPMapLib.Geometry.Size(e.w,e.h)},o.prototype.getZoom=function(){return this.map.getZoom()},o.prototype.getMaxZoom=function(){return this.map.maxZoom},o.prototype.getMinZoom=function(){return this.map.minZoom},o.prototype.centerAndZoom=function(e,t){var i=new OpenLayers.LonLat(e.lon,e.lat);this.map.setCenter(i,this.adjustZoom(t))},o.prototype.panTo=function(e,t){var i=new OpenLayers.LonLat(e.lon,e.lat);this.map.panTo(i,t)},o.prototype.pan=function(){for(var e in this._measureControls)this._measureControls.hasOwnProperty(e)&&this._measureControls[e].deactivate();for(var t in this._drawControls)this._drawControls.hasOwnProperty(t)&&this._drawControls[t].deactivate();this._drawControl&&(this.map.removeControl(this._drawControl),delete this._drawControl),this._measureControl&&(this.map.removeControl(this._measureControl),delete this._measureControl),this._currentZoomControl&&this._currentZoomControl.deactivate(),this.deactivateMouseContext(),this._setMouseCursor(this.defaultMapCursor)},o.prototype.panByPixel=function(e,t){this.map.pan(e,t,{isPan:!0})},o.prototype.adjustZoom=function(e){return e=e||this.map.getZoom(),e=e>this.map.minZoom?e:this.map.minZoom,e=e<this.map.maxZoom?e:this.map.maxZoom},o.prototype.containsPoint=function(e,t){return new OpenLayers.Bounds(e.sw.lon,e.sw.lat,e.ne.lon,e.ne.lat).containsLonLat(new OpenLayers.LonLat(t.lon,t.lat))},o.prototype.reset=function(){this.fullExtent(this.opts.defaultZoom)},o.prototype.setCenter=function(e,t){var i=new OpenLayers.LonLat(e.lon,e.lat);this.map.setCenter(i,this.adjustZoom(t))},o.prototype.switchLayer=function(e){},o.prototype.setZoom=function(e){this.map.zoomTo(this.adjustZoom(e))},o.prototype.zoomTo=function(e,t){t=t||this.map.maxZoom;var i=this.map.getPixelFromLonLat({lon:e.lon,lat:e.lat});this.map.zoomTo(t,i,null,e)},o.prototype.fullExtent=function(e){var t=this.map.originCenter,i=new OpenLayers.LonLat(t[0],t[1]);e=e||this.map.minZoom,this.centerAndZoom(i,e)},o.prototype._zoomInOut=function(e){if(this.pan(),this._currentZoomControl&&(this._currentZoomControl.deactivate(),this.map.removeControl(this._currentZoomControl)),"in"===e){this._currentZoomControl=new OpenLayers.Control.ZoomBox({alwaysZoom:!1});var t=OpenLayers.Util.getImageLocation("zoomOut.ico");this._setMouseCursor("url("+t+"), crosshair")}else{this._currentZoomControl=new OpenLayers.Control.ZoomBox({alwaysZoom:!1,out:!0});var i=OpenLayers.Util.getImageLocation("zoomIn.ico");this._setMouseCursor("url("+i+"), crosshair")}this.map.addControl(this._currentZoomControl),this._currentZoomControl.activate()},o.prototype.zoomIn=function(){this._zoomInOut("in")},o.prototype.zoomOut=function(){this._zoomInOut("out")},o.prototype.zoomInOutStop=function(){this._currentZoomControl&&(this._currentZoomControl.deactivate(),this.map.removeControl(this._currentZoomControl),delete this._currentZoomControl),this._setMouseCursor(this.defaultMapCursor)},o.prototype.zoomInFixed=function(){this.map.zoomIn()},o.prototype.zoomOutFixed=function(){this.map.zoomOut()},o.prototype.zoomToExtent=function(e,t,i){i?this.map.zoomToExtent(new OpenLayers.Bounds(e.left,e.bottom,e.right,e.top),!1,t):this.map.zoomToExtent(new OpenLayers.Bounds(e.left,e.bottom,e.right,e.top),!0,t)},o.prototype.getContainer=function(){return this._container},o.prototype.showNavigationControl=function(e){this._zoomBar||("common"===e.navigationType?this._zoomBar=new OpenLayers.Control.PanZoomBar(e.opts):this._zoomBar=new OpenLayers.Control.NPanZoomBar(e.opts)),this.map.addControl(this._zoomBar)},o.prototype.hideNavigationControl=function(){this.map.removeControl(this._zoomBar),this._zoomBar=null},o.prototype.addOverviewControl=function(e){var t={};this.map.restrictedExtent&&(t.restrictedExtent=this.map.restrictedExtent),t.minRatio=e&&e.minRatio?e.minRatio:10,t.maxRatio=e&&e.maxRatio?e.maxRatio:10,t.projection=this.map.projection,this._overView=new OpenLayers.Control.LTOverviewMap(t),this.map.addControl(this._overView)},o.prototype.removeOverviewControl=function(){this.map.removeControl(this._overView),this._overView.close(),this._overView=null},o.prototype.setOverViewSize=function(e,t){this._overView&&(this._overView.size.w=e,this._overView.size.h=t)},o.prototype.showOverviewControl=function(){this._overView&&this._overView.maximizeControl()},o.prototype.hideOverviewControl=function(){this._overView&&this._overView.minimizeControl()},o.prototype.showCopyRightControl=function(){this._CopyRight||(this._CopyRight=new OpenLayers.Control.CopyRightControl),this.map.addControl(this._CopyRight)},o.prototype.hideCopyRightControl=function(){this.map.removeControl(this._CopyRight),this._CopyRight=null},o.prototype.setCopyRight=function(e){this._CopyRight||(this._CopyRight=new OpenLayers.Control.CopyRightControl(e))},o.prototype.showScaleControl=function(){this._scale||(this._scale=new OpenLayers.Control.ScaleLine({bottomOutUnits:""})),this.map.addControl(this._scale)},o.prototype.hideScaleControl=function(){this.map.removeControl(this._scale),this._scale=null};var a;o.prototype.showNorthControl=function(){a||(a=new OpenLayers.Control.NorthControl),this.map.addControl(a)},o.prototype.hideNorthControl=function(){this.map.removeControl(a),a=null},o.prototype.showMousePosition=function(e){this._MousePosition&&this.map.removeControl(this._MousePosition),e?this._MousePosition=new OpenLayers.Control.JWMousePosition:this._MousePosition=new OpenLayers.Control.MousePosition,this.map.addControl(this._MousePosition)},o.prototype.hideMousePosition=function(){this.map.removeControl(this._MousePosition),this._MousePosition=null},o.prototype.addJWMousePosition=function(){this._MousePosition&&this.map.removeControl(this._MousePosition),this._MousePosition=new OpenLayers.Control.JWMousePosition,this.map.addControl(this._MousePosition)},o.prototype.removeJWMousePostion=function(){this._MousePosition instanceof OpenLayers.Control.JWMousePosition&&(this.map.removeControl(this._MousePosition),delete this._MousePosition,this._MousePosition=new OpenLayers.Control.MousePosition,this.map.addControl(this._MousePosition))},o.prototype.activateMouseContext=function(e,t){this._mouseContext||(this._mouseContext=new OpenLayers.Control.MouseContext,this.map.addControl(this._mouseContext),t&&(this._mouseContext.offset=t)),e&&this._mouseContext.setContext(e),this._mouseContext.activate()},o.prototype.deactivateMouseContext=function(){this._mouseContext&&(this._mouseContext.deactivate(),this.map.removeControl(this._mouseContext),delete this._mouseContext)},o.prototype.getMouseContextStyle=function(){if(this._mouseContext)return this._mouseContext.getContextStyle()},o.prototype.setMouseContextStyle=function(e){this._mouseContext&&this._mouseContext.setContextStyle(e)},o.prototype.getMouseContextElement=function(){if(this._mouseContext)return this._mouseContext.getElement()},o.prototype.falshOverlay=function(e,t){null!=e&&null!=e.id&&e._apiObj.flash(2*t)},o.prototype.rotateOverlay=function(e,t){null!=e&&null!=t&&null!=e._apiObj&&null!=e._apiObj.layer&&(e._apiObj.style.rotation=t,e._apiObj.layer.drawFeature(e._apiObj,e._apiObj.style))},o.prototype.addOverlay=function(e,t){var i,r=e.overlayType;t=t||this._featuresLayer;var n=t.name;switch(r){case NPMapLib.OVERLAY_TYPE_POLYLINE:i=this._createPolyline(e);break;case NPMapLib.OVERLAY_TYPE_POLYGON:i=this._createPolygon(e);break;case NPMapLib.OVERLAY_TYPE_CIRCLE:i=this._createCircle(e);break;case NPMapLib.OVERLAY_TYPE_CIRCLESECTOR:i=this._creatCircleSector(e);break;case NPMapLib.OVERLAY_TYPE_ELLIPSE:i=this._createEllipse(e);break;case NPMapLib.OVERLAY_TYPE_LABEL:i=this._createLabel(e);break;case NPMapLib.OVERLAY_TYPE_MARKER:i=this._createMarker(e);break;case NPMapLib.OVERLAY_TYPE_BUBBLE:i=this._createBubble(e);break;case NPMapLib.OVERLAY_TYPE_INFOWIN:var s=e.getPosition();s=NPMapLib.T.setPoint(this.map,s);var o=new OpenLayers.Size(e._width,e._height),a=""+e.getTitle();a+=e.getContent();var l,p=e.getOffset();if(e.iscommon)l=new OpenLayers.Popup.Anchored("npgis",new OpenLayers.LonLat(s.lon,s.lat),o,a,{size:new OpenLayers.Size(1,1),offset:new OpenLayers.Pixel(p.width,p.height)},(!1),e._closeCallback),l.panMapIfOutOfView=!0;else{if(e.autoSize&&e.positionBlock.isCenter){var h=e._content;if(e._dom){var u=document.createElement("div");u.appendChild(e._dom.cloneNode(!0)),h=u.innerHTML}var y="<div class='olFramedCloudPopupContent'>"+h+"</div>",c=this.map?this.map.div:document.body,d=OpenLayers.Util.getRenderedDimensions(y,null,{displayClass:"olPopup",containerElement:c});e.positionBlock.offset.x=-Math.ceil((d.w-e.positionBlock.imageSize.w)/2),e.positionBlock.blocks[0].anchor=new OpenLayers.Bounds(0-e.positionBlock.offset.x-parseInt(e.positionBlock.imageSize.w/2),3,null,null)}l=new OpenLayers.Popup.FramedCloud("npgis",new OpenLayers.LonLat(s.lon,s.lat),o,a,{size:new OpenLayers.Size(1,1),offset:new OpenLayers.Pixel(p.width,p.height)},(!1),e._closeCallback,e.positionBlock)}if(!l)return;l.closeOnMove=e._enableCloseOnClick,l.autoSize=e.autoSize,l.isAdaptation=e.isAdaptation,l.setSize(o),this.map.addPopup(l),l.map.paddingForPopups=new OpenLayers.Bounds(e.paddingForPopups.left,e.paddingForPopups.bottom,e.paddingForPopups.right,e.paddingForPopups.top),l.hide(),null!=e.getContentDom()&&l.setContentDom(e.getContentDom()),e.useDomStyle&&l.setOpacity(0),l.div.style.zIndex=99990,e.id=l.id,e._apiObj=l,this._popupList.push(e);break;case NPMapLib.OVERLAY_TYPE_ClusterPoints:e.layName=n?n:e.layName,new ClusterUtil(this.map,e);break;case NPMapLib.OVERLAY_TYPE_POINT:i=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e.lon,e.lat),e);break;case"PlottingSymbol":i=e._apiObj;break;default:return void console.warn("不支持的覆盖物类型"+r)}if(i){if(this._indexNum++,i.style.graphicZIndex=this._indexNum,i.style.cursor=this.featureCursor,e._rotation&&(i.style.rotation=e._rotation),e._apiObj=i,e._graphicZIndex=this._indexNum,n){var m=this._selfLayers[n];m&&m.addFeatures([i])}else this._featuresLayer.addFeatures([i]);return NPMapLib.Managers.OverlayManager.addOverlay(e),this._openLayersEvents.triggerEvent("addoverlay"),!0}},o.prototype.refresh=function(e){if(e._apiObj){var t=e.overlayType;switch(t){case NPMapLib.OVERLAY_TYPE_POLYLINE:this._updatePolyLine(e);break;case NPMapLib.OVERLAY_TYPE_POLYGON:this._updatePolygon(e);break;case NPMapLib.OVERLAY_TYPE_CIRCLE:this._updateCircle(e);break;case NPMapLib.OVERLAY_TYPE_CIRCLESECTOR:this._updateCircleSector(e);break;case NPMapLib.OVERLAY_TYPE_ELLIPSE:this._updateEllipse(e);break;case NPMapLib.OVERLAY_TYPE_LABEL:this._updateLabel(e);break;case NPMapLib.OVERLAY_TYPE_MARKER:this._updateMarker(e);break;case NPMapLib.OVERLAY_TYPE_INFOWIN:case NPMapLib.OVERLAY_TYPE_ClusterPoints:break;default:return void console.warn("不支持的覆盖物类型"+t)}e._rotation&&(e._apiObj.style.rotation=e._rotation),e._apiObj&&e._apiObj.layer&&e._apiObj.layer.drawFeature(e._apiObj)}},o.prototype._updateMarker=function(e){e._apiObj.style=this._getMarkerStyle(e)},o.prototype._updateLabel=function(e){var t=e.getStyle(),i={label:e.getContent(),fontSize:t.fontSize,fontFamily:t.fontFamily,fontWeight:t.isBold?"bold":"normal",labelXOffset:e.getOffset().width,labelYOffset:e.getOffset().height,labelAlign:"m",labelSelect:!0,graphicZIndex:e.getZIndex()};t.color&&(i.fontColor=t.color),e._apiObj.style=i},o.prototype._updatePolyLine=function(e){e._apiObj.style&&(e._apiObj.style.strokeColor=e.getColor(),e._apiObj.style.strokeWidth=e.getWeight(),e._apiObj.style.strokeOpacity=e.getOpacity(),e._apiObj.style.strokeDashstyle=n[e.getLineStyle()],e._apiObj.style.strokeLinecap=s[e.getArrowStyle()],e._apiObj.style.graphicZIndex=e.getZIndex())},o.prototype.openInfoWindow=function(e){e._apiObj instanceof OpenLayers.Popup&&e._apiObj.show()},o.prototype.hideInfoWindow=function(e){e._apiObj instanceof OpenLayers.Popup&&e._apiObj.hide(!1)},o.prototype.closeInfoWindow=function(e){if(e._apiObj instanceof OpenLayers.Popup){this.map.removePopup(e._apiObj);for(var t=0;t<this._popupList.length;t++)if(this._popupList[t]==e){this._popupList.splice(t,1);break}}},o.prototype.destroyInfoWindow=function(e){if(e._apiObj instanceof OpenLayers.Popup){this.map.destroyPopup(e._apiObj);for(var t=0;t<this._popupList.length;t++)if(this._popupList[t]==e){this._popupList.splice(t,1);break}}},o.prototype.setInfoWindow=function(e){e._apiObj instanceof OpenLayers.Popup&&e._apiObj.setContentDom(e.getContentDom())},o.prototype.getInfoWindowBaseDiv=function(e){if(e._apiObj instanceof OpenLayers.Popup)return e._apiObj.div},o.prototype.setBackgroundColor=function(e,t){e._apiObj instanceof OpenLayers.Popup&&e._apiObj.setBackgroundColor(t)},o.prototype.setInfoWindowSize=function(e,t){e._apiObj instanceof OpenLayers.Popup&&(t=new OpenLayers.Size(t.width,t.height),e._apiObj.setSize(t))},o.prototype.getInfoWindowSize=function(e){if(e._apiObj instanceof OpenLayers.Popup){var t=e._apiObj.size;return new NPMapLib.Geometry.Size(t.w+2,t.h)}},o.prototype.updateInfoWindowSize=function(e){e._apiObj instanceof OpenLayers.Popup&&e._apiObj.updateSize()},o.prototype.addOverlays=function(e){for(var t=0;t<e.length;t++)this.addOverlay(e[t])},o.prototype.removeOverlay=function(e){if(e){if("NPMapLib.Symbols.InfoWindow"===e.CLASS_NAME&&e._apiObj)return void this.map.removePopup(e._apiObj);e._apiObj&&e._apiObj.layer&&(e._menu&&e._menu.hide(),e._apiObj.layer.removeFeatures([e._apiObj]),NPMapLib.Managers.OverlayManager.removeOverlay(e.id),this._openLayersEvents.triggerEvent("removeoverlay"))}},o.prototype.removeOverlays=function(e){for(var t=0;t<e.length;t++)this.removeOverlay(e[t])},o.prototype.getOverlays=function(){return NPMapLib.Managers.OverlayManager.getAllOverlays()},o.prototype.removerAllOverlaysByLayerName=function(e){for(var t=this.map.getLayersByName(e),i=0;i<t.length;i++)t[i].removeAllFeatures()},o.prototype.clearOverlays=function(){if(this._popupList){for(var e=0;e<this._popupList.length;e++)this.map.removePopup(this._popupList[e]._apiObj),delete this._popupList[e];this._popupList=[]}},o.prototype.showOverlay=function(e){e&&null!=e._apiObj&&null!=e._apiObj.layer&&(e._apiObj.style.display="block",e._apiObj.layer.drawFeature(e._apiObj),e._apiObj.markerObj&&e._apiObj.markerObj.display(!0))},o.prototype.hideOverlay=function(e){e&&null!=e._apiObj&&null!=e._apiObj.layer&&(e._apiObj.style.display="none",e._apiObj.layer.drawFeature(e._apiObj),e._apiObj.markerObj&&e._apiObj.markerObj.display(!1))},o.prototype.setOverlayPosition=function(e,t){if(e&&null!=e._apiObj)if(e._apiObj instanceof OpenLayers.Popup){var i=new OpenLayers.LonLat(t.lon,t.lat);e._apiObj.lonlat=i,e._apiObj.updatePosition()}else e._apiObj.move(new OpenLayers.LonLat(t.lon,t.lat))},o.prototype.getOverlayPosition=function(e){if(e){var t=e;if(t._apiObj&&t._apiObj.geometry&&t._apiObj.geometry instanceof OpenLayers.Geometry.Point)return new NPMapLib.Geometry.Point(t._apiObj.geometry.x,t._apiObj.geometry.y);
if(t._apiObj&&t._apiObj.geometry&&t._apiObj.geometry instanceof OpenLayers.Geometry.Polygon){for(var i=[],r=0;r<t._apiObj.geometry.components.length;r++){for(var n=t._apiObj.geometry.components[r].components,s=[],o=0;o<n.length;o++)s.push(new NPMapLib.Geometry.Point(n[o].x,n[o].y));i.push(s)}return 1===i.length?i[0]:i}if(t._apiObj&&t._apiObj.geometry&&t._apiObj.geometry instanceof OpenLayers.Geometry.LineString){for(var a=t._apiObj.geometry.components,l=[],p=0;p<a.length;p++)l.push(new NPMapLib.Geometry.Point(a[p].x,a[p].y));return l}}},o.prototype.getInfoWindow=function(){var e=[];for(var t in this._popupList)"NPMapLib.Symbols.InfoWindow"===this._popupList[t].CLASS_NAME&&e.push(this._popupList[t]);return e},o.prototype.showMarkerLabel=function(e){e instanceof NPMapLib.Symbols.Marker&&e._label&&e._label._content&&(e._apiObj.style.label=e._label._content,e._apiObj.layer.drawFeature(e._apiObj))},o.prototype.hideMarkerLabel=function(e){e instanceof NPMapLib.Symbols.Marker&&(e._apiObj.style.label="",e._apiObj.layer.drawFeature(e._apiObj))},o.prototype._setMouseCursor=function(e){this.map&&(this.map.div.style.cursor=e)},o.prototype.getCursor=function(){if(this.map)return this.map.div.style.cursor},o.prototype.setCursor=function(e){this.defaultMapCursor=e,this._setMouseCursor(e)},o.prototype._createLayer=function(e){var t={};if(e._opts=e._opts||e.opts,e._opts){for(var i in e._opts)if(e._opts.hasOwnProperty(i)){var r=e._opts[i];void 0!==r&&(t[i]=r)}if(e._opts.fullExtent&&(t.maxExtent=new OpenLayers.Bounds(e._opts.fullExtent[0],e._opts.fullExtent[1],e._opts.fullExtent[2],e._opts.fullExtent[3])),!e._opts.centerPoint&&t.maxExtent){var n=t.maxExtent.getCenterLonLat();e._opts.centerPoint=[n.lon,n.lat]}e._opts.tilePixels&&(t.tileSize=new OpenLayers.Size(e._opts.tilePixels,e._opts.tilePixels)),e._opts.tileOrigin&&(t.tileOrigin=new OpenLayers.LonLat(e._opts.tileOrigin[0],e._opts.tileOrigin[1])),e._opts.origin&&(t.tileOrigin=new OpenLayers.LonLat(e._opts.origin[0],e._opts.origin[1]))}var s=this._opts.centerPoint;this._opts=t,s&&(this._opts.centerPoint=s);var o=null;return"NPMapLib.Layers.WMSLayer"===e.CLASS_NAME&&(o=this.WMSLayer(e,t)),"NPMapLib.Layers.WMTSLayer"===e.CLASS_NAME&&(o=this.WMTSLayer(e,t)),"NPMapLib.Layers.VectorGMLLayer"===e.CLASS_NAME&&(o=this.VectorGMLLayer(e,t)),"NPMapLib.Layers.ArcgisTileLayer"===e.CLASS_NAME&&(o=this.ArcgisCacheTile(e,t)),"NPMapLib.Layers.EzMapTileLayer"===e.CLASS_NAME&&(o=this._pgisLayer(e,t)),"NPMapLib.Layers.GoogleMapTileLayer"===e.CLASS_NAME&&(o=this._googleLayer(e,t)),"NPMapLib.Layers.BaiduTileLayer"===e.CLASS_NAME&&(o=this._baiduLayer(e,t)),"NPMapLib.Layers.BingTileLayer"===e.CLASS_NAME&&(o=this._bingLayer(e,t)),"NPMapLib.Layers.GaoDeLayer"===e.CLASS_NAME&&(o=this._gaodeLayer(e,t)),"NPMapLib.Layers.ImageLayer"===e.CLASS_NAME&&(o=this._imageLayer(e,e._opts)),"NPMapLib.Layers.GoogleOffLineLayer"===e.CLASS_NAME&&(o=this._googleOffLayer(e,t)),"NPMapLib.Layers.SuperMapLayer"===e.CLASS_NAME&&(o=this._supermapLayer(e,t)),"NPMapLib.Layers.TDMapLayer"===e.CLASS_NAME&&(o=this._tdmapLayer(e,t)),"NPMapLib.Layers.QQMapLayer"===e.CLASS_NAME&&(o=this._qqmapLayer(e,t)),"NPMapLib.Layers.HeatMapLayer"===e.CLASS_NAME&&(o=this._heatMapLayer(e,t)),"NPMapLib.Layers.OSMLayer"===e.CLASS_NAME&&(o=new OpenLayers.Layer.OSM(e.name,e.url,t)),"NPMapLib.Layers.Dynamicmaplayer"===e.CLASS_NAME&&(o=new OpenLayers.Layer.Dynamicmaplayer(e.name,e.url,t)),this._opts.centerPoint?this.map.originCenter=this._opts.centerPoint:e._opts.centerPoint&&(this.map.originCenter=e._opts.centerPoint),o},o.prototype.addLayer=function(e,t){if(!e.isAddToMap)return void(this._selfLayers[e.name]=e);if("NPMapLib.Layers.OverlayLayer"===e.CLASS_NAME){if(e.name){var i=this.map.getLayersByName(e.name);if(i.length>0)return}var r={},n={zIndexing:!0};r.rendererOptions=n;var s=this;if(e.useCluster){r={isClusterLayer:!0,eventListeners:{featureover:function(t){if(s._measureControl&&s._measureControl.active||s._drawControl&&s._drawControl.active||s._currentZoomControl&&this._currentZoomControl.active||s._setMouseCursor("pointer"),t.feature.data.isStatistics)return!1;if(t.feature.cluster&&1!==t.feature.cluster.length){if(e.clusteronmouseover){for(var i=[],r={strokeOpacity:1,strokeColor:"orange",fillColor:"red",pointRadius:3},n=0;n<t.feature.cluster.length;n++)t.feature.cluster[n].style=r,i.push(t.feature.cluster[n]);t.feature.data.cluster=i,e.clusteronmouseover(t.feature.data)}}else{var o=t.feature.data;e.onmouseover(o,""===t.feature.style.externalGraphic||"undefined"==typeof t.feature.style.externalGraphic)}return!1},featureout:function(t){if(s._measureControl&&s._measureControl.active||s._drawControl&&s._drawControl.active||s._currentZoomControl&&s._currentZoomControl.active||s._setMouseCursor(s.defaultMapCursor),t.feature.data.isStatistics)return!1;if(!t.feature.cluster||1===t.feature.cluster.length){var i=t.feature.data;e.onmouseout(i,""===t.feature.style.externalGraphic||"undefined"==typeof t.feature.style.externalGraphic)}return!1},featureclick:function(t){if(!s._navigator.isDrag&&!e.isHideContext){var i=t.feature,r=i.layer,n=r.clicentData.tempcluster;if(n=n?n:[],i.cluster&&i.cluster.length>1){var o={fontColor:"white",title:name,opacity:.8,graphicHeight:29,graphicWidth:29},a={strokeOpacity:1,cursor:s.featureCursor,strokeColor:"orange",fillColor:"red",pointRadius:3};if("zoom"===e.clusterClickModel)if(e.selectZoom){var l=new OpenLayers.LonLat(i.geometry.x,i.geometry.y);r.map.setCenter(l,e.selectZoom)}else{var p=this.map.getPixelFromLonLat({lon:i.geometry.getCentroid().x,lat:i.geometry.getCentroid().y});r.map.zoomTo(r.map.getZoom()+1,p)}else{if(i.cluster.length>500)return window.alert("聚合点位过多，请放大地图"),!1;for(var h=0;h<n.length;h++)n[h].style=o;r.removeFeatures(n,{silent:!0});var u=i.cluster.slice();n=[];for(var y=0;y<u.length;y++)n[y]=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(u[y].geometry.x,u[y].geometry.y),u[y]),u[y]._apiObj=n[y];r.addFeatures(n,{silent:!0});for(var c=0;c<n.length;c++)n[c].style=a,n[c].layer.drawFeature(n[c]);r.clicentData.tempcluster=n}}else if(i.attributes.count>1&&"zoom"===e.clusterClickModel)if(e.selectZoom){var d=new OpenLayers.LonLat(i.geometry.x,i.geometry.y);r.map.setCenter(d,e.selectZoom)}else{var m=this.map.getPixelFromLonLat({lon:i.geometry.getCentroid().x,lat:i.geometry.getCentroid().y});r.map.zoomTo(r.map.getZoom()+1,m)}var f;return i.cluster?i.cluster&&(1===i.cluster.length?f=i.cluster[0]:0===i.cluster.length&&(i.data.feature._apiObj=i,f=i.data.feature)):f=i.data,(!i.cluster||i.cluster.length<2)&&f&&!i.data.isStatistics&&"function"==typeof e.onSelect&&e.onSelect(f,""===t.feature.style.externalGraphic||"undefined"==typeof t.feature.style.externalGraphic),!1}}}};for(var o=[],a=e.statistics,l=a.length-1;l>=0;l--){var p=NPMapLib.T.setPoint(s,{lon:a[l].x,lat:a[l].y});o.push({x:p.lon,y:p.lat,label:a[l].label})}var h=new OpenLayers.Strategy.AnimatedCluster({threshold:e.threshold||5,distance:e.distance,animationMethod:OpenLayers.Easing.Expo.easeOut,animationDuration:10,maxZoom:e.maxZoom||this.map.maxZoom,minZoom:e.minZoom||this.map.minZoom,statistics:o,isAsynchronous:e.isAsynchronous,clusterClickModel:e.clusterClickModel,minClusterCount:e.minClusterCount,callbackFun:e.opts.success});r.strategies=[h],r.rendererOptions=n;var u={context:{getCount:function(t){if(e.isHideContext)return"";if(t.attributes.isStatistics)return t.attributes.count;var i=t.attributes.count?1===t.attributes.count?"":t.attributes.count:"";return""===i&&(i=e.getContent(t)),i},getUrl:function(t){if(t.attributes.isStatistics){var i=1===t.attributes.count?2:t.attributes.count,r=t.data;return e.getUrl(i,r)}var n=t.attributes.count?1===t.attributes.count?null:t.attributes.count:null,s=t.cluster&&1===t.cluster.length?t.cluster[0]:t.data;return e.getUrl(n,s)},getWidth:function(t){if(t.attributes.isStatistics){var i=1===t.attributes.count?2:t.attributes.count,r=t.data,n=e.getImageSize(i,r);return n.width}var s=t.attributes.count?1===t.attributes.count?null:t.attributes.count:null,o=t.cluster&&1===t.cluster.length?t.cluster[0]:t.data,a=e.getImageSize(s,o);return a.width},getHeight:function(t){if(t.attributes.isStatistics){var i=1===t.attributes.count?2:t.attributes.count,r=t.data,n=e.getImageSize(i,r);return n.height}var s=t.attributes.count?1===t.attributes.count?null:t.attributes.count:null,o=t.cluster&&1===t.cluster.length?t.cluster[0]:t.data,a=e.getImageSize(s,o);return a.height},getCursor:function(){return s.featureCursor},getRotation:function(t){if(t.attributes.isStatistics){var i=1===t.attributes.count?2:t.attributes.count,r=t.data;return e.getRotation(i,r)}var n=t.attributes.count?1===t.attributes.count?null:t.attributes.count:null,s=t.cluster&&1===t.cluster.length?t.cluster[0]:t.data;return e.getRotation(n,s)},getgraphicYOffset:function(t){if(t.attributes.isStatistics){var i=1===t.attributes.count?2:t.attributes.count,r=t.data,n=e.getImageSize(i,r);return null===i?-n.height/2:-n.height}var s=t.attributes.count?1===t.attributes.count?null:t.attributes.count:null,o=t.cluster&&1===t.cluster.length?t.cluster[0]:t.data,a=e.getImageSize(s,o);return null===s?-a.height/2:-a.height},getlabelYOffset:function(t){if(t.attributes.isStatistics){var i=1===t.attributes.count?2:t.attributes.count,r=t.data,n=e.getImageSize(i,r);return n.height/2+c}var s=t.attributes.count?1===t.attributes.count?null:t.attributes.count:null,o=t.cluster&&1===t.cluster.length?t.cluster[0]:t.data,a=e.getImageSize(s,o);return s?a.height/2+c:e.customLabelOffset?e.customLabelOffset.height:e.getCustomLabelOffset instanceof Function?e.getCustomLabelOffset(o).height:void 0},getFontColor:function(t){if(t.attributes.isStatistics){var i=1===t.attributes.count?2:t.attributes.count,r=t.data;return e.getFontColor?e.getFontColor(i,r):e.defaultStyle.fontColor}var n=t.attributes.count?1===t.attributes.count?null:t.attributes.count:null,s=t.cluster&&1===t.cluster.length?t.cluster[0]:t.data;return e.getFontColor?e.getFontColor(n,s):e.defaultStyle.fontColor},getFontSize:function(t){if(t.attributes.isStatistics){var i=1===t.attributes.count?2:t.attributes.count,r=t.data;return e.getFontSize?e.getFontSize(i,r):e.defaultStyle.fontSize}t.attributes.count?1===t.attributes.count?null:t.attributes.count:null,t.cluster&&1===t.cluster.length?t.cluster[0]:t.data;return e.getFontSize?e.getFontSize(i,r):e.defaultStyle.fontSize},getlabelXOffset:function(t){var i=t.attributes.count?1===t.attributes.count?null:t.attributes.count:null;if(!i&&e.customLabelOffset)return e.customLabelOffset.width},getTitle:function(t){var i=t.attributes.count?1===t.attributes.count?null:t.attributes.count:null;return i?void 0:e.opts.getTitle(t.data)},getlabelbg:function(t){var i=t.attributes.count?1===t.attributes.count?null:t.attributes.count:null;return i?e.getClusterBGColor(t.data):e.getBackGroundColor(t.data)},getBackGroundRXY:function(t){return e.labelBackGroundRXY},getBackGroundMargin:function(t){return e.labelBackGroundMargin},getBackGroundStroke:function(t){var i=t.attributes.count?1===t.attributes.count?null:t.attributes.count:null;return i?e.getClusterBGStroke(t.data):e.getBackGroundStroke(t.data)},getShowArrow:function(t){var i=t.attributes.count?1===t.attributes.count?null:t.attributes.count:null;return e.showOrHideArrow(i,t.data)}}},y=navigator.appName.indexOf("Microsoft Internet Explorer")!==-1&&document.all,c=y?-1:0;e.labelYOffset&&(c=e.labelYOffset),r.styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({externalGraphic:"${getUrl}",graphicWidth:"${getWidth}",graphicHeight:"${getHeight}",graphicOpacity:1,graphicYOffset:"${getgraphicYOffset}",label:"${getCount}",labelYOffset:"${getlabelYOffset}",labelXOffset:"${getlabelXOffset}",labelSelect:!0,fontColor:"${getFontColor}",fontSize:"${getFontSize}",rotation:"${getRotation}",labelBackgroundColor:"${getlabelbg}",labelBackGroundRXY:"${getBackGroundRXY}",labelBackGroundMargin:"${getBackGroundMargin}",labelBackGroundStroke:"${getBackGroundStroke}",showArrow:"${getShowArrow}",title:"${getTitle}"},u)})}r.renderers=["SVGExtended","VMLExtended","CanvasExtended"];var d=new OpenLayers.Layer.Vector(e.name,r);return this.map.addLayers([d]),this._selfLayers[e.name]=d,e._apiObj=d,e.clusterStrategy=h,void(e.useCluster?(d.events.register("beforefeaturemodified",this,function(e){if(!(this._measureControl&&this._measureControl.active||this._drawControl&&this._drawControl.active)){var t=e.feature,i=t.data.dragstart;return"function"==typeof i&&i.apply(this,[t.data,"dragstart"]),!0}}),d.events.register("featuremodified",this,function(e){if(!(this._measureControl&&this._measureControl.active||this._drawControl&&this._drawControl.active)){var t=e.feature,i=NPMapLib.T.getPoint(t.layer.map,{lon:t.geometry.x,lat:t.geometry.y});t.data.geometry={x:t.geometry.x,y:t.geometry.y},t.data.disableEditing(),t.data.enableEditing(),t.data.location.lon=i.lon,t.data.location.lat=i.lat;var r=t.data.dragend;return"function"==typeof r&&r.apply(this,[t.data,"dragend"]),!0}})):this._registerLayerEvent(d,e.isAddSFControl))}var m=this._createLayer(e);if(null!=m){if(this.map.addLayer(m),this._selfLayers[e.name]=m,e._apiObj=m,"EPSG:900913"===this.map.getProjection()&&this.map.originCenter[0]<180){var f=NPMapLib.T.setPoint(this,{lon:this.map.originCenter[0],lat:this.map.originCenter[1]});this.map.originCenter=[f.lon,f.lat]}this.fullExtent(this.opts.defaultZoom),"EPSG:4326"===this.map.getProjection()&&(NPMap.PROJECT="4326")}},o.prototype._googleOffLayer=function(t,i){i.getURL=e;var r=new OpenLayers.Layer.TMS(t.name,t.url,i);return r},o.prototype._imageLayer=function(e,t){var i=new OpenLayers.Bounds(t.fullExtent[0],t.fullExtent[1],t.fullExtent[2],t.fullExtent[3]),r=new OpenLayers.Layer.Image(e.name,e.url,i,new OpenLayers.Size(t.size[0],t.size[1]));return r},o.prototype._bingLayer=function(e,t){return new OpenLayers.Layer.Bing(t)},o.prototype._baiduLayer=function(e,t){return new OpenLayers.Layer.Baidu(e.name,e.url,t)},o.prototype._gaodeLayer=function(e,t){return new OpenLayers.Layer.gaode(e.name,e.url,t)},o.prototype._heatMapLayer=function(e,t){return new OpenLayers.Layer.Heatmap(e.name,this.map,this.map.baselayer,{visible:e.visible,radius:e.radius,opacity:100*t.opacity},t)},o.prototype._googleLayer=function(e,t){return new OpenLayers.Layer.OSM(e.name,e.url,t)},o.prototype._supermapLayer=function(e,t){return new OpenLayers.Layer.SuperMap(e.name,e.url,t)},o.prototype._pgisLayer=function(e,t){return t.maxResolution=2,t.tileOrigin||(t.tileOrigin=new OpenLayers.LonLat(0,0)),new OpenLayers.Layer.TMS_PGIS(e.name,e.url,t)},o.prototype._tdmapLayer=function(e,t){return new OpenLayers.Layer.TDTLayer(e.name,e.url,t)},o.prototype._qqmapLayer=function(e,t){return new OpenLayers.Layer.QQMap(e.name,e.url,t)},o.prototype.addLayers=function(e){if(e)for(var t=0;t<e.length;++t)this.addLayer(e[t],!1)},o.prototype.removeLayer=function(e){var t=this.map.getLayer(e);if(t)this.map.removeLayer(t,!1);else{var i=this.map.getLayersByName(e.name);i&&i.length>0&&this.map.removeLayer(i[0],!1)}},o.prototype.removeLayerByName=function(e){var t=this.map.getLayersByName(e);t&&t.length>0&&this.map.removeLayer(t[0],!1)},o.prototype.getLayer=function(e){return this.map.getLayer(e)},o.prototype.getLayerByName=function(e){var t=this.map.getLayersByName(e);return t&&t.length>0?t[0]:null},o.prototype.ArcgisCacheTile=function(e,t){return new OpenLayers.Layer.ArcGISCache(e.name,e.url,t)},o.prototype.GoogleOffLineLayer=function(t,i){i.getURL=e;var r=new OpenLayers.Layer.TMS(t.name,t.url,i);return r},o.prototype.WMTSLayer=function(e,t){var i=new OpenLayers.Layer.WMTS({name:e.name,url:e.url,layer:t.layerName,requestEncoding:t.requestEncoding,format:"image/png",matrixSet:t.matrixSet,matrixIds:t.matrixIds,resolutions:t.resolutions,style:t.style,serviceMode:"WMTS",projection:t.projection,tileOrigin:new OpenLayers.LonLat(t.tileOrigin.lon,t.tileOrigin.lat),tileSize:new OpenLayers.Size(t.tileSize[0],t.tileSize[1])});return i},o.prototype.WMSLayer=function(e,t){var i=new OpenLayers.Layer.WMS(e.name,e.url,{layers:t.layerName,format:t.format,tiled:t.tiled,transparent:t.transparent,version:t.version?t.version:"1.1.1"},{tileSize:new OpenLayers.Size(t.mapUnitPixels,t.mapUnitPixels),projection:t.projection,buffer:t.buffer,maxZoomLevel:t.maxZoomLevel,reproject:t.reproject,isBaseLayer:t.isBaseLayer});return i},o.prototype.VectorGMLLayer=function(e){var t=new OpenLayers.Layer.Vector(e.name,{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:e.url,format:new OpenLayers.Format.GML})});return t},o.prototype.VectorWFSLayer=function(e){var t=new OpenLayers.Layer.Vector("WFS",{strategies:[new OpenLayers.Strategy.BBOX],protocol:new OpenLayers.Protocol.WFS({url:"http://demo.opengeo.org/geoserver/wfs",featureType:"tasmania_roads",featureNS:"http://www.openplans.org/topp"})});return t},o.prototype.pixelToPoint=function(e){var t=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.x,e.y));return new NPMapLib.Geometry.Point(t.lon,t.lat)},o.prototype.pointToPixel=function(e){var t=this.map.getPixelFromLonLat(new OpenLayers.LonLat(e.lon,e.lat));return new NPMapLib.Geometry.Pixel(t.x,t.y)},o.prototype.drawing=function(e,t,i){var r="";switch(e._mode){case NPMapLib.DRAW_MODE_RECT:this._setMouseCursor("crosshair"),r="rect";break;case NPMapLib.DRAW_MODE_CIRCLE:this._setMouseCursor("crosshair"),r="circle";break;case NPMapLib.DRAW_MODE_CIRCLE_DIAMETER:this._setMouseCursor("crosshair"),r="circle2";break;case NPMapLib.DRAW_MODE_POLYLINE:this._setMouseCursor("crosshair"),r="line";break;case NPMapLib.DRAW_MODE_POLYLGON:this._setMouseCursor("crosshair"),r="polygon";break;case NPMapLib.DRAW_MODE_FREEHAND:this._setMouseCursor("crosshair"),r="freehand";break;case NPMapLib.DRAW_MODE_NONE:r=""}this._drawControl&&this.map.removeControl(this._drawControl);for(var n in this._drawControls)if(n===r){var s=this;if(this._drawControl=this._drawControls[n],i=i||{},i.cursor=i.cursor||"crosshair",i){var o=this._drawControl.handlerOptions.style;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];void 0!==l&&(o[a]=l)}this._drawControl.handlerOptions.style=o}this.map.addControl(this._drawControl),this._drawControl.activate(),this._drawControl.events.listeners={},this._unregisterdblclick(),this._drawControl.events.fallThrough=!0,this._drawControl.events.on({featureadded:function(r){if(s._setMouseCursor(s.defaultMapCursor),r.feature&&r.feature.geometry){var n=r.feature.geometry,o=n.bounds,a=new NPMapLib.Geometry.Extent(o.left,o.bottom,o.right,o.top);a=NPMapLib.T.getExtent(s,a);var l=s._getNPGISGeometry(e._mode,n,i);if(r.feature.layer.removeFeatures(r.feature),t instanceof Function)if(e._mode===NPMapLib.DRAW_MODE_CIRCLE||e._mode===NPMap.DRAW_MODE_CIRCLE_DIAMETER){for(var p=[],h=n.components[0].components,u=0;u<h.length;u++)p.push(new NPMapLib.Geometry.Point(h[u].x,h[u].y));var y=n.getCentroid(),c=new OpenLayers.Geometry.Point(h[0].x,h[0].y),d=new OpenLayers.Geometry.Point(y.x,y.y),m=new OpenLayers.Projection("EPSG:900913");c.transform(s.map.getProjection(),m),d.transform(s.map.getProjection(),m);var f=c.distanceTo(d);y=NPMapLib.T.getPoint(s,{lon:y.x,lat:y.y});var g=y.lon+","+y.lat+","+f;t(a,l,g,NPMapLib.T.getPoints(s,p))}else{for(var L=l.getPath(),v="",O=0;O<L.length;O++)v+=L[O].toString()+",";t(a,l,v.substring(0,v.length-1))}return!0}}})}else this._drawControls[n].deactivate()},o.prototype._getStrPoints=function(e,t){var i="";switch(e){case NPMapLib.DRAW_MODE_POLYLINE:for(var r=t.components,n=0;n<r.length;n++)n<r.length-1&&(i+=r[n].x+","+r[n].y+","),n===r.length-1&&(i+=r[n].x+","+r[n].y);break;case NPMapLib.DRAW_MODE_POLYLGON:case NPMapLib.DRAW_MODE_RECT:for(var s=t.components[0].components,o=0;o<s.length;o++)o<s.length-1&&(i+=s[o].x+","+s[o].y+","),o===s.length-1&&(i+=s[o].x+","+s[o].y);break;case NPMapLib.DRAW_MODE_CIRCLE:var a=t.bounds,l=a.getCenterLonLat(),p=t.components[0].components;if(p.length>0){var h=new OpenLayers.Geometry.Point(l.lon,l.lat),u=new OpenLayers.Geometry.Point(p[0].x,p[0].y),y=new OpenLayers.Projection("EPSG:900913");h.transform(this.map.getProjection(),y),u.transform(this.map.getProjection(),y);var c=h.distanceTo(u);i+=l.lon+","+l.lat+","+c}}return i},o.prototype._getNPGISGeometry=function(e,t,i){switch(e){case NPMapLib.DRAW_MODE_POLYLINE:var r=t.components,n=this._getPoint(r);return new NPMapLib.Geometry.Polyline(NPMapLib.T.getPoints(this,n),i);case NPMapLib.DRAW_MODE_POLYLGON:case NPMap.DRAW_MODE_FREEHAND:case NPMapLib.DRAW_MODE_RECT:var s=t.components[0].components,o=this._getPoint(s);return new NPMapLib.Geometry.Polygon(NPMapLib.T.getPoints(this,o),i);case NPMapLib.DRAW_MODE_CIRCLE:case NPMap.DRAW_MODE_CIRCLE_DIAMETER:return this._getCircleGeometry(e,t,i)}},o.prototype._getCircleGeometry=function(e,t,i){var r=t.bounds,n=r.getCenterLonLat(),s=t.components[0].components;if(s.length>0){var o=new OpenLayers.Geometry.Point(n.lon,n.lat),a=new OpenLayers.Geometry.Point(s[0].x,s[0].y),l=new OpenLayers.Projection("EPSG:900913");o.transform(this.map.getProjection(),l),a.transform(this.map.getProjection(),l);var p=o.distanceTo(a);return new NPMapLib.Geometry.Circle(NPMapLib.T.getPoint(this,n),p,i)}},o.prototype._getPoint=function(e){for(var t=[],i=0;i<e.length;i++)t.push(new NPMapLib.Geometry.Point(e[i].x,e[i].y));return t},o.prototype._initMeasureControl=function(){var e={Point:{pointRadius:4,graphicName:"circle",fillColor:"white",fillOpacity:1,strokeWidth:.5,strokeOpacity:1,strokeColor:"red",cursor:"inherit"},Line:{strokeWidth:1.5,strokeOpacity:1,strokeDashstyle:"dash",strokeColor:"#ff0000"},Polygon:{strokeWidth:1.5,strokeOpacity:1,fillOpacity:.3,fillColor:"red",strokeColor:"#ff0000"}},t=new OpenLayers.Style;t.addRules([new OpenLayers.Rule({symbolizer:e})]);var i=new OpenLayers.StyleMap({"default":t});this._measureControls={Path:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{displayUnits:"km",geodesic:!0,persist:!0,handlerOptions:{layerOptions:{styleMap:i}}}),Polygon:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{displayUnits:"km",persist:!1,geodesic:!0,handlerOptions:{layerOptions:{styleMap:i}}})}},o.prototype._getMesureLength=function(e){var t="km",i=this.map.getUnits(),r=OpenLayers.INCHES_PER_UNIT[t];if(r){var n=OpenLayers.INCHES_PER_UNIT[i];e*=n/r}return e},o.prototype.removeMeasureFeatures=function(){for(var e=0;e<this._measureFeatures.length;e++)this._measureFeatures[e]instanceof OpenLayers.Feature.Vector?this._measureFeatures[e].layer&&this._measureFeatures[e].layer.removeFeatures(this._measureFeatures[e]):this.removeOverlay(this._measureFeatures[e]),delete this._measureFeatures[e];this._measureFeatures=[]},o.prototype.centerAtMouse=function(){this.map.panTo(this.map.mousePosition)},o.prototype.measure=function(e,t,i){var r="",n=OpenLayers.Util.getImageLocation("ruler.cur");switch(e._mode){case NPMapLib.MEASURE_MODE_DISTANCE:r="Path",this._setMouseCursor("url("+n+"), crosshair");break;case NPMapLib.MEASURE_MODE_AREA:this._setMouseCursor("url("+n+"), crosshair"),r="Polygon";break;case NPMapLib.MEASURE_MODE_LOCATION:r="Point"}var s,o,a=this,l=[],p=[],h=navigator.appName.indexOf("Microsoft Internet Explorer")!==-1&&document.all;if(h){var u=navigator.appVersion.split(";")[1].replace(/[ ]/g,"");o="MSIE6.0"===u||"MSIE7.0"===u||"MSIE8.0"===u}o?new NPMapLib.Geometry.Size(0,10):new NPMapLib.Geometry.Size(0,4);this.removeOverlays(this.activMarkers),this._measureControl&&this.map.removeControl(this._measureControl);for(var y in this._measureControls)if(y===r){var c=!1;this._measureControl=this._measureControls[y],this.map.addControl(this._measureControl),this._measureControl.activate(),this._measureControl.events.listeners={},this._unregisterdblclick(),this._measureControl.events.fallThrough=!0,this._measureControl.events.on({measure:function(e){c=!0;var r=[],n=e.geometry,o={pointRadius:5,graphicName:"circle",fillColor:"red",fillOpacity:1,strokeWidth:1.5,strokeOpacity:1,strokeColor:"red"},h=n.components[n.components.length-1];if(a.activMarkers.length>0&&1===e.order){var u=NPMapLib.T.getPoint(a,{lon:h.x,lat:h.y}),y=a.activMarkers[a.activMarkers.length-1];y.getPosition().lon===u.lon&&y.getPosition().lat===u.lat&&(a.removeOverlay(y),a.activMarkers.pop())}if(a.activMarkers=[],0===e.measure)return a.map.getLayersByName("featureLayer")[0].removeFeatures(p),void a.pan();if(1===e.order){var d="CN"===NPMap.CULTURE?a._units[e.units]:"千米"===a._units[e.units]?"km":"m";label=("CN"===NPMap.CULTURE?"总长:":"Total:")+e.measure.toFixed(1)+":"+d;var m=a._getMeasureInfo(label,!0,function(){a.removeOverlays(l),a.map.getLayersByName("featureLayer")[0].removeFeatures(p),"function"==typeof i&&i()});if(n.components.length>0)for(var f=0;f<n.components.length;f++)r.push(new NPMapLib.Geometry.Point(n.components[f].x,n.components[f].y));var g=new OpenLayers.Geometry.Point(h.x,h.y),L=new OpenLayers.Feature.Vector(g,null,o);r=NPMapLib.T.getPoints(a,r),s?(s.setPath(r),r.length-p.length!=1&&(a.removeOverlay(l[l.length-1]),a.map.getLayersByName("featureLayer")[0].removeFeatures(p[p.length-1]))):(s=new NPMapLib.Geometry.Polyline(r,{color:"red",strokeWidth:3,strokeLinecap:"round"}),a.addOverlay(s)),"function"==typeof t&&t(label,r),this.map.getLayersByName("featureLayer")[0].addFeatures([L]),p.push(L);var v=r[r.length-1],O=new NPMap.Symbols.InfoWindow(v,"",m,{iscommon:!0,isAdaptation:!1,offset:new NPMapLib.Geometry.Size(12,(-11))});a.addOverlay(O),O.mapId=a.mapId;var P=O.getBaseDiv();P.style.boxShadow="5px 5px 0px rgba(34, 34, 34, 0.1)",O.open(null,!1),a._measureFeatures.push(O),l.push(O),a._measureFeatures.push(s),a._measureFeatures.push(L),l.push(s)}else{if(e.measure<1e-4)return void a.pan();if("CN"===NPMap.CULTURE?label=parseFloat(e.measure).toFixed(2)+"平方"+a._units[e.units]:label=parseFloat(e.measure).toFixed(2)+("千米"===a._units[e.units]?"k㎡":"㎡"),n.components.length>0&&n.components[0].components.length>0)for(var b=0;b<n.components[0].components.length;b++){var w=n.components[0].components[b];r.push(new NPMapLib.Geometry.Point(w.x,w.y))}var h=r[r.length-2],g=new OpenLayers.Geometry.Point(h.lon,h.lat),L=new OpenLayers.Feature.Vector(g,null,o);r=NPMapLib.T.getPoints(a,r),s=new NPMapLib.Geometry.Polygon(r,{color:"red",fillColor:"red",opacity:.6,fillOpacity:.3}),l.push(s),a.addOverlay(s),this.map.getLayersByName("featureLayer")[0].addFeatures([L]),"function"==typeof t&&t(label,r),a._measureFeatures.push(s),p.push(L),a._measureFeatures.push(L);var M=s._apiObj.geometry.bounds,_=M.getCenterLonLat(),v=NPMapLib.T.getPoint(a,new NPMapLib.Geometry.Point(_.lon,M.top)),m=a._getMeasureInfo(label,!0,function(){a.removeOverlays(l),a.map.getLayersByName("featureLayer")[0].removeFeatures(p),"function"==typeof i&&i()}),x=new NPMap.Symbols.InfoWindow(v,"",m,{iscommon:!0,isAdaptation:!1,offset:new NPMapLib.Geometry.Size(12,(-11))});a.addOverlay(x),x.mapId=a.mapId;var P=x.getBaseDiv();P.style.boxShadow="5px 5px 0px rgba(34, 34, 34, 0.1)",x.open(null,!1),a._measureFeatures.push(x),l.push(x)}return!0},measureProcess:function(e){if(!c){var t={pointRadius:5,graphicName:"circle",fillColor:"red",fillOpacity:1,strokeWidth:1.5,strokeOpacity:1,strokeColor:"red"};if(1===e.order){var i="CN"===NPMap.CULTURE?a._units[e.units]:"千米"===a._units[e.units]?"km":"m",r=e.measure.toFixed(1)+i,n=!1;0==e.measure.toFixed(1)&&(r="CN"===NPMap.CULTURE?"起点":"Origin",n=!0);var o=new NPMapLib.Geometry.Point(e.point.x,e.point.y),h=new OpenLayers.Geometry.Point(e.point.x,e.point.y),u=new OpenLayers.Feature.Vector(h,null,t);a._measureFeatures.push(u),this.map.getLayersByName("featureLayer")[0].addFeatures([u]),p.push(u),o=NPMapLib.T.getPoint(a,o),n?(s=new NPMapLib.Geometry.Polyline([o],{color:"red",strokeWidth:3,strokeLinecap:"round"}),a.addOverlay(s),s.mapId=a.mapId):s.addPoint(o);var y=a._getMeasureInfo(r),d=new NPMap.Symbols.InfoWindow(o,"",y,{iscommon:!0,isAdaptation:!1,offset:new NPMapLib.Geometry.Size(12,(-11))});a.addOverlay(d),d.mapId=a.mapId;var m=d.getBaseDiv();m.style.boxShadow="5px 5px 0px rgba(34, 34, 34, 0.1)",d.open(null,!1),a._measureFeatures.push(d),l.push(d),a.activMarkers.push(d)}else{var o=new NPMapLib.Geometry.Point(e.point.x,e.point.y),h=new OpenLayers.Geometry.Point(e.point.x,e.point.y),u=new OpenLayers.Feature.Vector(h,null,t);a._measureFeatures.push(u),this.map.getLayersByName("featureLayer")[0].addFeatures([u]),p.push(u)}return!0}}})}else this._measureControls[y].deactivate()},o.prototype._getMeasureInfo=function(e,t,i){var r=document.createElement("div");r.style.fontSize="12px",r.style.fontFamily="微软雅黑","mozilla"!==OpenLayers.BROWSER_NAME&&"msie"!==OpenLayers.BROWSER_NAME||(r.style.fontFamily="宋体"),r.style.color="#666666",r.style.border="1px solid #cccccc",r.style.height="23px",r.style.backgroundColor="#fff";var n=e.split(":");if(n.length>1){var s=document.createElement("span");s.style.maxWidth="100px",s.style.overflow="hidden",s.style.whiteSpace="nowrap",s.style.textOverflow="ellipsis",s.style["float"]="left",s.style.marginLeft="8px",s.style.display="inline-block",s.style.lineHeight="23px",s.innerText=n[0]+":",r.appendChild(s);var o=document.createElement("span");o.style.maxWidth="100px",o.style.overflow="hidden",o.style.whiteSpace="nowrap",o.style.textOverflow="ellipsis",o.style.color="#ff0000",o.style["float"]="left",o.style.marginLeft="12px",o.style.display="inline-block",o.style.lineHeight="23px",o.innerText=n[1],r.appendChild(o);var a=document.createElement("span");a.style.maxWidth="100px",a.style.overflow="hidden",a.style.whiteSpace="nowrap",a.style.textOverflow="ellipsis",a.style["float"]="left",a.style.marginLeft="4px",a.style.display="inline-block",a.style.lineHeight="23px",a.innerText=n[2],r.appendChild(a)}else{var s=document.createElement("span");s.style.maxWidth="100px",s.style.overflow="hidden",s.style.whiteSpace="nowrap",s.style.textOverflow="ellipsis",s.style["float"]="left",s.style.marginLeft="8px",s.style.display="inline-block",s.style.lineHeight="23px",s.innerText=e,r.appendChild(s)}if(t){var l=document.createElement("i");l.style.width="7px",l.style.height="14px",l.style["float"]="left",l.style.display="inline-block",l.style.marginLeft="5px",l.style.marginTop="4px",l.style.cursor="pointer",l.style.background="url('"+OpenLayers.Util.getImageLocation("measureClose.png")+"') no-repeat",l.style.backgroundPosition="0px 4px",l.onmouseover=function(){l.style.backgroundPosition="-7px 4px"},l.onmouseout=function(){l.style.backgroundPosition="0px 4px"},l.onmousedown=i,r.appendChild(l)}var p=document.createElement("i");return p.style.width="10px",p.style.height="10px",p.style["float"]="left",p.style.display="inline-block",r.appendChild(p),r},o.prototype._createPolyline=function(e){if(e instanceof NPMapLib.Geometry.Polyline){var t=NPMapLib.T.setPoints(this,e.getPath()),i=new OpenLayers.Geometry.LineString(this._castPoints(t));if(t&&!(t.length<=0)){var r=this._getPolylineStyle(e),n=new OpenLayers.Feature.Vector(i,e,r);return n}}},o.prototype._getPolylineStyle=function(e){var t=e.getArrowStyle(),i={strokeColor:e.getColor(),strokeWidth:e.getWeight(),strokeOpacity:e.getOpacity(),strokeDashstyle:n[e.getLineStyle()],graphicName:"triangle",pointRadius:2*e.getWeight(),arrowStyle:t};return s[t]&&(i.strokeLinecap=s[t]),i},o.prototype._updatePolygon=function(e){e._apiObj.style=this._getPolygonStyle(e)},o.prototype._getPolygonStyle=function(e){if(e instanceof NPMapLib.Geometry.Polygon){var t={fill:!0,fillColor:e.getFillColor(),fillOpacity:e.getFillOpacity(),strokeColor:e.getColor(),strokeWidth:e.getWeight(),strokeOpacity:e.getOpacity(),pointRadius:e.getPointRadius(),label:e.text?e.text:"",graphicZIndex:e.getZIndex(),strokeDashstyle:n[e.getLineStyle()]};return t}},o.prototype._createPolygon=function(e){if(e instanceof NPMapLib.Geometry.Polygon){var t=this._getPolygonStyle(e),i=e.getPath();if(i&&!(i.length<=0)){var r=[];if(i[0]instanceof NPMapLib.Geometry.Point)i=NPMapLib.T.setPoints(this,i),r=new OpenLayers.Geometry.LinearRing(this._castPoints(i));else for(var n=0;n<i.length;n++)r.push(new OpenLayers.Geometry.LinearRing(this._castPoints(NPMapLib.T.setPoints(this,i[n]))));var s=new OpenLayers.Geometry.Polygon(r),o=new OpenLayers.Feature.Vector(s,e,t);return o}}},o.prototype._updateCircle=function(e){
var t=NPMapLib.T.setPoint(this,e.getCenter()),i=e._apiObj.geometry.components[0].components[0],r=Math.sqrt((t.lon-i.x)*(t.lon-i.x)+(t.lat-i.y)*(t.lat-i.y)),n=parseFloat(e._radius),s=new NPMapLib.GisToolKit;if(n=s.getDistanceByProjection2(n,this.map),0===r||0===n)return void(e._apiObj.style=this._getCircleStyle(e));var o=n/r,a=new OpenLayers.Geometry.Point(t.lon,t.lat);e._apiObj.geometry.resize(o,a),e._apiObj.style=this._getCircleStyle(e)},o.prototype._getCircleStyle=function(e){var t=e.getRadius(),i=new NPMapLib.GisToolKit;return t=i.getDistanceByProjection2(t,this.map),{fill:!0,fillColor:e.getFillColor(),fillOpacity:e.getFillOpacity(),strokeOpacity:e.getOpacity(),strokeWidth:e.getWeight(),strokeColor:e.getColor(),pointRadius:t,label:e.text?e.text:"",graphicZIndex:e.getZIndex(),strokeDashstyle:n[e.getLineStyle()]}},o.prototype._getEllipseStyle=function(e){return{fill:!0,fillColor:e.getFillColor(),fillOpacity:e.getFillOpacity(),strokeOpacity:e.getOpacity(),strokeWidth:e.getWeight(),strokeColor:e.getColor(),label:e.text?e.text:"",graphicZIndex:e.getZIndex(),strokeDashstyle:n[e.getLineStyle()]}},o.prototype._createCircle=function(e){if(e instanceof NPMapLib.Geometry.Circle){var t=NPMapLib.T.setPoint(this,e.getCenter()),i=e.getRadius();if(t&&i){var r=new OpenLayers.Geometry.Point(t.lon,t.lat),n=new NPMapLib.GisToolKit;i=n.getDistanceByProjection2(i,this.map);var s=OpenLayers.Geometry.Polygon.createRegularPolygon(r,i,60,10),o=new OpenLayers.Feature.Vector(s,e,this._getCircleStyle(e));return o}}},o.prototype._createEllipse=function(e){if(e instanceof NPMapLib.Geometry.Ellipse&&e._firstPoint&&e._secondPoint&&e._distance){var t=NPMapLib.T.setPoint(this,e._firstPoint),i=NPMapLib.T.setPoint(this,e._secondPoint),r=(t.lon+i.lon)/2,n=(t.lat+i.lat)/2,s=this.getDistance(t,i),o=e._distance/2,a=Math.sqrt(e._distance/2*(e._distance/2)-s/2*(s/2)),l=new NPMapLib.Geometry.Point(t.lon,n),p=this.getDistance(t,l),h=Math.asin(p/(s/2))/Math.PI*180;(t.lon-i.lon)*(t.lat-i.lat)<0&&(h=180-h);var u=new NPMapLib.GisToolKit;o=u.getDistanceByProjection2(o,this.map),a=u.getDistanceByProjection2(a,this.map);var y=new OpenLayers.Geometry.Point(r,n),c=OpenLayers.Geometry.Polygon.createEllipsePolygion(y,o,a,60,h),d=new OpenLayers.Feature.Vector(c,e,this._getEllipseStyle(e));return d}},o.prototype._updateEllipse=function(e){var t=e._apiObj.layer;t.removeFeatures([e._apiObj]);var i=this._createEllipse(e);t.addFeatures([i]),e._apiObj=i},o.prototype._updateCircleSector=function(e){var t=e._apiObj.layer;t.removeFeatures([e._apiObj]);var i=this._creatCircleSector(e);t.addFeatures([i]),e._apiObj=i},o.prototype._getCircleSectorStyle=function(e){return{fill:!0,fillColor:e.getFillColor(),fillOpacity:e.getFillOpacity(),strokeOpacity:e.getOpacity(),strokeWidth:e.getWeight(),strokeColor:e.getColor(),graphicZIndex:e.getZIndex(),strokeDashstyle:n[e.getLineStyle()]}},o.prototype._creatCircleSector=function(e){if(e instanceof NPMapLib.Geometry.CircleSector){var t=e.getCenter(),i=e.getRadius(),r=e.getSides(),n=e.getAntBearing(),s=e.getLobeAngle();if(t&&i&&r&&n&&(s||0===s)){t=NPMapLib.T.setPoint(this,t);var o=new OpenLayers.Geometry.Point(t.lon,t.lat),a=new NPMapLib.GisToolKit;i=a.getDistanceByProjection2(i,this.map);var l=this._createOpenLayersCircleSector(o,i,r,n,s),p=new OpenLayers.Feature.Vector(l,e,this._getCircleSectorStyle(e));return p}}},o.prototype._createOpenLayersCircleSector=function(e,t,i,r,n){var s=360-r,o=Math.PI*(1/i-.5);s&&(o+=s/180*Math.PI);for(var a,l,p,h=[],u=0;u<i;u++){var y=u*((360-s)/360);a=o+2*y*Math.PI/i,l=e.x+t*Math.cos(a),p=e.y+t*Math.sin(a),h.push(new OpenLayers.Geometry.Point(l,p))}0!==s&&h.push(e);var c=new OpenLayers.Geometry.LinearRing(h);return c.rotate(parseFloat(r)+90+parseFloat(n),e),new OpenLayers.Geometry.Polygon([c])},o.prototype._createBubble=function(e){var t=NPMapLib.T.setPoint(this,e.getPosition()),i=this._getBubbleStyle(e),r=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),e,i);return r},o.prototype._getBubbleStyle=function(e){var t=e.getOffset(),i=e.getColor(),r={color:i,offset:t,bubble:!0};return r},o.prototype._getMarkerStyle=function(e){var t=e.getIcon();if(!t)return{};var i=e.getOffset(),r=null,n=e.getLabel();n&&(r=this._getLabelStyle(n,i));var s={graphicWidth:t.getImageSize().width,graphicHeight:t.getImageSize().height,graphicXOffset:t.getAnchor().width+i.width,graphicYOffset:t.getAnchor().height-i.height,externalGraphic:t.getImageUrl(),graphicZIndex:e.getZIndex()};if(null!=r)for(var o in r)s[o]=r[o];var a=e.getTitle();return a&&(s.title=a),s},o.prototype._createMarker=function(e){var t=NPMapLib.T.setPoint(this,e.getPosition()),i=this._getMarkerStyle(e),r=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),e,i);return r},o.prototype._createLabel=function(e){if(e){e._style.align="m";var t=this._getLabelStyle(e),i=NPMapLib.T.setPoint(this,e.getPosition()),r=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(i.lon,i.lat),e,t);return r}},o.prototype._getLabelStyle=function(e,t){var i=e.getStyle();t=t?t:{width:0,height:0};var r={label:e.getContent(),fontSize:i.fontSize+"px",fontFamily:i.fontFamily,fontWeight:i.isBold?"bold":"normal",labelXOffset:e.getOffset().width+t.width,labelYOffset:e.getOffset().height-t.height,labelAlign:e._style.align||"cb",labelSelect:!0,labelBackgroundColor:e._bgColor,labelBackGroundStroke:e._bgStroke,labelBackGroundRXY:e._bgRXY,labelBackGroundMargin:e._bgMargin,title:e.getContent()};return i.color&&(r.fontColor=i.color),r},o.prototype._castPoint=function(e){return new OpenLayers.Geometry.Point(e.lon,e.lat)},o.prototype._castPoints=function(e){if(!e)return[];for(var t=[],i=0;i<e.length;++i)t.push(this._castPoint(e[i]));return t},o.prototype.getOverlayStyle=function(e){var t=e.overlayType,i=null;switch(t){case NPMapLib.OVERLAY_TYPE_POLYLINE:i=this._getPolylineStyle(e);break;case NPMapLib.OVERLAY_TYPE_POLYGON:i=this._getPolygonStyle(e);break;case NPMapLib.OVERLAY_TYPE_CIRCLE:i=this._getCircleStyle(e);break;case NPMapLib.OVERLAY_TYPE_CIRCLESECTOR:i=this._getCircleSectorStyle(e);break;case NPMapLib.OVERLAY_TYPE_LABEL:i=this._getLabelStyle(e);break;case NPMapLib.OVERLAY_TYPE_MARKER:i=this._getMarkerStyle(e);break;case NPMapLib.OVERLAY_TYPE_BUBBLE:i=this._getBubbleStyle(e)}return i},o.prototype.getAreaOverlays=function(e,t,i){var r,n=[];t=void 0===t?"featureLayer":t,i=void 0===i||"function"!=typeof i?function(){return!0}:i;var s=e.bounds,o=this.map.getLayersByName("featureLayer")[0].features;for(var a in o)if(o.hasOwnProperty(a)){if(r=o[a],!i(r))continue;s.containsLonLat(new OpenLayers.LonLat(r.position.op_point.x,r.position.op_point.y))&&n.push(r)}return n},o.prototype.showMenu=function(e){var i=e.MenuList,r=e.id;if(i){e._menu&&e._menu.hide(),this.currentMenu&&(this.currentMenu.hide(),this.currentMenu=null,delete this.currentMenu);for(var n=[],s=i.split(";"),o=0,a=0;a<s.length;a++){for(var l=s[a].split(","),p=0;p<l.length;p++)n.push(new t(l[p],"overlayContextMenuCallBack("+o+","+r+")")),o++;n.push(null)}if(n.length>0){_menu=new OpenLayers.Menu("menulist",n),_menu.map=this.map,this.currentMenu=_menu;var h=_menu.draw();h&&this.map.layerContainerDiv.appendChild(h);var u=this,y=function(){this.hide(),e._menu=null,this.currentMenu=null,delete this.currentMenu,u.map.events.unregister("click",_menu,y)};this.map.events.register("click",_menu,y)}_menu.show(),e._menu=_menu}},o.prototype.showMapMenu=function(e,i,r){if(i){this.map._menu&&this.map._menu.hide();for(var n=[],s=0,o=0;o<i.length;o++){var a=i[o];for(j in a)a.hasOwnProperty(j)&&n.push(new t(j,a[j])),s++;n.push(null)}if(n.length>0){_menu=new OpenLayers.Menu("mapMenuList",n),_menu.map=this.map;var l=_menu.draw();l&&this.map.div.appendChild(l);var p=this;l.onclick=function(){_menu.hide(),p.map._menu=null},this.map.events.unregister("movestart",this,this.mapMenuHide),this.map.events.unregister("click",this,this.mapMenuHide),this.map.events.register("movestart",this,this.mapMenuHide),this.map.events.register("click",this,this.mapMenuHide)}_menu.show(e,r),this.map._menu=_menu}},o.prototype.mapMenuHide=function(){this.map._menu&&this.map._menu.hide()},o.prototype.getOverlayExtent=function(e){var t=new NPMapLib.Geometry.Extent(0,0,0,0);if(e._apiObj){var i=e._apiObj.geometry.bounds;t=new NPMapLib.Geometry.Extent(i.left,i.bottom,i.right,i.top)}return t},o.prototype._registerMapClick=function(e,t){this._clicks[e]=t},o.prototype._registerMapRightClick=function(e,t){this._clicks[e]=t},o.prototype._registerMapDoubleClick=function(e,t){var i=this,r=new OpenLayers.Control.ClickControl({eventMethods:{dblclick:function(t){var r=this.map.events.getMousePosition(t),n=this.map.getLonLatFromPixel(r),s=i._clicks[e];s&&s(NPMapLib.T.getPoint(i,n))}}});this._clicks[e]=t,this.map.addControl(r),r.activate()},o.prototype.addEventListener=function(e,t,i){if(e&&null!=e&&(e instanceof NPMapLib.Map||e instanceof NPMapLib.Adapter.OpenLayers.MapAdapter||e instanceof NPMapLib.Symbols.Marker||e instanceof NPMapLib.Symbols.Label||e instanceof NPMapLib.Geometry.Polyline||e instanceof NPMapLib.Geometry.Polygon||e instanceof NPMapLib.Geometry.CircleSector||e instanceof NPMapLib.Geometry.Ellipse||e instanceof NPMapLib.Geometry.Circle||e instanceof NPMapLib.Overlay||e instanceof NPMapLib.Symbols.Bubble)){var r=t+"_"+e.id;if(e instanceof NPMapLib.Map&&(r+="_map"),!this._events[r]){var n,s=this;if(e instanceof NPMapLib.Map||e instanceof NPMapLib.Adapter.OpenLayers.MapAdapter)switch(t){case NPMapLib.MAP_EVENT_CLICK:this._registerMapClick(t,i);break;case NPMapLib.MAP_EVENT_RIGHT_CLICK:this._registerMapRightClick(t,i);break;case NPMapLib.MAP_EVENT_DBLCLICK:this._registerMapDoubleClick(t,i);break;case NPMapLib.MAP_EVENT_ZOOM_END:n=function(e){if(e&&e.object){var t=e.object.getZoom();i(t)}},this.map.events.register(t,e,n);break;case NPMapLib.MAP_EVENT_MOUSE_MOVE:n=function(e){var t=e.object,r=t.getLonLatFromPixel(e.xy),n=new NPMapLib.Geometry.Point(r.lon,r.lat);n=NPMapLib.T.getPoint(s,n),i(n,e)},this.map.events.register(t,e,n);break;case NPMapLib.MAP_EVENT_MOVE_END:case NPMapLib.MAP_EVENT_MOVE_START:case NPMapLib.MAP_EVENT_DRAGGING:case NPMapLib.MAP_EVENT_DRAG_START:case NPMapLib.MAP_EVENT_DRAG_END:case NPMapLib.MAP_EVENT_MOUSE_OVER:case NPMapLib.MAP_EVENT_MOUSE_OUT:n=function(e){e&&e.object&&i(e)},this.map.events.register(t,e,n);break;case NPMapLib.MAP_EVENT_ADD_OVERLAY:case NPMapLib.MAP_EVENT_REMOVE_OVERLAY:case NPMapLib.MAP_EVENT_CLEAR_OVERLAYS:case NPMapLib.MAP_EVENT_ADD_CONTROL:case NPMapLib.MAP_EVENT_REMOVE_CONTROL:n=i,this._openLayersEvents.register(t,e,i);break;case NPMapLib.MAP_EVENT_ZOOM_START:n=function(e){var t=e.zoom,r=e.object.getZoom(),n=!0;r>t&&(n=!1),i(n,e.xy,e.zoomType)},this.map.events.register(t,e,n);break;case NPMapLib.MAP_EVENT_RESIZE:n=i,this.map.events.register("updatesize",e,n);break;case NPMapLib.MAP_EVENT_ZOOMCHANGE:var o=this;n=function(e){if(e.zoomChanged){var t=o.getZoom();t&&i(t)}},this.map.events.register("movestart",e,n);break;default:return void console.warn("暂不支持"+t+"事件")}else e.id&&(this._overlayEvents[e.id+"_"+t]=i,n=i);this._events[r]=n}}},o.prototype._unregisterMapClicks=function(e){this._clicks[e]&&delete this._clicks[e]},o.prototype.updateSize=function(){this.map.updateSize()},o.prototype.removeEventListener=function(e,t,i){if(e&&null!=e&&(e instanceof NPMapLib.Map||e instanceof NPMapLib.Adapter.OpenLayers.MapAdapter||e instanceof NPMapLib.Symbols.Marker||e instanceof NPMapLib.Symbols.Label||e instanceof NPMapLib.Geometry.Polyline||e instanceof NPMapLib.Geometry.Polygon||e instanceof NPMapLib.Geometry.CircleSector||e instanceof NPMapLib.Geometry.Circle||e instanceof NPMapLib.Symbols.Bubble)){var r=t+"_"+e.id;if(e instanceof NPMapLib.Map&&(r+="_map"),e instanceof NPMapLib.Map||e instanceof NPMapLib.Adapter.OpenLayers.MapAdapter)switch(t){case NPMapLib.MAP_EVENT_CLICK:case NPMapLib.MAP_EVENT_DBLCLICK:case NPMapLib.MAP_EVENT_RIGHT_CLICK:this._unregisterMapClicks(t);break;case NPMapLib.MAP_EVENT_MOUSE_MOVE:case NPMapLib.MAP_EVENT_MOUSE_OVER:case NPMapLib.MAP_EVENT_MOUSE_OUT:case NPMapLib.MAP_EVENT_ZOOM_START:case NPMapLib.MAP_EVENT_ZOOM_END:case NPMapLib.MAP_EVENT_DRAGGING:case NPMapLib.MAP_EVENT_DRAG_START:case NPMapLib.MAP_EVENT_DRAG_END:case NPMapLib.MAP_EVENT_MOVE_END:case NPMapLib.MAP_EVENT_MOVE_START:case NPMapLib.MAP_EVENT_ZOOMCHANGE:this.map.events.unregister(t,e,this._events[r]);break;case NPMapLib.MAP_EVENT_RESIZE:this.map.events.unregister("updatesize",e,this._events[r]);break;case NPMapLib.MAP_EVENT_ADD_OVERLAY:case NPMapLib.MAP_EVENT_REMOVE_OVERLAY:case NPMapLib.MAP_EVENT_CLEAR_OVERLAYS:case NPMapLib.MAP_EVENT_ADD_CONTROL:case NPMapLib.MAP_EVENT_REMOVE_CONTROL:this._openLayersEvents.unregister(t,e,this._events[r]);break;default:console.warn("取消事件"+t+"不支持")}else this._overlayEvents[e.id+"_"+t]&&delete this._overlayEvents[e.id+"_"+t];this._events[r]&&delete this._events[r]}},o.prototype.getTop=function(e){if(e&&e._apiObj){var t=e._apiObj.geometry.bounds;return NPMapLib.T.getPoint(this,new NPMapLib.Geometry.Point(t.getCenterLonLat().lon,t.top))}return null},o.prototype.setFillText=function(e,t,i,r){if(e&&e._apiObj){if(e._apiObj.style.label=t,i&&(e._apiObj.style.fontSize=i),r)for(var n in r)e._apiObj.style[n]=r[n];e._apiObj.layer.drawFeature(e._apiObj)}},o.prototype.showLayer=function(e){for(var t=this.map.getLayersByName(e.name),i=0;i<t.length;i++)t[i].setVisibility(!0)},o.prototype.clearTiles=function(e){for(var t=this.map.getLayersByName(e.name),i=0;i<t.length;i++)t[i].clearGrid()},o.prototype.hideLayer=function(e){for(var t=this.map.getLayersByName(e.name),i=0;i<t.length;i++)t[i].setVisibility(!1)},o.prototype.getBounds=function(e){if(e&&e._apiObj){var t=e._apiObj.geometry.getBounds();return NPMapLib.T.getExtent(this,new NPMapLib.Geometry.Extent(t.left,t.bottom,t.right,t.top))}return null},o.prototype.setTitle=function(e){e&&e._apiObj&&e._apiObj.setContentHTML(e.getTitle()+e.getContent())},o.prototype.setContent=function(e){e&&e._apiObj&&e._apiObj.setContentHTML(e.getTitle()+e.getContent())},o.prototype.getOverlayCenter=function(e){if(e&&e._apiObj){var t=e._apiObj.geometry.getBounds().getCenterLonLat();return NPMapLib.T.getPoint(this,new NPMapLib.Geometry.Point(t.lon,t.lat))}return null},o.prototype.getRadius=function(e){if(e&&e._apiObj){var t=e._apiObj.geometry.getBounds().getCenterLonLat(),i=e._apiObj.geometry,r=i.components[0].components[0],n=r.distanceTo(new OpenLayers.Geometry.Point(t.lon,t.lat)),s=new NPMapLib.GisToolKit;return s.getPlatDistanceByProjection2(n,this.map).toFixed(2)}return null},o.prototype.setBaseLayer=function(e){var t=this.map.getLayersByName(e.name);if(t.length>0)this.map.setBaseLayer(t[0]);else{var i=this._createLayer(e);null!=i&&this.map.setBaseLayer(i)}},o.prototype.getCirclePoints=function(e){if(e&&e._apiObj&&e._apiObj.geometry){for(var t=e._apiObj.geometry.components[0].components,i=[],r=0;r<t.length;r++)i.push(new NPMapLib.Geometry.Point(t[r].x,t[r].y));return i}},o.prototype.setVisibilityDefalutLayer=function(e){for(var t=this.map.getLayersByName("featureLayer"),i=0;i<t.length;i++)t[i].setVisibility(!!e)},o.prototype.getArea=function(e,t){if(e&&e._apiObj)return this._getArea(e._apiObj.geometry,t,!1)},o.prototype._getArea=function(e,t,i){var r,n;i?(r=e.getGeodesicArea(this.map.getProjectionObject()),n="m"):(r=e.getArea(),n=this.map.getUnits());var s=OpenLayers.INCHES_PER_UNIT[t];if(s){var o=OpenLayers.INCHES_PER_UNIT[n];r*=Math.pow(o/s,2)}return r},o.prototype.getOverlayZIndex=function(e){return e._graphicZIndex},o.prototype.setOverlayZIndex=function(e,t){e._graphicZIndex=t,e.refresh()},o.prototype.setMakrerTypeVisiable=function(e,t,i){if(null!=e._apiObj)if("undefined"!=typeof e._apiObj.showMarker[t]){if(e._apiObj.showMarker[t]===i)return;if(e._apiObj.showMarker[t]=i,i){var r=e.getOverlaysArry();if(r.length>0){var n=r[0].getMarkersByMarkType(t);e._apiObj.strategies[0].addClusterMarker(n)}}else for(var s=e._apiObj.features.slice(),o=s.length,a=[],l=0;l<o;l++)s[l].data.markType===t&&(e._apiObj.removeFeatures(s[l]),a.push(s[l]))}else e._apiObj.showMarker[t]=i},o.prototype.getMapUnits=function(){return this.map.units},o.prototype.setDefaultMapCursor=function(e){this.defaultMapCursor=e,this.setCursor(this.defaultMapCursor)},o.prototype.registerLayerFeatureclick=function(){this.cache={},this.map.events.register("mousedown",this,this.layerstart,{extension:!0}),this.map.events.register("touchstart",this,this.layerstart,{extension:!0}),this.map.events.register("touchmove",this,this.cancel,{extension:!0}),this.map.events.register("mousemove",this,this.onMousemove,{extension:!0})},o.prototype.triggerEvent=function(e,t){var i=this;if(t.feature){if(t.feature.layer&&this._selfLayers[t.feature.layer.name]&&"NPMapLib.Layers.HotspotLayer"===this._selfLayers[t.feature.layer.name].CLASS_NAME){var r=this._selfLayers[t.feature.layer.name],n=t.feature.data;switch(e){case"featureclick":r.click(n);break;case"featureover":r.onmouseover(n);break;case"featureout":r.onmouseout(n)}return!1}var s=t.feature;switch(e){case"featureclick":s.layer&&s.layer.eventListeners&&s.layer.eventListeners.featureclick?s.layer.eventListeners.featureclick(t):this._featuresLayerClick(t);break;case"featuremousedown":if(s.data&&s.data.id){var o=this._overlayEvents[s.data.id+"_featuremousedown"];"function"==typeof o&&o.apply(this,[s.data,"featuremousedown"])}break;case"featuremouseup":if(s.data&&s.data.id){var a=this._overlayEvents[s.data.id+"_featuremouseup"];"function"==typeof a&&a.apply(this,[s.data,"featuremouseup"])}break;case"featureover":s.layer&&s.layer.eventListeners&&s.layer.eventListeners.featureover?s.layer.eventListeners.featureover(t):this._overFeature(t);break;case"featureout":s.layer&&s.layer.eventListeners&&s.layer.eventListeners.featureout?s.layer.eventListeners.featureout(t):this._mouseout(t);break;case"featuremoving":var l=t.xy,p=null;if(l&&(p=this.pixelToPoint(l)),s.data&&s.data.id){"NPMapLib.Geometry.Polyline"===s.data.CLASS_NAME&&(p=NPMap.T.getPoint(i,p),p=this.getPointInLine(s.data,p));var h=this._overlayEvents[s.data.id+"_featuremoving"];"function"==typeof h&&h.apply(this,[s.data,p])}}return!1}},o.prototype.getPointInLine=function(e,t){for(var i=e.getPath(),r=null,n=99999,s=i.length-1;s>0;s--){var o=this._findShortPointInLine(t,i[s].lon,i[s].lat,i[s-1].lon,i[s-1].lat),a=this._calculateEuclideanDistance(t.lon,t.lat,o.lon,o.lat);a<n&&(n=a,r=o)}return r},o.prototype._findShortPointInLine=function(e,t,i,r,n){var s,o,a,l=e.lon,p=e.lat;if(s=this._calculateEuclideanDistance(t,i,r,n),o=this._calculateEuclideanDistance(t,i,l,p),a=this._calculateEuclideanDistance(r,n,l,p),s===o+a)return new NPMapLib.Geometry.Point(l,p);if(s<=1e-6)return new NPMapLib.Geometry.Point(t,i);if(a*a>=s*s+o*o)return new NPMapLib.Geometry.Point(t,i);if(o*o>=s*s+a*a)return new NPMapLib.Geometry.Point(r,n);if(r-t===0)return new NPMapLib.Geometry.Point(t,p);var h=(n-i)/(r-t),u=(l+(p-i)*h+h*h*t)/(h*h+1),y=h*u-h*t+i;return new NPMapLib.Geometry.Point(u,y)},o.prototype._calculateEuclideanDistance=function(e,t,i,r){var n=Math.sqrt((i-e)*(i-e)+(r-t)*(r-t));return n},o.prototype.getFeatures=function(e){return this.map.getFeatures(e)},o.prototype.onMousemove=function(e){for(var t,i=this.getFeatures(e),r={},n=[],s=0,o=i.length;s<o;++s)t=i[s],r[t.id]=t,n.push(t);var a;n.length>0&&(a=n[0]);for(var l=0;l<n.length;l++)a.style&&n[l].style&&a.style.graphicZIndex<n[l].style.graphicZIndex&&(a=n[l]);i.length>0&&this.triggerEvent("featuremoving",{feature:this.activeFeature,xy:{x:e.offsetX,y:e.offsetY}}),0===n.length&&(this.activeFeature&&(this.triggerEvent("featureout",{feature:this.activeFeature,xy:{x:e.offsetX,y:e.offsetY}}),delete this.cache[this.activeFeature.id]),this.activeFeature=null),this.activeFeature!==a&&(this.activeFeature&&(this.triggerEvent("featureout",{feature:this.activeFeature,xy:{x:e.offsetX,y:e.offsetY}}),delete this.cache[this.activeFeature.id],this.activeFeature=null),this.triggerEvent("featureover",{feature:a,xy:{x:e.offsetX,y:e.offsetY}}),this.activeFeature=a,this.cache[i.id]=a)},o.prototype.layerstart=function(e){this.startEvt=e;for(var t in this.cache)if(this.cache.hasOwnProperty(t)&&(feature=this.cache[t],feature)){var i=this.triggerEvent("featuremousedown",{feature:feature});if(this.curretFeature=feature,i===!1)break}},o.prototype.removeOverlayEvent=function(e){if(e&&e.id){var t=e.id+"_";for(var i in this._overlayEvents)0===i.indexOf(t)&&delete this._overlayEvents[i]}},o.prototype.filterClusterMarks=function(e,t){e._apiObj.strategies[0].filterClusterMarks(t)},o.prototype.getProjection=function(){return this.map.getProjection()},o.prototype.finishGeometry=function(){this._measureControl&&this._measureControl.handler&&this._measureControl.handler.finishGeometry()},o.prototype.setMapStyle=function(e,t){var i,n,s,o=this.map.layers;if("undefined"==typeof t&&(t=!0),"object"==typeof e){var a=this.map.baseLayer;if("OpenLayers.Layer.Baidu"!==a.CLASS_NAME&&"OpenLayers.Layer.gaode"!==a.CLASS_NAME)return;for(var l=0;l<e.styleJson.length;l++)if("background"===e.styleJson[l].featureType&&("geometry.fill"===e.styleJson[l].elementType||"geometry"===e.styleJson[l].elementType)){this._container.style.backgroundColor=e.styleJson[l].stylers.color;break}var p=this.getStyle(e.styleJson),h=a.url;if(OpenLayers.Util.isArray(h))for(var l=0;l<h.length;l++){var u=h[l],y=u.indexOf("&custom=");y!=-1&&(u=u.substring(0,y)),h[l]=u+"&custom="+encodeURIComponent(p),t||(h[l]=h[l]+"&imgCache=false")}else{var y=h.indexOf("&custom=");y!=-1&&(h=h.substring(0,y)),h=h+"&custom="+encodeURIComponent(p),t||(h+="&imgCache=false")}if(a.setUrl(h),"OpenLayers.Layer.Baidu"==a.CLASS_NAME&&(i=r(e,"poi"),n=r(e,"roadLabel"),s=r(e,"regionLabel"),a.showLabel=function(e){if("fixed"==e.type){var t=e.style0?e.style0[6]:null;return t&&"null"!=t?s.visibility:i.visibility}return"biaopai"!=e.type&&"line"!=e.type||n.visibility},a.beforDrawText=function(e,t,r){if("fixed"===e.type){if(e.textPos){var o=e.style0?e.style0[6]:null;if(o&&"null"!=o){if(5==t)return s.labels_text_stroke||r;if(4==t)return s.labels_text_fill||r}if(5==t)return i.labels_text_stroke||r;if(4==t)return i.labels_text_fill||r}}else if("line"===e.type){if(5==t)return n.labels_text_stroke||r;if(4==t)return n.labels_text_fill||r}else if("biaopai"===e.type)return n.labels_text_fill||r;return r}),"OpenLayers.Layer.gaode"==a.CLASS_NAME){if(!a.isVectorLayer){a=null;for(var l=o.length-1;l>=0;l--)o[l].isVectorLayer&&(a=o[l])}if(null==a)return;var i=r(e,"poi"),c=r(e,"administrativeLabel"),d=r(e,"roadLabel"),m=r(e,"guideboard"),f=r(e,"village"),g=r(e,"city"),L=r(e,"town"),v=r(e,"district"),s=r(e,"regionLabel");a.showLabel=function(e){return"roads:other"!=e.labels&&("labels:city"==e.labels?g.visibility:"labels:district"==e.labels?v.visibility:"labels:town"==e.labels?L.visibility:"labels:village"==e.labels?f.visibility:"labels:pois"==e.labels?i.visibility:"labels:aois"==e.labels?s.visibility:"roads:guideBoards"==e.labels?m.visibility:e.labels.indexOf("roads")!=-1?d.visibility:c.visibility)},a.beforeDrawLabel=function(e,t){if("labels:village"==e.labels){var r=0==t?f.labels_text_stroke:f.labels_text_fill;return r?"rgba("+r+")":r}if("labels:city"==e.labels){var r=0==t?g.labels_text_stroke:g.labels_text_fill;return r?"rgba("+r+")":r}if("labels:town"==e.labels){var r=0==t?L.labels_text_stroke:L.labels_text_fill;return r?"rgba("+r+")":r}if("labels:district"==e.labels){var r=0==t?v.labels_text_stroke:v.labels_text_fill;return r?"rgba("+r+")":r}if("labels:pois"==e.labels){var r=0==t?i.labels_text_stroke:i.labels_text_fill;return r?"rgba("+r+")":r}if("labels:aois"==e.labels){var r=0==t?s.labels_text_stroke:s.labels_text_fill;return r?"rgba("+r+")":r}if(e.labels.indexOf("roads")!=-1){var r=0==t?d.labels_text_stroke:d.labels_text_fill;return r?"rgba("+r+")":r}var r=0==t?c.labels_text_stroke:c.labels_text_fill;return r?"rgba("+r+")":r},window.setTimeout(function(){a.updateLabel()},10);var O=r(e,"land"),P=r(e,"green"),b=r(e,"manmade"),w=r(e,"water"),M=r(e,"building"),_=r(e,"highway"),x=r(e,"ringRoad"),C=r(e,"nationalRoad"),S=r(e,"localRoad"),N=r(e,"railway"),E=r(e,"subway"),T=r(e,"other"),A=r(e,"provincialRoad");a.showRoad=function(e){switch(e.labels){case"regions:land":return O.visibility;case"regions:green":return P.visibility;case"regions:parkingLot":case"regions:edu":case"regions:traffic":case"regions:scenicSpot":case"regions:health":case"regions:public":case"regions:sports":case"regions:culture":case"regions:business":return b.visibility;case"water":return w.visibility;case"buildings":return M.visibility;case"roads:highWay":return _.visibility;case"roads:ringRoad":return x.visibility;case"roads:nationalRoad":return C.visibility;case"roads:provincialRoad":return A.visibility;case"roads:secondaryRoad":case"roads:levelThreeRoad":case"roads:levelFourRoad":case"roads:other":case"roads:roadsBeingBuilt":return S.visibility;case"roads:railway":case"roads:highSpeedRailway":return N.visibility;case"roads:subway":case"regions:subway":case"roads:subwayBeingBuilt":return E.visibility;case"roads:underPass":case"roads:overPass":return T.visibility;default:return!0}},a.beforeDrawRoad=function(e,t){var i;switch(e.labels){case"regions:land":i=O;break;case"regions:green":i=P;break;case"regions:parkingLot":case"regions:edu":case"regions:traffic":case"regions:scenicSpot":case"regions:health":case"regions:public":case"regions:sports":case"regions:culture":case"regions:business":i=b;break;case"water":i=w;break;case"buildings":i=M;break;case"roads:highWay":i=_;break;case"roads:ringRoad":i=x;break;case"roads:nationalRoad":i=C;break;case"roads:provincialRoad":i=A;break;case"roads:secondaryRoad":case"roads:levelThreeRoad":case"roads:levelFourRoad":case"roads:other":case"roads:roadsBeingBuilt":i=S;break;case"roads:railway":case"roads:highSpeedRailway":i=N;break;case"roads:subway":case"regions:subway":case"roads:subwayBeingBuilt":i=E;break;case"roads:underPass":case"roads:overPass":i=T;break;default:i=null}return null!=i?(i=0==t?i.labels_text_stroke:i.labels_text_fill,i?"rgba("+i+")":i):null},a.updateLayer()}}else this.map.setMapStyle(e);for(var l=0;l<o.length;l++)!o[l]||!o[l].visibility||o[l]instanceof OpenLayers.Layer.Vector||o[l].redraw(),"OpenLayers.Layer.Baidu"==o[l].CLASS_NAME&&o[l].isVectorTile&&i&&n&&o[l].updateLabel()},o.prototype.getStyle=function(e){for(var t,i={featureType:"t",elementType:"e",visibility:"v",color:"c",lightness:"l",saturation:"s",weight:"w",zoom:"z",hue:"h"},r={all:"all",geometry:"g","geometry.fill":"g.f","geometry.stroke":"g.s",labels:"l","labels.text.fill":"l.t.f","labels.text.stroke":"l.t.s","lables.text":"l.t","labels.icon":"l.i"},n=[],s=0;t=e[s];s++)if(""!=t.featureType){var o=[];for(var a in i)t[a]&&("elementType"==a?o.push(i[a]+":"+r[t[a]]):o.push(i[a]+":"+t[a])),t.stylers&&t.stylers[a]&&o.push(i[a]+":"+t.stylers[a]);o.length>2&&n.push(o.join("|"))}return n.join(",")}}();